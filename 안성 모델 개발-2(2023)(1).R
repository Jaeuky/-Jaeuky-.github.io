{library(brnn)
  library(pls)
  library(pROC)
  library(mboost)
  library(e1071)
  library(arm)
  library(kernlab)
  library(caret)
  library(glmnet)
  library(mlbench)
  library(xlsx)
  library(psych)
  library(tidyverse)
  {library(vegan)
    library(ggplot2)
    library(reshape2)
    library(dplyr)
    library(rpart)
    library(randomForest)
    library(rfUtilities)
    library(nparcomp)
    library(lmtest)
    library(gridExtra)
    library(agricolae)
    library(indicspecies)
    library(caret)
    library(tidyverse)
    library(showtext)
    library(RColorBrewer)
    library(Hmisc)
    library(MASS)
    library(rcompanion)
    library(tidyverse)
    library(ggpubr)
    library(rstatix)
    library(datasets)
    library(ggplot2)
    library(multcompView)
    library(dplyr)#tukey normalization
    library(randomForest)
    library(rfUtilities)
    library(cluster)
    library(NbClust)
    library(kohonen)
    library(ggplot2)
    library(gridExtra)
    library(scales)
    library(readxl)
    library(timetk)
    library(forecast)}
  library(forecast)
  library(tsoutliers)
  library(stringr)
  library(lubridate)
  library(dendroTools)
  library(knitr)
  library(caret)
  library(glmnet)
  library(mlbench)
  library(psych)
  library(tidyverse)
  library(TTR)
  library(tseries)
  library(VMDecomp)
  library(glue)
  library(readxl)
  library(Fgmutils)
  library(broom)
  library(purrr)
  library(quantregForest)
  library(ranger)
  library(h2o)
  library(boot)
  library(AugmenterR)
}
library(ggmap)
# Sys.setenv(JAVA_HOME="C:/Program Files/Java/jre1.8.0_251")

setwd("D:/jaeuk/대학원/연구/2023 시계열 유류오염 예측/R_시계열 2023")

#안성 관정 총 9정
#관정 1 -> 수질인자 3개
#관정 2 -> 수질인자 3개
#관정 3 -> 수질인자 12개 -> 사용
#관정 4 -> 수질인자 12개 -> 사용
#관정 5 -> 수질인자 12개 -> 사용
#관정 6 -> 수질인자 12개 -> 사용
#관정 7 -> 수질인자 3개
#관정 8 -> 수질인자 12개 -> 사용
#관정 9 -> 수질인자 3개

#지도 Figure!
{
  register_google(key="AIzaSyDwglJs1oiUVKdmoQL_K0m-inCLmoXBgrY") #2023/10/15 갱신
  x = read.csv("안성 GPS.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  str(x)
  {
    x$latitude = as.numeric(x$latitude)
    x$longitude = as.numeric(x$longitude)
  }
  str(x)
  
  map01 = get_map(location=c(lon=127.5120, lat=37.0900),
                  zoom=15, maptype="satellite")
  
  ggmap(map01)+
    # geom_point(data = x, aes(x= longitude, y=latitude, color=factor(Site)), size = 8)+
    theme(#legend.position = c(130,35),
      legend.text = element_text(size=20),
      legend.key.size = unit(1,"cm"),
      legend.key.height = unit(1,"cm"),
      legend.title=element_blank(),
      axis.text = element_text(size=15),
      axis.title = element_text(size=18),
      title = element_text(size=25)) +
    xlab("longitude")+
    ylab("latitude") +
    scale_colour_manual(values=c("Well A"="white","Well B"="white", "Well C" = "white", "Well D" = "white", "Well E" = "white"))+
    ggtitle("Study area")
  
  
  map03 = get_map(location=c(lon=127.5120, lat=37.08552),
                  zoom=19, maptype="satellite")
  ggmap(map03)+
    geom_point(data = x, aes(x= longitude, y=latitude, color=factor(Site)), size = 10)+
    theme(#legend.position = c(130,35),
      legend.text = element_text(size=20),
      legend.key.size = unit(1,"cm"),
      legend.key.height = unit(1,"cm"),
      legend.title=element_blank(),
      axis.text = element_text(size=15),
      axis.title = element_text(size=18),
      title = element_text(size=25)) +
    xlab("longitude")+
    ylab("latitude") +
    scale_colour_manual(values=c("Well A"="white","Well B"="white", "Well C" = "white", "Well D" = "white", "Well E" = "white"))+
    ggtitle("Study area")
}
#DATA
{
  as3 <- read_excel("센서데이터_안성_3번.xlsx")
  as4 <- read_excel("센서데이터_안성_4번.xlsx")
  as5 <- read_excel("센서데이터_안성_5번.xlsx")
  as6 <- read_excel("센서데이터_안성_6번.xlsx")
  as8 <- read_excel("센서데이터_안성_8번.xlsx")
  
  head(as3)
  str(as3)
  head(as4)
  head(as5)
  head(as6)
  head(as8)
}
as4$timestamp = as.Date(as4$timestamp)
str(as3)
str(as4)
str(ca4)
{
  ast = rbind(as3,as4,as5,as6,as8)
  summary(ast$Cl)
  summary(ast$Depth)
  summary(ast$rdo)
  summary(ast$EC)
  summary(ast$NH3.N)
  summary(ast$NO3.N)
  summary(ast$ORP)
  summary(ast$pH)
  summary(ast$Salinity)
  summary(ast$TDS)
  summary(ast$Temp.)
  summary(ast$Turbidity)
  #as3
  summary(as3$Cl)
  summary(as3$Depth)
  summary(as3$rdo)
  summary(as3$EC)
  summary(as3$NH3.N)
  summary(as3$NO3.N)
  summary(as3$ORP)
  summary(as3$pH)
  summary(as3$Salinity)
  summary(as3$TDS)
  summary(as3$Temp.)
  summary(as3$Turbidity)
}
#===============================================================================
#==============================================================================
#기본 품질관리
{
  #관정 3
  as03 = as3
  {  
    as03$Depth[as03$Depth < 0.000000000001 | as03$Depth > 50] <- NA #none
    head(as03)
    p.dep1 = ggplot() + 
      geom_line(data = as03, aes(x = timestamp, y = Depth), color = "grey4")
    p.dep1
    
    as03$Temp.[as03$Temp. < 0.000000000001 | as03$Temp. > 50] <- NA #-5~50
    p.Temp1 = ggplot() + 
      geom_line(data = as03, aes(x = timestamp, y = Temp.), color = "grey4")
    p.Temp1
    
    as03$EC[as03$EC < 149.999999 | as03$EC > 350] <- NA #0~350
    p.EC1 = ggplot() +
      geom_line(data = as03, aes(x = timestamp, y = EC), color = "grey4")
    p.EC1
    
    as03$pH[as03$pH < 0.00000000000001 | as03$pH > 14] <- NA #0~14
    p.pa3 = ggplot() + 
      geom_line(data = as03, aes(x = timestamp, y = pH), color = "grey4")
    p.pa3
    
    as03$ORP[as03$ORP < -1400 | as03$ORP > 1400] <- NA #-1400 ~ 1400
    p.ORP1 = ggplot() +
      geom_line(data = as03, aes(x = timestamp, y = ORP), color = "grey4")
    p.ORP1
    
    as03$TDS[as03$TDS < 0.0000001 | as03$TDS > 350] <- NA #0~350
    p.TDS1 = ggplot() + 
      geom_line(data = as03, aes(x = timestamp, y = TDS), color = "grey4")
    p.TDS1
    
    as03$Salinity[as03$Salinity < 0.0000001 | as03$Salinity > 1] <- NA #0~1
    p.Salinity1 = ggplot() + 
      geom_line(data = as03, aes(x = timestamp, y = Salinity), color = "grey4")+
      xlab('Date') +
      ylab('Salinity')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Salinity") 
    p.Salinity1
    
    as03$rdo[as03$rdo < 0.0000001 | as03$rdo > 50] <- NA #0~50
    p.rdo1 = ggplot() +
      geom_line(data = as03, aes(x = timestamp, y = rdo), color = "grey4")
    p.rdo1
    
    as03$Turbidity[as03$Turbidity < 0.0000001 | as03$Turbidity > 1500] <- NA #0~1500
    p.Turbidity1 = ggplot() +
      geom_line(data = as03, aes(x = timestamp, y = Turbidity), color = "grey4")
    p.Turbidity1
    
    as03$NH3.N[as03$NH3.N < 0.0000001 | as03$NH3.N > 10000] <- NA #0~10,000
    p.NH3.N1 = ggplot() + 
      geom_line(data = as03, aes(x = timestamp, y = NH3.N), color = "grey4")
    p.NH3.N1
    
    as03$NO3.N[as03$NO3.N < 0.0000001 | as03$NO3.N > 40000] <- NA #0~40,000
    p.NO3.N1 = ggplot() + 
      geom_line(data = as03, aes(x = timestamp, y = NO3.N), color = "grey4")
    p.NO3.N1
    
    as03$Cl[as03$Cl < 0.0000001 | as03$Cl > 150000] <- NA #0~150,000
    p.Cl1 = ggplot() + 
      geom_line(data = as03, aes(x = timestamp, y = Cl), color = "grey4")
    p.Cl1
  }
  head(as03)
  #관정 4번
  as04 = as4
  {  
    as04$Depth[as04$Depth < 0.000000000001 | as04$Depth > 50] <- NA #none
    head(as04)
    p.dep1 = ggplot() + 
      geom_line(data = as04, aes(x = timestamp, y = Depth), color = "grey4")
    p.dep1
    
    as04$Temp.[as04$Temp. < 0.000000000001 | as04$Temp. > 50] <- NA #-5~50
    p.Temp1 = ggplot() + 
      geom_line(data = as04, aes(x = timestamp, y = Temp.), color = "grey4")
    p.Temp1
    
    as04$EC[as04$EC < 149.999999 | as04$EC > 350] <- NA #0~350
    p.EC1 = ggplot() +
      geom_line(data = as04, aes(x = timestamp, y = EC), color = "grey4")
    p.EC1
    
    as04$pH[as04$pH < 0.00000000000001 | as04$pH > 14] <- NA #0~14
    p.pH1 = ggplot() + 
      geom_line(data = as04, aes(x = timestamp, y = pH), color = "grey4")
    p.pH1
    
    as04$ORP[as04$ORP < -1400 | as04$ORP > 1400] <- NA #-1400 ~ 1400
    p.ORP1 = ggplot() +
      geom_line(data = as04, aes(x = timestamp, y = ORP), color = "grey4")
    p.ORP1
    
    as04$TDS[as04$TDS < 0.0000001 | as04$TDS > 350] <- NA #0~350
    p.TDS1 = ggplot() + 
      geom_line(data = as04, aes(x = timestamp, y = TDS), color = "grey4")
    p.TDS1
    
    as04$Salinity[as04$Salinity < 0.0000001 | as04$Salinity > 1] <- NA #0~1
    p.Salinity1 = ggplot() + 
      geom_line(data = as04, aes(x = timestamp, y = Salinity), color = "grey4")
    p.Salinity1
    
    as04$rdo[as04$rdo < 0.0000001 | as04$rdo > 50] <- NA #0~50
    p.rdo1 = ggplot() +
      geom_line(data = as04, aes(x = timestamp, y = rdo), color = "grey4")
    p.rdo1
    
    as04$Turbidity[as04$Turbidity < 0.0000001 | as04$Turbidity > 1500] <- NA #0~1500
    p.Turbidity1 = ggplot() +
      geom_line(data = as04, aes(x = timestamp, y = Turbidity), color = "grey4")
    p.Turbidity1
    
    as04$NH3.N[as04$NH3.N < 0.0000001 | as04$NH3.N > 10000] <- NA #0~10,000
    p.NH3.N1 = ggplot() + 
      geom_line(data = as04, aes(x = timestamp, y = NH3.N), color = "grey4")
    p.NH3.N1
    
    as04$NO3.N[as04$NO3.N < 0.0000001 | as04$NO3.N > 40000] <- NA #0~40,000
    p.NO3.N1 = ggplot() + 
      geom_line(data = as04, aes(x = timestamp, y = NO3.N), color = "grey4")
    p.NO3.N1
    
    as04$Cl[as04$Cl < 0.0000001 | as04$Cl > 150000] <- NA #0~150,000
    p.Cl1 = ggplot() + 
      geom_line(data = as04, aes(x = timestamp, y = Cl), color = "grey4")
    p.Cl1
  }
  head(as04)
  #관정 5번
  as05 = as5
  {  
    as05$Depth[as05$Depth < 0.000000000001 | as05$Depth > 50] <- NA #none
    head(as05)
    p.dep1 = ggplot() + 
      geom_line(data = as05, aes(x = timestamp, y = Depth), color = "grey4")
    p.dep1
    
    as05$Temp.[as05$Temp. < 0.000000000001 | as05$Temp. > 50] <- NA #-5~50
    p.Temp1 = ggplot() + 
      geom_line(data = as05, aes(x = timestamp, y = Temp.), color = "grey4")
    p.Temp1
    
    as05$EC[as05$EC < 149.999999 | as05$EC > 350] <- NA #0~350
    p.EC1 = ggplot() +
      geom_line(data = as05, aes(x = timestamp, y = EC), color = "grey4")
    p.EC1
    
    as05$pH[as05$pH < 0.00000000000001 | as05$pH > 14] <- NA #0~14
    p.pH3 = ggplot() + 
      geom_line(data = as05, aes(x = timestamp, y = pH), color = "grey4")
    p.pH3
    
    as05$ORP[as05$ORP < -1400 | as05$ORP > 1400] <- NA #-1400 ~ 1400
    p.ORP1 = ggplot() +
      geom_line(data = as05, aes(x = timestamp, y = ORP), color = "grey4")
    p.ORP1
    
    as05$TDS[as05$TDS < 0.0000001 | as05$TDS > 350] <- NA #0~350
    p.TDS1 = ggplot() + 
      geom_line(data = as05, aes(x = timestamp, y = TDS), color = "grey4")
    p.TDS1
    
    as05$Salinity[as05$Salinity < 0.0000001 | as05$Salinity > 1] <- NA #0~1
    p.Salinity1 = ggplot() + 
      geom_line(data = as05, aes(x = timestamp, y = Salinity), color = "grey4")
    p.Salinity1
    
    as05$rdo[as05$rdo < 0.0000001 | as05$rdo > 50] <- NA #0~50
    p.rdo1 = ggplot() +
      geom_line(data = as05, aes(x = timestamp, y = rdo), color = "grey4")
    p.rdo1
    
    as05$Turbidity[as05$Turbidity < 0.0000001 | as05$Turbidity > 1500] <- NA #0~1500
    p.Turbidity1 = ggplot() +
      geom_line(data = as05, aes(x = timestamp, y = Turbidity), color = "grey4")
    p.Turbidity1
    
    as05$NH3.N[as05$NH3.N < 0.0000001 | as05$NH3.N > 10000] <- NA #0~10,000
    p.NH3.N1 = ggplot() + 
      geom_line(data = as05, aes(x = timestamp, y = NH3.N), color = "grey4")
    p.NH3.N1
    
    as05$NO3.N[as05$NO3.N < 0.0000001 | as05$NO3.N > 40000] <- NA #0~40,000
    p.NO3.N1 = ggplot() + 
      geom_line(data = as05, aes(x = timestamp, y = NO3.N), color = "grey4")
    p.NO3.N1
    
    as05$Cl[as05$Cl < 0.0000001 | as05$Cl > 150000] <- NA #0~150,000
    p.Cl1 = ggplot() + 
      geom_line(data = as05, aes(x = timestamp, y = Cl), color = "grey4")
    p.Cl1
  }
  head(as05)
  #관정 6번
  as06 = as6
  {  
    as06$Depth[as06$Depth < 0.000000000001 | as06$Depth > 50] <- NA #none
    head(as06)
    p.dep1 = ggplot() + 
      geom_line(data = as06, aes(x = timestamp, y = Depth), color = "grey4")
    p.dep1
    
    as06$Temp.[as06$Temp. < 0.000000000001 | as06$Temp. > 50] <- NA #-5~50
    p.Temp1 = ggplot() + 
      geom_line(data = as06, aes(x = timestamp, y = Temp.), color = "grey4")
    p.Temp1
    
    as06$EC[as06$EC < 149.999999 | as06$EC > 350] <- NA #0~350
    p.EC1 = ggplot() +
      geom_line(data = as06, aes(x = timestamp, y = EC), color = "grey4")
    p.EC1
    
    as06$pH[as06$pH < 0.00000000000001 | as06$pH > 14] <- NA #0~14
    p.pa3 = ggplot() + 
      geom_line(data = as06, aes(x = timestamp, y = pH), color = "grey4")
    p.pa3
    
    as06$ORP[as06$ORP < -1400 | as06$ORP > 1400] <- NA #-1400 ~ 1400
    p.ORP1 = ggplot() +
      geom_line(data = as06, aes(x = timestamp, y = ORP), color = "grey4")
    p.ORP1
    
    as06$TDS[as06$TDS < 0.0000001 | as06$TDS > 350] <- NA #0~350
    p.TDS1 = ggplot() + 
      geom_line(data = as06, aes(x = timestamp, y = TDS), color = "grey4")
    p.TDS1
    
    as06$Salinity[as06$Salinity < 0.0000001 | as06$Salinity > 1] <- NA #0~1
    p.Salinity1 = ggplot() + 
      geom_line(data = as06, aes(x = timestamp, y = Salinity), color = "grey4")
    p.Salinity1
    
    as06$rdo[as06$rdo < 0.0000001 | as06$rdo > 50] <- NA #0~50
    p.rdo1 = ggplot() +
      geom_line(data = as06, aes(x = timestamp, y = rdo), color = "grey4")
    p.rdo1
    
    as06$Turbidity[as06$Turbidity < 0.0000001 | as06$Turbidity > 1500] <- NA #0~1500
    p.Turbidity1 = ggplot() +
      geom_line(data = as06, aes(x = timestamp, y = Turbidity), color = "grey4")
    p.Turbidity1
    
    as06$NH3.N[as06$NH3.N < 0.0000001 | as06$NH3.N > 10000] <- NA #0~10,000
    p.NH3.N1 = ggplot() + 
      geom_line(data = as06, aes(x = timestamp, y = NH3.N), color = "grey4")
    p.NH3.N1
    
    as06$NO3.N[as06$NO3.N < 0.0000001 | as06$NO3.N > 40000] <- NA #0~40,000
    p.NO3.N1 = ggplot() + 
      geom_line(data = as06, aes(x = timestamp, y = NO3.N), color = "grey4")
    p.NO3.N1
    
    as06$Cl[as06$Cl < 0.0000001 | as06$Cl > 150000] <- NA #0~150,000
    p.Cl1 = ggplot() + 
      geom_line(data = as06, aes(x = timestamp, y = Cl), color = "grey4")
    p.Cl1
  }
  head(as06)
  #관정 8번
  as08 = as8
  {  
    as08$Depth[as08$Depth < 0.000000000001 | as08$Depth > 50] <- NA #none
    head(as08)
    p.dep1 = ggplot() + 
      geom_line(data = as08, aes(x = timestamp, y = Depth), color = "grey4")
    p.dep1
    
    as08$Temp.[as08$Temp. < 0.000000000001 | as08$Temp. > 50] <- NA #-5~50
    p.Temp1 = ggplot() + 
      geom_line(data = as08, aes(x = timestamp, y = Temp.), color = "grey4")
    p.Temp1
    
    as08$EC[as08$EC < 149.999999 | as08$EC > 350] <- NA #0~350
    p.EC1 = ggplot() +
      geom_line(data = as08, aes(x = timestamp, y = EC), color = "grey4")
    p.EC1
    
    as08$pH[as08$pH < 0.00000000000001 | as08$pH > 14] <- NA #0~14
    p.pa3 = ggplot() + 
      geom_line(data = as08, aes(x = timestamp, y = pH), color = "grey4")
    p.pa3
    
    as08$ORP[as08$ORP < -1400 | as08$ORP > 1400] <- NA #-1400 ~ 1400
    p.ORP1 = ggplot() +
      geom_line(data = as08, aes(x = timestamp, y = ORP), color = "grey4")
    p.ORP1
    
    as08$TDS[as08$TDS < 0.0000001 | as08$TDS > 350] <- NA #0~350
    p.TDS1 = ggplot() + 
      geom_line(data = as08, aes(x = timestamp, y = TDS), color = "grey4")
    p.TDS1
    
    as08$Salinity[as08$Salinity < 0.0000001 | as08$Salinity > 1] <- NA #0~1
    p.Salinity1 = ggplot() + 
      geom_line(data = as08, aes(x = timestamp, y = Salinity), color = "grey4")
    p.Salinity1
    
    as08$rdo[as08$rdo < 0.0000001 | as08$rdo > 50] <- NA #0~50
    p.rdo1 = ggplot() +
      geom_line(data = as08, aes(x = timestamp, y = rdo), color = "grey4")
    p.rdo1
    
    as08$Turbidity[as08$Turbidity < 0.0000001 | as08$Turbidity > 1500] <- NA #0~1500
    p.Turbidity1 = ggplot() +
      geom_line(data = as08, aes(x = timestamp, y = Turbidity), color = "grey4")
    p.Turbidity1
    
    as08$NH3.N[as08$NH3.N < 0.0000001 | as08$NH3.N > 10000] <- NA #0~10,000
    p.NH3.N1 = ggplot() + 
      geom_line(data = as08, aes(x = timestamp, y = NH3.N), color = "grey4")
    p.NH3.N1
    
    as08$NO3.N[as08$NO3.N < 0.0000001 | as08$NO3.N > 40000] <- NA #0~40,000
    p.NO3.N1 = ggplot() + 
      geom_line(data = as08, aes(x = timestamp, y = NO3.N), color = "grey4")
    p.NO3.N1
    
    as08$Cl[as08$Cl < 0.0000001 | as08$Cl > 150000] <- NA #0~150,000
    p.Cl1 = ggplot() + 
      geom_line(data = as08, aes(x = timestamp, y = Cl), color = "grey4")
    p.Cl1
  }
  head(as08)
}
#===============================================================================
#하루단위 이상치 보정
{
  as003 =as03
  as004 =as04
  as005 =as05
  as006 =as06
  as008 =as08
  str(as003)
  as003$Date = as.Date(as003$timestamp)
  str(as003)
  head(as003)
  as004$Date = as.Date(as004$timestamp)
  as005$Date = as.Date(as005$timestamp)
  as006$Date = as.Date(as006$timestamp)
  as008$Date = as.Date(as008$timestamp)
  
  head(as003)
  head(as004)
  head(as005)
  head(as006)
  head(as008)
  
  #forecastML, dplyr 패키지 껐다가 다시 켜기!!!!
  
  #안성 관정 3-----------------
  {
    a = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Depth = mean(Depth))
    head(a)
    
    a1 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Temp. = mean(Temp.))
    head(a1)
    
    a2 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(pH = mean(pH))
    head(a2)
    
    a3 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(ORP = mean(ORP))
    head(a3)
    
    a4 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(EC = mean(EC))
    
    a5 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(rdo = mean(rdo))
    
    a6 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Turbidity = mean(Turbidity))
    
    a7 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(TDS = mean(TDS))
    
    a8 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Salinity = mean(Salinity))
    
    a9 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(NH3.N = mean(NH3.N))
    
    a10 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(NO3.N = mean(NO3.N))
    
    a11 = as003 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Cl = mean(Cl))
    
    a12 = cbind(a,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)
    # a12 = cbind(a,a1,a3,a5,a6,a9,a10,a11)
    head(a12)
    names(a12)[1] <- c("Date")
    a12 = a12[c(1,2,4,6,8,10,12,14,16,18,20,22,24)]
  }
  head(a12)
  # write.xlsx(a12, '원센서 하루단위 안성3.xlsx')
  #그다음에 만들어진 데이터를 이상치 보정
  df = a12
  head(df)
  {df$Depth = as.numeric(df$Depth)
    df$Temp. = as.numeric(df$Temp.)
    df$EC = as.numeric(df$EC)
    df$pH = as.numeric(df$pH)
    df$ORP = as.numeric(df$ORP)
    df$TDS = as.numeric(df$TDS)
    df$Salinity = as.numeric(df$Salinity)
    df$rdo = as.numeric(df$rdo)
    df$Turbidity = as.numeric(df$Turbidity)
    df$NH3.N = as.numeric(df$NH3.N)
    df$NO3.N = as.numeric(df$NO3.N)
    df$Cl = as.numeric(df$Cl)
  }
  str(df)
  {
    x_num <- as.numeric(unlist(df$Depth))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c = tsclean(x_num)
    c = as.data.frame(c)
    head(c)
    
    #Temp.
    x_num <- as.numeric(unlist(df$Temp.))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c1 = tsclean(x_num)
    c1= as.data.frame(c1)
    head(c1)
    
    #pH
    x_num <- as.numeric(unlist(df$pH))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c2 = tsclean(x_num)
    c2= as.data.frame(c2)
    head(c2)
    
    #ORP
    x_num <- as.numeric(unlist(df$ORP))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c3 = tsclean(x_num)
    c3= as.data.frame(c3)
    head(c3)
    
    #EC
    x_num <- as.numeric(unlist(df$EC))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c4 = tsclean(x_num)
    c4= as.data.frame(c4)
    head(c4)
    
    #rdo
    x_num <- as.numeric(unlist(df$rdo))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c5 = tsclean(x_num)
    c5= as.data.frame(c5)
    head(c5)
    
    #Turbidity
    x_num <- as.numeric(unlist(df$Turbidity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c6 = tsclean(x_num)
    c6= as.data.frame(c6)
    head(c6)
    
    #TDS
    x_num <- as.numeric(unlist(df$TDS))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c7 = tsclean(x_num)
    c7= as.data.frame(c7)
    head(c7)
    
    #Salinity
    x_num <- as.numeric(unlist(df$Salinity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c8 = tsclean(x_num)
    c8= as.data.frame(c8)
    head(c8)
    
    #NH3.N
    x_num <- as.numeric(unlist(df$NH3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c9 = tsclean(x_num)
    c9= as.data.frame(c9)
    head(c9)
    
    #NO3.N
    x_num <- as.numeric(unlist(df$NO3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c10 = tsclean(x_num)
    c10= as.data.frame(c10)
    head(c10)
    
    #Cl
    x_num <- as.numeric(unlist(df$Cl))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c11 = tsclean(x_num)
    c11= as.data.frame(c11)
    head(c11)
  }
  c12 = cbind(df$Date, c,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11)
  head(c12)
  {
    names(c12)[1] <- c("Date")
    names(c12)[2] <- c("Depth.pp")
    names(c12)[3] <- c("Temperature.pp")
    names(c12)[4] <- c("pH.pp")
    names(c12)[5] <- c("ORP.pp")
    names(c12)[6] <- c("EC.pp")
    names(c12)[7] <- c("DO.pp")
    names(c12)[8] <- c("Turbidity.pp")
    names(c12)[9] <- c("TDS.pp")
    names(c12)[10] <- c("Salinity.pp")
    names(c12)[11] <- c("NH3.N.pp")
    names(c12)[12] <- c("NO3.N.pp")
    names(c12)[13] <- c("Cl.pp")
  }
  head(c12)
  c12$Date = as.Date(c12$Date)
  head(c12)
  # write.xlsx(c12, '품질관리(12개인자) 안성3.xlsx')
  
  #안성 관정 4-----------------
  {  
    a = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Depth = mean(Depth))
    head(a)
    
    a1 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Temp. = mean(Temp.))
    head(a1)
    
    a2 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(pH = mean(pH))
    head(a2)
    
    a3 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(ORP = mean(ORP))
    head(a3)
    
    a4 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(EC = mean(EC))
    
    a5 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(rdo = mean(rdo))
    
    a6 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Turbidity = mean(Turbidity))
    
    a7 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(TDS = mean(TDS))
    
    a8 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Salinity = mean(Salinity))
    
    a9 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(NH3.N = mean(NH3.N))
    
    a10 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(NO3.N = mean(NO3.N))
    
    a11 = as004 %>%
      mutate(date = floor_date(Date)) %>%
      group_by(date) %>%
      summarise(Cl = mean(Cl))
    
    a12 = cbind(a,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)
    # a12 = cbind(a,a1,a3,a5,a6,a9,a10,a11)
    head(a12)
    names(a12)[1] <- c("Date")
    a12 = a12[c(1,2,4,6,8,10,12,14,16,18,20,22,24)]
  }
  head(a12)
  # write.xlsx(a12, '원센서 하루단위 안성4.xlsx')
  #그다음에 만들어진 데이터를 이상치 보정
  df = a12
  head(df)
  {df$Depth = as.numeric(df$Depth)
    df$Temp. = as.numeric(df$Temp.)
    df$EC = as.numeric(df$EC)
    df$pH = as.numeric(df$pH)
    df$ORP = as.numeric(df$ORP)
    df$TDS = as.numeric(df$TDS)
    df$Salinity = as.numeric(df$Salinity)
    df$rdo = as.numeric(df$rdo)
    df$Turbidity = as.numeric(df$Turbidity)
    df$NH3.N = as.numeric(df$NH3.N)
    df$NO3.N = as.numeric(df$NO3.N)
    df$Cl = as.numeric(df$Cl)
  }
  str(df)
  {  x_num <- as.numeric(unlist(df$Depth))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c = tsclean(x_num)
    c = as.data.frame(c)
    head(c)
    
    #Temp.
    x_num <- as.numeric(unlist(df$Temp.))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c1 = tsclean(x_num)
    c1= as.data.frame(c1)
    head(c1)
    
    #pH
    x_num <- as.numeric(unlist(df$pH))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c2 = tsclean(x_num)
    c2= as.data.frame(c2)
    head(c2)
    
    #ORP
    x_num <- as.numeric(unlist(df$ORP))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c3 = tsclean(x_num)
    c3= as.data.frame(c3)
    head(c3)
    
    #EC
    x_num <- as.numeric(unlist(df$EC))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c4 = tsclean(x_num)
    c4= as.data.frame(c4)
    head(c4)
    
    #rdo
    x_num <- as.numeric(unlist(df$rdo))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c5 = tsclean(x_num)
    c5= as.data.frame(c5)
    head(c5)
    
    #Turbidity
    x_num <- as.numeric(unlist(df$Turbidity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c6 = tsclean(x_num)
    c6= as.data.frame(c6)
    head(c6)
    
    #TDS
    x_num <- as.numeric(unlist(df$TDS))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c7 = tsclean(x_num)
    c7= as.data.frame(c7)
    head(c7)
    
    #Salinity
    x_num <- as.numeric(unlist(df$Salinity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c8 = tsclean(x_num)
    c8= as.data.frame(c8)
    head(c8)
    
    #NH3.N
    x_num <- as.numeric(unlist(df$NH3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c9 = tsclean(x_num)
    c9= as.data.frame(c9)
    head(c9)
    
    #NO3.N
    x_num <- as.numeric(unlist(df$NO3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c10 = tsclean(x_num)
    c10= as.data.frame(c10)
    head(c10)
    
    #Cl
    x_num <- as.numeric(unlist(df$Cl))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c11 = tsclean(x_num)
    c11= as.data.frame(c11)
    head(c11)
  }
  c12 = cbind(df$Date, c,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11)
  head(c12)
  {  names(c12)[1] <- c("Date")
    names(c12)[2] <- c("Depth.pp")
    names(c12)[3] <- c("Temperature.pp")
    names(c12)[4] <- c("pH.pp")
    names(c12)[5] <- c("ORP.pp")
    names(c12)[6] <- c("EC.pp")
    names(c12)[7] <- c("DO.pp")
    names(c12)[8] <- c("Turbidity.pp")
    names(c12)[9] <- c("TDS.pp")
    names(c12)[10] <- c("Salinity.pp")
    names(c12)[11] <- c("NH3.N.pp")
    names(c12)[12] <- c("NO3.N.pp")
    names(c12)[13] <- c("Cl.pp")
  }
  head(c12)
  c12$Date = as.Date(c12$Date)
  head(c12)
  # write.xlsx(c12, '품질관리(12개인자) 안성4.xlsx')
  
  #안성 관정 5-----------------
  {  a = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Depth = mean(Depth))
  head(a)
  
  a1 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Temp. = mean(Temp.))
  head(a1)
  
  a2 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(pH = mean(pH))
  head(a2)
  
  a3 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(ORP = mean(ORP))
  head(a3)
  
  a4 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(EC = mean(EC))
  
  a5 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(rdo = mean(rdo))
  
  a6 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Turbidity = mean(Turbidity))
  
  a7 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(TDS = mean(TDS))
  
  a8 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Salinity = mean(Salinity))
  
  a9 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(NH3.N = mean(NH3.N))
  
  a10 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(NO3.N = mean(NO3.N))
  
  a11 = as005 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Cl = mean(Cl))
  
  a12 = cbind(a,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)
  # a12 = cbind(a,a1,a3,a5,a6,a9,a10,a11)
  head(a12)
  names(a12)[1] <- c("Date")
  a12 = a12[c(1,2,4,6,8,10,12,14,16,18,20,22,24)]
  }
  head(a12)
  # write.xlsx(a12, '원센서 하루단위 안성5.xlsx')
  #그다음에 만들어진 데이터를 이상치 보정
  df = a12
  head(df)
  {df$Depth = as.numeric(df$Depth)
    df$Temp. = as.numeric(df$Temp.)
    df$EC = as.numeric(df$EC)
    df$pH = as.numeric(df$pH)
    df$ORP = as.numeric(df$ORP)
    df$TDS = as.numeric(df$TDS)
    df$Salinity = as.numeric(df$Salinity)
    df$rdo = as.numeric(df$rdo)
    df$Turbidity = as.numeric(df$Turbidity)
    df$NH3.N = as.numeric(df$NH3.N)
    df$NO3.N = as.numeric(df$NO3.N)
    df$Cl = as.numeric(df$Cl)
  }
  str(df)
  {  x_num <- as.numeric(unlist(df$Depth))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c = tsclean(x_num)
    c = as.data.frame(c)
    head(c)
    
    #Temp.
    x_num <- as.numeric(unlist(df$Temp.))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c1 = tsclean(x_num)
    c1= as.data.frame(c1)
    head(c1)
    
    #pH
    x_num <- as.numeric(unlist(df$pH))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c2 = tsclean(x_num)
    c2= as.data.frame(c2)
    head(c2)
    
    #ORP
    x_num <- as.numeric(unlist(df$ORP))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c3 = tsclean(x_num)
    c3= as.data.frame(c3)
    head(c3)
    
    #EC
    x_num <- as.numeric(unlist(df$EC))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c4 = tsclean(x_num)
    c4= as.data.frame(c4)
    head(c4)
    
    #rdo
    x_num <- as.numeric(unlist(df$rdo))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c5 = tsclean(x_num)
    c5= as.data.frame(c5)
    head(c5)
    
    #Turbidity
    x_num <- as.numeric(unlist(df$Turbidity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c6 = tsclean(x_num)
    c6= as.data.frame(c6)
    head(c6)
    
    #TDS
    x_num <- as.numeric(unlist(df$TDS))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c7 = tsclean(x_num)
    c7= as.data.frame(c7)
    head(c7)
    
    #Salinity
    x_num <- as.numeric(unlist(df$Salinity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c8 = tsclean(x_num)
    c8= as.data.frame(c8)
    head(c8)
    
    #NH3.N
    x_num <- as.numeric(unlist(df$NH3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c9 = tsclean(x_num)
    c9= as.data.frame(c9)
    head(c9)
    
    #NO3.N
    x_num <- as.numeric(unlist(df$NO3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c10 = tsclean(x_num)
    c10= as.data.frame(c10)
    head(c10)
    
    #Cl
    x_num <- as.numeric(unlist(df$Cl))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c11 = tsclean(x_num)
    c11= as.data.frame(c11)
    head(c11)
  }
  c12 = cbind(df$Date, c,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11)
  head(c12)
  {  names(c12)[1] <- c("Date")
    names(c12)[2] <- c("Depth.pp")
    names(c12)[3] <- c("Temperature.pp")
    names(c12)[4] <- c("pH.pp")
    names(c12)[5] <- c("ORP.pp")
    names(c12)[6] <- c("EC.pp")
    names(c12)[7] <- c("DO.pp")
    names(c12)[8] <- c("Turbidity.pp")
    names(c12)[9] <- c("TDS.pp")
    names(c12)[10] <- c("Salinity.pp")
    names(c12)[11] <- c("NH3.N.pp")
    names(c12)[12] <- c("NO3.N.pp")
    names(c12)[13] <- c("Cl.pp")
  }
  head(c12)
  c12$Date = as.Date(c12$Date)
  head(c12)
  # write.xlsx(c12, '품질관리(12개인자) 안성5.xlsx')
  
  #안성 관정 6-----------------
  {  a = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Depth = mean(Depth))
  head(a)
  
  a1 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Temp. = mean(Temp.))
  head(a1)
  
  a2 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(pH = mean(pH))
  head(a2)
  
  a3 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(ORP = mean(ORP))
  head(a3)
  
  a4 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(EC = mean(EC))
  
  a5 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(rdo = mean(rdo))
  
  a6 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Turbidity = mean(Turbidity))
  
  a7 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(TDS = mean(TDS))
  
  a8 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Salinity = mean(Salinity))
  
  a9 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(NH3.N = mean(NH3.N))
  
  a10 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(NO3.N = mean(NO3.N))
  
  a11 = as006 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Cl = mean(Cl))
  
  a12 = cbind(a,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)
  # a12 = cbind(a,a1,a3,a5,a6,a9,a10,a11)
  head(a12)
  names(a12)[1] <- c("Date")
  a12 = a12[c(1,2,4,6,8,10,12,14,16,18,20,22,24)]
  }
  head(a12)
  # write.xlsx(a12, '원센서 하루단위 안성6.xlsx')
  #그다음에 만들어진 데이터를 이상치 보정
  df = a12
  head(df)
  {df$Depth = as.numeric(df$Depth)
    df$Temp. = as.numeric(df$Temp.)
    df$EC = as.numeric(df$EC)
    df$pH = as.numeric(df$pH)
    df$ORP = as.numeric(df$ORP)
    df$TDS = as.numeric(df$TDS)
    df$Salinity = as.numeric(df$Salinity)
    df$rdo = as.numeric(df$rdo)
    df$Turbidity = as.numeric(df$Turbidity)
    df$NH3.N = as.numeric(df$NH3.N)
    df$NO3.N = as.numeric(df$NO3.N)
    df$Cl = as.numeric(df$Cl)
  }
  str(df)
  {  x_num <- as.numeric(unlist(df$Depth))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c = tsclean(x_num)
    c = as.data.frame(c)
    head(c)
    
    #Temp.
    x_num <- as.numeric(unlist(df$Temp.))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c1 = tsclean(x_num)
    c1= as.data.frame(c1)
    head(c1)
    
    #pH
    x_num <- as.numeric(unlist(df$pH))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c2 = tsclean(x_num)
    c2= as.data.frame(c2)
    head(c2)
    
    #ORP
    x_num <- as.numeric(unlist(df$ORP))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c3 = tsclean(x_num)
    c3= as.data.frame(c3)
    head(c3)
    
    #EC
    x_num <- as.numeric(unlist(df$EC))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c4 = tsclean(x_num)
    c4= as.data.frame(c4)
    head(c4)
    
    #rdo
    x_num <- as.numeric(unlist(df$rdo))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c5 = tsclean(x_num)
    c5= as.data.frame(c5)
    head(c5)
    
    #Turbidity
    x_num <- as.numeric(unlist(df$Turbidity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c6 = tsclean(x_num)
    c6= as.data.frame(c6)
    head(c6)
    
    #TDS
    x_num <- as.numeric(unlist(df$TDS))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c7 = tsclean(x_num)
    c7= as.data.frame(c7)
    head(c7)
    
    #Salinity
    x_num <- as.numeric(unlist(df$Salinity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c8 = tsclean(x_num)
    c8= as.data.frame(c8)
    head(c8)
    
    #NH3.N
    x_num <- as.numeric(unlist(df$NH3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c9 = tsclean(x_num)
    c9= as.data.frame(c9)
    head(c9)
    
    #NO3.N
    x_num <- as.numeric(unlist(df$NO3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c10 = tsclean(x_num)
    c10= as.data.frame(c10)
    head(c10)
    
    #Cl
    x_num <- as.numeric(unlist(df$Cl))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c11 = tsclean(x_num)
    c11= as.data.frame(c11)
    head(c11)
  }
  c12 = cbind(df$Date, c,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11)
  head(c12)
  {  names(c12)[1] <- c("Date")
    names(c12)[2] <- c("Depth.pp")
    names(c12)[3] <- c("Temperature.pp")
    names(c12)[4] <- c("pH.pp")
    names(c12)[5] <- c("ORP.pp")
    names(c12)[6] <- c("EC.pp")
    names(c12)[7] <- c("DO.pp")
    names(c12)[8] <- c("Turbidity.pp")
    names(c12)[9] <- c("TDS.pp")
    names(c12)[10] <- c("Salinity.pp")
    names(c12)[11] <- c("NH3.N.pp")
    names(c12)[12] <- c("NO3.N.pp")
    names(c12)[13] <- c("Cl.pp")
  }
  head(c12)
  c12$Date = as.Date(c12$Date)
  head(c12)
  # write.xlsx(c12, '품질관리(12개인자) 안성6.xlsx')
  
  #안성 관정 8-----------------
  {  a = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Depth = mean(Depth))
  head(a)
  
  a1 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Temp. = mean(Temp.))
  head(a1)
  
  a2 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(pH = mean(pH))
  head(a2)
  
  a3 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(ORP = mean(ORP))
  head(a3)
  
  a4 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(EC = mean(EC))
  
  a5 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(rdo = mean(rdo))
  
  a6 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Turbidity = mean(Turbidity))
  
  a7 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(TDS = mean(TDS))
  
  a8 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Salinity = mean(Salinity))
  
  a9 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(NH3.N = mean(NH3.N))
  
  a10 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(NO3.N = mean(NO3.N))
  
  a11 = as008 %>%
    mutate(date = floor_date(Date)) %>%
    group_by(date) %>%
    summarise(Cl = mean(Cl))
  
  a12 = cbind(a,a1,a2,a3,a4,a5,a6,a7,a8,a9,a10,a11)
  # a12 = cbind(a,a1,a3,a5,a6,a9,a10,a11)
  head(a12)
  names(a12)[1] <- c("Date")
  a12 = a12[c(1,2,4,6,8,10,12,14,16,18,20,22,24)]
  }
  head(a12)
  # write.xlsx(a12, '원센서 하루단위 안성8.xlsx')
  #그다음에 만들어진 데이터를 이상치 보정
  df = a12
  head(df)
  {df$Depth = as.numeric(df$Depth)
    df$Temp. = as.numeric(df$Temp.)
    df$EC = as.numeric(df$EC)
    df$pH = as.numeric(df$pH)
    df$ORP = as.numeric(df$ORP)
    df$TDS = as.numeric(df$TDS)
    df$Salinity = as.numeric(df$Salinity)
    df$rdo = as.numeric(df$rdo)
    df$Turbidity = as.numeric(df$Turbidity)
    df$NH3.N = as.numeric(df$NH3.N)
    df$NO3.N = as.numeric(df$NO3.N)
    df$Cl = as.numeric(df$Cl)
  }
  str(df)
  {  x_num <- as.numeric(unlist(df$Depth))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c = tsclean(x_num)
    c = as.data.frame(c)
    head(c)
    
    #Temp.
    x_num <- as.numeric(unlist(df$Temp.))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c1 = tsclean(x_num)
    c1= as.data.frame(c1)
    head(c1)
    
    #pH
    x_num <- as.numeric(unlist(df$pH))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c2 = tsclean(x_num)
    c2= as.data.frame(c2)
    head(c2)
    
    #ORP
    x_num <- as.numeric(unlist(df$ORP))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c3 = tsclean(x_num)
    c3= as.data.frame(c3)
    head(c3)
    
    #EC
    x_num <- as.numeric(unlist(df$EC))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c4 = tsclean(x_num)
    c4= as.data.frame(c4)
    head(c4)
    
    #rdo
    x_num <- as.numeric(unlist(df$rdo))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c5 = tsclean(x_num)
    c5= as.data.frame(c5)
    head(c5)
    
    #Turbidity
    x_num <- as.numeric(unlist(df$Turbidity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c6 = tsclean(x_num)
    c6= as.data.frame(c6)
    head(c6)
    
    #TDS
    x_num <- as.numeric(unlist(df$TDS))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c7 = tsclean(x_num)
    c7= as.data.frame(c7)
    head(c7)
    
    #Salinity
    x_num <- as.numeric(unlist(df$Salinity))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c8 = tsclean(x_num)
    c8= as.data.frame(c8)
    head(c8)
    
    #NH3.N
    x_num <- as.numeric(unlist(df$NH3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c9 = tsclean(x_num)
    c9= as.data.frame(c9)
    head(c9)
    
    #NO3.N
    x_num <- as.numeric(unlist(df$NO3.N))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c10 = tsclean(x_num)
    c10= as.data.frame(c10)
    head(c10)
    
    #Cl
    x_num <- as.numeric(unlist(df$Cl))
    b = tsoutliers(x_num)
    b = as.data.frame(b)
    c11 = tsclean(x_num)
    c11= as.data.frame(c11)
    head(c11)
  }
  c12 = cbind(df$Date, c,c1,c2,c3,c4,c5,c6,c7,c8,c9,c10,c11)
  head(c12)
  {  names(c12)[1] <- c("Date")
    names(c12)[2] <- c("Depth.pp")
    names(c12)[3] <- c("Temperature.pp")
    names(c12)[4] <- c("pH.pp")
    names(c12)[5] <- c("ORP.pp")
    names(c12)[6] <- c("EC.pp")
    names(c12)[7] <- c("DO.pp")
    names(c12)[8] <- c("Turbidity.pp")
    names(c12)[9] <- c("TDS.pp")
    names(c12)[10] <- c("Salinity.pp")
    names(c12)[11] <- c("NH3.N.pp")
    names(c12)[12] <- c("NO3.N.pp")
    names(c12)[13] <- c("Cl.pp")
  }
  head(c12)
  c12$Date = as.Date(c12$Date)
  head(c12)
  # write.xlsx(c12, '품질관리(12개인자) 안성8.xlsx')
}
#===============================================================================
#한 관정 내에서 일정한 값이 총 데이터 중에 몇개인지 파악하기 -> 50%이상이 일정한 값이면 해당인자는 연구(보정 및 예측)에서 제외!
{
  as03 <- read_excel("품질관리(12개인자) 안성3.xlsx")
  as04 <- read_excel("품질관리(12개인자) 안성4.xlsx")
  as05 <- read_excel("품질관리(12개인자) 안성5.xlsx")
  as06 <- read_excel("품질관리(12개인자) 안성6.xlsx")
  as08 <- read_excel("품질관리(12개인자) 안성8.xlsx")
  
  as03$Date = as.Date(as03$Date)
  as04$Date = as.Date(as04$Date)
  as05$Date = as.Date(as05$Date)
  as06$Date = as.Date(as06$Date)
  as08$Date = as.Date(as08$Date)
  str(as03)
  str(as04)
  str(as05)
  str(as06)
  str(as08)
  
  head(as03)
  head(as04)
  head(as05)
  head(as06)
  head(as08)
  
  #안성 관정3
  head(as03) #545
  
  summary(as03$Depth.pp)
  as03$Depth.pp = as.character(as03$Depth.pp)
  td = as.data.frame(table(as03$Depth.pp))
  summary(td)
  
  summary(as03$Temperature.pp)
  as03$Temperature.pp = as.character(as03$Temperature.pp)
  td = as.data.frame(table(as03$Temperature.pp))
  summary(td)
  
  summary(as03$pH.pp)
  as03$pH.pp = as.character(as03$pH.pp)
  td = as.data.frame(table(as03$pH.pp))
  summary(td)
  
  summary(as03$ORP.pp)
  as03$ORP.pp = as.character(as03$ORP.pp)
  td = as.data.frame(table(as03$ORP.pp))
  summary(td)
  
  summary(as03$EC.pp)
  as03$EC.pp = as.character(as03$EC.pp)
  td = as.data.frame(table(as03$EC.pp))
  summary(td)
  
  summary(as03$DO.pp) #303개가 일정 값 -> 300/545 -> 제거
  as03$DO.pp = as.character(as03$DO.pp)
  td = as.data.frame(table(as03$DO.pp))
  summary(td)
  
  summary(as03$Turbidity.pp)
  as03$Turbidity.pp = as.character(as03$Turbidity.pp)
  td = as.data.frame(table(as03$Turbidity.pp))
  summary(td)
  
  summary(as03$TDS.pp)
  as03$TDS.pp = as.character(as03$TDS.pp)
  td = as.data.frame(table(as03$TDS.pp))
  summary(td)
  
  summary(as03$Salinity.pp)
  as03$Salinity.pp = as.character(as03$Salinity.pp)
  td = as.data.frame(table(as03$Salinity.pp))
  summary(td)
  
  summary(as03$NH3.N.pp)
  as03$NH3.N.pp = as.character(as03$NH3.N.pp)
  td = as.data.frame(table(as03$NH3.N.pp))
  summary(td)
  
  summary(as03$NO3.N.pp)
  as03$NO3.N.pp = as.character(as03$NO3.N.pp)
  td = as.data.frame(table(as03$NO3.N.pp))
  summary(td)
  
  summary(as03$Cl.pp)
  as03$Cl.pp = as.character(as03$Cl.pp)
  td = as.data.frame(table(as03$Cl.pp))
  summary(td)
  
  #안성 관정4
  head(as04) #1330
  
  summary(as04$Depth.pp)
  as04$Depth.pp = as.character(as04$Depth.pp)
  td = as.data.frame(table(as04$Depth.pp))
  summary(td)
  
  summary(as04$Temperature.pp)
  as04$Temperature.pp = as.character(as04$Temperature.pp)
  td = as.data.frame(table(as04$Temperature.pp))
  summary(td)
  
  summary(as04$pH.pp)
  as04$pH.pp = as.character(as04$pH.pp)
  td = as.data.frame(table(as04$pH.pp))
  summary(td)
  
  summary(as04$ORP.pp)
  as04$ORP.pp = as.character(as04$ORP.pp)
  td = as.data.frame(table(as04$ORP.pp))
  summary(td)
  
  summary(as04$EC.pp) #547개가 일정 값 -> 간당하지만 패스
  as04$EC.pp = as.character(as04$EC.pp)
  td = as.data.frame(table(as04$EC.pp))
  summary(td)
  
  summary(as04$DO.pp) #1275개가 일정 값 -> 1275/1330 -> 제거
  as04$DO.pp = as.character(as04$DO.pp)
  td = as.data.frame(table(as04$DO.pp))
  summary(td)
  
  summary(as04$Turbidity.pp)
  as04$Turbidity.pp = as.character(as04$Turbidity.pp)
  td = as.data.frame(table(as04$Turbidity.pp))
  summary(td)
  
  summary(as04$TDS.pp)
  as04$TDS.pp = as.character(as04$TDS.pp)
  td = as.data.frame(table(as04$TDS.pp))
  summary(td)
  
  summary(as04$Salinity.pp)
  as04$Salinity.pp = as.character(as04$Salinity.pp)
  td = as.data.frame(table(as04$Salinity.pp))
  summary(td)
  
  summary(as04$NH3.N.pp)
  as04$NH3.N.pp = as.character(as04$NH3.N.pp)
  td = as.data.frame(table(as04$NH3.N.pp))
  summary(td)
  
  summary(as04$NO3.N.pp)
  as04$NO3.N.pp = as.character(as04$NO3.N.pp)
  td = as.data.frame(table(as04$NO3.N.pp))
  summary(td)
  
  summary(as04$Cl.pp)
  as04$Cl.pp = as.character(as04$Cl.pp)
  td = as.data.frame(table(as04$Cl.pp))
  summary(td)
  
  #안성 관정5
  head(as05) #820
  
  summary(as05$Depth.pp)
  as05$Depth.pp = as.character(as05$Depth.pp)
  td = as.data.frame(table(as05$Depth.pp))
  summary(td)
  
  summary(as05$Temperature.pp)
  as05$Temperature.pp = as.character(as05$Temperature.pp)
  td = as.data.frame(table(as05$Temperature.pp))
  summary(td)
  
  summary(as05$pH.pp)
  as05$pH.pp = as.character(as05$pH.pp)
  td = as.data.frame(table(as05$pH.pp))
  summary(td)
  
  summary(as05$ORP.pp)
  as05$ORP.pp = as.character(as05$ORP.pp)
  td = as.data.frame(table(as05$ORP.pp))
  summary(td)
  
  summary(as05$EC.pp)
  as05$EC.pp = as.character(as05$EC.pp)
  td = as.data.frame(table(as05$EC.pp))
  summary(td)
  
  summary(as05$DO.pp) #618개가 일정 값 -> 618/820 -> 제거
  as05$DO.pp = as.character(as05$DO.pp)
  td = as.data.frame(table(as05$DO.pp))
  summary(td)
  
  summary(as05$Turbidity.pp)
  as05$Turbidity.pp = as.character(as05$Turbidity.pp)
  td = as.data.frame(table(as05$Turbidity.pp))
  summary(td)
  
  summary(as05$TDS.pp)
  as05$TDS.pp = as.character(as05$TDS.pp)
  td = as.data.frame(table(as05$TDS.pp))
  summary(td)
  
  summary(as05$Salinity.pp)
  as05$Salinity.pp = as.character(as05$Salinity.pp)
  td = as.data.frame(table(as05$Salinity.pp))
  summary(td)
  
  summary(as05$NH3.N.pp)
  as05$NH3.N.pp = as.character(as05$NH3.N.pp)
  td = as.data.frame(table(as05$NH3.N.pp))
  summary(td)
  
  summary(as05$NO3.N.pp)
  as05$NO3.N.pp = as.character(as05$NO3.N.pp)
  td = as.data.frame(table(as05$NO3.N.pp))
  summary(td)
  
  summary(as05$Cl.pp)
  as05$Cl.pp = as.character(as05$Cl.pp)
  td = as.data.frame(table(as05$Cl.pp))
  summary(td)
  
  #안성 관정6
  head(as06) #1372
  
  summary(as06$Depth.pp)
  as06$Depth.pp = as.character(as06$Depth.pp)
  td = as.data.frame(table(as06$Depth.pp))
  summary(td)
  
  summary(as06$Temperature.pp)
  as06$Temperature.pp = as.character(as06$Temperature.pp)
  td = as.data.frame(table(as06$Temperature.pp))
  summary(td)
  
  summary(as06$pH.pp)
  as06$pH.pp = as.character(as06$pH.pp)
  td = as.data.frame(table(as06$pH.pp))
  summary(td)
  
  summary(as06$ORP.pp)
  as06$ORP.pp = as.character(as06$ORP.pp)
  td = as.data.frame(table(as06$ORP.pp))
  summary(td)
  
  summary(as06$EC.pp)
  as06$EC.pp = as.character(as06$EC.pp)
  td = as.data.frame(table(as06$EC.pp))
  summary(td)
  
  summary(as06$DO.pp) #1287개가 일정 값 -> 1287/1372 -> 제거
  as06$DO.pp = as.character(as06$DO.pp)
  td = as.data.frame(table(as06$DO.pp))
  summary(td)
  
  summary(as06$Turbidity.pp)
  as06$Turbidity.pp = as.character(as06$Turbidity.pp)
  td = as.data.frame(table(as06$Turbidity.pp))
  summary(td)
  
  summary(as06$TDS.pp)
  as06$TDS.pp = as.character(as06$TDS.pp)
  td = as.data.frame(table(as06$TDS.pp))
  summary(td)
  
  summary(as06$Salinity.pp)
  as06$Salinity.pp = as.character(as06$Salinity.pp)
  td = as.data.frame(table(as06$Salinity.pp))
  summary(td)
  
  summary(as06$NH3.N.pp)
  as06$NH3.N.pp = as.character(as06$NH3.N.pp)
  td = as.data.frame(table(as06$NH3.N.pp))
  summary(td)
  
  summary(as06$NO3.N.pp)
  as06$NO3.N.pp = as.character(as06$NO3.N.pp)
  td = as.data.frame(table(as06$NO3.N.pp))
  summary(td)
  
  summary(as06$Cl.pp)
  as06$Cl.pp = as.character(as06$Cl.pp)
  td = as.data.frame(table(as06$Cl.pp))
  summary(td)
  
  #안성 관정8
  head(as08) #1337
  
  summary(as08$Depth.pp)
  as08$Depth.pp = as.character(as08$Depth.pp)
  td = as.data.frame(table(as08$Depth.pp))
  summary(td)
  
  summary(as08$Temperature.pp)
  as08$Temperature.pp = as.character(as08$Temperature.pp)
  td = as.data.frame(table(as08$Temperature.pp))
  summary(td)
  
  summary(as08$pH.pp)
  as08$pH.pp = as.character(as08$pH.pp)
  td = as.data.frame(table(as08$pH.pp))
  summary(td)
  
  summary(as08$ORP.pp)
  as08$ORP.pp = as.character(as08$ORP.pp)
  td = as.data.frame(table(as08$ORP.pp))
  summary(td)
  
  summary(as08$EC.pp)
  as08$EC.pp = as.character(as08$EC.pp)
  td = as.data.frame(table(as08$EC.pp))
  summary(td)
  
  summary(as08$DO.pp) 
  as08$DO.pp = as.character(as08$DO.pp)
  td = as.data.frame(table(as08$DO.pp))
  summary(td)
  
  summary(as08$Turbidity.pp)
  as08$Turbidity.pp = as.character(as08$Turbidity.pp)
  td = as.data.frame(table(as08$Turbidity.pp))
  summary(td)
  
  summary(as08$TDS.pp)
  as08$TDS.pp = as.character(as08$TDS.pp)
  td = as.data.frame(table(as08$TDS.pp))
  summary(td)
  
  summary(as08$Salinity.pp)
  as08$Salinity.pp = as.character(as08$Salinity.pp)
  td = as.data.frame(table(as08$Salinity.pp))
  summary(td)
  
  summary(as08$NH3.N.pp)
  as08$NH3.N.pp = as.character(as08$NH3.N.pp)
  td = as.data.frame(table(as08$NH3.N.pp))
  summary(td)
  
  summary(as08$NO3.N.pp)
  as08$NO3.N.pp = as.character(as08$NO3.N.pp)
  td = as.data.frame(table(as08$NO3.N.pp))
  summary(td)
  
  summary(as08$Cl.pp)
  as08$Cl.pp = as.character(as08$Cl.pp)
  td = as.data.frame(table(as08$Cl.pp))
  summary(td)
}
#결론 = DO(rdo)만 제거하면 됨
#소숫점 6자리 같은 부분 시각화-figure
{
  as03 <- read_excel("품질관리(12개인자) 안성3.xlsx")
  as04 <- read_excel("품질관리(12개인자) 안성4.xlsx")
  as05 <- read_excel("품질관리(12개인자) 안성5.xlsx")
  as06 <- read_excel("품질관리(12개인자) 안성6.xlsx")
  as08 <- read_excel("품질관리(12개인자) 안성8.xlsx")
  
  as03$Date = as.Date(as03$Date)
  as04$Date = as.Date(as04$Date)
  as05$Date = as.Date(as05$Date)
  as06$Date = as.Date(as06$Date)
  as08$Date = as.Date(as08$Date)
  
  head(as03)
  
  p.DO = ggplot() + 
    geom_line(data = as04, aes(x = Date, y = DO.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    # geom_point(data = e3, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Year') +
    ylab('DO (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") 
  p.DO
  
  p.TDS = ggplot() + 
    geom_line(data = as04, aes(x = Date, y = TDS.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    # geom_point(data = e3, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Year') +
    ylab('TDS (ppt)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") 
  p.TDS
}
#===============================================================================
#구간을 따로 자르지는 말고, 각 관정마다 연속으로 일정한 값 나오는 구간 제거
{
  as03 <- read_excel("품질관리(12개인자) 안성3.xlsx")
  as04 <- read_excel("품질관리(12개인자) 안성4.xlsx")
  as05 <- read_excel("품질관리(12개인자) 안성5.xlsx")
  as06 <- read_excel("품질관리(12개인자) 안성6.xlsx")
  as08 <- read_excel("품질관리(12개인자) 안성8.xlsx")
  
  as03 = as03[,-7]
  as04 = as04[,-7]
  as05 = as05[,-7]
  as06 = as06[,-7]
  as08 = as08[,-7]
  
  as03$Date = as.Date(as03$Date)
  as04$Date = as.Date(as04$Date)
  as05$Date = as.Date(as05$Date)
  as06$Date = as.Date(as06$Date)
  as08$Date = as.Date(as08$Date)
  
  str(as03)
  str(as04)
  str(as05)
  str(as06)
  str(as08)
  
  head(as03)
  head(as04)
  head(as05)
  head(as06)
  head(as08)
  
  #연속으로 일정한 값 나오는 구간만 제거
  {
    #Depth
    n3.Depth = as03%>%filter(Depth.pp != lag(Depth.pp)) #-------->Depth.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    
    head(as03) #개 행
    head(n3.Depth) #개 행
    
    #Temperature
    n3.Temperature = n3.Depth%>%filter(Temperature.pp != lag(Temperature.pp)) #-------->Temperature.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.Temperature) #개 행
    
    #pH
    n3.pH = n3.Temperature%>%filter(pH.pp != lag(pH.pp)) #-------->pH.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.pH) #개 행
    
    #ORP
    n3.ORP = n3.pH%>%filter(ORP.pp != lag(ORP.pp)) #-------->ORP.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.ORP) #개 행
    
    #EC
    n3.EC = n3.ORP%>%filter(EC.pp != lag(EC.pp)) #-------->EC.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.EC) #개 행
    
    #DO
    # n1.DO = n1.EC%>%filter(DO.pp != lag(DO.pp)) #-------->DO.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    # head(h01)
    # head(n1.DO)
    
    #Turbidity
    n3.Turbidity = n3.EC%>%filter(Turbidity.pp != lag(Turbidity.pp)) #-------->Turbidity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.Turbidity) #개 행
    
    #TDS
    n3.TDS = n3.Turbidity%>%filter(TDS.pp != lag(TDS.pp)) #-------->TDS.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.TDS) #개 행
    
    #Salinity
    n3.Salinity = n3.TDS%>%filter(Salinity.pp != lag(Salinity.pp)) #-------->Salinity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.Salinity) #개 행
    
    #NH3.N
    n3.NH3.N = n3.Salinity%>%filter(NH3.N.pp != lag(NH3.N.pp)) #-------->NH3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.NH3.N) #개 행
    
    #NO3.N
    n3.NO3.N = n3.NH3.N%>%filter(NO3.N.pp != lag(NO3.N.pp)) #-------->NO3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.NO3.N) #개 행
    
    #Cl
    n3.Cl = n3.NO3.N%>%filter(Cl.pp != lag(Cl.pp)) #-------->Cl.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as03)
    head(n3.Cl) #개 행
    
    n3 = n3.Cl
  }
  
  {  #Depth
    n4.Depth = as04%>%filter(Depth.pp != lag(Depth.pp)) #-------->Depth.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    
    head(as04) #개 행
    head(n4.Depth) #개 행
    
    #Temperature
    n4.Temperature = n4.Depth%>%filter(Temperature.pp != lag(Temperature.pp)) #-------->Temperature.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.Temperature) #개 행
    
    #pH
    n4.pH = n4.Temperature%>%filter(pH.pp != lag(pH.pp)) #-------->pH.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.pH) #개 행
    
    #ORP
    n4.ORP = n4.pH%>%filter(ORP.pp != lag(ORP.pp)) #-------->ORP.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.ORP) #개 행
    
    #EC
    n4.EC = n4.ORP%>%filter(EC.pp != lag(EC.pp)) #-------->EC.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.EC) #개 행
    
    #DO
    # n1.DO = n1.EC%>%filter(DO.pp != lag(DO.pp)) #-------->DO.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    # head(h01)
    # head(n1.DO)
    
    #Turbidity
    n4.Turbidity = n4.EC%>%filter(Turbidity.pp != lag(Turbidity.pp)) #-------->Turbidity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.Turbidity) #개 행
    
    #TDS
    n4.TDS = n4.Turbidity%>%filter(TDS.pp != lag(TDS.pp)) #-------->TDS.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.TDS) #개 행
    
    #Salinity
    n4.Salinity = n4.TDS%>%filter(Salinity.pp != lag(Salinity.pp)) #-------->Salinity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.Salinity) #개 행
    
    #NH3.N
    n4.NH3.N = n4.Salinity%>%filter(NH3.N.pp != lag(NH3.N.pp)) #-------->NH3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.NH3.N) #개 행
    
    #NO3.N
    n4.NO3.N = n4.NH3.N%>%filter(NO3.N.pp != lag(NO3.N.pp)) #-------->NO3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.NO3.N) #개 행
    
    #Cl
    n4.Cl = n4.NO3.N%>%filter(Cl.pp != lag(Cl.pp)) #-------->Cl.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as04)
    head(n4.Cl) #개 행
    
    n4 = n4.Cl
  }
  
  {  #Depth
    n5.Depth = as05%>%filter(Depth.pp != lag(Depth.pp)) #-------->Depth.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    
    head(as05) #개 행
    head(n5.Depth) #개 행
    
    #Temperature
    n5.Temperature = n5.Depth%>%filter(Temperature.pp != lag(Temperature.pp)) #-------->Temperature.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.Temperature) #개 행
    
    #pH
    n5.pH = n5.Temperature%>%filter(pH.pp != lag(pH.pp)) #-------->pH.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.pH) #개 행
    
    #ORP
    n5.ORP = n5.pH%>%filter(ORP.pp != lag(ORP.pp)) #-------->ORP.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.ORP) #개 행
    
    #EC
    n5.EC = n5.ORP%>%filter(EC.pp != lag(EC.pp)) #-------->EC.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.EC) #개 행
    
    #DO
    # n1.DO = n1.EC%>%filter(DO.pp != lag(DO.pp)) #-------->DO.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    # head(h01)
    # head(n1.DO)
    
    #Turbidity
    n5.Turbidity = n5.EC%>%filter(Turbidity.pp != lag(Turbidity.pp)) #-------->Turbidity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.Turbidity) #개 행
    
    #TDS
    n5.TDS = n5.Turbidity%>%filter(TDS.pp != lag(TDS.pp)) #-------->TDS.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.TDS) #개 행
    
    #Salinity
    n5.Salinity = n5.TDS%>%filter(Salinity.pp != lag(Salinity.pp)) #-------->Salinity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.Salinity) #개 행
    
    #NH3.N
    n5.NH3.N = n5.Salinity%>%filter(NH3.N.pp != lag(NH3.N.pp)) #-------->NH3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.NH3.N) #개 행
    
    #NO3.N
    n5.NO3.N = n5.NH3.N%>%filter(NO3.N.pp != lag(NO3.N.pp)) #-------->NO3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.NO3.N) #개 행
    
    #Cl
    n5.Cl = n5.NO3.N%>%filter(Cl.pp != lag(Cl.pp)) #-------->Cl.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as05)
    head(n5.Cl) #개 행
    
    n5 = n5.Cl
  }
  
  {  #Depth
    n6.Depth = as06%>%filter(Depth.pp != lag(Depth.pp)) #-------->Depth.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    
    head(as06) #개 행
    head(n6.Depth) #개 행
    
    #Temperature
    n6.Temperature = n6.Depth%>%filter(Temperature.pp != lag(Temperature.pp)) #-------->Temperature.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.Temperature) #개 행
    
    #pH
    n6.pH = n6.Temperature%>%filter(pH.pp != lag(pH.pp)) #-------->pH.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.pH) #개 행
    
    #ORP
    n6.ORP = n6.pH%>%filter(ORP.pp != lag(ORP.pp)) #-------->ORP.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.ORP) #개 행
    
    #EC
    n6.EC = n6.ORP%>%filter(EC.pp != lag(EC.pp)) #-------->EC.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.EC) #개 행
    
    #DO
    # n1.DO = n1.EC%>%filter(DO.pp != lag(DO.pp)) #-------->DO.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    # head(h01)
    # head(n1.DO)
    
    #Turbidity
    n6.Turbidity = n6.EC%>%filter(Turbidity.pp != lag(Turbidity.pp)) #-------->Turbidity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.Turbidity) #개 행
    
    #TDS
    n6.TDS = n6.Turbidity%>%filter(TDS.pp != lag(TDS.pp)) #-------->TDS.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.TDS) #개 행
    
    #Salinity
    n6.Salinity = n6.TDS%>%filter(Salinity.pp != lag(Salinity.pp)) #-------->Salinity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.Salinity) #개 행
    
    #NH3.N
    n6.NH3.N = n6.Salinity%>%filter(NH3.N.pp != lag(NH3.N.pp)) #-------->NH3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.NH3.N) #개 행
    
    #NO3.N
    n6.NO3.N = n6.NH3.N%>%filter(NO3.N.pp != lag(NO3.N.pp)) #-------->NO3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.NO3.N) #개 행
    
    #Cl
    n6.Cl = n6.NO3.N%>%filter(Cl.pp != lag(Cl.pp)) #-------->Cl.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as06)
    head(n6.Cl) #개 행
    
    n6 = n6.Cl
  }
  
  {  #Depth
    n8.Depth = as08%>%filter(Depth.pp != lag(Depth.pp)) #-------->Depth.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    
    head(as08) #개 행
    head(n8.Depth) #개 행
    
    #Temperature
    n8.Temperature = n8.Depth%>%filter(Temperature.pp != lag(Temperature.pp)) #-------->Temperature.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.Temperature) #개 행
    
    #pH
    n8.pH = n8.Temperature%>%filter(pH.pp != lag(pH.pp)) #-------->pH.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.pH) #개 행
    
    #ORP
    n8.ORP = n8.pH%>%filter(ORP.pp != lag(ORP.pp)) #-------->ORP.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.ORP) #개 행
    
    #EC
    n8.EC = n8.ORP%>%filter(EC.pp != lag(EC.pp)) #-------->EC.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.EC) #개 행
    
    #DO
    # n1.DO = n1.EC%>%filter(DO.pp != lag(DO.pp)) #-------->DO.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    # head(h01)
    # head(n1.DO)
    
    #Turbidity
    n8.Turbidity = n8.EC%>%filter(Turbidity.pp != lag(Turbidity.pp)) #-------->Turbidity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.Turbidity) #개 행
    
    #TDS
    n8.TDS = n8.Turbidity%>%filter(TDS.pp != lag(TDS.pp)) #-------->TDS.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.TDS) #개 행
    
    #Salinity
    n8.Salinity = n8.TDS%>%filter(Salinity.pp != lag(Salinity.pp)) #-------->Salinity.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.Salinity) #개 행
    
    #NH3.N
    n8.NH3.N = n8.Salinity%>%filter(NH3.N.pp != lag(NH3.N.pp)) #-------->NH3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.NH3.N) #개 행
    
    #NO3.N
    n8.NO3.N = n8.NH3.N%>%filter(NO3.N.pp != lag(NO3.N.pp)) #-------->NO3.N.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.NO3.N) #개 행
    
    #Cl
    n8.Cl = n8.NO3.N%>%filter(Cl.pp != lag(Cl.pp)) #-------->Cl.pp값이 연속적으로 중복되는 행만 제거!!!!!! 
    head(as08)
    head(n8.Cl) #개 행
    
    n8 = n8.Cl
  }
}
head(n3) #545 ->467개 행
head(n4) #1330 -> 486개 행
head(n5) #820 -> 538개 행
head(n6) #1372 -> 863개 행
head(n8) #1337 -> 1100개 행
#===============================================================================
#데이터 저장
{
  # write.xlsx(n3, '품질관리(최종) 안성3.xlsx')
  # write.xlsx(n4, '품질관리(최종) 안성4.xlsx')
  # write.xlsx(n5, '품질관리(최종) 안성5.xlsx')
  # write.xlsx(n6, '품질관리(최종) 안성6.xlsx')
  # write.xlsx(n8, '품질관리(최종) 안성8.xlsx')
}
#===============================================================================
#데이터 불러오기
{
  n3 <- read_excel("품질관리(최종) 안성3.xlsx")
  n4 <- read_excel("품질관리(최종) 안성4.xlsx")
  n5 <- read_excel("품질관리(최종) 안성5.xlsx")
  n6 <- read_excel("품질관리(최종) 안성6.xlsx")
  n8 <- read_excel("품질관리(최종) 안성8.xlsx")
  
  n3$Date = as.Date(n3$Date)
  n4$Date = as.Date(n4$Date)
  n5$Date = as.Date(n5$Date)
  n6$Date = as.Date(n6$Date)
  n8$Date = as.Date(n8$Date)
  
  str(n3)
  str(n4)
  str(n5)
  str(n6)
  str(n8)
  
  head(n3)
  head(n4)
  head(n5)
  head(n6)
  head(n8)
  
  #여기에 수분석 데이터 불러오기
  x3 = read.csv("안성 수분석 관정3.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x4 = read.csv("안성 수분석 관정4.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x5 = read.csv("안성 수분석 관정5.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x6 = read.csv("안성 수분석 관정6.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x8 = read.csv("안성 수분석 관정8.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
}
{
  nt = rbind(n3,n4,n5,n6,n8)
  summary(nt$Cl.pp)
  summary(nt$Depth.pp)
  # summary(nt$DO.pp)
  summary(nt$EC.pp)
  summary(nt$NH3.N.pp)
  summary(nt$NO3.N.pp)
  summary(nt$ORP.pp)
  summary(nt$pH.pp)
  summary(nt$Salinity.pp)
  summary(nt$TDS.pp)
  summary(nt$Temperature.pp)
  summary(nt$Turbidity.pp)
}
#===============================================================================
#Data Extraction 후 불러오기
{
  e3  <- read_excel("안성 관정3(ob,pp).xlsx")
  e4  <- read_excel("안성 관정4(ob,pp).xlsx")
  e5  <- read_excel("안성 관정5(ob,pp).xlsx")
  e6  <- read_excel("안성 관정6(ob,pp).xlsx")
  e8  <- read_excel("안성 관정8(ob,pp).xlsx")
  
  e3$Date = as.Date(e3$Date)
  e4$Date = as.Date(e4$Date)
  e5$Date = as.Date(e5$Date)
  e6$Date = as.Date(e6$Date)
  e8$Date = as.Date(e8$Date)
}
#===============================================================================
#이제 plotting!!! 품질관리가 어떻게 이뤄졌는지
{
  #대표적으로 관정3
  p.dep = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = Depth.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Depth of water (m)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Depth of water") 
  p.dep
  p.Temperature = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = Temperature.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = Temperature.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Temperature (C)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Temperature") 
  p.Temperature
  p.pH = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = pH.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = pH.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('pH')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("pH") 
  p.pH
  p.ORP = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = ORP.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('ORP')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("ORP") 
  p.ORP
  p.EC = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = EC.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = EC.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('EC')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("EC") 
  p.EC
  # p.rdo = ggplot() +
  #   geom_line(data = n1, aes(x = Date, y = DO.pp), color = "dodgerblue3", size = 2) +
  #   # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
  #   geom_point(data = x1, aes(x = Date, y = DO.ob), color = "red2", size = 3) +
  #   xlab('Date') +
  #   ylab('rdo')+
  #   #ylim(0,0.3)+
  #   theme(legend.text = element_text(size = 22))+
  #   theme(panel.background = element_rect(fill="white", color = "black"),
  #         axis.title.x = element_text(size=20),
  #         axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
  #         axis.title.y = element_text(size=25),
  #         plot.title = element_text(size = 30),
  #         legend.text = element_text(size = 25),
  #         legend.title = element_text(size = 28)) +
  #   ggtitle("rdo")
  # p.rdo
  p.Turbidity = ggplot() +
    geom_line(data = e3, aes(x = Date, y = Turbidity.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = x3, aes(x = Date, y = Turbidity.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Turbidity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Turbidity") 
  p.Turbidity
  p.TDS = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = TDS.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = TDS.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('TDS (ppm)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("TDS") 
  p.TDS
  p.Salinity = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = Salinity.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = Salinity.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Salinity") 
  p.Salinity
  p.NH3.N = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = NH3.N.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('NH3.N (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NH3.N") 
  p.NH3.N
  p.NO3.N = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = NO3.N.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('NO3.N (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NO3.N") 
  p.NO3.N
  p.Cl = ggplot() + 
    geom_line(data = n3, aes(x = Date, y = Cl.pp), color = "dodgerblue3", size = 2) +
    # geom_line(data = h1, aes(x = timestamp, y = Depth), color = "black", size = 0.5, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Cl (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Cl") 
  p.Cl
}
#===============================================================================
#데이터 전처리 과정 예시로 보이기
{
  {
    as3 <- read_excel("센서데이터_안성_3번.xlsx")
    #Cl
    p.Cl = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = Cl), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.Cl
    
    #Depth
    p.Depth = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = Depth), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('Depth (m)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.Depth
    
    #DO
    p.DO = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = rdo), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('RDO (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.DO
    
    #EC
    p.EC = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = EC), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('EC (μS/cm)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.EC
    
    #NH3.N
    p.NH3.N = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = NH3.N), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.NH3.N
    
    #NO3.N
    p.NO3.N = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = NO3.N), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('NO3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.NO3.N
    
    #ORP
    p.ORP = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = ORP), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('ORP (mV)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.ORP
    
    #pH
    p.pH = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = pH), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('pH')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.pH
    
    #Salinity
    p.Salinity = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = Salinity), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('Salinity')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.Salinity
    
    #TDS
    p.TDS = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = TDS), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('TDS (ppt)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.TDS
    
    #Temperature
    p.Temperature = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = Temp.), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('Temperature (°C)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.Temperature
    
    #Turbidity
    p.Turbidity = ggplot() + 
      #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
      geom_line(data = as3, aes(x = timestamp, y = Turbidity), color = "black", size = 1, alpha = 0.8) +
      #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
      xlab('Years') +
      ylab('Turbidity (NTU)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) 
    # ggtitle("Salinity") #+ylim(0,50)
    p.Turbidity
    
    #par(mfrow=)로 Multiple plot 그리기 1
    
    gridExtra::grid.arrange(p.Cl,p.Depth,p.DO,p.EC,p.NH3.N,p.NO3.N,p.ORP,p.pH,p.Salinity,p.TDS,p.Temperature,p.Turbidity, ncol=1)
  }
  #논문 피규어 처럼 그리기
  {
    head(as3)
    names(as3)[2] <- c("Depth (m)")
    names(as3)[3] <- c("Temp. (°C)")
    names(as3)[4] <- c("EC (μS/cm)")
    names(as3)[5] <- c("pH")
    names(as3)[6] <- c("ORP (mV)")
    names(as3)[7] <- c("TDS (ppt)")
    names(as3)[8] <- c("Salinity")
    names(as3)[9] <- c("DO (mg/L)")
    names(as3)[10] <- c("Turbidity (NTU)")
    names(as3)[11] <- c("NH3-N (mg/L)")
    names(as3)[12] <- c("NO3-N (mg/L)")
    names(as3)[13] <- c("Cl (mg/L)")
    head(as3)
    
    df_melt = melt(as3, id.vars = "timestamp", variable.name = "Factor", value.name = "value")
    df_melt$Factor <- factor(df_melt$Factor, levels = c("Cl (mg/L)", "Depth (m)","DO (mg/L)", "EC (μS/cm)","NH3-N (mg/L)","NO3-N (mg/L)","ORP (mV)",
                                                        "pH","Salinity","TDS (ppt)","Temp. (°C)","Turbidity (NTU)"))
    
    ggplot(df_melt, aes(x=timestamp, y=value, colour=Factor)) + 
      geom_path(color = "black", size = 1.5, alpha = 0.8) + 
      # scale_x_datetime(breaks=date_breaks("6 months"), labels=date_format("%H:%M")) +
      facet_grid(Factor ~., scales = "free_y") +
      theme(legend.position="none") +
      theme(legend.text = element_text(size = 0))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=0),
            axis.text.x = element_text(size=30), axis.text.y = element_text(size=30),
            axis.title.y = element_text(size=0),
            plot.title = element_text(size = 0),
            legend.text = element_text(size = 0),
            legend.title = element_text(size = 0),
            strip.text.y = element_text(size = 27),
            strip.background = element_rect(color="black", fill="white", size=0, linetype="solid"))
  }
  #==============================================================
  #품질관리 과정 보이기! (위에 하루단위 이상치 보정 과정에서 c12를 원하는 관정으로 설정하고 와야함)
  head(as03)
  as3 <- read_excel("센서데이터_안성_3번.xlsx")
  #Salinity
  p.Salinity = ggplot() + 
    #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
    geom_line(data = as3, aes(x = timestamp, y = Salinity), color = "black", size = 1.5, alpha = 0.8) +
    #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Raw data") 
  # ggtitle("Salinity") #+ylim(0,50)
  p.Salinity
  
  p.Cl = ggplot() + 
    #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
    geom_line(data = as03, aes(x = timestamp, y = Salinity), color = "black", size = 1.5, alpha = 0.8) +
    #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Basic quality control")# +ylim(0,50)
  p.Cl
  #하루로 묶은거
  df
  p.Sal = ggplot() + 
    #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
    geom_line(data = df, aes(x = Date, y = Salinity), color = "black", size = 1.5, alpha = 0.8) +
    #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Set data interval")# +ylim(0,50)
  p.Sal
  
  p.Sal = ggplot() + 
    #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
    geom_line(data = c12, aes(x = Date, y = Salinity.pp), color = "black", size = 1.5, alpha = 0.8) +
    #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Anomaly detection & Missing value interpolation") +ylim(0,0.7)
  p.Sal
  
  #이상치 나타내기
  #Temp
  tph = ttt[,c(1,3)]
  head(tph)
  # imputation <- tph |> na_kalman()
  # imputation <- tph |> na_interpolation(option = 'linear')
  # head(imputation)
  #imputation = as.data.frame(imputation)
  #head(imputation)
  df %>%
    plot_anomaly_diagnostics(Date, Salinity, .alpha = 0.05, .interactive = FALSE) + ggtitle("waterTemp") +
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 20),
          legend.title = element_text(size = 20)) +
    xlab('Date') +
    ylab('Salinity')
  
  #이상치 나타내는 플랏
  #Depth
  tph = df[,c(1,2)]
  head(tph)
  # imputation <- tph |> na_kalman()
  # imputation <- tph |> na_interpolation(option = 'linear')
  # head(imputation)
  #imputation = as.data.frame(imputation)
  #head(imputation)
  tph %>%
    plot_anomaly_diagnostics(Date, waterLevel, .alpha = 0.05, .interactive = FALSE) + ggtitle("waterLevel") +
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 20),
          legend.title = element_text(size = 20)) + ylim(2,5)+
    xlab('Date') +
    ylab('Depth to water (m)')
}
#논문 Figure
{
  as3 <- read_excel("센서데이터_안성_3번.xlsx")
  {
    head(as3)
    names(as3)[2] <- c("Depth (m)")
    names(as3)[3] <- c("Temp. (°C)")
    names(as3)[4] <- c("EC (μS/cm)")
    names(as3)[5] <- c("pH")
    names(as3)[6] <- c("ORP (mV)")
    names(as3)[7] <- c("TDS (ppt)")
    names(as3)[8] <- c("Salinity")
    names(as3)[9] <- c("DO (mg/L)")
    names(as3)[10] <- c("Turbidity (NTU)")
    names(as3)[11] <- c("NH3-N (mg/L)")
    names(as3)[12] <- c("NO3-N (mg/L)")
    names(as3)[13] <- c("Cl (mg/L)")
    head(as3)
    
    df_melt = melt(as3, id.vars = "timestamp", variable.name = "Factor", value.name = "value")
    df_melt$Factor <- factor(df_melt$Factor, levels = c("Cl (mg/L)", "Depth (m)","DO (mg/L)", "EC (μS/cm)","NH3-N (mg/L)","NO3-N (mg/L)","ORP (mV)",
                                                        "pH","Salinity","TDS (ppt)","Temp. (°C)","Turbidity (NTU)"))
    
    ggplot(df_melt, aes(x=timestamp, y=value, colour=Factor)) + 
      geom_path(color = "black", size = 1.5, alpha = 0.8) + 
      # scale_x_datetime(breaks=date_breaks("6 months"), labels=date_format("%H:%M")) +
      facet_grid(Factor ~., scales = "free_y") +
      theme(legend.position="none") +
      theme(legend.text = element_text(size = 0))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=0),
            axis.text.x = element_text(size=0), axis.text.y = element_text(size=30),
            axis.title.y = element_text(size=0),
            plot.title = element_text(size = 45),
            legend.text = element_text(size = 0),
            legend.title = element_text(size = 0),
            strip.text.y = element_text(size = 27),
            strip.background = element_rect(color="black", fill="white", size=0, linetype="solid"))+
      ggtitle("Well_A")
  }
  
  as4 <- read_excel("센서데이터_안성_4번.xlsx")
  {  head(as4)
    names(as4)[2] <- c("Depth (m)")
    names(as4)[3] <- c("Temp. (°C)")
    names(as4)[4] <- c("EC (μS/cm)")
    names(as4)[5] <- c("pH")
    names(as4)[6] <- c("ORP (mV)")
    names(as4)[7] <- c("TDS (ppt)")
    names(as4)[8] <- c("Salinity")
    names(as4)[9] <- c("DO (mg/L)")
    names(as4)[10] <- c("Turbidity (NTU)")
    names(as4)[11] <- c("NH3-N (mg/L)")
    names(as4)[12] <- c("NO3-N (mg/L)")
    names(as4)[13] <- c("Cl (mg/L)")
    head(as4)
    
    df_melt = melt(as4, id.vars = "timestamp", variable.name = "Factor", value.name = "value")
    df_melt$Factor <- factor(df_melt$Factor, levels = c("Cl (mg/L)", "Depth (m)","DO (mg/L)", "EC (μS/cm)","NH3-N (mg/L)","NO3-N (mg/L)","ORP (mV)",
                                                        "pH","Salinity","TDS (ppt)","Temp. (°C)","Turbidity (NTU)"))
    
    ggplot(df_melt, aes(x=timestamp, y=value, colour=Factor)) + 
      geom_path(color = "black", size = 1.5, alpha = 0.8) + 
      # scale_x_datetime(breaks=date_breaks("6 months"), labels=date_format("%H:%M")) +
      facet_grid(Factor ~., scales = "free_y") +
      theme(legend.position="none") +
      theme(legend.text = element_text(size = 0))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=0),
            axis.text.x = element_text(size=30), axis.text.y = element_text(size=30),
            axis.title.y = element_text(size=0),
            plot.title = element_text(size = 45),
            legend.text = element_text(size = 0),
            legend.title = element_text(size = 0),
            strip.text.y = element_text(size = 27),
            strip.background = element_rect(color="black", fill="white", size=0, linetype="solid"))+
      ggtitle("Well_B")
  }
  
  as5 <- read_excel("센서데이터_안성_5번.xlsx")
  {  head(as5)
    names(as5)[2] <- c("Depth (m)")
    names(as5)[3] <- c("Temp. (°C)")
    names(as5)[4] <- c("EC (μS/cm)")
    names(as5)[5] <- c("pH")
    names(as5)[6] <- c("ORP (mV)")
    names(as5)[7] <- c("TDS (ppt)")
    names(as5)[8] <- c("Salinity")
    names(as5)[9] <- c("DO (mg/L)")
    names(as5)[10] <- c("Turbidity (NTU)")
    names(as5)[11] <- c("NH3-N (mg/L)")
    names(as5)[12] <- c("NO3-N (mg/L)")
    names(as5)[13] <- c("Cl (mg/L)")
    head(as5)
    
    df_melt = melt(as5, id.vars = "timestamp", variable.name = "Factor", value.name = "value")
    df_melt$Factor <- factor(df_melt$Factor, levels = c("Cl (mg/L)", "Depth (m)","DO (mg/L)", "EC (μS/cm)","NH3-N (mg/L)","NO3-N (mg/L)","ORP (mV)",
                                                        "pH","Salinity","TDS (ppt)","Temp. (°C)","Turbidity (NTU)"))
    
    ggplot(df_melt, aes(x=timestamp, y=value, colour=Factor)) + 
      geom_path(color = "black", size = 1.5, alpha = 0.8) + 
      # scale_x_datetime(breaks=date_breaks("6 months"), labels=date_format("%H:%M")) +
      facet_grid(Factor ~., scales = "free_y") +
      theme(legend.position="none") +
      theme(legend.text = element_text(size = 0))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=0),
            axis.text.x = element_text(size=30), axis.text.y = element_text(size=30),
            axis.title.y = element_text(size=0),
            plot.title = element_text(size = 45),
            legend.text = element_text(size = 0),
            legend.title = element_text(size = 0),
            strip.text.y = element_text(size = 27),
            strip.background = element_rect(color="black", fill="white", size=0, linetype="solid"))+
      ggtitle("Well_C")
  }
  
  as6 <- read_excel("센서데이터_안성_6번.xlsx")
  {  head(as6)
    names(as6)[2] <- c("Depth (m)")
    names(as6)[3] <- c("Temp. (°C)")
    names(as6)[4] <- c("EC (μS/cm)")
    names(as6)[5] <- c("pH")
    names(as6)[6] <- c("ORP (mV)")
    names(as6)[7] <- c("TDS (ppt)")
    names(as6)[8] <- c("Salinity")
    names(as6)[9] <- c("DO (mg/L)")
    names(as6)[10] <- c("Turbidity (NTU)")
    names(as6)[11] <- c("NH3-N (mg/L)")
    names(as6)[12] <- c("NO3-N (mg/L)")
    names(as6)[13] <- c("Cl (mg/L)")
    head(as6)
    
    df_melt = melt(as6, id.vars = "timestamp", variable.name = "Factor", value.name = "value")
    df_melt$Factor <- factor(df_melt$Factor, levels = c("Cl (mg/L)", "Depth (m)","DO (mg/L)", "EC (μS/cm)","NH3-N (mg/L)","NO3-N (mg/L)","ORP (mV)",
                                                        "pH","Salinity","TDS (ppt)","Temp. (°C)","Turbidity (NTU)"))
    
    ggplot(df_melt, aes(x=timestamp, y=value, colour=Factor)) + 
      geom_path(color = "black", size = 1.5, alpha = 0.8) + 
      # scale_x_datetime(breaks=date_breaks("6 months"), labels=date_format("%H:%M")) +
      facet_grid(Factor ~., scales = "free_y") +
      theme(legend.position="none") +
      theme(legend.text = element_text(size = 0))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=0),
            axis.text.x = element_text(size=30), axis.text.y = element_text(size=30),
            axis.title.y = element_text(size=0),
            plot.title = element_text(size = 45),
            legend.text = element_text(size = 0),
            legend.title = element_text(size = 0),
            strip.text.y = element_text(size = 27),
            strip.background = element_rect(color="black", fill="white", size=0, linetype="solid"))+
      ggtitle("Well_D")
  }
  
  as8 <- read_excel("센서데이터_안성_8번.xlsx")
  {  head(as8)
    names(as8)[2] <- c("Depth (m)")
    names(as8)[3] <- c("Temp. (°C)")
    names(as8)[4] <- c("EC (μS/cm)")
    names(as8)[5] <- c("pH")
    names(as8)[6] <- c("ORP (mV)")
    names(as8)[7] <- c("TDS (ppt)")
    names(as8)[8] <- c("Salinity")
    names(as8)[9] <- c("DO (mg/L)")
    names(as8)[10] <- c("Turbidity (NTU)")
    names(as8)[11] <- c("NH3-N (mg/L)")
    names(as8)[12] <- c("NO3-N (mg/L)")
    names(as8)[13] <- c("Cl (mg/L)")
    head(as8)
    
    df_melt = melt(as8, id.vars = "timestamp", variable.name = "Factor", value.name = "value")
    df_melt$Factor <- factor(df_melt$Factor, levels = c("Cl (mg/L)", "Depth (m)","DO (mg/L)", "EC (μS/cm)","NH3-N (mg/L)","NO3-N (mg/L)","ORP (mV)",
                                                        "pH","Salinity","TDS (ppt)","Temp. (°C)","Turbidity (NTU)"))
    
    ggplot(df_melt, aes(x=timestamp, y=value, colour=Factor)) + 
      geom_path(color = "black", size = 1.5, alpha = 0.8) + 
      # scale_x_datetime(breaks=date_breaks("6 months"), labels=date_format("%H:%M")) +
      facet_grid(Factor ~., scales = "free_y") +
      theme(legend.position="none") +
      theme(legend.text = element_text(size = 0))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=0),
            axis.text.x = element_text(size=30), axis.text.y = element_text(size=30),
            axis.title.y = element_text(size=0),
            plot.title = element_text(size = 45),
            legend.text = element_text(size = 0),
            legend.title = element_text(size = 0),
            strip.text.y = element_text(size = 27),
            strip.background = element_rect(color="black", fill="white", size=0, linetype="solid"))+
      ggtitle("Well_E")
  }
}
#품질관리 과정 plot 
#품질관리 과정 보이기! (위에 하루단위 이상치 보정 과정에서 c12를 원하는 관정으로 설정하고 와야함)
{
  as05 <- read_excel("품질관리(12개인자) 안성5.xlsx")
  head(as05)
  as5 <- read_excel("센서데이터_안성_5번.xlsx")
  #Cl
  p.Cl = ggplot() + 
    #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
    geom_line(data = as5, aes(x = timestamp, y = Cl), color = "black", size = 1.5, alpha = 0.8) +
    #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Raw data") 
  # ggtitle("Salinity") #+ylim(0,50)
  p.Cl
  
  p.Cl = ggplot() + 
    #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
    geom_line(data = as05, aes(x = timestamp, y = Cl), color = "black", size = 1.5, alpha = 0.8) +
    #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Basic quality control")# +ylim(0,50)
  p.Cl
  #하루로 묶은거
  df
  p.Cl = ggplot() + 
    #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
    geom_line(data = df, aes(x = Date, y = Cl), color = "black", size = 1.5, alpha = 0.8) +
    #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Set data interval")# +ylim(0,50)
  p.Cl
  
  p.Cl = ggplot() + 
    #  geom_line(data = df, aes(x = Date, y = waterTemp), color = "dodgerblue3", size = 2) +
    geom_line(data = c12, aes(x = Date, y = Cl.pp), color = "black", size = 1.5, alpha = 0.8) +
    #  geom_point(data = ob, aes(x = Date, y = Temp.), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Anomaly detection & Missing value interpolation")# +ylim(0,0.7)
  p.Cl
}
#===============================================================================
#Model selection for Calibration
{
  #Data
  {
    e3  <- read_excel("안성 관정3(ob,pp).xlsx")
    e4  <- read_excel("안성 관정4(ob,pp).xlsx")
    e5  <- read_excel("안성 관정5(ob,pp).xlsx")
    e6  <- read_excel("안성 관정6(ob,pp).xlsx")
    e8  <- read_excel("안성 관정8(ob,pp).xlsx")
    e34568  <- read_excel("안성 통합(ob,pp).xlsx")
    
    e3$Date = as.Date(e3$Date)
    e4$Date = as.Date(e4$Date)
    e5$Date = as.Date(e5$Date)
    e6$Date = as.Date(e6$Date)
    e8$Date = as.Date(e8$Date)
    e34568$Date = as.Date(e34568$Date)
    
    e3$NO3.N.ob = as.numeric(e3$NO3.N.ob)
    e4$NO3.N.ob = as.numeric(e4$NO3.N.ob)
    e5$NO3.N.ob = as.numeric(e5$NO3.N.ob)
    e6$NO3.N.ob = as.numeric(e6$NO3.N.ob)
    e8$NO3.N.ob = as.numeric(e8$NO3.N.ob)
    e34568$NO3.N.ob = as.numeric(e34568$NO3.N.ob)
    
    str(e3)
    str(e4)
    str(e5)
    str(e6)
    str(e8)
    str(e34568)
  }
  #========================
  #Depth
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Depth.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(Depth.ob ~ Depth.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[15])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$Depth.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(Depth.ob ~ Depth.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[15])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$Depth.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(Depth.ob ~ Depth.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[15])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$Depth.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(Depth.ob ~ Depth.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[15])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$Depth.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(Depth.ob ~ Depth.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[15])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$Depth.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(Depth.ob ~ Depth.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[15])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$Depth.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$Depth.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(Depth.ob ~ Depth.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[15])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$Depth.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(Depth.ob ~ Depth.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[15])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$Depth.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(Depth.ob ~ Depth.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[15])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$Depth.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(Depth.ob ~ Depth.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[15])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$Depth.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(Depth.ob ~ Depth.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[15])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$Depth.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(Depth.ob ~ Depth.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$Depth.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.Depth = do.call(rbind, datalist)
    # write.csv(big_data1.Depth, file = "안성통합(Depth모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.Depth = read.csv("안성통합(Depth모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.Depth, reorder(Model, RMSE, median , na.rm=T))
    Depth.model.RMSE.plot <- ggplot(data = big_data1.Depth, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Depth")
    new_order2 <- with(big_data1.Depth, reorder(Model, MAE, median , na.rm=T))
    Depth.model.MAE.plot <- ggplot(data = big_data1.Depth, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Depth")
    new_order3 <- with(big_data1.Depth, reorder(Model, -R2.train, median , na.rm=T))
    Depth.model.R2.train.plot <- ggplot(data = big_data1.Depth, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Depth")
    new_order4 <- with(big_data1.Depth, reorder(Model, -R2.lm, median , na.rm=T))
    Depth.model.R2.lm.plot <- ggplot(data = big_data1.Depth, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Depth")
    new_order5 <- with(big_data1.Depth, reorder(Model, -R2.test, median , na.rm=T))
    Depth.model.R2.test.plot <- ggplot(data = big_data1.Depth, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Depth")
    
    big_data1.Depth %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.Depth %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  
  Depth.model.RMSE.plot
  Depth.model.MAE.plot
  Depth.model.R2.train.plot
  Depth.model.R2.test.plot
  Depth.model.R2.lm.plot
  #========================
  #pH
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$pH.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(pH.ob ~ pH.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[17])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$pH.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(pH.ob ~ pH.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[17])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$pH.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(pH.ob ~ pH.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[17])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$pH.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(pH.ob ~ pH.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[17])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$pH.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(pH.ob ~ pH.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[17])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$pH.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(pH.ob ~ pH.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[17])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$pH.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$pH.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(pH.ob ~ pH.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[17])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$pH.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(pH.ob ~ pH.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[17])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$pH.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(pH.ob ~ pH.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[17])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$pH.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(pH.ob ~ pH.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[17])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$pH.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(pH.ob ~ pH.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[17])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$pH.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(pH.ob ~ pH.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$pH.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.pH = do.call(rbind, datalist)
    # write.csv(big_data1.pH, file = "안성통합(pH모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.pH = read.csv("안성통합(pH모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.pH, reorder(Model, RMSE, median , na.rm=T))
    pH.model.RMSE.plot <- ggplot(data = big_data1.pH, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("pH")
    new_order2 <- with(big_data1.pH, reorder(Model, MAE, median , na.rm=T))
    pH.model.MAE.plot <- ggplot(data = big_data1.pH, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("pH")
    new_order3 <- with(big_data1.pH, reorder(Model, -R2.train, median , na.rm=T))
    pH.model.R2.train.plot <- ggplot(data = big_data1.pH, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("pH")
    new_order4 <- with(big_data1.pH, reorder(Model, -R2.lm, median , na.rm=T))
    pH.model.R2.lm.plot <- ggplot(data = big_data1.pH, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("pH")
    new_order5 <- with(big_data1.pH, reorder(Model, -R2.test, median , na.rm=T))
    pH.model.R2.test.plot <- ggplot(data = big_data1.pH, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("pH")
    
    big_data1.pH %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.pH %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  pH.model.RMSE.plot
  pH.model.MAE.plot
  pH.model.R2.train.plot
  pH.model.R2.test.plot
  pH.model.R2.lm.plot
  #========================
  #ORP
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$ORP.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(ORP.ob ~ ORP.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[18])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$ORP.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(ORP.ob ~ ORP.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[18])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$ORP.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(ORP.ob ~ ORP.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[18])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$ORP.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(ORP.ob ~ ORP.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[18])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$ORP.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(ORP.ob ~ ORP.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[18])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$ORP.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(ORP.ob ~ ORP.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[18])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$ORP.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$ORP.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(ORP.ob ~ ORP.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[18])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$ORP.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(ORP.ob ~ ORP.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[18])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$ORP.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(ORP.ob ~ ORP.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[18])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$ORP.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(ORP.ob ~ ORP.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[18])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$ORP.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(ORP.ob ~ ORP.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[18])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$ORP.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(ORP.ob ~ ORP.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$ORP.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.ORP = do.call(rbind, datalist)
    # write.csv(big_data1.ORP, file = "안성통합(ORP모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.ORP = read.csv("안성통합(ORP모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.ORP, reorder(Model, RMSE, median , na.rm=T))
    ORP.model.RMSE.plot <- ggplot(data = big_data1.ORP, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("ORP")
    new_order2 <- with(big_data1.ORP, reorder(Model, MAE, median , na.rm=T))
    ORP.model.MAE.plot <- ggplot(data = big_data1.ORP, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("ORP")
    new_order3 <- with(big_data1.ORP, reorder(Model, -R2.train, median , na.rm=T))
    ORP.model.R2.train.plot <- ggplot(data = big_data1.ORP, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("ORP")
    new_order4 <- with(big_data1.ORP, reorder(Model, -R2.lm, median , na.rm=T))
    ORP.model.R2.lm.plot <- ggplot(data = big_data1.ORP, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("ORP")
    new_order5 <- with(big_data1.ORP, reorder(Model, -R2.test, median , na.rm=T))
    ORP.model.R2.test.plot <- ggplot(data = big_data1.ORP, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("ORP")
    
    big_data1.ORP %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.ORP %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  ORP.model.RMSE.plot
  ORP.model.MAE.plot
  ORP.model.R2.train.plot
  ORP.model.R2.test.plot
  ORP.model.R2.lm.plot
  #========================
  #EC
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$EC.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(EC.ob ~ EC.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[19])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$EC.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(EC.ob ~ EC.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[19])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$EC.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(EC.ob ~ EC.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[19])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$EC.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(EC.ob ~ EC.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[19])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$EC.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(EC.ob ~ EC.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[19])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$EC.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(EC.ob ~ EC.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[19])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$EC.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$EC.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(EC.ob ~ EC.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[19])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$EC.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(EC.ob ~ EC.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[19])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$EC.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(EC.ob ~ EC.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[19])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$EC.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(EC.ob ~ EC.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[19])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$EC.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(EC.ob ~ EC.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[19])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$EC.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(EC.ob ~ EC.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$EC.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.EC = do.call(rbind, datalist)
    # write.csv(big_data1.EC, file = "안성통합(EC모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.EC = read.csv("안성통합(EC모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.EC, reorder(Model, RMSE, median , na.rm=T))
    EC.model.RMSE.plot <- ggplot(data = big_data1.EC, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("EC")
    new_order2 <- with(big_data1.EC, reorder(Model, MAE, median , na.rm=T))
    EC.model.MAE.plot <- ggplot(data = big_data1.EC, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("EC")
    new_order3 <- with(big_data1.EC, reorder(Model, -R2.train, median , na.rm=T))
    EC.model.R2.train.plot <- ggplot(data = big_data1.EC, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("EC")
    new_order4 <- with(big_data1.EC, reorder(Model, -R2.lm, median , na.rm=T))
    EC.model.R2.lm.plot <- ggplot(data = big_data1.EC, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("EC")
    new_order5 <- with(big_data1.EC, reorder(Model, -R2.test, median , na.rm=T))
    EC.model.R2.test.plot <- ggplot(data = big_data1.EC, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("EC")
    
    big_data1.EC %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.EC %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  EC.model.RMSE.plot
  EC.model.MAE.plot
  EC.model.R2.train.plot
  EC.model.R2.test.plot
  EC.model.R2.lm.plot
  #========================
  #Turbidity
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Turbidity.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[20])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$Turbidity.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[20])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$Turbidity.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[20])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$Turbidity.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[20])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$Turbidity.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[20])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$Turbidity.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[20])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$Turbidity.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$Turbidity.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[20])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$Turbidity.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[20])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$Turbidity.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[20])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$Turbidity.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[20])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$Turbidity.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[20])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$Turbidity.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(Turbidity.ob ~ Turbidity.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$Turbidity.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.Turbidity = do.call(rbind, datalist)
    # write.csv(big_data1.Turbidity, file = "안성통합(Turbidity모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.Turbidity = read.csv("안성통합(Turbidity모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.Turbidity, reorder(Model, RMSE, median , na.rm=T))
    Turbidity.model.RMSE.plot <- ggplot(data = big_data1.Turbidity, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Turbidity") +xlim(50,110)
    new_order2 <- with(big_data1.Turbidity, reorder(Model, MAE, median , na.rm=T))
    Turbidity.model.MAE.plot <- ggplot(data = big_data1.Turbidity, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Turbidity")
    new_order3 <- with(big_data1.Turbidity, reorder(Model, -R2.train, median , na.rm=T))
    Turbidity.model.R2.train.plot <- ggplot(data = big_data1.Turbidity, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Turbidity")
    new_order4 <- with(big_data1.Turbidity, reorder(Model, -R2.lm, median , na.rm=T))
    Turbidity.model.R2.lm.plot <- ggplot(data = big_data1.Turbidity, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Turbidity")
    new_order5 <- with(big_data1.Turbidity, reorder(Model, -R2.test, median , na.rm=T))
    Turbidity.model.R2.test.plot <- ggplot(data = big_data1.Turbidity, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Turbidity")
    
    big_data1.Turbidity %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.Turbidity %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  Turbidity.model.RMSE.plot
  Turbidity.model.MAE.plot
  Turbidity.model.R2.train.plot
  Turbidity.model.R2.test.plot
  Turbidity.model.R2.lm.plot
  #========================
  #TDS
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$TDS.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(TDS.ob ~ TDS.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[21])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$TDS.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(TDS.ob ~ TDS.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[21])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$TDS.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(TDS.ob ~ TDS.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[21])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$TDS.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(TDS.ob ~ TDS.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[21])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$TDS.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(TDS.ob ~ TDS.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[21])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$TDS.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(TDS.ob ~ TDS.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[21])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$TDS.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$TDS.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(TDS.ob ~ TDS.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[21])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$TDS.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(TDS.ob ~ TDS.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[21])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$TDS.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(TDS.ob ~ TDS.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[21])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$TDS.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(TDS.ob ~ TDS.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[21])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$TDS.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(TDS.ob ~ TDS.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[21])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$TDS.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(TDS.ob ~ TDS.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$TDS.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.TDS = do.call(rbind, datalist)
    # write.csv(big_data1.TDS, file = "안성통합(TDS모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.TDS = read.csv("안성통합(TDS모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.TDS, reorder(Model, RMSE, median , na.rm=T))
    TDS.model.RMSE.plot <- ggplot(data = big_data1.TDS, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("TDS")
    new_order2 <- with(big_data1.TDS, reorder(Model, MAE, median , na.rm=T))
    TDS.model.MAE.plot <- ggplot(data = big_data1.TDS, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("TDS")
    new_order3 <- with(big_data1.TDS, reorder(Model, -R2.train, median , na.rm=T))
    TDS.model.R2.train.plot <- ggplot(data = big_data1.TDS, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("TDS")
    new_order4 <- with(big_data1.TDS, reorder(Model, -R2.lm, median , na.rm=T))
    TDS.model.R2.lm.plot <- ggplot(data = big_data1.TDS, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("TDS")
    new_order5 <- with(big_data1.TDS, reorder(Model, -R2.test, median , na.rm=T))
    TDS.model.R2.test.plot <- ggplot(data = big_data1.TDS, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("TDS")
    
    big_data1.TDS %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.TDS %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  TDS.model.RMSE.plot
  TDS.model.MAE.plot
  TDS.model.R2.train.plot
  TDS.model.R2.test.plot
  TDS.model.R2.lm.plot
  #========================
  #Salinity
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Salinity.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[22])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$Salinity.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[22])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$Salinity.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[22])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$Salinity.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[22])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$Salinity.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[22])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$Salinity.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[22])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$Salinity.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$Salinity.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[22])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$Salinity.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[22])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$Salinity.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[22])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$Salinity.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[22])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$Salinity.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[22])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$Salinity.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(Salinity.ob ~ Salinity.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$Salinity.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.Salinity = do.call(rbind, datalist)
    # write.csv(big_data1.Salinity, file = "안성통합(Salinity모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.Salinity = read.csv("안성통합(Salinity모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.Salinity, reorder(Model, RMSE, median , na.rm=T))
    Salinity.model.RMSE.plot <- ggplot(data = big_data1.Salinity, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Salinity") + xlim(0.06,0.11)
    new_order2 <- with(big_data1.Salinity, reorder(Model, MAE, median , na.rm=T))
    Salinity.model.MAE.plot <- ggplot(data = big_data1.Salinity, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Salinity")
    new_order3 <- with(big_data1.Salinity, reorder(Model, -R2.train, median , na.rm=T))
    Salinity.model.R2.train.plot <- ggplot(data = big_data1.Salinity, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Salinity")
    new_order4 <- with(big_data1.Salinity, reorder(Model, -R2.lm, median , na.rm=T))
    Salinity.model.R2.lm.plot <- ggplot(data = big_data1.Salinity, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Salinity")
    new_order5 <- with(big_data1.Salinity, reorder(Model, -R2.test, median , na.rm=T))
    Salinity.model.R2.test.plot <- ggplot(data = big_data1.Salinity, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Salinity")
    
    big_data1.Salinity %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.Salinity %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  Salinity.model.RMSE.plot
  Salinity.model.MAE.plot
  Salinity.model.R2.train.plot
  Salinity.model.R2.test.plot
  Salinity.model.R2.lm.plot
  #========================
  #NH3.N
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[23])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$NH3.N.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[23])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$NH3.N.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[23])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$NH3.N.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[23])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$NH3.N.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[23])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$NH3.N.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[23])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$NH3.N.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$NH3.N.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[23])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$NH3.N.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[23])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$NH3.N.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[23])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$NH3.N.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[23])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$NH3.N.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[23])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$NH3.N.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(NH3.N.ob ~ NH3.N.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$NH3.N.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.NH3.N = do.call(rbind, datalist)
    # write.csv(big_data1.NH3.N, file = "안성통합(NH3.N모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.NH3.N = read.csv("안성통합(NH3.N모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.NH3.N, reorder(Model, RMSE, median , na.rm=T))
    NH3.N.model.RMSE.plot <- ggplot(data = big_data1.NH3.N, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NH3-N")
    new_order2 <- with(big_data1.NH3.N, reorder(Model, MAE, median , na.rm=T))
    NH3.N.model.MAE.plot <- ggplot(data = big_data1.NH3.N, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NH3.N")
    new_order3 <- with(big_data1.NH3.N, reorder(Model, -R2.train, median , na.rm=T))
    NH3.N.model.R2.train.plot <- ggplot(data = big_data1.NH3.N, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NH3.N")
    new_order4 <- with(big_data1.NH3.N, reorder(Model, -R2.lm, median , na.rm=T))
    NH3.N.model.R2.lm.plot <- ggplot(data = big_data1.NH3.N, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NH3.N")
    new_order5 <- with(big_data1.NH3.N, reorder(Model, -R2.test, median , na.rm=T))
    NH3.N.model.R2.test.plot <- ggplot(data = big_data1.NH3.N, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NH3.N")
    
    big_data1.NH3.N %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.NH3.N %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  NH3.N.model.RMSE.plot
  NH3.N.model.MAE.plot
  NH3.N.model.R2.train.plot
  NH3.N.model.R2.test.plot
  NH3.N.model.R2.lm.plot
  #========================
  #NO3.N
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    mset$NO3.N.ob[mset$NO3.N.ob %in% "NA"] <- NA
    mset = mset[complete.cases(mset), ]
    inTraining <- createDataPartition(mset$NO3.N.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[24])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$NO3.N.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[24])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$NO3.N.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[24])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$NO3.N.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[24])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$NO3.N.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[24])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$NO3.N.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[24])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$NO3.N.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$NO3.N.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[24])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$NO3.N.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[24])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$NO3.N.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[24])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$NO3.N.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[24])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$NO3.N.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[24])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$NO3.N.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(NO3.N.ob ~ NO3.N.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$NO3.N.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.NO3.N = do.call(rbind, datalist)
    # write.csv(big_data1.NO3.N, file = "안성통합(NO3.N모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.NO3.N = read.csv("안성통합(NO3.N모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.NO3.N, reorder(Model, RMSE, median , na.rm=T))
    NO3.N.model.RMSE.plot <- ggplot(data = big_data1.NO3.N, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NO3-N")+xlim(12,21)
    new_order2 <- with(big_data1.NO3.N, reorder(Model, MAE, median , na.rm=T))
    NO3.N.model.MAE.plot <- ggplot(data = big_data1.NO3.N, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NO3.N")
    new_order3 <- with(big_data1.NO3.N, reorder(Model, -R2.train, median , na.rm=T))
    NO3.N.model.R2.train.plot <- ggplot(data = big_data1.NO3.N, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NO3.N")
    new_order4 <- with(big_data1.NO3.N, reorder(Model, -R2.lm, median , na.rm=T))
    NO3.N.model.R2.lm.plot <- ggplot(data = big_data1.NO3.N, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NO3.N")
    new_order5 <- with(big_data1.NO3.N, reorder(Model, -R2.test, median , na.rm=T))
    NO3.N.model.R2.test.plot <- ggplot(data = big_data1.NO3.N, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("NO3.N")
    
    big_data1.NO3.N %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.NO3.N %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  NO3.N.model.RMSE.plot
  NO3.N.model.MAE.plot
  NO3.N.model.R2.train.plot
  NO3.N.model.R2.test.plot
  NO3.N.model.R2.lm.plot
  #========================
  #Cl
  datalist = list()
  for (i in 1:20) {
    # set.seed(i)
    ti = e34568
    head(ti)
    px = as.data.frame(ti)
    head(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Cl.ob, p = .70, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    #===
    model.lm <- train(Cl.ob ~ Cl.pp,data = train,method = 'lm')
    model.lm$results$RMSE
    model.lm$results$MAE
    model.lm$results$Rsquared
    
    pv=predict(model.lm, test[25])
    pv.lm =as.data.frame (pv)
    head(pv.lm)
    test.lm = cbind(test$Cl.ob, pv.lm$pv)
    test.lm = as.data.frame(test.lm)
    head(test.lm)
    
    lm1 = lm(V2 ~ V1, test.lm)
    summary(lm1)
    summary(lm1)$adj.r.squared
    
    lm.r <- cor(test.lm$V2, test.lm$V1)^2
    lm.r
    #===
    model.rf <- train(Cl.ob ~ Cl.pp,data = train,method = 'rf')
    model.rf$results$RMSE
    model.rf$results$MAE
    
    pv=predict(model.rf, test[25])
    pv.rf =as.data.frame (pv)
    head(pv.rf)
    test.rf = cbind(test$Cl.ob, pv.rf$pv)
    test.rf = as.data.frame(test.rf)
    head(test.rf)
    
    lm2 = lm(V2 ~ V1, test.rf)
    summary(lm2)
    summary(lm2)$adj.r.squared
    
    rf.r <- cor(test.rf$V2, test.rf$V1)^2
    rf.r
    #===
    model.glm <- train(Cl.ob ~ Cl.pp,data = train,method = 'glm')
    model.glm$results$RMSE
    model.glm$results$MAE
    model.glm
    
    pv=predict(model.glm, test[25])
    pv.glm =as.data.frame (pv)
    head(pv.glm)
    test.glm = cbind(test$Cl.ob, pv.glm$pv)
    test.glm = as.data.frame(test.glm)
    head(test.glm)
    
    lm3 = lm(V2 ~ V1, test.glm)
    summary(lm3)
    summary(lm3)$adj.r.squared
    
    glm.r <- cor(test.glm$V2, test.glm$V1)^2
    glm.r
    #===
    model.bayesglm <- train(Cl.ob ~ Cl.pp,data = train,method = 'bayesglm')
    model.bayesglm$results$RMSE
    model.bayesglm$results$MAE
    
    pv=predict(model.bayesglm, test[25])
    pv.bayesglm =as.data.frame (pv)
    head(pv.bayesglm)
    test.bayesglm = cbind(test$Cl.ob, pv.bayesglm$pv)
    test.bayesglm = as.data.frame(test.bayesglm)
    head(test.bayesglm)
    
    lm4 = lm(V2 ~ V1, test.bayesglm)
    summary(lm4)
    summary(lm4)$adj.r.squared
    
    bayesglm.r <- cor(test.bayesglm$V2, test.bayesglm$V1)^2
    bayesglm.r
    #===
    model.glmboost <- train(Cl.ob ~ Cl.pp,data = train,method = 'glmboost')
    model.glmboost$results$RMSE[1]
    model.glmboost$results$MAE[1]
    
    pv=predict(model.glmboost, test[25])
    pv.glmboost =as.data.frame (pv)
    head(pv.glmboost)
    test.glmboost = cbind(test$Cl.ob, pv.glmboost$V1)
    test.glmboost = as.data.frame(test.glmboost)
    head(test.glmboost)
    
    lm5 = lm(V2 ~ V1, test.glmboost)
    summary(lm5)
    summary(lm5)$adj.r.squared
    
    glmboost.r <- cor(test.glmboost$V2, test.glmboost$V1)^2
    glmboost.r
    #===
    model.BstLm <- train(Cl.ob ~ Cl.pp,data = train,method = 'BstLm')
    model.BstLm$results$RMSE[1]
    model.BstLm$results$MAE[1]
    
    pv=predict(model.BstLm, test[25])
    pv.BstLm =as.data.frame (pv)
    head(pv.BstLm)
    test.BstLm = cbind(test$Cl.ob, pv.BstLm$pv)
    test.BstLm = as.data.frame(test.BstLm)
    head(test.BstLm)
    
    R2(pv.BstLm, test$Cl.ob)
    
    lm6 = lm(V2 ~ V1, test.BstLm)
    summary(lm6)
    summary(lm6)$adj.r.squared
    
    BstLm.r <- cor(test.BstLm$V2, test.BstLm$V1)^2
    BstLm.r
    #===
    model.gausL <- train(Cl.ob ~ Cl.pp,data = train,method = 'gaussprLinear')
    model.gausL$results$RMSE
    model.gausL$results$MAE
    model.gausL
    
    pv=predict(model.gausL, test[25])
    pv.gausL =as.data.frame (pv)
    head(pv.gausL)
    test.gausL = cbind(test$Cl.ob, pv.gausL$pv)
    test.gausL = as.data.frame(test.gausL)
    head(test.gausL)
    
    lm7 = lm(V2 ~ V1, test.gausL)
    summary(lm7)
    summary(lm7)$adj.r.squared
    
    sst = sum((test.gausL$V1-mean(test.gausL$V1))^2)
    sse = sum((test.gausL$V2-mean(test.gausL$V1))^2)
    gausL.r <- cor(test.gausL$V2, test.gausL$V1)^2
    gausL.r
    #===
    model.gausr <- train(Cl.ob ~ Cl.pp,data = train,method = 'gaussprRadial')
    model.gausr$results$RMSE
    model.gausr$results$MAE
    
    pv=predict(model.gausr, test[25])
    pv.gausr =as.data.frame (pv)
    head(pv.gausr)
    test.gausr = cbind(test$Cl.ob, pv.gausr$pv)
    test.gausr = as.data.frame(test.gausr)
    head(test.gausr)
    lm8 = lm(V2 ~ V1, test.gausr)
    summary(lm8)
    summary(lm8)$adj.r.squared
    
    gausr.r <- cor(test.gausr$V2, test.gausr$V1)^2
    gausr.r
    #===
    model.svmLinear <- train(Cl.ob ~ Cl.pp,data = train,method = 'svmLinear')
    model.svmLinear$results$RMSE
    model.svmLinear$results$MAE
    
    pv=predict(model.svmLinear, test[25])
    pv.svmLinear =as.data.frame (pv)
    head(pv.svmLinear)
    test.svmLinear = cbind(test$Cl.ob, pv.svmLinear$pv)
    test.svmLinear = as.data.frame(test.svmLinear)
    head(test.svmLinear)
    
    lm9 = lm(V2 ~ V1, test.svmLinear)
    summary(lm9)
    summary(lm9)$adj.r.squared
    
    svmLinear.r <- cor(test.svmLinear$V2, test.svmLinear$V1)^2
    svmLinear.r
    #===
    model.svmRadial <- train(Cl.ob ~ Cl.pp,data = train,method = 'svmRadial')
    model.svmRadial$results$RMSE[1]
    model.svmRadial$results$MAE[1]
    
    pv=predict(model.svmRadial, test[25])
    pv.svmRadial =as.data.frame (pv)
    head(pv.svmRadial)
    test.svmRadial = cbind(test$Cl.ob, pv.svmRadial$pv)
    test.svmRadial = as.data.frame(test.svmRadial)
    head(test.svmRadial)
    
    lm10 = lm(V2 ~ V1, test.svmRadial)
    summary(lm10)
    summary(lm10)$adj.r.squared
    
    svmRadial.r <- cor(test.svmRadial$V2, test.svmRadial$V1)^2
    svmRadial.r
    #===
    model.ppr <- train(Cl.ob ~ Cl.pp,data = train,method = 'ppr')
    model.ppr$results$RMSE[1]
    model.ppr$results$MAE[1]
    
    pv=predict(model.ppr, test[25])
    pv.ppr =as.data.frame (pv)
    head(pv.ppr)
    test.ppr = cbind(test$Cl.ob, pv.ppr$pv)
    test.ppr = as.data.frame(test.ppr)
    head(test.ppr)
    
    lm11 = lm(V2 ~ V1, test.ppr)
    summary(lm11)
    summary(lm11)$adj.r.squared
    
    ppr.r <- cor(test.ppr$V2, test.ppr$V1)^2
    ppr.r
    #===
    # model.ANN <- train(Cl.ob ~ Cl.pp,data = train,method = 'avNNet')
    # model.ANN
    # model.ANN$results$RMSE[1]
    # model.ANN$results$MAE[1]
    # 
    # pv=predict(model.ANN, test[16])
    # pv.ANN =as.data.frame (pv)
    # head(pv.ANN)
    # test.ANN = cbind(test$Cl.ob, pv.ANN$pv)
    # test.ANN = as.data.frame(test.ANN)
    # head(test.ANN)
    # 
    # lm12 = lm(V2 ~ V1, test.ANN)
    # summary(lm12)
    # summary(lm12)$adj.r.squared
    #===
    model.cp <- data.frame(Model = c("lm",
                                     "Rf",
                                     "Glm",
                                     "Bayesian glm",
                                     "Boosted glm",
                                     "Boosted lm",
                                     "Gaussian Linear",
                                     "Gaussian Radial",
                                     "SVM Linear",
                                     "SVM Radial",
                                     "PPR"),
                           # "ANN"),
                           RMSE = c(model.lm$results$RMSE,
                                    model.rf$results$RMSE,
                                    model.glm$results$RMSE,
                                    model.bayesglm$results$RMSE,
                                    model.glmboost$results$RMSE[1],
                                    model.BstLm$results$RMSE[1],
                                    model.gausL$results$RMSE,
                                    model.gausr$results$RMSE,
                                    model.svmLinear$results$RMSE,
                                    model.svmRadial$results$RMSE[1],
                                    model.ppr$results$RMSE[1]),
                           # model.ANN$results$RMSE[1]),
                           MAE = c(model.lm$results$MAE,
                                   model.rf$results$MAE,
                                   model.glm$results$MAE,
                                   model.bayesglm$results$MAE,
                                   model.glmboost$results$MAE[1],
                                   model.BstLm$results$MAE[1],
                                   model.gausL$results$MAE,
                                   model.gausr$results$MAE,
                                   model.svmLinear$results$MAE,
                                   model.svmRadial$results$MAE[1],
                                   model.ppr$results$MAE[1]),
                           # model.ANN$results$MAE[1]),
                           R2.train = c(model.lm$results$Rsquared,
                                        model.rf$results$Rsquared,
                                        model.glm$results$Rsquared,
                                        model.bayesglm$results$Rsquared,
                                        model.glmboost$results$Rsquared[1],
                                        model.BstLm$results$Rsquared[1],
                                        model.gausL$results$Rsquared,
                                        model.gausr$results$Rsquared,
                                        model.svmLinear$results$Rsquared,
                                        model.svmRadial$results$Rsquared[1],
                                        model.ppr$results$Rsquared[1]),
                           R2.lm = c(summary(lm1)$adj.r.squared,
                                     summary(lm2)$adj.r.squared,
                                     summary(lm3)$adj.r.squared,
                                     summary(lm4)$adj.r.squared,
                                     summary(lm5)$adj.r.squared,
                                     summary(lm6)$adj.r.squared,
                                     summary(lm7)$adj.r.squared,
                                     summary(lm8)$adj.r.squared,
                                     summary(lm9)$adj.r.squared,
                                     summary(lm10)$adj.r.squared,
                                     summary(lm11)$adj.r.squared),
                           R2.test = c(lm.r,rf.r,glm.r,bayesglm.r,glmboost.r,BstLm.r,gausL.r,gausr.r,svmLinear.r,svmRadial.r,ppr.r))
    
    # summary(lm12)$adj.r.squared))
    
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  {  
    # big_data1.Cl = do.call(rbind, datalist)
    # write.csv(big_data1.Cl, file = "안성통합(Cl모델선정).csv", na="-", fileEncoding = "CP949")
    big_data1.Cl = read.csv("안성통합(Cl모델선정).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    new_order1 <- with(big_data1.Cl, reorder(Model, RMSE, median , na.rm=T))
    Cl.model.RMSE.plot <- ggplot(data = big_data1.Cl, aes(x = RMSE, y = new_order1, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Cl")
    new_order2 <- with(big_data1.Cl, reorder(Model, MAE, median , na.rm=T))
    Cl.model.MAE.plot <- ggplot(data = big_data1.Cl, aes(x = MAE, y = new_order2, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Cl")
    new_order3 <- with(big_data1.Cl, reorder(Model, -R2.train, median , na.rm=T))
    Cl.model.R2.train.plot <- ggplot(data = big_data1.Cl, aes(x = R2.train, y = new_order3, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Cl")
    new_order4 <- with(big_data1.Cl, reorder(Model, -R2.lm, median , na.rm=T))
    Cl.model.R2.lm.plot <- ggplot(data = big_data1.Cl, aes(x = R2.lm, y = new_order4, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Cl")
    new_order5 <- with(big_data1.Cl, reorder(Model, -R2.test, median , na.rm=T))
    Cl.model.R2.test.plot <- ggplot(data = big_data1.Cl, aes(x = R2.test, y = new_order5, fill = Model)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(hjust = 0.5, size = 30),
            axis.title.x = element_text(size=25),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=0),
            axis.text.y = element_text(size=20)) +
      ggtitle("Cl")
    
    big_data1.Cl %>% filter(Model == "lm") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "Rf") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "Glm") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "Bayesian glm") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "Boosted glm") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "Boosted lm") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "Gaussian Linear") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "Gaussian Radial") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "SVM Linear") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "SVM Radial") %>% summarise(median(RMSE))
    big_data1.Cl %>% filter(Model == "PPR") %>% summarise(median(RMSE))
  }
  Cl.model.RMSE.plot
  Cl.model.MAE.plot
  Cl.model.R2.train.plot
  Cl.model.R2.test.plot
  Cl.model.R2.lm.plot
}
#수질 인자 보정 알고리즘으로 SVM Radial 선정
#===============================================================================
#수분석 데이터의 아웃라이어 제거!
#눈으로 지움
#Data extraction 된 데이터
{
  n3 <- read_excel("품질관리(최종) 안성3.xlsx")
  n4 <- read_excel("품질관리(최종) 안성4.xlsx")
  n5 <- read_excel("품질관리(최종) 안성5.xlsx")
  n6 <- read_excel("품질관리(최종) 안성6.xlsx")
  n8 <- read_excel("품질관리(최종) 안성8.xlsx")
  
  n3$Date = as.Date(n3$Date)
  n4$Date = as.Date(n4$Date)
  n5$Date = as.Date(n5$Date)
  n6$Date = as.Date(n6$Date)
  n8$Date = as.Date(n8$Date)
  
  str(n3)
  str(n4)
  str(n5)
  str(n6)
  str(n8)
  
  head(n3)
  head(n4)
  head(n5)
  head(n6)
  head(n8)
  
  #여기에 수분석 데이터 불러오기
  x3 = read.csv("안성 수분석 관정3.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x4 = read.csv("안성 수분석 관정4.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x5 = read.csv("안성 수분석 관정5.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x6 = read.csv("안성 수분석 관정6.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x8 = read.csv("안성 수분석 관정8.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
}
{
  e3  <- read_excel("안성 관정3(ob,pp).xlsx")
  e4  <- read_excel("안성 관정4(ob,pp).xlsx")
  e5  <- read_excel("안성 관정5(ob,pp).xlsx")
  e6  <- read_excel("안성 관정6(ob,pp).xlsx")
  e8  <- read_excel("안성 관정8(ob,pp).xlsx")
  e34568  <- read_excel("안성 통합(ob,pp)outlier제거.xlsx")
  
  e3$Date = as.Date(e3$Date)
  e4$Date = as.Date(e4$Date)
  e5$Date = as.Date(e5$Date)
  e6$Date = as.Date(e6$Date)
  e8$Date = as.Date(e8$Date)
  e34568$Date = as.Date(e34568$Date)
  
  e3$NO3.N.ob = as.numeric(e3$NO3.N.ob)
  e4$NO3.N.ob = as.numeric(e4$NO3.N.ob)
  e5$NO3.N.ob = as.numeric(e5$NO3.N.ob)
  e6$NO3.N.ob = as.numeric(e6$NO3.N.ob)
  e8$NO3.N.ob = as.numeric(e8$NO3.N.ob)
  e34568$NO3.N.ob = as.numeric(e34568$NO3.N.ob)
}
#===============================================================================
#관정별 인자별 보정 모델 만들기
#안성 관정3
ti = e3
{
  #Depth
  {
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Depth.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  
  #Untuned(모델 생성)
  # Depth.svmRadial.default = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial')
  # Depth.svmRadial.default
  # saveRDS(Depth.svmRadial.default, "안성3.Depth.svmRadial.default.rds")
  Depth.svmRadial.default = readRDS("안성3.Depth.svmRadial.default.rds")
  Depth.svmRadial.default
  
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Depth.svmRadial.tuned = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5486:5), C = c(0.1,0.25,0.5,0.75,1)))
  # Depth.svmRadial.tuned
  # saveRDS(Depth.svmRadial.tuned, "안성3.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned = readRDS("안성3.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, test[14])
    Depth.default.test =as.data.frame (pv)
    head(Depth.default.test)
    names(Depth.default.test)[1] <- c("Depth.default.test")
    head(Depth.default.test)
    Depth.default.test = cbind(test$Depth.ob, Depth.default.test$Depth.default.test)
    Depth.default.test = as.data.frame(Depth.default.test)
    head(Depth.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, mset[14])
    Depth.default.mset =as.data.frame (pv)
    head(Depth.default.mset)
    names(Depth.default.mset)[1] <- c("Depth.default.mset")
    head(Depth.default.mset)
    Depth.default.mset = cbind(mset$Depth.ob, Depth.default.mset$Depth.default.mset)
    Depth.default.mset = as.data.frame(Depth.default.mset)
    head(Depth.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, test[14])
    Depth.tuned.test =as.data.frame (pv)
    head(Depth.tuned.test)
    names(Depth.tuned.test)[1] <- c("Depth.tuned.test")
    Depth.tuned.test = cbind(test$Depth.ob, Depth.tuned.test$Depth.tuned.test)
    Depth.tuned.test = as.data.frame(Depth.tuned.test)
    head(Depth.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, mset[14])
    Depth.tuned.mset =as.data.frame (pv)
    head(Depth.tuned.mset)
    names(Depth.tuned.mset)[1] <- c("Depth.tuned.mset")
    head(Depth.tuned.mset)
    Depth.tuned.mset = cbind(mset$Depth.ob, Depth.tuned.mset$Depth.tuned.mset)
    Depth.tuned.mset = as.data.frame(Depth.tuned.mset)
    head(Depth.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, n3[2])
    Depth.tuned.n3 =as.data.frame (pv)
    head(Depth.tuned.n3)
    names(Depth.tuned.n3)[1] <- c("Depth.tuned.n3")
    head(Depth.tuned.n3)
    Depth.tuned.n3 = cbind(n3[1], Depth.tuned.n3)
    head(Depth.tuned.n3)
  }
  
  #R^2
  lm1 = lm(V2 ~ V1, Depth.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.mset)
  summary(lm1)
  
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Depth.default.mset, Depth.tuned.mset,ti$Depth.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Depth.ob")
    names(plot1)[3] <- c("Depth.default.mset")
    names(plot1)[5] <- c("Depth.tuned.mset")
    names(plot1)[6] <- c("Depth.pp")
  }
  head(plot1)
  Depth  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Depth.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Depth.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Depth.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Depth.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Depth.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Depth') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Depth')
  Depth
  
  n3.Depth = ggplot() +
    geom_line(data = n3, aes(x = Date, y = Depth.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = Depth.tuned.n3, aes(x = Date, y = Depth.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Depth (m)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Depth (Well A)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.Depth
  
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.pp))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Depth.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Depth.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Depth (Well A)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.ob))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Depth.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Depth.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("Depth (Well A)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #pH
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$pH.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # pH.svmRadial.default = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial')
  # pH.svmRadial.default
  # saveRDS(pH.svmRadial.default, "안성3.pH.svmRadial.default.rds")
  pH.svmRadial.default = readRDS("안성3.pH.svmRadial.default.rds")
  pH.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # pH.svmRadial.tuned = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(50:60), C = c(0.1,0.25,0.5,0.75,1)))
  # pH.svmRadial.tuned
  # saveRDS(pH.svmRadial.tuned, "안성3.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned = readRDS("안성3.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned
  
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, test[16])
    pH.default.test =as.data.frame (pv)
    head(pH.default.test)
    names(pH.default.test)[1] <- c("pH.default.test")
    head(pH.default.test)
    pH.default.test = cbind(test$pH.ob, pH.default.test$pH.default.test)
    pH.default.test = as.data.frame(pH.default.test)
    head(pH.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, mset[16])
    pH.default.mset =as.data.frame (pv)
    head(pH.default.mset)
    names(pH.default.mset)[1] <- c("pH.default.mset")
    head(pH.default.mset)
    pH.default.mset = cbind(mset$pH.ob, pH.default.mset$pH.default.mset)
    pH.default.mset = as.data.frame(pH.default.mset)
    head(pH.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, test[16])
    pH.tuned.test =as.data.frame (pv)
    head(pH.tuned.test)
    names(pH.tuned.test)[1] <- c("pH.tuned.test")
    pH.tuned.test = cbind(test$pH.ob, pH.tuned.test$pH.tuned.test)
    pH.tuned.test = as.data.frame(pH.tuned.test)
    head(pH.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, mset[16])
    pH.tuned.mset =as.data.frame (pv)
    head(pH.tuned.mset)
    names(pH.tuned.mset)[1] <- c("pH.tuned.mset")
    head(pH.tuned.mset)
    pH.tuned.mset = cbind(mset$pH.ob, pH.tuned.mset$pH.tuned.mset)
    pH.tuned.mset = as.data.frame(pH.tuned.mset)
    head(pH.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, n3[4])
    pH.tuned.n3 =as.data.frame (pv)
    head(pH.tuned.n3)
    names(pH.tuned.n3)[1] <- c("pH.tuned.n3")
    head(pH.tuned.n3)
    pH.tuned.n3 = cbind(n3[1], pH.tuned.n3)
    head(pH.tuned.n3)
  }
  
  #R^2
  lm1 = lm(V2 ~ V1, pH.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, pH.default.mset, pH.tuned.mset,ti$pH.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("pH.ob")
    names(plot1)[3] <- c("pH.default.mset")
    names(plot1)[5] <- c("pH.tuned.mset")
    names(plot1)[6] <- c("pH.pp")
  }
  head(plot1)
  pH  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = pH.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = pH.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = pH.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = pH.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = pH.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('pH') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('pH')
  pH
  n3.pH = ggplot() +
    geom_line(data = n3, aes(x = Date, y = pH.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = pH.tuned.n3, aes(x = Date, y = pH.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = pH.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('pH')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("pH (Well A)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.pH
  
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.pp))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=pH.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=pH.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("pH (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.ob))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=pH.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=pH.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("pH (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #ORP
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$ORP.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # ORP.svmRadial.default = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial')
  # ORP.svmRadial.default
  # saveRDS(ORP.svmRadial.default, "안성3.ORP.svmRadial.default.rds")
  ORP.svmRadial.default = readRDS("안성3.ORP.svmRadial.default.rds")
  ORP.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # ORP.svmRadial.tuned = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5486:5), C = c(0.1,0.25,0.5,0.75,1)))
  # ORP.svmRadial.tuned
  # saveRDS(ORP.svmRadial.tuned, "안성3.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned = readRDS("안성3.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, test[17])
    ORP.default.test =as.data.frame (pv)
    head(ORP.default.test)
    names(ORP.default.test)[1] <- c("ORP.default.test")
    head(ORP.default.test)
    ORP.default.test = cbind(test$ORP.ob, ORP.default.test$ORP.default.test)
    ORP.default.test = as.data.frame(ORP.default.test)
    head(ORP.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, mset[17])
    ORP.default.mset =as.data.frame (pv)
    head(ORP.default.mset)
    names(ORP.default.mset)[1] <- c("ORP.default.mset")
    head(ORP.default.mset)
    ORP.default.mset = cbind(mset$ORP.ob, ORP.default.mset$ORP.default.mset)
    ORP.default.mset = as.data.frame(ORP.default.mset)
    head(ORP.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, test[17])
    ORP.tuned.test =as.data.frame (pv)
    head(ORP.tuned.test)
    names(ORP.tuned.test)[1] <- c("ORP.tuned.test")
    ORP.tuned.test = cbind(test$ORP.ob, ORP.tuned.test$ORP.tuned.test)
    ORP.tuned.test = as.data.frame(ORP.tuned.test)
    head(ORP.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, mset[17])
    ORP.tuned.mset =as.data.frame (pv)
    head(ORP.tuned.mset)
    names(ORP.tuned.mset)[1] <- c("ORP.tuned.mset")
    head(ORP.tuned.mset)
    ORP.tuned.mset = cbind(mset$ORP.ob, ORP.tuned.mset$ORP.tuned.mset)
    ORP.tuned.mset = as.data.frame(ORP.tuned.mset)
    head(ORP.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, n3[5])
    ORP.tuned.n3 =as.data.frame (pv)
    head(ORP.tuned.n3)
    names(ORP.tuned.n3)[1] <- c("ORP.tuned.n3")
    head(ORP.tuned.n3)
    ORP.tuned.n3 = cbind(n3[1], ORP.tuned.n3)
    head(ORP.tuned.n3)
  }
  #R^2
  lm1 = lm(V2 ~ V1, ORP.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.mset)
  summary(lm1)
  
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, ORP.default.mset, ORP.tuned.mset,ti$ORP.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("ORP.ob")
    names(plot1)[3] <- c("ORP.default.mset")
    names(plot1)[5] <- c("ORP.tuned.mset")
    names(plot1)[6] <- c("ORP.pp")
  }
  head(plot1)
  ORP  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = ORP.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = ORP.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = ORP.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = ORP.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = ORP.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('ORP') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('ORP')
  ORP
  n3.ORP = ggplot() +
    geom_line(data = n3, aes(x = Date, y = ORP.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = ORP.tuned.n3, aes(x = Date, y = ORP.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('ORP')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("ORP (안성3)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.ORP
  
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.pp))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=ORP.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=ORP.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("ORP (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.ob))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=ORP.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=ORP.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("ORP (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  
  #===========
  #EC
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$EC.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # EC.svmRadial.default = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial')
  # EC.svmRadial.default
  # saveRDS(EC.svmRadial.default, "안성3.EC.svmRadial.default.rds")
  EC.svmRadial.default = readRDS("안성3.EC.svmRadial.default.rds")
  EC.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # EC.svmRadial.tuned = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(50:60), C = c(0.1,0.25,0.5,0.75,1)))
  # EC.svmRadial.tuned
  # saveRDS(EC.svmRadial.tuned, "안성3.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned = readRDS("안성3.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, test[18])
    EC.default.test =as.data.frame (pv)
    head(EC.default.test)
    names(EC.default.test)[1] <- c("EC.default.test")
    head(EC.default.test)
    EC.default.test = cbind(test$EC.ob, EC.default.test$EC.default.test)
    EC.default.test = as.data.frame(EC.default.test)
    head(EC.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, mset[18])
    EC.default.mset =as.data.frame (pv)
    head(EC.default.mset)
    names(EC.default.mset)[1] <- c("EC.default.mset")
    head(EC.default.mset)
    EC.default.mset = cbind(mset$EC.ob, EC.default.mset$EC.default.mset)
    EC.default.mset = as.data.frame(EC.default.mset)
    head(EC.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, test[18])
    EC.tuned.test =as.data.frame (pv)
    head(EC.tuned.test)
    names(EC.tuned.test)[1] <- c("EC.tuned.test")
    EC.tuned.test = cbind(test$EC.ob, EC.tuned.test$EC.tuned.test)
    EC.tuned.test = as.data.frame(EC.tuned.test)
    head(EC.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, mset[18])
    EC.tuned.mset =as.data.frame (pv)
    head(EC.tuned.mset)
    names(EC.tuned.mset)[1] <- c("EC.tuned.mset")
    head(EC.tuned.mset)
    EC.tuned.mset = cbind(mset$EC.ob, EC.tuned.mset$EC.tuned.mset)
    EC.tuned.mset = as.data.frame(EC.tuned.mset)
    head(EC.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, n3[6])
    EC.tuned.n3 =as.data.frame (pv)
    head(EC.tuned.n3)
    names(EC.tuned.n3)[1] <- c("EC.tuned.n3")
    head(EC.tuned.n3)
    EC.tuned.n3 = cbind(n3[1], EC.tuned.n3)
    head(EC.tuned.n3)
  }
  #R^2
  lm1 = lm(V2 ~ V1, EC.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, EC.default.mset, EC.tuned.mset,ti$EC.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("EC.ob")
    names(plot1)[3] <- c("EC.default.mset")
    names(plot1)[5] <- c("EC.tuned.mset")
    names(plot1)[6] <- c("EC.pp")
  }
  head(plot1)
  EC  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = EC.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = EC.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = EC.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = EC.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = EC.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('EC') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('EC')
  EC
  n3.EC = ggplot() +
    geom_line(data = n3, aes(x = Date, y = EC.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = EC.tuned.n3, aes(x = Date, y = EC.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = EC.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('EC (μS/cm)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("EC (Well A)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.EC
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.pp))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=EC.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=EC.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("EC (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.ob))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=EC.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=EC.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("EC (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  
  #===========
  #Turbidity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Turbidity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Turbidity.svmRadial.default = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial')
  # Turbidity.svmRadial.default
  # saveRDS(Turbidity.svmRadial.default, "안성3.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default = readRDS("안성3.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Turbidity.svmRadial.tuned = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(10:20), C = c(0.1,0.25,0.5,0.75,1)))
  # Turbidity.svmRadial.tuned
  # saveRDS(Turbidity.svmRadial.tuned, "안성3.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned = readRDS("안성3.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, test[19])
    Turbidity.default.test =as.data.frame (pv)
    head(Turbidity.default.test)
    names(Turbidity.default.test)[1] <- c("Turbidity.default.test")
    head(Turbidity.default.test)
    Turbidity.default.test = cbind(test$Turbidity.ob, Turbidity.default.test$Turbidity.default.test)
    Turbidity.default.test = as.data.frame(Turbidity.default.test)
    head(Turbidity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, mset[19])
    Turbidity.default.mset =as.data.frame (pv)
    head(Turbidity.default.mset)
    names(Turbidity.default.mset)[1] <- c("Turbidity.default.mset")
    head(Turbidity.default.mset)
    Turbidity.default.mset = cbind(mset$Turbidity.ob, Turbidity.default.mset$Turbidity.default.mset)
    Turbidity.default.mset = as.data.frame(Turbidity.default.mset)
    head(Turbidity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, test[19])
    Turbidity.tuned.test =as.data.frame (pv)
    head(Turbidity.tuned.test)
    names(Turbidity.tuned.test)[1] <- c("Turbidity.tuned.test")
    Turbidity.tuned.test = cbind(test$Turbidity.ob, Turbidity.tuned.test$Turbidity.tuned.test)
    Turbidity.tuned.test = as.data.frame(Turbidity.tuned.test)
    head(Turbidity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, mset[19])
    Turbidity.tuned.mset =as.data.frame (pv)
    head(Turbidity.tuned.mset)
    names(Turbidity.tuned.mset)[1] <- c("Turbidity.tuned.mset")
    head(Turbidity.tuned.mset)
    Turbidity.tuned.mset = cbind(mset$Turbidity.ob, Turbidity.tuned.mset$Turbidity.tuned.mset)
    Turbidity.tuned.mset = as.data.frame(Turbidity.tuned.mset)
    head(Turbidity.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, n3[7])
    Turbidity.tuned.n3 =as.data.frame (pv)
    head(Turbidity.tuned.n3)
    names(Turbidity.tuned.n3)[1] <- c("Turbidity.tuned.n3")
    head(Turbidity.tuned.n3)
    Turbidity.tuned.n3 = cbind(n3[1], Turbidity.tuned.n3)
    head(Turbidity.tuned.n3)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Turbidity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.mset)
  summary(lm1)
  
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Turbidity.default.mset, Turbidity.tuned.mset,ti$Turbidity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Turbidity.ob")
    names(plot1)[3] <- c("Turbidity.default.mset")
    names(plot1)[5] <- c("Turbidity.tuned.mset")
    names(plot1)[6] <- c("Turbidity.pp")
  }
  head(plot1)
  Turbidity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Turbidity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Turbidity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Turbidity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Turbidity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Turbidity')
  Turbidity
  
  n3.Turbidity = ggplot() +
    geom_line(data = n3, aes(x = Date, y = Turbidity.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = Turbidity.tuned.n3, aes(x = Date, y = Turbidity.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = Turbidity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Turbidity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Turbidity (안성3)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.Turbidity
  
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.pp))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Turbidity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Turbidity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Turbidity (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.ob))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Turbidity.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Turbidity.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("Turbidity (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  
  #===========
  #TDS
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$TDS.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # TDS.svmRadial.default = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial')
  # TDS.svmRadial.default
  # saveRDS(TDS.svmRadial.default, "안성3.TDS.svmRadial.default.rds")
  TDS.svmRadial.default = readRDS("안성3.TDS.svmRadial.default.rds")
  TDS.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # TDS.svmRadial.tuned = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.145:5), C = c(0.1,0.25,0.5,0.75,1)))
  # TDS.svmRadial.tuned
  # saveRDS(TDS.svmRadial.tuned, "안성3.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned = readRDS("안성3.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, test[20])
    TDS.default.test =as.data.frame (pv)
    head(TDS.default.test)
    names(TDS.default.test)[1] <- c("TDS.default.test")
    head(TDS.default.test)
    TDS.default.test = cbind(test$TDS.ob, TDS.default.test$TDS.default.test)
    TDS.default.test = as.data.frame(TDS.default.test)
    head(TDS.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, mset[20])
    TDS.default.mset =as.data.frame (pv)
    head(TDS.default.mset)
    names(TDS.default.mset)[1] <- c("TDS.default.mset")
    head(TDS.default.mset)
    TDS.default.mset = cbind(mset$TDS.ob, TDS.default.mset$TDS.default.mset)
    TDS.default.mset = as.data.frame(TDS.default.mset)
    head(TDS.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, test[20])
    TDS.tuned.test =as.data.frame (pv)
    head(TDS.tuned.test)
    names(TDS.tuned.test)[1] <- c("TDS.tuned.test")
    TDS.tuned.test = cbind(test$TDS.ob, TDS.tuned.test$TDS.tuned.test)
    TDS.tuned.test = as.data.frame(TDS.tuned.test)
    head(TDS.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, mset[20])
    TDS.tuned.mset =as.data.frame (pv)
    head(TDS.tuned.mset)
    names(TDS.tuned.mset)[1] <- c("TDS.tuned.mset")
    head(TDS.tuned.mset)
    TDS.tuned.mset = cbind(mset$TDS.ob, TDS.tuned.mset$TDS.tuned.mset)
    TDS.tuned.mset = as.data.frame(TDS.tuned.mset)
    head(TDS.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, n3[8])
    TDS.tuned.n3 =as.data.frame (pv)
    head(TDS.tuned.n3)
    names(TDS.tuned.n3)[1] <- c("TDS.tuned.n3")
    head(TDS.tuned.n3)
    TDS.tuned.n3 = cbind(n3[1], TDS.tuned.n3)
    head(TDS.tuned.n3)
  }
  #R^2
  lm1 = lm(V2 ~ V1, TDS.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, TDS.default.mset, TDS.tuned.mset,ti$TDS.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("TDS.ob")
    names(plot1)[3] <- c("TDS.default.mset")
    names(plot1)[5] <- c("TDS.tuned.mset")
    names(plot1)[6] <- c("TDS.pp")
  }
  head(plot1)
  TDS  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = TDS.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = TDS.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = TDS.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = TDS.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = TDS.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('TDS') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('TDS')
  TDS
  n3.TDS = ggplot() +
    geom_line(data = n3, aes(x = Date, y = TDS.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = TDS.tuned.n3, aes(x = Date, y = TDS.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = TDS.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('TDS')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("TDS (안성3)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.TDS
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.pp))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=TDS.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=TDS.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("TDS (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.ob))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=TDS.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=TDS.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("TDS (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  
  #===========
  #Salinity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Salinity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Salinity.svmRadial.default = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial')
  # Salinity.svmRadial.default
  # saveRDS(Salinity.svmRadial.default, "안성3.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default = readRDS("안성3.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Salinity.svmRadial.tuned = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(5:15), C = c(0.1,0.25,0.5,0.75,1)))
  # Salinity.svmRadial.tuned
  # saveRDS(Salinity.svmRadial.tuned, "안성3.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned = readRDS("안성3.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, test[21])
    Salinity.default.test =as.data.frame (pv)
    head(Salinity.default.test)
    names(Salinity.default.test)[1] <- c("Salinity.default.test")
    head(Salinity.default.test)
    Salinity.default.test = cbind(test$Salinity.ob, Salinity.default.test$Salinity.default.test)
    Salinity.default.test = as.data.frame(Salinity.default.test)
    head(Salinity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, mset[21])
    Salinity.default.mset =as.data.frame (pv)
    head(Salinity.default.mset)
    names(Salinity.default.mset)[1] <- c("Salinity.default.mset")
    head(Salinity.default.mset)
    Salinity.default.mset = cbind(mset$Salinity.ob, Salinity.default.mset$Salinity.default.mset)
    Salinity.default.mset = as.data.frame(Salinity.default.mset)
    head(Salinity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, test[21])
    Salinity.tuned.test =as.data.frame (pv)
    head(Salinity.tuned.test)
    names(Salinity.tuned.test)[1] <- c("Salinity.tuned.test")
    Salinity.tuned.test = cbind(test$Salinity.ob, Salinity.tuned.test$Salinity.tuned.test)
    Salinity.tuned.test = as.data.frame(Salinity.tuned.test)
    head(Salinity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, mset[21])
    Salinity.tuned.mset =as.data.frame (pv)
    head(Salinity.tuned.mset)
    names(Salinity.tuned.mset)[1] <- c("Salinity.tuned.mset")
    head(Salinity.tuned.mset)
    Salinity.tuned.mset = cbind(mset$Salinity.ob, Salinity.tuned.mset$Salinity.tuned.mset)
    Salinity.tuned.mset = as.data.frame(Salinity.tuned.mset)
    head(Salinity.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, n3[9])
    Salinity.tuned.n3 =as.data.frame (pv)
    head(Salinity.tuned.n3)
    names(Salinity.tuned.n3)[1] <- c("Salinity.tuned.n3")
    head(Salinity.tuned.n3)
    Salinity.tuned.n3 = cbind(n3[1], Salinity.tuned.n3)
    head(Salinity.tuned.n3)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Salinity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Salinity.default.mset, Salinity.tuned.mset,ti$Salinity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Salinity.ob")
    names(plot1)[3] <- c("Salinity.default.mset")
    names(plot1)[5] <- c("Salinity.tuned.mset")
    names(plot1)[6] <- c("Salinity.pp")
  }
  head(plot1)
  Salinity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Salinity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Salinity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Salinity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Salinity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Salinity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Salinity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Salinity')
  Salinity
  n3.Salinity = ggplot() +
    geom_line(data = n3, aes(x = Date, y = Salinity.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = Salinity.tuned.n3, aes(x = Date, y = Salinity.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = Salinity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Salinity (안성3)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.Salinity
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.pp))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Salinity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Salinity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Salinity (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.ob))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Salinity.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Salinity.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("Salinity (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  
  #===========
  #NH3.N
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NH3.N.svmRadial.default = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial')
  # NH3.N.svmRadial.default
  # saveRDS(NH3.N.svmRadial.default, "안성3.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default = readRDS("안성3.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NH3.N.svmRadial.tuned = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5486:5), C = c(0.1,0.25,0.5,0.75,1)))
  # NH3.N.svmRadial.tuned
  # saveRDS(NH3.N.svmRadial.tuned, "안성3.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned = readRDS("안성3.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, test[22])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, mset[22])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, test[22])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, mset[22])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, n3[10])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(n3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NH3.N.default.mset, NH3.N.tuned.mset,ti$NH3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NH3.N.ob")
    names(plot1)[3] <- c("NH3.N.default.mset")
    names(plot1)[5] <- c("NH3.N.tuned.mset")
    names(plot1)[6] <- c("NH3.N.pp")
  }
  head(plot1)
  NH3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NH3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NH3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NH3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NH3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NH3.N')
  NH3.N
  n3.NH3.N = ggplot() +
    geom_line(data = n3, aes(x = Date, y = NH3.N.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NH3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NH3.N (안성3)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.NH3.N
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.pp))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NH3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NH3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NH3.N (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.ob))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NH3.N.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NH3.N.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("NH3.N (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  
  #===========
  #NO3.N
  {
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$NO3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NO3.N.svmRadial.default = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial')
  # NO3.N.svmRadial.default
  # saveRDS(NO3.N.svmRadial.default, "안성3.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default = readRDS("안성3.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NO3.N.svmRadial.tuned = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(20:30), C = c(0.1,0.25,0.5,0.75,1)))
  # NO3.N.svmRadial.tuned
  # saveRDS(NO3.N.svmRadial.tuned, "안성3.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned = readRDS("안성3.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, test[23])
    NO3.N.default.test =as.data.frame (pv)
    head(NO3.N.default.test)
    names(NO3.N.default.test)[1] <- c("NO3.N.default.test")
    head(NO3.N.default.test)
    NO3.N.default.test = cbind(test$NO3.N.ob, NO3.N.default.test$NO3.N.default.test)
    NO3.N.default.test = as.data.frame(NO3.N.default.test)
    head(NO3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, mset[23])
    NO3.N.default.mset =as.data.frame (pv)
    head(NO3.N.default.mset)
    names(NO3.N.default.mset)[1] <- c("NO3.N.default.mset")
    head(NO3.N.default.mset)
    NO3.N.default.mset = cbind(mset$NO3.N.ob, NO3.N.default.mset$NO3.N.default.mset)
    NO3.N.default.mset = as.data.frame(NO3.N.default.mset)
    head(NO3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, test[23])
    NO3.N.tuned.test =as.data.frame (pv)
    head(NO3.N.tuned.test)
    names(NO3.N.tuned.test)[1] <- c("NO3.N.tuned.test")
    NO3.N.tuned.test = cbind(test$NO3.N.ob, NO3.N.tuned.test$NO3.N.tuned.test)
    NO3.N.tuned.test = as.data.frame(NO3.N.tuned.test)
    head(NO3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, mset[23])
    NO3.N.tuned.mset =as.data.frame (pv)
    head(NO3.N.tuned.mset)
    names(NO3.N.tuned.mset)[1] <- c("NO3.N.tuned.mset")
    head(NO3.N.tuned.mset)
    NO3.N.tuned.mset = cbind(mset$NO3.N.ob, NO3.N.tuned.mset$NO3.N.tuned.mset)
    NO3.N.tuned.mset = as.data.frame(NO3.N.tuned.mset)
    head(NO3.N.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, n3[11])
    NO3.N.tuned.n3 =as.data.frame (pv)
    head(NO3.N.tuned.n3)
    names(NO3.N.tuned.n3)[1] <- c("NO3.N.tuned.n3")
    head(NO3.N.tuned.n3)
    NO3.N.tuned.n3 = cbind(n3[1], NO3.N.tuned.n3)
    head(NO3.N.tuned.n3)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NO3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NO3.N.default.mset, NO3.N.tuned.mset,ti$NO3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NO3.N.ob")
    names(plot1)[3] <- c("NO3.N.default.mset")
    names(plot1)[5] <- c("NO3.N.tuned.mset")
    names(plot1)[6] <- c("NO3.N.pp")
  }
  head(plot1)
  NO3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NO3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NO3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NO3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NO3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NO3.N')
  NO3.N
  n3.NO3.N = ggplot() +
    geom_line(data = n3, aes(x = Date, y = NO3.N.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = NO3.N.tuned.n3, aes(x = Date, y = NO3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NO3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NO3.N (안성3)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.NO3.N
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.pp))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NO3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NO3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NO3.N (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.ob))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NO3.N.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NO3.N.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("NO3.N (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  
  #===========
  #Cl
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Cl.svmRadial.default = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial')
  # Cl.svmRadial.default
  # saveRDS(Cl.svmRadial.default, "안성3.Cl.svmRadial.default.rds")
  Cl.svmRadial.default = readRDS("안성3.Cl.svmRadial.default.rds")
  Cl.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Cl.svmRadial.tuned = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.548:5), C = c(0.1,0.25,0.5,0.75,1)))
  # Cl.svmRadial.tuned
  # saveRDS(Cl.svmRadial.tuned, "안성3.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned = readRDS("안성3.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, test[24])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, mset[24])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, test[24])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, mset[24])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #안성3(안성3 시계열열 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, n3[12])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(n3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Cl.default.mset, Cl.tuned.mset,ti$Cl.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Cl.ob")
    names(plot1)[3] <- c("Cl.default.mset")
    names(plot1)[5] <- c("Cl.tuned.mset")
    names(plot1)[6] <- c("Cl.pp")
  }
  head(plot1)
  Cl  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Cl.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Cl.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Cl.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Cl.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Cl.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Cl') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Cl')
  Cl
  n3.Cl = ggplot() +
    geom_line(data = n3, aes(x = Date, y = Cl.pp), color = "dodgerblue3", size = 2) +
    geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Cl (Well A)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n3.Cl
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.pp))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Cl.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Cl.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Cl (안성3)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.ob))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Cl.pp), size = 3, col = "dodgerblue3") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Cl.pp),method = "lm", se = F, col = "dodgerblue3", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue3"),
      # axis.text.y.right=element_text(color="dodgerblue3")
    )+
    ggtitle("Cl (안성3)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
}
#-----------
#안성 관정4
ti = e4
{
  #Depth
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Depth.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Depth.svmRadial.default = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial')
  # Depth.svmRadial.default
  # saveRDS(Depth.svmRadial.default, "안성4.Depth.svmRadial.default.rds")
  Depth.svmRadial.default = readRDS("안성4.Depth.svmRadial.default.rds")
  Depth.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Depth.svmRadial.tuned = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5486:5), C = c(0.1,0.25,0.5,0.75,1)))
  # Depth.svmRadial.tuned
  # saveRDS(Depth.svmRadial.tuned, "안성4.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned = readRDS("안성4.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, test[14])
    Depth.default.test =as.data.frame (pv)
    head(Depth.default.test)
    names(Depth.default.test)[1] <- c("Depth.default.test")
    head(Depth.default.test)
    Depth.default.test = cbind(test$Depth.ob, Depth.default.test$Depth.default.test)
    Depth.default.test = as.data.frame(Depth.default.test)
    head(Depth.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, mset[14])
    Depth.default.mset =as.data.frame (pv)
    head(Depth.default.mset)
    names(Depth.default.mset)[1] <- c("Depth.default.mset")
    head(Depth.default.mset)
    Depth.default.mset = cbind(mset$Depth.ob, Depth.default.mset$Depth.default.mset)
    Depth.default.mset = as.data.frame(Depth.default.mset)
    head(Depth.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, test[14])
    Depth.tuned.test =as.data.frame (pv)
    head(Depth.tuned.test)
    names(Depth.tuned.test)[1] <- c("Depth.tuned.test")
    Depth.tuned.test = cbind(test$Depth.ob, Depth.tuned.test$Depth.tuned.test)
    Depth.tuned.test = as.data.frame(Depth.tuned.test)
    head(Depth.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, mset[14])
    Depth.tuned.mset =as.data.frame (pv)
    head(Depth.tuned.mset)
    names(Depth.tuned.mset)[1] <- c("Depth.tuned.mset")
    head(Depth.tuned.mset)
    Depth.tuned.mset = cbind(mset$Depth.ob, Depth.tuned.mset$Depth.tuned.mset)
    Depth.tuned.mset = as.data.frame(Depth.tuned.mset)
    head(Depth.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, n4[2])
    Depth.tuned.n4 =as.data.frame (pv)
    head(Depth.tuned.n4)
    names(Depth.tuned.n4)[1] <- c("Depth.tuned.n4")
    head(Depth.tuned.n4)
    Depth.tuned.n4 = cbind(n4[1], Depth.tuned.n4)
    head(Depth.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Depth.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Depth.default.mset, Depth.tuned.mset,ti$Depth.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Depth.ob")
    names(plot1)[3] <- c("Depth.default.mset")
    names(plot1)[5] <- c("Depth.tuned.mset")
    names(plot1)[6] <- c("Depth.pp")
  }
  head(plot1)
  Depth  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Depth.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Depth.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Depth.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Depth.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Depth.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Depth') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Depth')
  Depth
  n4.Depth = ggplot() +
    geom_line(data = n4, aes(x = Date, y = Depth.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Depth.tuned.n4, aes(x = Date, y = Depth.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Depth (m)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Depth (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.Depth
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.pp))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Depth.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Depth.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Depth (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.ob))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Depth.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Depth.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Depth (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #pH
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$pH.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # pH.svmRadial.default = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial')
  # pH.svmRadial.default
  # saveRDS(pH.svmRadial.default, "안성4.pH.svmRadial.default.rds")
  pH.svmRadial.default = readRDS("안성4.pH.svmRadial.default.rds")
  pH.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # pH.svmRadial.tuned = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(50:60), C = c(0.1,0.25,0.5,0.75,1)))
  # pH.svmRadial.tuned
  # saveRDS(pH.svmRadial.tuned, "안성4.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned = readRDS("안성4.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, test[16])
    pH.default.test =as.data.frame (pv)
    head(pH.default.test)
    names(pH.default.test)[1] <- c("pH.default.test")
    head(pH.default.test)
    pH.default.test = cbind(test$pH.ob, pH.default.test$pH.default.test)
    pH.default.test = as.data.frame(pH.default.test)
    head(pH.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, mset[16])
    pH.default.mset =as.data.frame (pv)
    head(pH.default.mset)
    names(pH.default.mset)[1] <- c("pH.default.mset")
    head(pH.default.mset)
    pH.default.mset = cbind(mset$pH.ob, pH.default.mset$pH.default.mset)
    pH.default.mset = as.data.frame(pH.default.mset)
    head(pH.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, test[16])
    pH.tuned.test =as.data.frame (pv)
    head(pH.tuned.test)
    names(pH.tuned.test)[1] <- c("pH.tuned.test")
    pH.tuned.test = cbind(test$pH.ob, pH.tuned.test$pH.tuned.test)
    pH.tuned.test = as.data.frame(pH.tuned.test)
    head(pH.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, mset[16])
    pH.tuned.mset =as.data.frame (pv)
    head(pH.tuned.mset)
    names(pH.tuned.mset)[1] <- c("pH.tuned.mset")
    head(pH.tuned.mset)
    pH.tuned.mset = cbind(mset$pH.ob, pH.tuned.mset$pH.tuned.mset)
    pH.tuned.mset = as.data.frame(pH.tuned.mset)
    head(pH.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, n4[4])
    pH.tuned.n4 =as.data.frame (pv)
    head(pH.tuned.n4)
    names(pH.tuned.n4)[1] <- c("pH.tuned.n4")
    head(pH.tuned.n4)
    pH.tuned.n4 = cbind(n4[1], pH.tuned.n4)
    head(pH.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, pH.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, pH.default.mset, pH.tuned.mset,ti$pH.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("pH.ob")
    names(plot1)[3] <- c("pH.default.mset")
    names(plot1)[5] <- c("pH.tuned.mset")
    names(plot1)[6] <- c("pH.pp")
  }
  head(plot1)
  pH  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = pH.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = pH.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = pH.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = pH.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = pH.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('pH') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('pH')
  pH
  n4.pH = ggplot() +
    geom_line(data = n4, aes(x = Date, y = pH.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = pH.tuned.n4, aes(x = Date, y = pH.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = pH.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('pH')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("pH (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.pH
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.pp))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=pH.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=pH.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("pH (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.ob))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=pH.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=pH.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("pH (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #ORP
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$ORP.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # ORP.svmRadial.default = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial')
  # ORP.svmRadial.default
  # saveRDS(ORP.svmRadial.default, "안성4.ORP.svmRadial.default.rds")
  ORP.svmRadial.default = readRDS("안성4.ORP.svmRadial.default.rds")
  ORP.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # ORP.svmRadial.tuned = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(1:10), C = c(0.1,0.25,0.5,0.75,1)))
  # ORP.svmRadial.tuned
  # saveRDS(ORP.svmRadial.tuned, "안성4.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned = readRDS("안성4.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, test[17])
    ORP.default.test =as.data.frame (pv)
    head(ORP.default.test)
    names(ORP.default.test)[1] <- c("ORP.default.test")
    head(ORP.default.test)
    ORP.default.test = cbind(test$ORP.ob, ORP.default.test$ORP.default.test)
    ORP.default.test = as.data.frame(ORP.default.test)
    head(ORP.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, mset[17])
    ORP.default.mset =as.data.frame (pv)
    head(ORP.default.mset)
    names(ORP.default.mset)[1] <- c("ORP.default.mset")
    head(ORP.default.mset)
    ORP.default.mset = cbind(mset$ORP.ob, ORP.default.mset$ORP.default.mset)
    ORP.default.mset = as.data.frame(ORP.default.mset)
    head(ORP.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, test[17])
    ORP.tuned.test =as.data.frame (pv)
    head(ORP.tuned.test)
    names(ORP.tuned.test)[1] <- c("ORP.tuned.test")
    ORP.tuned.test = cbind(test$ORP.ob, ORP.tuned.test$ORP.tuned.test)
    ORP.tuned.test = as.data.frame(ORP.tuned.test)
    head(ORP.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, mset[17])
    ORP.tuned.mset =as.data.frame (pv)
    head(ORP.tuned.mset)
    names(ORP.tuned.mset)[1] <- c("ORP.tuned.mset")
    head(ORP.tuned.mset)
    ORP.tuned.mset = cbind(mset$ORP.ob, ORP.tuned.mset$ORP.tuned.mset)
    ORP.tuned.mset = as.data.frame(ORP.tuned.mset)
    head(ORP.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, n4[5])
    ORP.tuned.n4 =as.data.frame (pv)
    head(ORP.tuned.n4)
    names(ORP.tuned.n4)[1] <- c("ORP.tuned.n4")
    head(ORP.tuned.n4)
    ORP.tuned.n4 = cbind(n4[1], ORP.tuned.n4)
    head(ORP.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, ORP.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, ORP.default.mset, ORP.tuned.mset,ti$ORP.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("ORP.ob")
    names(plot1)[3] <- c("ORP.default.mset")
    names(plot1)[5] <- c("ORP.tuned.mset")
    names(plot1)[6] <- c("ORP.pp")
  }
  head(plot1)
  ORP  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = ORP.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = ORP.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = ORP.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = ORP.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = ORP.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('ORP') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('ORP')
  ORP
  n4.ORP = ggplot() +
    geom_line(data = n4, aes(x = Date, y = ORP.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = ORP.tuned.n4, aes(x = Date, y = ORP.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('ORP')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("ORP (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.ORP
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.pp))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=ORP.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=ORP.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("ORP (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.ob))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=ORP.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=ORP.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("ORP (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #EC
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$EC.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # EC.svmRadial.default = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial')
  # EC.svmRadial.default
  # saveRDS(EC.svmRadial.default, "안성4.EC.svmRadial.default.rds")
  EC.svmRadial.default = readRDS("안성4.EC.svmRadial.default.rds")
  EC.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # EC.svmRadial.tuned = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.4541:5), C = c(0.1,0.25,0.5,0.75,1)))
  # EC.svmRadial.tuned
  # saveRDS(EC.svmRadial.tuned, "안성4.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned = readRDS("안성4.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, test[18])
    EC.default.test =as.data.frame (pv)
    head(EC.default.test)
    names(EC.default.test)[1] <- c("EC.default.test")
    head(EC.default.test)
    EC.default.test = cbind(test$EC.ob, EC.default.test$EC.default.test)
    EC.default.test = as.data.frame(EC.default.test)
    head(EC.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, mset[18])
    EC.default.mset =as.data.frame (pv)
    head(EC.default.mset)
    names(EC.default.mset)[1] <- c("EC.default.mset")
    head(EC.default.mset)
    EC.default.mset = cbind(mset$EC.ob, EC.default.mset$EC.default.mset)
    EC.default.mset = as.data.frame(EC.default.mset)
    head(EC.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, test[18])
    EC.tuned.test =as.data.frame (pv)
    head(EC.tuned.test)
    names(EC.tuned.test)[1] <- c("EC.tuned.test")
    EC.tuned.test = cbind(test$EC.ob, EC.tuned.test$EC.tuned.test)
    EC.tuned.test = as.data.frame(EC.tuned.test)
    head(EC.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, mset[18])
    EC.tuned.mset =as.data.frame (pv)
    head(EC.tuned.mset)
    names(EC.tuned.mset)[1] <- c("EC.tuned.mset")
    head(EC.tuned.mset)
    EC.tuned.mset = cbind(mset$EC.ob, EC.tuned.mset$EC.tuned.mset)
    EC.tuned.mset = as.data.frame(EC.tuned.mset)
    head(EC.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, n4[6])
    EC.tuned.n4 =as.data.frame (pv)
    head(EC.tuned.n4)
    names(EC.tuned.n4)[1] <- c("EC.tuned.n4")
    head(EC.tuned.n4)
    EC.tuned.n4 = cbind(n4[1], EC.tuned.n4)
    head(EC.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, EC.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, EC.default.mset, EC.tuned.mset,ti$EC.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("EC.ob")
    names(plot1)[3] <- c("EC.default.mset")
    names(plot1)[5] <- c("EC.tuned.mset")
    names(plot1)[6] <- c("EC.pp")
  }
  head(plot1)
  EC  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = EC.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = EC.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = EC.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = EC.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = EC.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('EC') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('EC')
  EC
  n4.EC = ggplot() +
    geom_line(data = n4, aes(x = Date, y = EC.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = EC.tuned.n4, aes(x = Date, y = EC.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = EC.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('EC')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("EC (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.EC
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.pp))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=EC.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=EC.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("EC (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.ob))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=EC.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=EC.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("EC (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Turbidity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Turbidity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Turbidity.svmRadial.default = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial')
  # Turbidity.svmRadial.default
  # saveRDS(Turbidity.svmRadial.default, "안성4.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default = readRDS("안성4.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Turbidity.svmRadial.tuned = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(1000:1005), C = c(0.1,0.25,0.5,0.75,1)))
  # Turbidity.svmRadial.tuned
  # saveRDS(Turbidity.svmRadial.tuned, "안성4.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned = readRDS("안성4.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, test[19])
    Turbidity.default.test =as.data.frame (pv)
    head(Turbidity.default.test)
    names(Turbidity.default.test)[1] <- c("Turbidity.default.test")
    head(Turbidity.default.test)
    Turbidity.default.test = cbind(test$Turbidity.ob, Turbidity.default.test$Turbidity.default.test)
    Turbidity.default.test = as.data.frame(Turbidity.default.test)
    head(Turbidity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, mset[19])
    Turbidity.default.mset =as.data.frame (pv)
    head(Turbidity.default.mset)
    names(Turbidity.default.mset)[1] <- c("Turbidity.default.mset")
    head(Turbidity.default.mset)
    Turbidity.default.mset = cbind(mset$Turbidity.ob, Turbidity.default.mset$Turbidity.default.mset)
    Turbidity.default.mset = as.data.frame(Turbidity.default.mset)
    head(Turbidity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, test[19])
    Turbidity.tuned.test =as.data.frame (pv)
    head(Turbidity.tuned.test)
    names(Turbidity.tuned.test)[1] <- c("Turbidity.tuned.test")
    Turbidity.tuned.test = cbind(test$Turbidity.ob, Turbidity.tuned.test$Turbidity.tuned.test)
    Turbidity.tuned.test = as.data.frame(Turbidity.tuned.test)
    head(Turbidity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, mset[19])
    Turbidity.tuned.mset =as.data.frame (pv)
    head(Turbidity.tuned.mset)
    names(Turbidity.tuned.mset)[1] <- c("Turbidity.tuned.mset")
    head(Turbidity.tuned.mset)
    Turbidity.tuned.mset = cbind(mset$Turbidity.ob, Turbidity.tuned.mset$Turbidity.tuned.mset)
    Turbidity.tuned.mset = as.data.frame(Turbidity.tuned.mset)
    head(Turbidity.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, n4[7])
    Turbidity.tuned.n4 =as.data.frame (pv)
    head(Turbidity.tuned.n4)
    names(Turbidity.tuned.n4)[1] <- c("Turbidity.tuned.n4")
    head(Turbidity.tuned.n4)
    Turbidity.tuned.n4 = cbind(n4[1], Turbidity.tuned.n4)
    head(Turbidity.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Turbidity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Turbidity.default.mset, Turbidity.tuned.mset,ti$Turbidity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Turbidity.ob")
    names(plot1)[3] <- c("Turbidity.default.mset")
    names(plot1)[5] <- c("Turbidity.tuned.mset")
    names(plot1)[6] <- c("Turbidity.pp")
  }
  head(plot1)
  Turbidity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Turbidity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Turbidity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Turbidity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Turbidity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Turbidity')
  Turbidity
  n4.Turbidity = ggplot() +
    geom_line(data = n4, aes(x = Date, y = Turbidity.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Turbidity.tuned.n4, aes(x = Date, y = Turbidity.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = Turbidity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Turbidity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Turbidity (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.Turbidity
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.pp))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Turbidity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Turbidity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Turbidity (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.ob))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Turbidity.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Turbidity.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Turbidity (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #TDS
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$TDS.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # TDS.svmRadial.default = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial')
  # TDS.svmRadial.default
  # saveRDS(TDS.svmRadial.default, "안성4.TDS.svmRadial.default.rds")
  TDS.svmRadial.default = readRDS("안성4.TDS.svmRadial.default.rds")
  TDS.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # TDS.svmRadial.tuned = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(50:55), C = c(0.1,0.25,0.5,0.75,1)))
  # TDS.svmRadial.tuned
  # saveRDS(TDS.svmRadial.tuned, "안성4.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned = readRDS("안성4.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, test[20])
    TDS.default.test =as.data.frame (pv)
    head(TDS.default.test)
    names(TDS.default.test)[1] <- c("TDS.default.test")
    head(TDS.default.test)
    TDS.default.test = cbind(test$TDS.ob, TDS.default.test$TDS.default.test)
    TDS.default.test = as.data.frame(TDS.default.test)
    head(TDS.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, mset[20])
    TDS.default.mset =as.data.frame (pv)
    head(TDS.default.mset)
    names(TDS.default.mset)[1] <- c("TDS.default.mset")
    head(TDS.default.mset)
    TDS.default.mset = cbind(mset$TDS.ob, TDS.default.mset$TDS.default.mset)
    TDS.default.mset = as.data.frame(TDS.default.mset)
    head(TDS.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, test[20])
    TDS.tuned.test =as.data.frame (pv)
    head(TDS.tuned.test)
    names(TDS.tuned.test)[1] <- c("TDS.tuned.test")
    TDS.tuned.test = cbind(test$TDS.ob, TDS.tuned.test$TDS.tuned.test)
    TDS.tuned.test = as.data.frame(TDS.tuned.test)
    head(TDS.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, mset[20])
    TDS.tuned.mset =as.data.frame (pv)
    head(TDS.tuned.mset)
    names(TDS.tuned.mset)[1] <- c("TDS.tuned.mset")
    head(TDS.tuned.mset)
    TDS.tuned.mset = cbind(mset$TDS.ob, TDS.tuned.mset$TDS.tuned.mset)
    TDS.tuned.mset = as.data.frame(TDS.tuned.mset)
    head(TDS.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, n4[8])
    TDS.tuned.n4 =as.data.frame (pv)
    head(TDS.tuned.n4)
    names(TDS.tuned.n4)[1] <- c("TDS.tuned.n4")
    head(TDS.tuned.n4)
    TDS.tuned.n4 = cbind(n4[1], TDS.tuned.n4)
    head(TDS.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, TDS.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, TDS.default.mset, TDS.tuned.mset,ti$TDS.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("TDS.ob")
    names(plot1)[3] <- c("TDS.default.mset")
    names(plot1)[5] <- c("TDS.tuned.mset")
    names(plot1)[6] <- c("TDS.pp")
  }
  head(plot1)
  TDS  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = TDS.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = TDS.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = TDS.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = TDS.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = TDS.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('TDS') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('TDS')
  TDS
  n4.TDS = ggplot() +
    geom_line(data = n4, aes(x = Date, y = TDS.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = TDS.tuned.n4, aes(x = Date, y = TDS.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = TDS.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('TDS')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("TDS (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.TDS
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.pp))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=TDS.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=TDS.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("TDS (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.ob))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=TDS.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=TDS.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("TDS (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Salinity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Salinity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Salinity.svmRadial.default = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial')
  # Salinity.svmRadial.default
  # saveRDS(Salinity.svmRadial.default, "안성4.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default = readRDS("안성4.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Salinity.svmRadial.tuned = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.0000484:5), C = c(0.1,0.25,0.5,0.75,1)))
  # Salinity.svmRadial.tuned
  # saveRDS(Salinity.svmRadial.tuned, "안성4.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned = readRDS("안성4.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, test[21])
    Salinity.default.test =as.data.frame (pv)
    head(Salinity.default.test)
    names(Salinity.default.test)[1] <- c("Salinity.default.test")
    head(Salinity.default.test)
    Salinity.default.test = cbind(test$Salinity.ob, Salinity.default.test$Salinity.default.test)
    Salinity.default.test = as.data.frame(Salinity.default.test)
    head(Salinity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, mset[21])
    Salinity.default.mset =as.data.frame (pv)
    head(Salinity.default.mset)
    names(Salinity.default.mset)[1] <- c("Salinity.default.mset")
    head(Salinity.default.mset)
    Salinity.default.mset = cbind(mset$Salinity.ob, Salinity.default.mset$Salinity.default.mset)
    Salinity.default.mset = as.data.frame(Salinity.default.mset)
    head(Salinity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, test[21])
    Salinity.tuned.test =as.data.frame (pv)
    head(Salinity.tuned.test)
    names(Salinity.tuned.test)[1] <- c("Salinity.tuned.test")
    Salinity.tuned.test = cbind(test$Salinity.ob, Salinity.tuned.test$Salinity.tuned.test)
    Salinity.tuned.test = as.data.frame(Salinity.tuned.test)
    head(Salinity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, mset[21])
    Salinity.tuned.mset =as.data.frame (pv)
    head(Salinity.tuned.mset)
    names(Salinity.tuned.mset)[1] <- c("Salinity.tuned.mset")
    head(Salinity.tuned.mset)
    Salinity.tuned.mset = cbind(mset$Salinity.ob, Salinity.tuned.mset$Salinity.tuned.mset)
    Salinity.tuned.mset = as.data.frame(Salinity.tuned.mset)
    head(Salinity.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, n4[9])
    Salinity.tuned.n4 =as.data.frame (pv)
    head(Salinity.tuned.n4)
    names(Salinity.tuned.n4)[1] <- c("Salinity.tuned.n4")
    head(Salinity.tuned.n4)
    Salinity.tuned.n4 = cbind(n4[1], Salinity.tuned.n4)
    head(Salinity.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Salinity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Salinity.default.mset, Salinity.tuned.mset,ti$Salinity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Salinity.ob")
    names(plot1)[3] <- c("Salinity.default.mset")
    names(plot1)[5] <- c("Salinity.tuned.mset")
    names(plot1)[6] <- c("Salinity.pp")
  }
  head(plot1)
  Salinity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Salinity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Salinity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Salinity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Salinity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Salinity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Salinity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Salinity')
  Salinity
  n4.Salinity = ggplot() +
    geom_line(data = n4, aes(x = Date, y = Salinity.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Salinity.tuned.n4, aes(x = Date, y = Salinity.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = Salinity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Salinity (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.Salinity
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.pp))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Salinity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Salinity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Salinity (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.ob))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Salinity.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Salinity.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Salinity (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #NH3.N
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NH3.N.svmRadial.default = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial')
  # NH3.N.svmRadial.default
  # saveRDS(NH3.N.svmRadial.default, "안성4.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default = readRDS("안성4.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NH3.N.svmRadial.tuned = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5486:5), C = c(0.1,0.25,0.5,0.75,1)))
  # NH3.N.svmRadial.tuned
  # saveRDS(NH3.N.svmRadial.tuned, "안성4.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned = readRDS("안성4.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, test[22])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, mset[22])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, test[22])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, mset[22])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, n4[10])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(n4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NH3.N.default.mset, NH3.N.tuned.mset,ti$NH3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NH3.N.ob")
    names(plot1)[3] <- c("NH3.N.default.mset")
    names(plot1)[5] <- c("NH3.N.tuned.mset")
    names(plot1)[6] <- c("NH3.N.pp")
  }
  head(plot1)
  NH3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NH3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NH3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NH3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NH3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NH3.N')
  NH3.N
  
  n4.NH3.N = ggplot() +
    geom_line(data = n4, aes(x = Date, y = NH3.N.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NH3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NH3.N (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.NH3.N
  
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.pp))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NH3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NH3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NH3.N (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.ob))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NH3.N.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NH3.N.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("NH3.N (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #NO3.N
  {  head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$NO3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NO3.N.svmRadial.default = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial')
  # NO3.N.svmRadial.default
  # saveRDS(NO3.N.svmRadial.default, "안성4.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default = readRDS("안성4.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NO3.N.svmRadial.tuned = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.546:5), C = c(0.1,0.25,0.5,0.75,1)))
  # NO3.N.svmRadial.tuned
  # saveRDS(NO3.N.svmRadial.tuned, "안성4.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned = readRDS("안성4.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, test[23])
    NO3.N.default.test =as.data.frame (pv)
    head(NO3.N.default.test)
    names(NO3.N.default.test)[1] <- c("NO3.N.default.test")
    head(NO3.N.default.test)
    NO3.N.default.test = cbind(test$NO3.N.ob, NO3.N.default.test$NO3.N.default.test)
    NO3.N.default.test = as.data.frame(NO3.N.default.test)
    head(NO3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, mset[23])
    NO3.N.default.mset =as.data.frame (pv)
    head(NO3.N.default.mset)
    names(NO3.N.default.mset)[1] <- c("NO3.N.default.mset")
    head(NO3.N.default.mset)
    NO3.N.default.mset = cbind(mset$NO3.N.ob, NO3.N.default.mset$NO3.N.default.mset)
    NO3.N.default.mset = as.data.frame(NO3.N.default.mset)
    head(NO3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, test[23])
    NO3.N.tuned.test =as.data.frame (pv)
    head(NO3.N.tuned.test)
    names(NO3.N.tuned.test)[1] <- c("NO3.N.tuned.test")
    NO3.N.tuned.test = cbind(test$NO3.N.ob, NO3.N.tuned.test$NO3.N.tuned.test)
    NO3.N.tuned.test = as.data.frame(NO3.N.tuned.test)
    head(NO3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, mset[23])
    NO3.N.tuned.mset =as.data.frame (pv)
    head(NO3.N.tuned.mset)
    names(NO3.N.tuned.mset)[1] <- c("NO3.N.tuned.mset")
    head(NO3.N.tuned.mset)
    NO3.N.tuned.mset = cbind(mset$NO3.N.ob, NO3.N.tuned.mset$NO3.N.tuned.mset)
    NO3.N.tuned.mset = as.data.frame(NO3.N.tuned.mset)
    head(NO3.N.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, n4[11])
    NO3.N.tuned.n4 =as.data.frame (pv)
    head(NO3.N.tuned.n4)
    names(NO3.N.tuned.n4)[1] <- c("NO3.N.tuned.n4")
    head(NO3.N.tuned.n4)
    NO3.N.tuned.n4 = cbind(n4[1], NO3.N.tuned.n4)
    head(NO3.N.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NO3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NO3.N.default.mset, NO3.N.tuned.mset,ti$NO3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NO3.N.ob")
    names(plot1)[3] <- c("NO3.N.default.mset")
    names(plot1)[5] <- c("NO3.N.tuned.mset")
    names(plot1)[6] <- c("NO3.N.pp")
  }
  head(plot1)
  
  NO3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NO3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NO3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NO3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NO3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NO3.N')
  NO3.N
  
  n4.NO3.N = ggplot() +
    geom_line(data = n4, aes(x = Date, y = NO3.N.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = NO3.N.tuned.n4, aes(x = Date, y = NO3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NO3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NO3.N (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.NO3.N
  
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.pp))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NO3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NO3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NO3.N (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.ob))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NO3.N.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NO3.N.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("NO3.N (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Cl
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Cl.svmRadial.default = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial')
  # Cl.svmRadial.default
  # saveRDS(Cl.svmRadial.default, "안성4.Cl.svmRadial.default.rds")
  Cl.svmRadial.default = readRDS("안성4.Cl.svmRadial.default.rds")
  Cl.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Cl.svmRadial.tuned = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.7498:5), C = c(0.1,0.25,0.5,0.75,1)))
  # Cl.svmRadial.tuned
  # saveRDS(Cl.svmRadial.tuned, "안성4.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned = readRDS("안성4.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, test[24])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, mset[24])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, test[24])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, mset[24])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, n4[12])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(n4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Cl.default.mset, Cl.tuned.mset,ti$Cl.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Cl.ob")
    names(plot1)[3] <- c("Cl.default.mset")
    names(plot1)[5] <- c("Cl.tuned.mset")
    names(plot1)[6] <- c("Cl.pp")
  }
  head(plot1)
  
  Cl  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Cl.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Cl.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Cl.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Cl.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Cl.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Cl') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Cl')
  Cl
  
  n4.Cl = ggplot() +
    geom_line(data = n4, aes(x = Date, y = Cl.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Cl (안성4)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.Cl
  
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.pp))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Cl.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Cl.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Cl (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.ob))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Cl.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Cl.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Cl (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
}
#-----------
#안성 관정5
ti = e5
{
  #Depth
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Depth.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Depth.svmRadial.default = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial')
  # Depth.svmRadial.default
  # saveRDS(Depth.svmRadial.default, "안성5.Depth.svmRadial.default.rds")
  Depth.svmRadial.default = readRDS("안성5.Depth.svmRadial.default.rds")
  Depth.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Depth.svmRadial.tuned = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(20:25), C = c(0.1,0.25,0.5,0.75,1)))
  # Depth.svmRadial.tuned
  # saveRDS(Depth.svmRadial.tuned, "안성5.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned = readRDS("안성5.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, test[14])
    Depth.default.test =as.data.frame (pv)
    head(Depth.default.test)
    names(Depth.default.test)[1] <- c("Depth.default.test")
    head(Depth.default.test)
    Depth.default.test = cbind(test$Depth.ob, Depth.default.test$Depth.default.test)
    Depth.default.test = as.data.frame(Depth.default.test)
    head(Depth.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, mset[14])
    Depth.default.mset =as.data.frame (pv)
    head(Depth.default.mset)
    names(Depth.default.mset)[1] <- c("Depth.default.mset")
    head(Depth.default.mset)
    Depth.default.mset = cbind(mset$Depth.ob, Depth.default.mset$Depth.default.mset)
    Depth.default.mset = as.data.frame(Depth.default.mset)
    head(Depth.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, test[14])
    Depth.tuned.test =as.data.frame (pv)
    head(Depth.tuned.test)
    names(Depth.tuned.test)[1] <- c("Depth.tuned.test")
    Depth.tuned.test = cbind(test$Depth.ob, Depth.tuned.test$Depth.tuned.test)
    Depth.tuned.test = as.data.frame(Depth.tuned.test)
    head(Depth.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, mset[14])
    Depth.tuned.mset =as.data.frame (pv)
    head(Depth.tuned.mset)
    names(Depth.tuned.mset)[1] <- c("Depth.tuned.mset")
    head(Depth.tuned.mset)
    Depth.tuned.mset = cbind(mset$Depth.ob, Depth.tuned.mset$Depth.tuned.mset)
    Depth.tuned.mset = as.data.frame(Depth.tuned.mset)
    head(Depth.tuned.mset)
    
    #안성5(안성5 시계열열 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, n5[2])
    Depth.tuned.n5 =as.data.frame (pv)
    head(Depth.tuned.n5)
    names(Depth.tuned.n5)[1] <- c("Depth.tuned.n5")
    head(Depth.tuned.n5)
    Depth.tuned.n5 = cbind(n5[1], Depth.tuned.n5)
    head(Depth.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Depth.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Depth.default.mset, Depth.tuned.mset,ti$Depth.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Depth.ob")
    names(plot1)[3] <- c("Depth.default.mset")
    names(plot1)[5] <- c("Depth.tuned.mset")
    names(plot1)[6] <- c("Depth.pp")
  }
  head(plot1)
  Depth  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Depth.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Depth.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Depth.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Depth.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Depth.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Depth') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Depth')
  Depth
  n5.Depth = ggplot() +
    geom_line(data = n5, aes(x = Date, y = Depth.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Depth.tuned.n5, aes(x = Date, y = Depth.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Depth (m)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Depth (안성5)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n5.Depth
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.pp))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Depth.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Depth.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Depth (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.ob))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Depth.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Depth.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Depth (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #pH
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$pH.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # pH.svmRadial.default = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial')
  # pH.svmRadial.default
  # saveRDS(pH.svmRadial.default, "안성5.pH.svmRadial.default.rds")
  pH.svmRadial.default = readRDS("안성5.pH.svmRadial.default.rds")
  pH.svmRadial.default
  #Tuned(모델 생성)
  fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  pH.svmRadial.tuned = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
                             tuneGrid = expand.grid(sigma = c(0.1585:5), C = c(0.1,0.25,0.5,0.75,1)))
  pH.svmRadial.tuned
  saveRDS(pH.svmRadial.tuned, "안성5.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned = readRDS("안성5.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, test[16])
    pH.default.test =as.data.frame (pv)
    head(pH.default.test)
    names(pH.default.test)[1] <- c("pH.default.test")
    head(pH.default.test)
    pH.default.test = cbind(test$pH.ob, pH.default.test$pH.default.test)
    pH.default.test = as.data.frame(pH.default.test)
    head(pH.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, mset[16])
    pH.default.mset =as.data.frame (pv)
    head(pH.default.mset)
    names(pH.default.mset)[1] <- c("pH.default.mset")
    head(pH.default.mset)
    pH.default.mset = cbind(mset$pH.ob, pH.default.mset$pH.default.mset)
    pH.default.mset = as.data.frame(pH.default.mset)
    head(pH.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, test[16])
    pH.tuned.test =as.data.frame (pv)
    head(pH.tuned.test)
    names(pH.tuned.test)[1] <- c("pH.tuned.test")
    pH.tuned.test = cbind(test$pH.ob, pH.tuned.test$pH.tuned.test)
    pH.tuned.test = as.data.frame(pH.tuned.test)
    head(pH.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, mset[16])
    pH.tuned.mset =as.data.frame (pv)
    head(pH.tuned.mset)
    names(pH.tuned.mset)[1] <- c("pH.tuned.mset")
    head(pH.tuned.mset)
    pH.tuned.mset = cbind(mset$pH.ob, pH.tuned.mset$pH.tuned.mset)
    pH.tuned.mset = as.data.frame(pH.tuned.mset)
    head(pH.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, n5[4])
    pH.tuned.n5 =as.data.frame (pv)
    head(pH.tuned.n5)
    names(pH.tuned.n5)[1] <- c("pH.tuned.n5")
    head(pH.tuned.n5)
    pH.tuned.n5 = cbind(n5[1], pH.tuned.n5)
    head(pH.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, pH.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, pH.default.mset, pH.tuned.mset,ti$pH.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("pH.ob")
    names(plot1)[3] <- c("pH.default.mset")
    names(plot1)[5] <- c("pH.tuned.mset")
    names(plot1)[6] <- c("pH.pp")
  }
  head(plot1)
  pH  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = pH.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = pH.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = pH.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = pH.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = pH.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('pH') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('pH')
  pH
  n5.pH = ggplot() +
    geom_line(data = n5, aes(x = Date, y = pH.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = pH.tuned.n5, aes(x = Date, y = pH.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = pH.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('pH')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("pH (안성5)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n5.pH
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.pp))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=pH.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=pH.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("pH (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.ob))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=pH.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=pH.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("pH (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #ORP
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$ORP.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  ORP.svmRadial.default = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial')
  ORP.svmRadial.default
  # saveRDS(ORP.svmRadial.default, "안성5.ORP.svmRadial.default.rds")
  ORP.svmRadial.default = readRDS("안성5.ORP.svmRadial.default.rds")
  ORP.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # ORP.svmRadial.tuned = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5465:5), C = c(0.1,0.25,0.5,0.75,1)))
  # ORP.svmRadial.tuned
  # saveRDS(ORP.svmRadial.tuned, "안성5.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned = readRDS("안성5.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, test[17])
    ORP.default.test =as.data.frame (pv)
    head(ORP.default.test)
    names(ORP.default.test)[1] <- c("ORP.default.test")
    head(ORP.default.test)
    ORP.default.test = cbind(test$ORP.ob, ORP.default.test$ORP.default.test)
    ORP.default.test = as.data.frame(ORP.default.test)
    head(ORP.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, mset[17])
    ORP.default.mset =as.data.frame (pv)
    head(ORP.default.mset)
    names(ORP.default.mset)[1] <- c("ORP.default.mset")
    head(ORP.default.mset)
    ORP.default.mset = cbind(mset$ORP.ob, ORP.default.mset$ORP.default.mset)
    ORP.default.mset = as.data.frame(ORP.default.mset)
    head(ORP.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, test[17])
    ORP.tuned.test =as.data.frame (pv)
    head(ORP.tuned.test)
    names(ORP.tuned.test)[1] <- c("ORP.tuned.test")
    ORP.tuned.test = cbind(test$ORP.ob, ORP.tuned.test$ORP.tuned.test)
    ORP.tuned.test = as.data.frame(ORP.tuned.test)
    head(ORP.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, mset[17])
    ORP.tuned.mset =as.data.frame (pv)
    head(ORP.tuned.mset)
    names(ORP.tuned.mset)[1] <- c("ORP.tuned.mset")
    head(ORP.tuned.mset)
    ORP.tuned.mset = cbind(mset$ORP.ob, ORP.tuned.mset$ORP.tuned.mset)
    ORP.tuned.mset = as.data.frame(ORP.tuned.mset)
    head(ORP.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, n5[5])
    ORP.tuned.n5 =as.data.frame (pv)
    head(ORP.tuned.n5)
    names(ORP.tuned.n5)[1] <- c("ORP.tuned.n5")
    head(ORP.tuned.n5)
    ORP.tuned.n5 = cbind(n5[1], ORP.tuned.n5)
    head(ORP.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, ORP.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, ORP.default.mset, ORP.tuned.mset,ti$ORP.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("ORP.ob")
    names(plot1)[3] <- c("ORP.default.mset")
    names(plot1)[5] <- c("ORP.tuned.mset")
    names(plot1)[6] <- c("ORP.pp")
  }
  head(plot1)
  ORP  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = ORP.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = ORP.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = ORP.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = ORP.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = ORP.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('ORP') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('ORP')
  ORP
  n5.ORP = ggplot() +
    geom_line(data = n5, aes(x = Date, y = ORP.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = ORP.tuned.n5, aes(x = Date, y = ORP.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('ORP')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("ORP (안성5)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n5.ORP
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.pp))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=ORP.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=ORP.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("ORP (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.ob))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=ORP.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=ORP.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("ORP (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #EC
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$EC.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # EC.svmRadial.default = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial')
  # EC.svmRadial.default
  # saveRDS(EC.svmRadial.default, "안성5.EC.svmRadial.default.rds")
  EC.svmRadial.default = readRDS("안성5.EC.svmRadial.default.rds")
  EC.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # EC.svmRadial.tuned = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.4845:5), C = c(0.1,0.25,0.5,0.75,1)))
  # EC.svmRadial.tuned
  # saveRDS(EC.svmRadial.tuned, "안성5.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned = readRDS("안성5.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, test[18])
    EC.default.test =as.data.frame (pv)
    head(EC.default.test)
    names(EC.default.test)[1] <- c("EC.default.test")
    head(EC.default.test)
    EC.default.test = cbind(test$EC.ob, EC.default.test$EC.default.test)
    EC.default.test = as.data.frame(EC.default.test)
    head(EC.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, mset[18])
    EC.default.mset =as.data.frame (pv)
    head(EC.default.mset)
    names(EC.default.mset)[1] <- c("EC.default.mset")
    head(EC.default.mset)
    EC.default.mset = cbind(mset$EC.ob, EC.default.mset$EC.default.mset)
    EC.default.mset = as.data.frame(EC.default.mset)
    head(EC.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, test[18])
    EC.tuned.test =as.data.frame (pv)
    head(EC.tuned.test)
    names(EC.tuned.test)[1] <- c("EC.tuned.test")
    EC.tuned.test = cbind(test$EC.ob, EC.tuned.test$EC.tuned.test)
    EC.tuned.test = as.data.frame(EC.tuned.test)
    head(EC.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, mset[18])
    EC.tuned.mset =as.data.frame (pv)
    head(EC.tuned.mset)
    names(EC.tuned.mset)[1] <- c("EC.tuned.mset")
    head(EC.tuned.mset)
    EC.tuned.mset = cbind(mset$EC.ob, EC.tuned.mset$EC.tuned.mset)
    EC.tuned.mset = as.data.frame(EC.tuned.mset)
    head(EC.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, n5[6])
    EC.tuned.n5 =as.data.frame (pv)
    head(EC.tuned.n5)
    names(EC.tuned.n5)[1] <- c("EC.tuned.n5")
    head(EC.tuned.n5)
    EC.tuned.n5 = cbind(n5[1], EC.tuned.n5)
    head(EC.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, EC.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, EC.default.mset, EC.tuned.mset,ti$EC.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("EC.ob")
    names(plot1)[3] <- c("EC.default.mset")
    names(plot1)[5] <- c("EC.tuned.mset")
    names(plot1)[6] <- c("EC.pp")
  }
  head(plot1)
  EC  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = EC.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = EC.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = EC.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = EC.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = EC.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('EC') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('EC')
  EC
  n5.EC = ggplot() +
    geom_line(data = n5, aes(x = Date, y = EC.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = EC.tuned.n5, aes(x = Date, y = EC.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = EC.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('EC')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("EC (안성5)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n5.EC
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.pp))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=EC.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=EC.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("EC (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.ob))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=EC.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=EC.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("EC (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Turbidity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Turbidity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Turbidity.svmRadial.default = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial')
  # Turbidity.svmRadial.default
  # saveRDS(Turbidity.svmRadial.default, "안성5.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default = readRDS("안성5.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Turbidity.svmRadial.tuned = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(100:105), C = c(0.1,0.25,0.5,0.75,1)))
  # Turbidity.svmRadial.tuned
  # saveRDS(Turbidity.svmRadial.tuned, "안성5.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned = readRDS("안성5.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, test[19])
    Turbidity.default.test =as.data.frame (pv)
    head(Turbidity.default.test)
    names(Turbidity.default.test)[1] <- c("Turbidity.default.test")
    head(Turbidity.default.test)
    Turbidity.default.test = cbind(test$Turbidity.ob, Turbidity.default.test$Turbidity.default.test)
    Turbidity.default.test = as.data.frame(Turbidity.default.test)
    head(Turbidity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, mset[19])
    Turbidity.default.mset =as.data.frame (pv)
    head(Turbidity.default.mset)
    names(Turbidity.default.mset)[1] <- c("Turbidity.default.mset")
    head(Turbidity.default.mset)
    Turbidity.default.mset = cbind(mset$Turbidity.ob, Turbidity.default.mset$Turbidity.default.mset)
    Turbidity.default.mset = as.data.frame(Turbidity.default.mset)
    head(Turbidity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, test[19])
    Turbidity.tuned.test =as.data.frame (pv)
    head(Turbidity.tuned.test)
    names(Turbidity.tuned.test)[1] <- c("Turbidity.tuned.test")
    Turbidity.tuned.test = cbind(test$Turbidity.ob, Turbidity.tuned.test$Turbidity.tuned.test)
    Turbidity.tuned.test = as.data.frame(Turbidity.tuned.test)
    head(Turbidity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, mset[19])
    Turbidity.tuned.mset =as.data.frame (pv)
    head(Turbidity.tuned.mset)
    names(Turbidity.tuned.mset)[1] <- c("Turbidity.tuned.mset")
    head(Turbidity.tuned.mset)
    Turbidity.tuned.mset = cbind(mset$Turbidity.ob, Turbidity.tuned.mset$Turbidity.tuned.mset)
    Turbidity.tuned.mset = as.data.frame(Turbidity.tuned.mset)
    head(Turbidity.tuned.mset)
    
    #안성5(안성5 시계열 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, n5[7])
    Turbidity.tuned.n5 =as.data.frame (pv)
    head(Turbidity.tuned.n5)
    names(Turbidity.tuned.n5)[1] <- c("Turbidity.tuned.n5")
    head(Turbidity.tuned.n5)
    Turbidity.tuned.n5 = cbind(n5[1], Turbidity.tuned.n5)
    head(Turbidity.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Turbidity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Turbidity.default.mset, Turbidity.tuned.mset,ti$Turbidity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Turbidity.ob")
    names(plot1)[3] <- c("Turbidity.default.mset")
    names(plot1)[5] <- c("Turbidity.tuned.mset")
    names(plot1)[6] <- c("Turbidity.pp")
  }
  head(plot1)
  Turbidity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Turbidity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Turbidity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Turbidity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Turbidity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Turbidity')
  Turbidity
  n5.Turbidity = ggplot() +
    geom_line(data = n5, aes(x = Date, y = Turbidity.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Turbidity.tuned.n5, aes(x = Date, y = Turbidity.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = Turbidity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Turbidity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Turbidity (안성5)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n5.Turbidity
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.pp))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Turbidity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Turbidity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Turbidity (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.ob))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Turbidity.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Turbidity.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Turbidity (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #TDS
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$TDS.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # TDS.svmRadial.default = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial')
  # TDS.svmRadial.default
  # saveRDS(TDS.svmRadial.default, "안성5.TDS.svmRadial.default.rds")
  TDS.svmRadial.default = readRDS("안성5.TDS.svmRadial.default.rds")
  TDS.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # TDS.svmRadial.tuned = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(1000:1005), C = c(0.1,0.25,0.5,0.75,1)))
  # TDS.svmRadial.tuned
  # saveRDS(TDS.svmRadial.tuned, "안성5.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned = readRDS("안성5.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, test[20])
    TDS.default.test =as.data.frame (pv)
    head(TDS.default.test)
    names(TDS.default.test)[1] <- c("TDS.default.test")
    head(TDS.default.test)
    TDS.default.test = cbind(test$TDS.ob, TDS.default.test$TDS.default.test)
    TDS.default.test = as.data.frame(TDS.default.test)
    head(TDS.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, mset[20])
    TDS.default.mset =as.data.frame (pv)
    head(TDS.default.mset)
    names(TDS.default.mset)[1] <- c("TDS.default.mset")
    head(TDS.default.mset)
    TDS.default.mset = cbind(mset$TDS.ob, TDS.default.mset$TDS.default.mset)
    TDS.default.mset = as.data.frame(TDS.default.mset)
    head(TDS.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, test[20])
    TDS.tuned.test =as.data.frame (pv)
    head(TDS.tuned.test)
    names(TDS.tuned.test)[1] <- c("TDS.tuned.test")
    TDS.tuned.test = cbind(test$TDS.ob, TDS.tuned.test$TDS.tuned.test)
    TDS.tuned.test = as.data.frame(TDS.tuned.test)
    head(TDS.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, mset[20])
    TDS.tuned.mset =as.data.frame (pv)
    head(TDS.tuned.mset)
    names(TDS.tuned.mset)[1] <- c("TDS.tuned.mset")
    head(TDS.tuned.mset)
    TDS.tuned.mset = cbind(mset$TDS.ob, TDS.tuned.mset$TDS.tuned.mset)
    TDS.tuned.mset = as.data.frame(TDS.tuned.mset)
    head(TDS.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, n5[8])
    TDS.tuned.n5 =as.data.frame (pv)
    head(TDS.tuned.n5)
    names(TDS.tuned.n5)[1] <- c("TDS.tuned.n5")
    head(TDS.tuned.n5)
    TDS.tuned.n5 = cbind(n5[1], TDS.tuned.n5)
    head(TDS.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, TDS.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, TDS.default.mset, TDS.tuned.mset,ti$TDS.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("TDS.ob")
    names(plot1)[3] <- c("TDS.default.mset")
    names(plot1)[5] <- c("TDS.tuned.mset")
    names(plot1)[6] <- c("TDS.pp")
  }
  head(plot1)
  TDS  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = TDS.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = TDS.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = TDS.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = TDS.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = TDS.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('TDS') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('TDS')
  TDS
  n5.TDS = ggplot() +
    geom_line(data = n5, aes(x = Date, y = TDS.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = TDS.tuned.n5, aes(x = Date, y = TDS.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = TDS.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('TDS')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("TDS (안성5)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n5.TDS
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.pp))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=TDS.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=TDS.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("TDS (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.ob))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=TDS.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=TDS.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("TDS (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Salinity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Salinity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Salinity.svmRadial.default = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial')
  # Salinity.svmRadial.default
  # saveRDS(Salinity.svmRadial.default, "안성5.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default = readRDS("안성5.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Salinity.svmRadial.tuned = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(20:25), C = c(0.1,0.25,0.5,0.75,1)))
  # Salinity.svmRadial.tuned
  # saveRDS(Salinity.svmRadial.tuned, "안성5.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned = readRDS("안성5.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, test[21])
    Salinity.default.test =as.data.frame (pv)
    head(Salinity.default.test)
    names(Salinity.default.test)[1] <- c("Salinity.default.test")
    head(Salinity.default.test)
    Salinity.default.test = cbind(test$Salinity.ob, Salinity.default.test$Salinity.default.test)
    Salinity.default.test = as.data.frame(Salinity.default.test)
    head(Salinity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, mset[21])
    Salinity.default.mset =as.data.frame (pv)
    head(Salinity.default.mset)
    names(Salinity.default.mset)[1] <- c("Salinity.default.mset")
    head(Salinity.default.mset)
    Salinity.default.mset = cbind(mset$Salinity.ob, Salinity.default.mset$Salinity.default.mset)
    Salinity.default.mset = as.data.frame(Salinity.default.mset)
    head(Salinity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, test[21])
    Salinity.tuned.test =as.data.frame (pv)
    head(Salinity.tuned.test)
    names(Salinity.tuned.test)[1] <- c("Salinity.tuned.test")
    Salinity.tuned.test = cbind(test$Salinity.ob, Salinity.tuned.test$Salinity.tuned.test)
    Salinity.tuned.test = as.data.frame(Salinity.tuned.test)
    head(Salinity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, mset[21])
    Salinity.tuned.mset =as.data.frame (pv)
    head(Salinity.tuned.mset)
    names(Salinity.tuned.mset)[1] <- c("Salinity.tuned.mset")
    head(Salinity.tuned.mset)
    Salinity.tuned.mset = cbind(mset$Salinity.ob, Salinity.tuned.mset$Salinity.tuned.mset)
    Salinity.tuned.mset = as.data.frame(Salinity.tuned.mset)
    head(Salinity.tuned.mset)
    
    #안성5(안성5 시계열열 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, n5[9])
    Salinity.tuned.n5 =as.data.frame (pv)
    head(Salinity.tuned.n5)
    names(Salinity.tuned.n5)[1] <- c("Salinity.tuned.n5")
    head(Salinity.tuned.n5)
    Salinity.tuned.n5 = cbind(n5[1], Salinity.tuned.n5)
    head(Salinity.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Salinity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Salinity.default.mset, Salinity.tuned.mset,ti$Salinity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Salinity.ob")
    names(plot1)[3] <- c("Salinity.default.mset")
    names(plot1)[5] <- c("Salinity.tuned.mset")
    names(plot1)[6] <- c("Salinity.pp")
  }
  head(plot1)
  Salinity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Salinity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Salinity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Salinity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Salinity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Salinity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Salinity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Salinity')
  Salinity
  n5.Salinity = ggplot() +
    geom_line(data = n5, aes(x = Date, y = Salinity.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Salinity.tuned.n5, aes(x = Date, y = Salinity.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = Salinity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Salinity (안성5)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n5.Salinity
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.pp))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Salinity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Salinity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Salinity (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.ob))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Salinity.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Salinity.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Salinity (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #NH3.N
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NH3.N.svmRadial.default = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial')
  # NH3.N.svmRadial.default
  # saveRDS(NH3.N.svmRadial.default, "안성5.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default = readRDS("안성5.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NH3.N.svmRadial.tuned = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5486:5), C = c(0.1,0.25,0.5,0.75,1)))
  # NH3.N.svmRadial.tuned
  # saveRDS(NH3.N.svmRadial.tuned, "안성5.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned = readRDS("안성5.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, test[22])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, mset[22])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, test[22])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, mset[22])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, n5[10])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(n5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NH3.N.default.mset, NH3.N.tuned.mset,ti$NH3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NH3.N.ob")
    names(plot1)[3] <- c("NH3.N.default.mset")
    names(plot1)[5] <- c("NH3.N.tuned.mset")
    names(plot1)[6] <- c("NH3.N.pp")
  }
  head(plot1)
  NH3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NH3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NH3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NH3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NH3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NH3.N')
  NH3.N
  
  n5.NH3.N = ggplot() +
    geom_line(data = n5, aes(x = Date, y = NH3.N.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NH3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NH3.N (안성5)") +ylim(0,4)
  #  scale_x_continuous(breaks = months)
  n5.NH3.N
  
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.pp))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NH3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NH3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NH3.N (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.ob))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NH3.N.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NH3.N.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("NH3.N (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #NO3.N
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    mset$NO3.N.ob[mset$NO3.N.ob %in% "NA"] <- NA
    mset = mset[complete.cases(mset), ]
    inTraining <- createDataPartition(mset$NO3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NO3.N.svmRadial.default = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial')
  # NO3.N.svmRadial.default
  # saveRDS(NO3.N.svmRadial.default, "안성5.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default = readRDS("안성5.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NO3.N.svmRadial.tuned = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(100:105), C = c(0.1,0.25,0.5,0.75,1)))
  # NO3.N.svmRadial.tuned
  # saveRDS(NO3.N.svmRadial.tuned, "안성5.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned = readRDS("안성5.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, test[23])
    NO3.N.default.test =as.data.frame (pv)
    head(NO3.N.default.test)
    names(NO3.N.default.test)[1] <- c("NO3.N.default.test")
    head(NO3.N.default.test)
    NO3.N.default.test = cbind(test$NO3.N.ob, NO3.N.default.test$NO3.N.default.test)
    NO3.N.default.test = as.data.frame(NO3.N.default.test)
    head(NO3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, mset[23])
    NO3.N.default.mset =as.data.frame (pv)
    head(NO3.N.default.mset)
    names(NO3.N.default.mset)[1] <- c("NO3.N.default.mset")
    head(NO3.N.default.mset)
    NO3.N.default.mset = cbind(mset$NO3.N.ob, NO3.N.default.mset$NO3.N.default.mset)
    NO3.N.default.mset = as.data.frame(NO3.N.default.mset)
    head(NO3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, test[23])
    NO3.N.tuned.test =as.data.frame (pv)
    head(NO3.N.tuned.test)
    names(NO3.N.tuned.test)[1] <- c("NO3.N.tuned.test")
    NO3.N.tuned.test = cbind(test$NO3.N.ob, NO3.N.tuned.test$NO3.N.tuned.test)
    NO3.N.tuned.test = as.data.frame(NO3.N.tuned.test)
    head(NO3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, mset[23])
    NO3.N.tuned.mset =as.data.frame (pv)
    head(NO3.N.tuned.mset)
    names(NO3.N.tuned.mset)[1] <- c("NO3.N.tuned.mset")
    head(NO3.N.tuned.mset)
    NO3.N.tuned.mset = cbind(mset$NO3.N.ob, NO3.N.tuned.mset$NO3.N.tuned.mset)
    NO3.N.tuned.mset = as.data.frame(NO3.N.tuned.mset)
    head(NO3.N.tuned.mset)
    
    #안성5(안성5 시계열 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, n5[11])
    NO3.N.tuned.n5 =as.data.frame (pv)
    head(NO3.N.tuned.n5)
    names(NO3.N.tuned.n5)[1] <- c("NO3.N.tuned.n5")
    head(NO3.N.tuned.n5)
    NO3.N.tuned.n5 = cbind(n5[1], NO3.N.tuned.n5)
    head(NO3.N.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NO3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NO3.N.default.mset, NO3.N.tuned.mset,mset$NO3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NO3.N.ob")
    names(plot1)[3] <- c("NO3.N.default.mset")
    names(plot1)[5] <- c("NO3.N.tuned.mset")
    names(plot1)[6] <- c("NO3.N.pp")
  }
  head(plot1)
  
  NO3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NO3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NO3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NO3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NO3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NO3.N')
  NO3.N
  
  n5.NO3.N = ggplot() +
    geom_line(data = n5, aes(x = Date, y = NO3.N.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = NO3.N.tuned.n5, aes(x = Date, y = NO3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NO3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NO3.N (안성5)") +ylim(0,4)
  #  scale_x_continuous(breaks = months)
  n5.NO3.N
  
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.pp))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NO3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NO3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NO3.N (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.ob))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NO3.N.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NO3.N.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("NO3.N (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Cl
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Cl.svmRadial.default = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial')
  # Cl.svmRadial.default
  # saveRDS(Cl.svmRadial.default, "안성5.Cl.svmRadial.default.rds")
  Cl.svmRadial.default = readRDS("안성5.Cl.svmRadial.default.rds")
  Cl.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Cl.svmRadial.tuned = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(100:105), C = c(0.1,0.25,0.5,0.75,1)))
  # Cl.svmRadial.tuned
  # saveRDS(Cl.svmRadial.tuned, "안성5.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned = readRDS("안성5.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, test[24])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, mset[24])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, test[24])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, mset[24])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, n5[12])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(n5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Cl.default.mset, Cl.tuned.mset,ti$Cl.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Cl.ob")
    names(plot1)[3] <- c("Cl.default.mset")
    names(plot1)[5] <- c("Cl.tuned.mset")
    names(plot1)[6] <- c("Cl.pp")
  }
  head(plot1)
  
  Cl  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Cl.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Cl.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Cl.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Cl.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Cl.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Cl') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Cl')
  Cl
  
  n5.Cl = ggplot() +
    geom_line(data = n5, aes(x = Date, y = Cl.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Cl (안성5)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.Cl
  
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.pp))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Cl.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Cl.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Cl (안성5)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.ob))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Cl.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Cl.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Cl (안성5)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
}
#-----------
#안성 관정6
ti = e6
{
  #Depth
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Depth.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Depth.svmRadial.default = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial')
  # Depth.svmRadial.default
  # saveRDS(Depth.svmRadial.default, "안성6.Depth.svmRadial.default.rds")
  Depth.svmRadial.default = readRDS("안성6.Depth.svmRadial.default.rds")
  Depth.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Depth.svmRadial.tuned = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(10:15), C = c(0.1,0.25,0.5,0.75,1)))
  # Depth.svmRadial.tuned
  # saveRDS(Depth.svmRadial.tuned, "안성6.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned = readRDS("안성6.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, test[14])
    Depth.default.test =as.data.frame (pv)
    head(Depth.default.test)
    names(Depth.default.test)[1] <- c("Depth.default.test")
    head(Depth.default.test)
    Depth.default.test = cbind(test$Depth.ob, Depth.default.test$Depth.default.test)
    Depth.default.test = as.data.frame(Depth.default.test)
    head(Depth.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, mset[14])
    Depth.default.mset =as.data.frame (pv)
    head(Depth.default.mset)
    names(Depth.default.mset)[1] <- c("Depth.default.mset")
    head(Depth.default.mset)
    Depth.default.mset = cbind(mset$Depth.ob, Depth.default.mset$Depth.default.mset)
    Depth.default.mset = as.data.frame(Depth.default.mset)
    head(Depth.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, test[14])
    Depth.tuned.test =as.data.frame (pv)
    head(Depth.tuned.test)
    names(Depth.tuned.test)[1] <- c("Depth.tuned.test")
    Depth.tuned.test = cbind(test$Depth.ob, Depth.tuned.test$Depth.tuned.test)
    Depth.tuned.test = as.data.frame(Depth.tuned.test)
    head(Depth.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, mset[14])
    Depth.tuned.mset =as.data.frame (pv)
    head(Depth.tuned.mset)
    names(Depth.tuned.mset)[1] <- c("Depth.tuned.mset")
    head(Depth.tuned.mset)
    Depth.tuned.mset = cbind(mset$Depth.ob, Depth.tuned.mset$Depth.tuned.mset)
    Depth.tuned.mset = as.data.frame(Depth.tuned.mset)
    head(Depth.tuned.mset)
    
    #안성6(안성6 시계열열 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, n6[2])
    Depth.tuned.n6 =as.data.frame (pv)
    head(Depth.tuned.n6)
    names(Depth.tuned.n6)[1] <- c("Depth.tuned.n6")
    head(Depth.tuned.n6)
    Depth.tuned.n6 = cbind(n6[1], Depth.tuned.n6)
    head(Depth.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Depth.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Depth.default.mset, Depth.tuned.mset,ti$Depth.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Depth.ob")
    names(plot1)[3] <- c("Depth.default.mset")
    names(plot1)[5] <- c("Depth.tuned.mset")
    names(plot1)[6] <- c("Depth.pp")
  }
  head(plot1)
  Depth  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Depth.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Depth.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Depth.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Depth.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Depth.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Depth') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Depth')
  Depth
  n6.Depth = ggplot() +
    geom_line(data = n6, aes(x = Date, y = Depth.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Depth.tuned.n6, aes(x = Date, y = Depth.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Depth (m)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Depth (안성6)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n6.Depth
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.pp))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Depth.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Depth.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Depth (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.ob))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Depth.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Depth.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Depth (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #pH
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$pH.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # pH.svmRadial.default = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial')
  # pH.svmRadial.default
  # saveRDS(pH.svmRadial.default, "안성6.pH.svmRadial.default.rds")
  pH.svmRadial.default = readRDS("안성6.pH.svmRadial.default.rds")
  pH.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # pH.svmRadial.tuned = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  #                            tuneGrid = expand.grid(sigma = c(0.51213:5), C = c(0.1,0.25,0.5,0.75,1)))
  # pH.svmRadial.tuned
  # saveRDS(pH.svmRadial.tuned, "안성6.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned = readRDS("안성6.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, test[16])
    pH.default.test =as.data.frame (pv)
    head(pH.default.test)
    names(pH.default.test)[1] <- c("pH.default.test")
    head(pH.default.test)
    pH.default.test = cbind(test$pH.ob, pH.default.test$pH.default.test)
    pH.default.test = as.data.frame(pH.default.test)
    head(pH.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, mset[16])
    pH.default.mset =as.data.frame (pv)
    head(pH.default.mset)
    names(pH.default.mset)[1] <- c("pH.default.mset")
    head(pH.default.mset)
    pH.default.mset = cbind(mset$pH.ob, pH.default.mset$pH.default.mset)
    pH.default.mset = as.data.frame(pH.default.mset)
    head(pH.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, test[16])
    pH.tuned.test =as.data.frame (pv)
    head(pH.tuned.test)
    names(pH.tuned.test)[1] <- c("pH.tuned.test")
    pH.tuned.test = cbind(test$pH.ob, pH.tuned.test$pH.tuned.test)
    pH.tuned.test = as.data.frame(pH.tuned.test)
    head(pH.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, mset[16])
    pH.tuned.mset =as.data.frame (pv)
    head(pH.tuned.mset)
    names(pH.tuned.mset)[1] <- c("pH.tuned.mset")
    head(pH.tuned.mset)
    pH.tuned.mset = cbind(mset$pH.ob, pH.tuned.mset$pH.tuned.mset)
    pH.tuned.mset = as.data.frame(pH.tuned.mset)
    head(pH.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, n6[4])
    pH.tuned.n6 =as.data.frame (pv)
    head(pH.tuned.n6)
    names(pH.tuned.n6)[1] <- c("pH.tuned.n6")
    head(pH.tuned.n6)
    pH.tuned.n6 = cbind(n6[1], pH.tuned.n6)
    head(pH.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, pH.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, pH.default.mset, pH.tuned.mset,ti$pH.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("pH.ob")
    names(plot1)[3] <- c("pH.default.mset")
    names(plot1)[5] <- c("pH.tuned.mset")
    names(plot1)[6] <- c("pH.pp")
  }
  head(plot1)
  pH  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = pH.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = pH.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = pH.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = pH.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = pH.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('pH') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('pH')
  pH
  n6.pH = ggplot() +
    geom_line(data = n6, aes(x = Date, y = pH.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = pH.tuned.n6, aes(x = Date, y = pH.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = pH.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('pH')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("pH (안성6)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n6.pH
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.pp))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=pH.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=pH.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("pH (안성4)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.ob))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=pH.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=pH.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("pH (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #ORP
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$ORP.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # ORP.svmRadial.default = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial')
  # ORP.svmRadial.default
  # saveRDS(ORP.svmRadial.default, "안성6.ORP.svmRadial.default.rds")
  ORP.svmRadial.default = readRDS("안성6.ORP.svmRadial.default.rds")
  ORP.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # ORP.svmRadial.tuned = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5465:5), C = c(0.1,0.25,0.5,0.75,1)))
  # ORP.svmRadial.tuned
  # saveRDS(ORP.svmRadial.tuned, "안성6.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned = readRDS("안성6.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, test[17])
    ORP.default.test =as.data.frame (pv)
    head(ORP.default.test)
    names(ORP.default.test)[1] <- c("ORP.default.test")
    head(ORP.default.test)
    ORP.default.test = cbind(test$ORP.ob, ORP.default.test$ORP.default.test)
    ORP.default.test = as.data.frame(ORP.default.test)
    head(ORP.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, mset[17])
    ORP.default.mset =as.data.frame (pv)
    head(ORP.default.mset)
    names(ORP.default.mset)[1] <- c("ORP.default.mset")
    head(ORP.default.mset)
    ORP.default.mset = cbind(mset$ORP.ob, ORP.default.mset$ORP.default.mset)
    ORP.default.mset = as.data.frame(ORP.default.mset)
    head(ORP.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, test[17])
    ORP.tuned.test =as.data.frame (pv)
    head(ORP.tuned.test)
    names(ORP.tuned.test)[1] <- c("ORP.tuned.test")
    ORP.tuned.test = cbind(test$ORP.ob, ORP.tuned.test$ORP.tuned.test)
    ORP.tuned.test = as.data.frame(ORP.tuned.test)
    head(ORP.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, mset[17])
    ORP.tuned.mset =as.data.frame (pv)
    head(ORP.tuned.mset)
    names(ORP.tuned.mset)[1] <- c("ORP.tuned.mset")
    head(ORP.tuned.mset)
    ORP.tuned.mset = cbind(mset$ORP.ob, ORP.tuned.mset$ORP.tuned.mset)
    ORP.tuned.mset = as.data.frame(ORP.tuned.mset)
    head(ORP.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, n6[5])
    ORP.tuned.n6 =as.data.frame (pv)
    head(ORP.tuned.n6)
    names(ORP.tuned.n6)[1] <- c("ORP.tuned.n6")
    head(ORP.tuned.n6)
    ORP.tuned.n6 = cbind(n6[1], ORP.tuned.n6)
    head(ORP.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, ORP.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, ORP.default.mset, ORP.tuned.mset,ti$ORP.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("ORP.ob")
    names(plot1)[3] <- c("ORP.default.mset")
    names(plot1)[5] <- c("ORP.tuned.mset")
    names(plot1)[6] <- c("ORP.pp")
  }
  head(plot1)
  ORP  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = ORP.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = ORP.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = ORP.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = ORP.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = ORP.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('ORP') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('ORP')
  ORP
  n6.ORP = ggplot() +
    geom_line(data = n6, aes(x = Date, y = ORP.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = ORP.tuned.n6, aes(x = Date, y = ORP.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('ORP')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("ORP (안성6)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n6.ORP
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.pp))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=ORP.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=ORP.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("ORP (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.ob))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=ORP.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=ORP.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("ORP (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #EC
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$EC.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # EC.svmRadial.default = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial')
  # EC.svmRadial.default
  # saveRDS(EC.svmRadial.default, "안성6.EC.svmRadial.default.rds")
  EC.svmRadial.default = readRDS("안성6.EC.svmRadial.default.rds")
  EC.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # EC.svmRadial.tuned = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(20:25), C = c(0.1,0.25,0.5,0.75,1)))
  # EC.svmRadial.tuned
  # saveRDS(EC.svmRadial.tuned, "안성6.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned = readRDS("안성6.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, test[18])
    EC.default.test =as.data.frame (pv)
    head(EC.default.test)
    names(EC.default.test)[1] <- c("EC.default.test")
    head(EC.default.test)
    EC.default.test = cbind(test$EC.ob, EC.default.test$EC.default.test)
    EC.default.test = as.data.frame(EC.default.test)
    head(EC.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, mset[18])
    EC.default.mset =as.data.frame (pv)
    head(EC.default.mset)
    names(EC.default.mset)[1] <- c("EC.default.mset")
    head(EC.default.mset)
    EC.default.mset = cbind(mset$EC.ob, EC.default.mset$EC.default.mset)
    EC.default.mset = as.data.frame(EC.default.mset)
    head(EC.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, test[18])
    EC.tuned.test =as.data.frame (pv)
    head(EC.tuned.test)
    names(EC.tuned.test)[1] <- c("EC.tuned.test")
    EC.tuned.test = cbind(test$EC.ob, EC.tuned.test$EC.tuned.test)
    EC.tuned.test = as.data.frame(EC.tuned.test)
    head(EC.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, mset[18])
    EC.tuned.mset =as.data.frame (pv)
    head(EC.tuned.mset)
    names(EC.tuned.mset)[1] <- c("EC.tuned.mset")
    head(EC.tuned.mset)
    EC.tuned.mset = cbind(mset$EC.ob, EC.tuned.mset$EC.tuned.mset)
    EC.tuned.mset = as.data.frame(EC.tuned.mset)
    head(EC.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, n6[6])
    EC.tuned.n6 =as.data.frame (pv)
    head(EC.tuned.n6)
    names(EC.tuned.n6)[1] <- c("EC.tuned.n6")
    head(EC.tuned.n6)
    EC.tuned.n6 = cbind(n6[1], EC.tuned.n6)
    head(EC.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, EC.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, EC.default.mset, EC.tuned.mset,ti$EC.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("EC.ob")
    names(plot1)[3] <- c("EC.default.mset")
    names(plot1)[5] <- c("EC.tuned.mset")
    names(plot1)[6] <- c("EC.pp")
  }
  head(plot1)
  EC  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = EC.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = EC.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = EC.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = EC.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = EC.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('EC') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('EC')
  EC
  n6.EC = ggplot() +
    geom_line(data = n6, aes(x = Date, y = EC.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = EC.tuned.n6, aes(x = Date, y = EC.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = EC.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('EC')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("EC (안성6)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n6.EC
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.pp))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=EC.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=EC.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("EC (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.ob))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=EC.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=EC.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("EC (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Turbidity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Turbidity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Turbidity.svmRadial.default = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial')
  # Turbidity.svmRadial.default
  # saveRDS(Turbidity.svmRadial.default, "안성6.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default = readRDS("안성6.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Turbidity.svmRadial.tuned = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(5:10), C = c(0.1,0.25,0.5,0.75,1)))
  # Turbidity.svmRadial.tuned
  # saveRDS(Turbidity.svmRadial.tuned, "안성6.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned = readRDS("안성6.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, test[19])
    Turbidity.default.test =as.data.frame (pv)
    head(Turbidity.default.test)
    names(Turbidity.default.test)[1] <- c("Turbidity.default.test")
    head(Turbidity.default.test)
    Turbidity.default.test = cbind(test$Turbidity.ob, Turbidity.default.test$Turbidity.default.test)
    Turbidity.default.test = as.data.frame(Turbidity.default.test)
    head(Turbidity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, mset[19])
    Turbidity.default.mset =as.data.frame (pv)
    head(Turbidity.default.mset)
    names(Turbidity.default.mset)[1] <- c("Turbidity.default.mset")
    head(Turbidity.default.mset)
    Turbidity.default.mset = cbind(mset$Turbidity.ob, Turbidity.default.mset$Turbidity.default.mset)
    Turbidity.default.mset = as.data.frame(Turbidity.default.mset)
    head(Turbidity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, test[19])
    Turbidity.tuned.test =as.data.frame (pv)
    head(Turbidity.tuned.test)
    names(Turbidity.tuned.test)[1] <- c("Turbidity.tuned.test")
    Turbidity.tuned.test = cbind(test$Turbidity.ob, Turbidity.tuned.test$Turbidity.tuned.test)
    Turbidity.tuned.test = as.data.frame(Turbidity.tuned.test)
    head(Turbidity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, mset[19])
    Turbidity.tuned.mset =as.data.frame (pv)
    head(Turbidity.tuned.mset)
    names(Turbidity.tuned.mset)[1] <- c("Turbidity.tuned.mset")
    head(Turbidity.tuned.mset)
    Turbidity.tuned.mset = cbind(mset$Turbidity.ob, Turbidity.tuned.mset$Turbidity.tuned.mset)
    Turbidity.tuned.mset = as.data.frame(Turbidity.tuned.mset)
    head(Turbidity.tuned.mset)
    
    #안성6(안성6 시계열 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, n6[7])
    Turbidity.tuned.n6 =as.data.frame (pv)
    head(Turbidity.tuned.n6)
    names(Turbidity.tuned.n6)[1] <- c("Turbidity.tuned.n6")
    head(Turbidity.tuned.n6)
    Turbidity.tuned.n6 = cbind(n6[1], Turbidity.tuned.n6)
    head(Turbidity.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Turbidity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Turbidity.default.mset, Turbidity.tuned.mset,ti$Turbidity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Turbidity.ob")
    names(plot1)[3] <- c("Turbidity.default.mset")
    names(plot1)[5] <- c("Turbidity.tuned.mset")
    names(plot1)[6] <- c("Turbidity.pp")
  }
  head(plot1)
  Turbidity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Turbidity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Turbidity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Turbidity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Turbidity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Turbidity')
  Turbidity
  n6.Turbidity = ggplot() +
    geom_line(data = n6, aes(x = Date, y = Turbidity.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Turbidity.tuned.n6, aes(x = Date, y = Turbidity.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = Turbidity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Turbidity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Turbidity (안성6)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n6.Turbidity
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.pp))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Turbidity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Turbidity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Turbidity (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.ob))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Turbidity.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Turbidity.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Turbidity (안성4)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #TDS
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$TDS.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # TDS.svmRadial.default = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial')
  # TDS.svmRadial.default
  # saveRDS(TDS.svmRadial.default, "안성6.TDS.svmRadial.default.rds")
  TDS.svmRadial.default = readRDS("안성6.TDS.svmRadial.default.rds")
  TDS.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # TDS.svmRadial.tuned = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5413:5), C = c(0.1,0.25,0.5,0.75,1)))
  # TDS.svmRadial.tuned
  # saveRDS(TDS.svmRadial.tuned, "안성6.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned = readRDS("안성6.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, test[20])
    TDS.default.test =as.data.frame (pv)
    head(TDS.default.test)
    names(TDS.default.test)[1] <- c("TDS.default.test")
    head(TDS.default.test)
    TDS.default.test = cbind(test$TDS.ob, TDS.default.test$TDS.default.test)
    TDS.default.test = as.data.frame(TDS.default.test)
    head(TDS.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, mset[20])
    TDS.default.mset =as.data.frame (pv)
    head(TDS.default.mset)
    names(TDS.default.mset)[1] <- c("TDS.default.mset")
    head(TDS.default.mset)
    TDS.default.mset = cbind(mset$TDS.ob, TDS.default.mset$TDS.default.mset)
    TDS.default.mset = as.data.frame(TDS.default.mset)
    head(TDS.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, test[20])
    TDS.tuned.test =as.data.frame (pv)
    head(TDS.tuned.test)
    names(TDS.tuned.test)[1] <- c("TDS.tuned.test")
    TDS.tuned.test = cbind(test$TDS.ob, TDS.tuned.test$TDS.tuned.test)
    TDS.tuned.test = as.data.frame(TDS.tuned.test)
    head(TDS.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, mset[20])
    TDS.tuned.mset =as.data.frame (pv)
    head(TDS.tuned.mset)
    names(TDS.tuned.mset)[1] <- c("TDS.tuned.mset")
    head(TDS.tuned.mset)
    TDS.tuned.mset = cbind(mset$TDS.ob, TDS.tuned.mset$TDS.tuned.mset)
    TDS.tuned.mset = as.data.frame(TDS.tuned.mset)
    head(TDS.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, n6[8])
    TDS.tuned.n6 =as.data.frame (pv)
    head(TDS.tuned.n6)
    names(TDS.tuned.n6)[1] <- c("TDS.tuned.n6")
    head(TDS.tuned.n6)
    TDS.tuned.n6 = cbind(n6[1], TDS.tuned.n6)
    head(TDS.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, TDS.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, TDS.default.mset, TDS.tuned.mset,ti$TDS.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("TDS.ob")
    names(plot1)[3] <- c("TDS.default.mset")
    names(plot1)[5] <- c("TDS.tuned.mset")
    names(plot1)[6] <- c("TDS.pp")
  }
  head(plot1)
  TDS  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = TDS.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = TDS.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = TDS.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = TDS.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = TDS.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('TDS') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('TDS')
  TDS
  n6.TDS = ggplot() +
    geom_line(data = n6, aes(x = Date, y = TDS.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = TDS.tuned.n6, aes(x = Date, y = TDS.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = TDS.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('TDS')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("TDS (안성6)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n6.TDS
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.pp))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=TDS.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=TDS.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("TDS (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.ob))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=TDS.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=TDS.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("TDS (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Salinity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Salinity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Salinity.svmRadial.default = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial')
  # Salinity.svmRadial.default
  # saveRDS(Salinity.svmRadial.default, "안성6.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default = readRDS("안성6.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Salinity.svmRadial.tuned = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(20:25), C = c(0.1,0.25,0.5,0.75,1)))
  # Salinity.svmRadial.tuned
  # saveRDS(Salinity.svmRadial.tuned, "안성6.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned = readRDS("안성6.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, test[21])
    Salinity.default.test =as.data.frame (pv)
    head(Salinity.default.test)
    names(Salinity.default.test)[1] <- c("Salinity.default.test")
    head(Salinity.default.test)
    Salinity.default.test = cbind(test$Salinity.ob, Salinity.default.test$Salinity.default.test)
    Salinity.default.test = as.data.frame(Salinity.default.test)
    head(Salinity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, mset[21])
    Salinity.default.mset =as.data.frame (pv)
    head(Salinity.default.mset)
    names(Salinity.default.mset)[1] <- c("Salinity.default.mset")
    head(Salinity.default.mset)
    Salinity.default.mset = cbind(mset$Salinity.ob, Salinity.default.mset$Salinity.default.mset)
    Salinity.default.mset = as.data.frame(Salinity.default.mset)
    head(Salinity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, test[21])
    Salinity.tuned.test =as.data.frame (pv)
    head(Salinity.tuned.test)
    names(Salinity.tuned.test)[1] <- c("Salinity.tuned.test")
    Salinity.tuned.test = cbind(test$Salinity.ob, Salinity.tuned.test$Salinity.tuned.test)
    Salinity.tuned.test = as.data.frame(Salinity.tuned.test)
    head(Salinity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, mset[21])
    Salinity.tuned.mset =as.data.frame (pv)
    head(Salinity.tuned.mset)
    names(Salinity.tuned.mset)[1] <- c("Salinity.tuned.mset")
    head(Salinity.tuned.mset)
    Salinity.tuned.mset = cbind(mset$Salinity.ob, Salinity.tuned.mset$Salinity.tuned.mset)
    Salinity.tuned.mset = as.data.frame(Salinity.tuned.mset)
    head(Salinity.tuned.mset)
    
    #안성6(안성6 시계열열 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, n6[9])
    Salinity.tuned.n6 =as.data.frame (pv)
    head(Salinity.tuned.n6)
    names(Salinity.tuned.n6)[1] <- c("Salinity.tuned.n6")
    head(Salinity.tuned.n6)
    Salinity.tuned.n6 = cbind(n6[1], Salinity.tuned.n6)
    head(Salinity.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Salinity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Salinity.default.mset, Salinity.tuned.mset,ti$Salinity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Salinity.ob")
    names(plot1)[3] <- c("Salinity.default.mset")
    names(plot1)[5] <- c("Salinity.tuned.mset")
    names(plot1)[6] <- c("Salinity.pp")
  }
  head(plot1)
  Salinity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Salinity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Salinity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Salinity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Salinity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Salinity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Salinity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Salinity')
  Salinity
  n6.Salinity = ggplot() +
    geom_line(data = n6, aes(x = Date, y = Salinity.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Salinity.tuned.n6, aes(x = Date, y = Salinity.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = Salinity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Salinity (안성6)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n6.Salinity
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.pp))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Salinity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Salinity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Salinity (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.ob))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Salinity.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Salinity.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Salinity (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #NH3.N
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NH3.N.svmRadial.default = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial')
  # NH3.N.svmRadial.default
  # saveRDS(NH3.N.svmRadial.default, "안성6.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default = readRDS("안성6.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NH3.N.svmRadial.tuned = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(10:15), C = c(0.1,0.25,0.5,0.75,1)))
  # NH3.N.svmRadial.tuned
  # saveRDS(NH3.N.svmRadial.tuned, "안성6.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned = readRDS("안성6.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, test[22])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, mset[22])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, test[22])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, mset[22])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, n6[10])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(n6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NH3.N.default.mset, NH3.N.tuned.mset,ti$NH3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NH3.N.ob")
    names(plot1)[3] <- c("NH3.N.default.mset")
    names(plot1)[5] <- c("NH3.N.tuned.mset")
    names(plot1)[6] <- c("NH3.N.pp")
  }
  head(plot1)
  NH3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NH3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NH3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NH3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NH3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NH3.N')
  NH3.N
  n6.NH3.N = ggplot() +
    geom_line(data = n6, aes(x = Date, y = NH3.N.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NH3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NH3.N (안성6)") +ylim(0,4)
  #  scale_x_continuous(breaks = months)
  n6.NH3.N
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.pp))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NH3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NH3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NH3.N (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.ob))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NH3.N.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NH3.N.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("NH3.N (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #NO3.N
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    mset$NO3.N.ob[mset$NO3.N.ob %in% "NA"] <- NA
    mset = mset[complete.cases(mset), ]
    inTraining <- createDataPartition(mset$NO3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NO3.N.svmRadial.default = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial')
  # NO3.N.svmRadial.default
  # saveRDS(NO3.N.svmRadial.default, "안성6.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default = readRDS("안성6.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NO3.N.svmRadial.tuned = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.54864:5), C = c(0.1,0.25,0.5,0.75,1)))
  # NO3.N.svmRadial.tuned
  # saveRDS(NO3.N.svmRadial.tuned, "안성6.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned = readRDS("안성6.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, test[23])
    NO3.N.default.test =as.data.frame (pv)
    head(NO3.N.default.test)
    names(NO3.N.default.test)[1] <- c("NO3.N.default.test")
    head(NO3.N.default.test)
    NO3.N.default.test = cbind(test$NO3.N.ob, NO3.N.default.test$NO3.N.default.test)
    NO3.N.default.test = as.data.frame(NO3.N.default.test)
    head(NO3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, mset[23])
    NO3.N.default.mset =as.data.frame (pv)
    head(NO3.N.default.mset)
    names(NO3.N.default.mset)[1] <- c("NO3.N.default.mset")
    head(NO3.N.default.mset)
    NO3.N.default.mset = cbind(mset$NO3.N.ob, NO3.N.default.mset$NO3.N.default.mset)
    NO3.N.default.mset = as.data.frame(NO3.N.default.mset)
    head(NO3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, test[23])
    NO3.N.tuned.test =as.data.frame (pv)
    head(NO3.N.tuned.test)
    names(NO3.N.tuned.test)[1] <- c("NO3.N.tuned.test")
    NO3.N.tuned.test = cbind(test$NO3.N.ob, NO3.N.tuned.test$NO3.N.tuned.test)
    NO3.N.tuned.test = as.data.frame(NO3.N.tuned.test)
    head(NO3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, mset[23])
    NO3.N.tuned.mset =as.data.frame (pv)
    head(NO3.N.tuned.mset)
    names(NO3.N.tuned.mset)[1] <- c("NO3.N.tuned.mset")
    head(NO3.N.tuned.mset)
    NO3.N.tuned.mset = cbind(mset$NO3.N.ob, NO3.N.tuned.mset$NO3.N.tuned.mset)
    NO3.N.tuned.mset = as.data.frame(NO3.N.tuned.mset)
    head(NO3.N.tuned.mset)
    
    #안성6(안성6 시계열 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, n6[11])
    NO3.N.tuned.n6 =as.data.frame (pv)
    head(NO3.N.tuned.n6)
    names(NO3.N.tuned.n6)[1] <- c("NO3.N.tuned.n6")
    head(NO3.N.tuned.n6)
    NO3.N.tuned.n6 = cbind(n6[1], NO3.N.tuned.n6)
    head(NO3.N.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NO3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NO3.N.default.mset, NO3.N.tuned.mset,mset$NO3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NO3.N.ob")
    names(plot1)[3] <- c("NO3.N.default.mset")
    names(plot1)[5] <- c("NO3.N.tuned.mset")
    names(plot1)[6] <- c("NO3.N.pp")
  }
  head(plot1)
  NO3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NO3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NO3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NO3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NO3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NO3.N')
  NO3.N
  n6.NO3.N = ggplot() +
    geom_line(data = n6, aes(x = Date, y = NO3.N.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = NO3.N.tuned.n6, aes(x = Date, y = NO3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NO3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NO3.N (안성6)") #+ylim(0,4)
  #  scale_x_continuous(breaks = months)
  n6.NO3.N
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.pp))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NO3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NO3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NO3.N (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.ob))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NO3.N.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NO3.N.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("NO3.N (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Cl
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Cl.svmRadial.default = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial')
  # Cl.svmRadial.default
  # saveRDS(Cl.svmRadial.default, "안성6.Cl.svmRadial.default.rds")
  Cl.svmRadial.default = readRDS("안성6.Cl.svmRadial.default.rds")
  Cl.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Cl.svmRadial.tuned = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.8456:5), C = c(0.1,0.25,0.5,0.75,1)))
  # Cl.svmRadial.tuned
  # saveRDS(Cl.svmRadial.tuned, "안성6.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned = readRDS("안성6.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, test[24])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, mset[24])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, test[24])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, mset[24])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #안성4(안성4 시계열열 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, n6[12])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(n6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Cl.default.mset, Cl.tuned.mset,ti$Cl.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Cl.ob")
    names(plot1)[3] <- c("Cl.default.mset")
    names(plot1)[5] <- c("Cl.tuned.mset")
    names(plot1)[6] <- c("Cl.pp")
  }
  head(plot1)
  Cl  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Cl.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Cl.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Cl.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Cl.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Cl.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Cl') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Cl')
  Cl
  n6.Cl = ggplot() +
    geom_line(data = n6, aes(x = Date, y = Cl.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Cl (안성6)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.Cl
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.pp))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Cl.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Cl.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Cl (안성6)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.ob))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Cl.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Cl.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Cl (안성6)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
}
#-----------
#안성 관정8
ti = e8
{
  #Depth
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Depth.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Depth.svmRadial.default = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial')
  # Depth.svmRadial.default
  # saveRDS(Depth.svmRadial.default, "안성8.Depth.svmRadial.default.rds")
  Depth.svmRadial.default = readRDS("안성8.Depth.svmRadial.default.rds")
  Depth.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Depth.svmRadial.tuned = train(Depth.ob ~ Depth.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(10:15), C = c(0.1,0.25,0.5,0.75,1)))
  # Depth.svmRadial.tuned
  # saveRDS(Depth.svmRadial.tuned, "안성8.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned = readRDS("안성8.Depth.svmRadial.tuned.rds")
  Depth.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, test[14])
    Depth.default.test =as.data.frame (pv)
    head(Depth.default.test)
    names(Depth.default.test)[1] <- c("Depth.default.test")
    head(Depth.default.test)
    Depth.default.test = cbind(test$Depth.ob, Depth.default.test$Depth.default.test)
    Depth.default.test = as.data.frame(Depth.default.test)
    head(Depth.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.default, mset[14])
    Depth.default.mset =as.data.frame (pv)
    head(Depth.default.mset)
    names(Depth.default.mset)[1] <- c("Depth.default.mset")
    head(Depth.default.mset)
    Depth.default.mset = cbind(mset$Depth.ob, Depth.default.mset$Depth.default.mset)
    Depth.default.mset = as.data.frame(Depth.default.mset)
    head(Depth.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, test[14])
    Depth.tuned.test =as.data.frame (pv)
    head(Depth.tuned.test)
    names(Depth.tuned.test)[1] <- c("Depth.tuned.test")
    Depth.tuned.test = cbind(test$Depth.ob, Depth.tuned.test$Depth.tuned.test)
    Depth.tuned.test = as.data.frame(Depth.tuned.test)
    head(Depth.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, mset[14])
    Depth.tuned.mset =as.data.frame (pv)
    head(Depth.tuned.mset)
    names(Depth.tuned.mset)[1] <- c("Depth.tuned.mset")
    head(Depth.tuned.mset)
    Depth.tuned.mset = cbind(mset$Depth.ob, Depth.tuned.mset$Depth.tuned.mset)
    Depth.tuned.mset = as.data.frame(Depth.tuned.mset)
    head(Depth.tuned.mset)
    
    #안성8(안성8 시계열열 예측 데이터 생성)
    pv=predict(Depth.svmRadial.tuned, n8[2])
    Depth.tuned.n8 =as.data.frame (pv)
    head(Depth.tuned.n8)
    names(Depth.tuned.n8)[1] <- c("Depth.tuned.n8")
    head(Depth.tuned.n8)
    Depth.tuned.n8 = cbind(n8[1], Depth.tuned.n8)
    head(Depth.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Depth.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Depth.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Depth.default.mset, Depth.tuned.mset,ti$Depth.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Depth.ob")
    names(plot1)[3] <- c("Depth.default.mset")
    names(plot1)[5] <- c("Depth.tuned.mset")
    names(plot1)[6] <- c("Depth.pp")
  }
  head(plot1)
  Depth  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Depth.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Depth.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Depth.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Depth.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Depth.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Depth.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Depth') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Depth')
  Depth
  n8.Depth = ggplot() +
    geom_line(data = n8, aes(x = Date, y = Depth.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Depth.tuned.n8, aes(x = Date, y = Depth.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Depth (m)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Depth (안성8)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n8.Depth
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.pp))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Depth.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Depth.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Depth (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Depth.ob/max(plot1$Depth.ob))
  ggplot(plot1, aes(x=Depth.ob))+
    geom_point(aes(y=Depth.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Depth.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Depth.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Depth.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Depth (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #pH
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$pH.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # pH.svmRadial.default = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial')
  # pH.svmRadial.default
  # saveRDS(pH.svmRadial.default, "안성8.pH.svmRadial.default.rds")
  pH.svmRadial.default = readRDS("안성8.pH.svmRadial.default.rds")
  pH.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # pH.svmRadial.tuned = train(pH.ob ~ pH.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  #                            tuneGrid = expand.grid(sigma = c(0.51213:5), C = c(0.1,0.25,0.5,0.75,1)))
  # pH.svmRadial.tuned
  # saveRDS(pH.svmRadial.tuned, "안성8.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned = readRDS("안성8.pH.svmRadial.tuned.rds")
  pH.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, test[16])
    pH.default.test =as.data.frame (pv)
    head(pH.default.test)
    names(pH.default.test)[1] <- c("pH.default.test")
    head(pH.default.test)
    pH.default.test = cbind(test$pH.ob, pH.default.test$pH.default.test)
    pH.default.test = as.data.frame(pH.default.test)
    head(pH.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.default, mset[16])
    pH.default.mset =as.data.frame (pv)
    head(pH.default.mset)
    names(pH.default.mset)[1] <- c("pH.default.mset")
    head(pH.default.mset)
    pH.default.mset = cbind(mset$pH.ob, pH.default.mset$pH.default.mset)
    pH.default.mset = as.data.frame(pH.default.mset)
    head(pH.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, test[16])
    pH.tuned.test =as.data.frame (pv)
    head(pH.tuned.test)
    names(pH.tuned.test)[1] <- c("pH.tuned.test")
    pH.tuned.test = cbind(test$pH.ob, pH.tuned.test$pH.tuned.test)
    pH.tuned.test = as.data.frame(pH.tuned.test)
    head(pH.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, mset[16])
    pH.tuned.mset =as.data.frame (pv)
    head(pH.tuned.mset)
    names(pH.tuned.mset)[1] <- c("pH.tuned.mset")
    head(pH.tuned.mset)
    pH.tuned.mset = cbind(mset$pH.ob, pH.tuned.mset$pH.tuned.mset)
    pH.tuned.mset = as.data.frame(pH.tuned.mset)
    head(pH.tuned.mset)
    
    #안성8(안성8 시계열열 예측 데이터 생성)
    pv=predict(pH.svmRadial.tuned, n8[4])
    pH.tuned.n8 =as.data.frame (pv)
    head(pH.tuned.n8)
    names(pH.tuned.n8)[1] <- c("pH.tuned.n8")
    head(pH.tuned.n8)
    pH.tuned.n8 = cbind(n8[1], pH.tuned.n8)
    head(pH.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, pH.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, pH.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, pH.default.mset, pH.tuned.mset,ti$pH.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("pH.ob")
    names(plot1)[3] <- c("pH.default.mset")
    names(plot1)[5] <- c("pH.tuned.mset")
    names(plot1)[6] <- c("pH.pp")
  }
  head(plot1)
  pH  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = pH.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = pH.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = pH.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = pH.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = pH.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = pH.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('pH') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('pH')
  pH
  n8.pH = ggplot() +
    geom_line(data = n8, aes(x = Date, y = pH.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = pH.tuned.n8, aes(x = Date, y = pH.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = pH.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('pH')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("pH (안성8)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n8.pH
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.pp))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=pH.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=pH.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("pH (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$pH.ob/max(plot1$pH.ob))
  ggplot(plot1, aes(x=pH.ob))+
    geom_point(aes(y=pH.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=pH.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=pH.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=pH.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("pH (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #ORP
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$ORP.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # ORP.svmRadial.default = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial')
  # ORP.svmRadial.default
  # saveRDS(ORP.svmRadial.default, "안성8.ORP.svmRadial.default.rds")
  ORP.svmRadial.default = readRDS("안성8.ORP.svmRadial.default.rds")
  ORP.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # ORP.svmRadial.tuned = train(ORP.ob ~ ORP.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(10:15), C = c(0.1,0.25,0.5,0.75,1)))
  # ORP.svmRadial.tuned
  # saveRDS(ORP.svmRadial.tuned, "안성8.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned = readRDS("안성8.ORP.svmRadial.tuned.rds")
  ORP.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, test[17])
    ORP.default.test =as.data.frame (pv)
    head(ORP.default.test)
    names(ORP.default.test)[1] <- c("ORP.default.test")
    head(ORP.default.test)
    ORP.default.test = cbind(test$ORP.ob, ORP.default.test$ORP.default.test)
    ORP.default.test = as.data.frame(ORP.default.test)
    head(ORP.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.default, mset[17])
    ORP.default.mset =as.data.frame (pv)
    head(ORP.default.mset)
    names(ORP.default.mset)[1] <- c("ORP.default.mset")
    head(ORP.default.mset)
    ORP.default.mset = cbind(mset$ORP.ob, ORP.default.mset$ORP.default.mset)
    ORP.default.mset = as.data.frame(ORP.default.mset)
    head(ORP.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, test[17])
    ORP.tuned.test =as.data.frame (pv)
    head(ORP.tuned.test)
    names(ORP.tuned.test)[1] <- c("ORP.tuned.test")
    ORP.tuned.test = cbind(test$ORP.ob, ORP.tuned.test$ORP.tuned.test)
    ORP.tuned.test = as.data.frame(ORP.tuned.test)
    head(ORP.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, mset[17])
    ORP.tuned.mset =as.data.frame (pv)
    head(ORP.tuned.mset)
    names(ORP.tuned.mset)[1] <- c("ORP.tuned.mset")
    head(ORP.tuned.mset)
    ORP.tuned.mset = cbind(mset$ORP.ob, ORP.tuned.mset$ORP.tuned.mset)
    ORP.tuned.mset = as.data.frame(ORP.tuned.mset)
    head(ORP.tuned.mset)
    
    #안성8(안성8 시계열열 예측 데이터 생성)
    pv=predict(ORP.svmRadial.tuned, n8[5])
    ORP.tuned.n8 =as.data.frame (pv)
    head(ORP.tuned.n8)
    names(ORP.tuned.n8)[1] <- c("ORP.tuned.n8")
    head(ORP.tuned.n8)
    ORP.tuned.n8 = cbind(n8[1], ORP.tuned.n8)
    head(ORP.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, ORP.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, ORP.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, ORP.default.mset, ORP.tuned.mset,ti$ORP.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("ORP.ob")
    names(plot1)[3] <- c("ORP.default.mset")
    names(plot1)[5] <- c("ORP.tuned.mset")
    names(plot1)[6] <- c("ORP.pp")
  }
  head(plot1)
  ORP  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = ORP.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = ORP.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = ORP.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = ORP.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = ORP.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = ORP.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('ORP') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('ORP')
  ORP
  n8.ORP = ggplot() +
    geom_line(data = n8, aes(x = Date, y = ORP.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = ORP.tuned.n8, aes(x = Date, y = ORP.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('ORP')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("ORP (안성8)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n8.ORP
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.pp))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=ORP.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=ORP.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("ORP (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$ORP.ob/max(plot1$ORP.ob))
  ggplot(plot1, aes(x=ORP.ob))+
    geom_point(aes(y=ORP.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=ORP.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=ORP.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=ORP.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("ORP (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #EC
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$EC.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # EC.svmRadial.default = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial')
  # EC.svmRadial.default
  # saveRDS(EC.svmRadial.default, "안성8.EC.svmRadial.default.rds")
  EC.svmRadial.default = readRDS("안성8.EC.svmRadial.default.rds")
  EC.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # EC.svmRadial.tuned = train(EC.ob ~ EC.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(20:25), C = c(0.1,0.25,0.5,0.75,1)))
  # EC.svmRadial.tuned
  # saveRDS(EC.svmRadial.tuned, "안성8.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned = readRDS("안성8.EC.svmRadial.tuned.rds")
  EC.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, test[18])
    EC.default.test =as.data.frame (pv)
    head(EC.default.test)
    names(EC.default.test)[1] <- c("EC.default.test")
    head(EC.default.test)
    EC.default.test = cbind(test$EC.ob, EC.default.test$EC.default.test)
    EC.default.test = as.data.frame(EC.default.test)
    head(EC.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.default, mset[18])
    EC.default.mset =as.data.frame (pv)
    head(EC.default.mset)
    names(EC.default.mset)[1] <- c("EC.default.mset")
    head(EC.default.mset)
    EC.default.mset = cbind(mset$EC.ob, EC.default.mset$EC.default.mset)
    EC.default.mset = as.data.frame(EC.default.mset)
    head(EC.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, test[18])
    EC.tuned.test =as.data.frame (pv)
    head(EC.tuned.test)
    names(EC.tuned.test)[1] <- c("EC.tuned.test")
    EC.tuned.test = cbind(test$EC.ob, EC.tuned.test$EC.tuned.test)
    EC.tuned.test = as.data.frame(EC.tuned.test)
    head(EC.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, mset[18])
    EC.tuned.mset =as.data.frame (pv)
    head(EC.tuned.mset)
    names(EC.tuned.mset)[1] <- c("EC.tuned.mset")
    head(EC.tuned.mset)
    EC.tuned.mset = cbind(mset$EC.ob, EC.tuned.mset$EC.tuned.mset)
    EC.tuned.mset = as.data.frame(EC.tuned.mset)
    head(EC.tuned.mset)
    
    #안성8(안성8 시계열열 예측 데이터 생성)
    pv=predict(EC.svmRadial.tuned, n8[6])
    EC.tuned.n8 =as.data.frame (pv)
    head(EC.tuned.n8)
    names(EC.tuned.n8)[1] <- c("EC.tuned.n8")
    head(EC.tuned.n8)
    EC.tuned.n8 = cbind(n8[1], EC.tuned.n8)
    head(EC.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, EC.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, EC.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, EC.default.mset, EC.tuned.mset,ti$EC.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("EC.ob")
    names(plot1)[3] <- c("EC.default.mset")
    names(plot1)[5] <- c("EC.tuned.mset")
    names(plot1)[6] <- c("EC.pp")
  }
  head(plot1)
  EC  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = EC.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = EC.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = EC.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = EC.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = EC.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = EC.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('EC') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('EC')
  EC
  n8.EC = ggplot() +
    geom_line(data = n8, aes(x = Date, y = EC.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = EC.tuned.n8, aes(x = Date, y = EC.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = EC.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('EC')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("EC (안성8)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n8.EC
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.pp))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=EC.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=EC.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("EC (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$EC.ob/max(plot1$EC.ob))
  ggplot(plot1, aes(x=EC.ob))+
    geom_point(aes(y=EC.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=EC.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=EC.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=EC.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("EC (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Turbidity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Turbidity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Turbidity.svmRadial.default = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial')
  # Turbidity.svmRadial.default
  # saveRDS(Turbidity.svmRadial.default, "안성8.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default = readRDS("안성8.Turbidity.svmRadial.default.rds")
  Turbidity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Turbidity.svmRadial.tuned = train(Turbidity.ob ~ Turbidity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.554:5), C = c(0.1,0.25,0.5,0.75,1)))
  # Turbidity.svmRadial.tuned
  # saveRDS(Turbidity.svmRadial.tuned, "안성8.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned = readRDS("안성8.Turbidity.svmRadial.tuned.rds")
  Turbidity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, test[19])
    Turbidity.default.test =as.data.frame (pv)
    head(Turbidity.default.test)
    names(Turbidity.default.test)[1] <- c("Turbidity.default.test")
    head(Turbidity.default.test)
    Turbidity.default.test = cbind(test$Turbidity.ob, Turbidity.default.test$Turbidity.default.test)
    Turbidity.default.test = as.data.frame(Turbidity.default.test)
    head(Turbidity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.default, mset[19])
    Turbidity.default.mset =as.data.frame (pv)
    head(Turbidity.default.mset)
    names(Turbidity.default.mset)[1] <- c("Turbidity.default.mset")
    head(Turbidity.default.mset)
    Turbidity.default.mset = cbind(mset$Turbidity.ob, Turbidity.default.mset$Turbidity.default.mset)
    Turbidity.default.mset = as.data.frame(Turbidity.default.mset)
    head(Turbidity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, test[19])
    Turbidity.tuned.test =as.data.frame (pv)
    head(Turbidity.tuned.test)
    names(Turbidity.tuned.test)[1] <- c("Turbidity.tuned.test")
    Turbidity.tuned.test = cbind(test$Turbidity.ob, Turbidity.tuned.test$Turbidity.tuned.test)
    Turbidity.tuned.test = as.data.frame(Turbidity.tuned.test)
    head(Turbidity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, mset[19])
    Turbidity.tuned.mset =as.data.frame (pv)
    head(Turbidity.tuned.mset)
    names(Turbidity.tuned.mset)[1] <- c("Turbidity.tuned.mset")
    head(Turbidity.tuned.mset)
    Turbidity.tuned.mset = cbind(mset$Turbidity.ob, Turbidity.tuned.mset$Turbidity.tuned.mset)
    Turbidity.tuned.mset = as.data.frame(Turbidity.tuned.mset)
    head(Turbidity.tuned.mset)
    
    #안성8(안성8 시계열 예측 데이터 생성)
    pv=predict(Turbidity.svmRadial.tuned, n8[7])
    Turbidity.tuned.n8 =as.data.frame (pv)
    head(Turbidity.tuned.n8)
    names(Turbidity.tuned.n8)[1] <- c("Turbidity.tuned.n8")
    head(Turbidity.tuned.n8)
    Turbidity.tuned.n8 = cbind(n8[1], Turbidity.tuned.n8)
    head(Turbidity.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Turbidity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Turbidity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Turbidity.default.mset, Turbidity.tuned.mset,ti$Turbidity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Turbidity.ob")
    names(plot1)[3] <- c("Turbidity.default.mset")
    names(plot1)[5] <- c("Turbidity.tuned.mset")
    names(plot1)[6] <- c("Turbidity.pp")
  }
  head(plot1)
  Turbidity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Turbidity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Turbidity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Turbidity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Turbidity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Turbidity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Turbidity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Turbidity')
  Turbidity
  n8.Turbidity = ggplot() +
    geom_line(data = n8, aes(x = Date, y = Turbidity.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Turbidity.tuned.n8, aes(x = Date, y = Turbidity.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = Turbidity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Turbidity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Turbidity (안성8)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n8.Turbidity
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.pp))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Turbidity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Turbidity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Turbidity (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Turbidity.ob/max(plot1$Turbidity.ob))
  ggplot(plot1, aes(x=Turbidity.ob))+
    geom_point(aes(y=Turbidity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Turbidity.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Turbidity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Turbidity.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Turbidity (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #TDS
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$TDS.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # TDS.svmRadial.default = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial')
  # TDS.svmRadial.default
  # saveRDS(TDS.svmRadial.default, "안성8.TDS.svmRadial.default.rds")
  TDS.svmRadial.default = readRDS("안성8.TDS.svmRadial.default.rds")
  TDS.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # TDS.svmRadial.tuned = train(TDS.ob ~ TDS.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.5413:5), C = c(0.1,0.25,0.5,0.75,1)))
  # TDS.svmRadial.tuned
  # saveRDS(TDS.svmRadial.tuned, "안성8.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned = readRDS("안성8.TDS.svmRadial.tuned.rds")
  TDS.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, test[20])
    TDS.default.test =as.data.frame (pv)
    head(TDS.default.test)
    names(TDS.default.test)[1] <- c("TDS.default.test")
    head(TDS.default.test)
    TDS.default.test = cbind(test$TDS.ob, TDS.default.test$TDS.default.test)
    TDS.default.test = as.data.frame(TDS.default.test)
    head(TDS.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.default, mset[20])
    TDS.default.mset =as.data.frame (pv)
    head(TDS.default.mset)
    names(TDS.default.mset)[1] <- c("TDS.default.mset")
    head(TDS.default.mset)
    TDS.default.mset = cbind(mset$TDS.ob, TDS.default.mset$TDS.default.mset)
    TDS.default.mset = as.data.frame(TDS.default.mset)
    head(TDS.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, test[20])
    TDS.tuned.test =as.data.frame (pv)
    head(TDS.tuned.test)
    names(TDS.tuned.test)[1] <- c("TDS.tuned.test")
    TDS.tuned.test = cbind(test$TDS.ob, TDS.tuned.test$TDS.tuned.test)
    TDS.tuned.test = as.data.frame(TDS.tuned.test)
    head(TDS.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, mset[20])
    TDS.tuned.mset =as.data.frame (pv)
    head(TDS.tuned.mset)
    names(TDS.tuned.mset)[1] <- c("TDS.tuned.mset")
    head(TDS.tuned.mset)
    TDS.tuned.mset = cbind(mset$TDS.ob, TDS.tuned.mset$TDS.tuned.mset)
    TDS.tuned.mset = as.data.frame(TDS.tuned.mset)
    head(TDS.tuned.mset)
    
    #안성8(안성8 시계열열 예측 데이터 생성)
    pv=predict(TDS.svmRadial.tuned, n8[8])
    TDS.tuned.n8 =as.data.frame (pv)
    head(TDS.tuned.n8)
    names(TDS.tuned.n8)[1] <- c("TDS.tuned.n8")
    head(TDS.tuned.n8)
    TDS.tuned.n8 = cbind(n8[1], TDS.tuned.n8)
    head(TDS.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, TDS.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, TDS.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, TDS.default.mset, TDS.tuned.mset,ti$TDS.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("TDS.ob")
    names(plot1)[3] <- c("TDS.default.mset")
    names(plot1)[5] <- c("TDS.tuned.mset")
    names(plot1)[6] <- c("TDS.pp")
  }
  head(plot1)
  TDS  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = TDS.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = TDS.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = TDS.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = TDS.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = TDS.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = TDS.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('TDS') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('TDS')
  TDS
  n8.TDS = ggplot() +
    geom_line(data = n8, aes(x = Date, y = TDS.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = TDS.tuned.n8, aes(x = Date, y = TDS.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = TDS.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('TDS')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("TDS (안성8)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n8.TDS
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.pp))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=TDS.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=TDS.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("TDS (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$TDS.ob/max(plot1$TDS.ob))
  ggplot(plot1, aes(x=TDS.ob))+
    geom_point(aes(y=TDS.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=TDS.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=TDS.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=TDS.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("TDS (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Salinity
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Salinity.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Salinity.svmRadial.default = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial')
  # Salinity.svmRadial.default
  # saveRDS(Salinity.svmRadial.default, "안성8.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default = readRDS("안성8.Salinity.svmRadial.default.rds")
  Salinity.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Salinity.svmRadial.tuned = train(Salinity.ob ~ Salinity.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(20:25), C = c(0.1,0.25,0.5,0.75,1)))
  # Salinity.svmRadial.tuned
  # saveRDS(Salinity.svmRadial.tuned, "안성8.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned = readRDS("안성8.Salinity.svmRadial.tuned.rds")
  Salinity.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, test[21])
    Salinity.default.test =as.data.frame (pv)
    head(Salinity.default.test)
    names(Salinity.default.test)[1] <- c("Salinity.default.test")
    head(Salinity.default.test)
    Salinity.default.test = cbind(test$Salinity.ob, Salinity.default.test$Salinity.default.test)
    Salinity.default.test = as.data.frame(Salinity.default.test)
    head(Salinity.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.default, mset[21])
    Salinity.default.mset =as.data.frame (pv)
    head(Salinity.default.mset)
    names(Salinity.default.mset)[1] <- c("Salinity.default.mset")
    head(Salinity.default.mset)
    Salinity.default.mset = cbind(mset$Salinity.ob, Salinity.default.mset$Salinity.default.mset)
    Salinity.default.mset = as.data.frame(Salinity.default.mset)
    head(Salinity.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, test[21])
    Salinity.tuned.test =as.data.frame (pv)
    head(Salinity.tuned.test)
    names(Salinity.tuned.test)[1] <- c("Salinity.tuned.test")
    Salinity.tuned.test = cbind(test$Salinity.ob, Salinity.tuned.test$Salinity.tuned.test)
    Salinity.tuned.test = as.data.frame(Salinity.tuned.test)
    head(Salinity.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, mset[21])
    Salinity.tuned.mset =as.data.frame (pv)
    head(Salinity.tuned.mset)
    names(Salinity.tuned.mset)[1] <- c("Salinity.tuned.mset")
    head(Salinity.tuned.mset)
    Salinity.tuned.mset = cbind(mset$Salinity.ob, Salinity.tuned.mset$Salinity.tuned.mset)
    Salinity.tuned.mset = as.data.frame(Salinity.tuned.mset)
    head(Salinity.tuned.mset)
    
    #안성8(안성8 시계열열 예측 데이터 생성)
    pv=predict(Salinity.svmRadial.tuned, n8[9])
    Salinity.tuned.n8 =as.data.frame (pv)
    head(Salinity.tuned.n8)
    names(Salinity.tuned.n8)[1] <- c("Salinity.tuned.n8")
    head(Salinity.tuned.n8)
    Salinity.tuned.n8 = cbind(n8[1], Salinity.tuned.n8)
    head(Salinity.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Salinity.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Salinity.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Salinity.default.mset, Salinity.tuned.mset,ti$Salinity.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Salinity.ob")
    names(plot1)[3] <- c("Salinity.default.mset")
    names(plot1)[5] <- c("Salinity.tuned.mset")
    names(plot1)[6] <- c("Salinity.pp")
  }
  head(plot1)
  Salinity  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Salinity.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Salinity.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Salinity.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Salinity.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Salinity.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Salinity.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Salinity') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Salinity')
  Salinity
  n8.Salinity = ggplot() +
    geom_line(data = n8, aes(x = Date, y = Salinity.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Salinity.tuned.n8, aes(x = Date, y = Salinity.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = Salinity.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Salinity (안성8)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n8.Salinity
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.pp))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Salinity.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Salinity.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Salinity (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Salinity.ob/max(plot1$Salinity.ob))
  ggplot(plot1, aes(x=Salinity.ob))+
    geom_point(aes(y=Salinity.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Salinity.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Salinity.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Salinity.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Salinity (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #NH3.N
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NH3.N.svmRadial.default = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial')
  # NH3.N.svmRadial.default
  # saveRDS(NH3.N.svmRadial.default, "안성8.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default = readRDS("안성8.NH3.N.svmRadial.default.rds")
  NH3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NH3.N.svmRadial.tuned = train(NH3.N.ob ~ NH3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(10:15), C = c(0.1,0.25,0.5,0.75,1)))
  # NH3.N.svmRadial.tuned
  # saveRDS(NH3.N.svmRadial.tuned, "안성8.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned = readRDS("안성8.NH3.N.svmRadial.tuned.rds")
  NH3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, test[22])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.default, mset[22])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, test[22])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, mset[22])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #안성8(안성8 시계열열 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, n8[10])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(n8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NH3.N.default.mset, NH3.N.tuned.mset,ti$NH3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NH3.N.ob")
    names(plot1)[3] <- c("NH3.N.default.mset")
    names(plot1)[5] <- c("NH3.N.tuned.mset")
    names(plot1)[6] <- c("NH3.N.pp")
  }
  head(plot1)
  NH3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NH3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NH3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NH3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NH3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NH3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NH3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NH3.N')
  NH3.N
  n8.NH3.N = ggplot() +
    geom_line(data = n8, aes(x = Date, y = NH3.N.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NH3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NH3.N (안성8)") +ylim(0,4)
  #  scale_x_continuous(breaks = months)
  n8.NH3.N
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.pp))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NH3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NH3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NH3.N (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$NH3.N.ob/max(plot1$NH3.N.ob))
  ggplot(plot1, aes(x=NH3.N.ob))+
    geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NH3.N.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NH3.N.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("NH3.N (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #NO3.N
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    mset$NO3.N.ob[mset$NO3.N.ob %in% "NA"] <- NA
    mset = mset[complete.cases(mset), ]
    inTraining <- createDataPartition(mset$NO3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # NO3.N.svmRadial.default = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial')
  # NO3.N.svmRadial.default
  # saveRDS(NO3.N.svmRadial.default, "안성8.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default = readRDS("안성8.NO3.N.svmRadial.default.rds")
  NO3.N.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # NO3.N.svmRadial.tuned = train(NO3.N.ob ~ NO3.N.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.54864:5), C = c(0.1,0.25,0.5,0.75,1)))
  # NO3.N.svmRadial.tuned
  # saveRDS(NO3.N.svmRadial.tuned, "안성8.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned = readRDS("안성8.NO3.N.svmRadial.tuned.rds")
  NO3.N.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, test[23])
    NO3.N.default.test =as.data.frame (pv)
    head(NO3.N.default.test)
    names(NO3.N.default.test)[1] <- c("NO3.N.default.test")
    head(NO3.N.default.test)
    NO3.N.default.test = cbind(test$NO3.N.ob, NO3.N.default.test$NO3.N.default.test)
    NO3.N.default.test = as.data.frame(NO3.N.default.test)
    head(NO3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.default, mset[23])
    NO3.N.default.mset =as.data.frame (pv)
    head(NO3.N.default.mset)
    names(NO3.N.default.mset)[1] <- c("NO3.N.default.mset")
    head(NO3.N.default.mset)
    NO3.N.default.mset = cbind(mset$NO3.N.ob, NO3.N.default.mset$NO3.N.default.mset)
    NO3.N.default.mset = as.data.frame(NO3.N.default.mset)
    head(NO3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, test[23])
    NO3.N.tuned.test =as.data.frame (pv)
    head(NO3.N.tuned.test)
    names(NO3.N.tuned.test)[1] <- c("NO3.N.tuned.test")
    NO3.N.tuned.test = cbind(test$NO3.N.ob, NO3.N.tuned.test$NO3.N.tuned.test)
    NO3.N.tuned.test = as.data.frame(NO3.N.tuned.test)
    head(NO3.N.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, mset[23])
    NO3.N.tuned.mset =as.data.frame (pv)
    head(NO3.N.tuned.mset)
    names(NO3.N.tuned.mset)[1] <- c("NO3.N.tuned.mset")
    head(NO3.N.tuned.mset)
    NO3.N.tuned.mset = cbind(mset$NO3.N.ob, NO3.N.tuned.mset$NO3.N.tuned.mset)
    NO3.N.tuned.mset = as.data.frame(NO3.N.tuned.mset)
    head(NO3.N.tuned.mset)
    
    #안성8(안성8 시계열 예측 데이터 생성)
    pv=predict(NO3.N.svmRadial.tuned, n8[11])
    NO3.N.tuned.n8 =as.data.frame (pv)
    head(NO3.N.tuned.n8)
    names(NO3.N.tuned.n8)[1] <- c("NO3.N.tuned.n8")
    head(NO3.N.tuned.n8)
    NO3.N.tuned.n8 = cbind(n8[1], NO3.N.tuned.n8)
    head(NO3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NO3.N.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NO3.N.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, NO3.N.default.mset, NO3.N.tuned.mset,mset$NO3.N.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("NO3.N.ob")
    names(plot1)[3] <- c("NO3.N.default.mset")
    names(plot1)[5] <- c("NO3.N.tuned.mset")
    names(plot1)[6] <- c("NO3.N.pp")
  }
  head(plot1)
  NO3.N  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = NO3.N.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = NO3.N.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = NO3.N.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = NO3.N.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = NO3.N.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('NO3.N') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('NO3.N')
  NO3.N
  n8.NO3.N = ggplot() +
    geom_line(data = n8, aes(x = Date, y = NO3.N.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = NO3.N.tuned.n8, aes(x = Date, y = NO3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('NO3.N')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("NO3.N (안성8)") #+ylim(0,4)
  #  scale_x_continuous(breaks = months)
  n8.NO3.N
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.pp))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=NO3.N.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=NO3.N.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("NO3.N (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$NO3.N.ob/max(plot1$NO3.N.ob))
  ggplot(plot1, aes(x=NO3.N.ob))+
    geom_point(aes(y=NO3.N.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=NO3.N.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=NO3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=NO3.N.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("NO3.N (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
  #===========
  #Cl
  {  
    head(ti)
    px = ti
    px = as.data.frame(px)
    mset = px
    head(mset)
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
  }
  #Untuned(모델 생성)
  # Cl.svmRadial.default = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial')
  # Cl.svmRadial.default
  # saveRDS(Cl.svmRadial.default, "안성8.Cl.svmRadial.default.rds")
  Cl.svmRadial.default = readRDS("안성8.Cl.svmRadial.default.rds")
  Cl.svmRadial.default
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # Cl.svmRadial.tuned = train(Cl.ob ~ Cl.pp, data = train, method = 'svmRadial', trControl = fitControl,preProcess = c("center","scale"),
  # tuneGrid = expand.grid(sigma = c(0.8456:5), C = c(0.1,0.25,0.5,0.75,1)))
  # Cl.svmRadial.tuned
  # saveRDS(Cl.svmRadial.tuned, "안성8.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned = readRDS("안성8.Cl.svmRadial.tuned.rds")
  Cl.svmRadial.tuned
  {  
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, test[24])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.default, mset[24])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, test[24])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, mset[24])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #안성8(안성8 시계열열 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, n8[12])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(n8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset)
  summary(lm1)
  #Plotting
  #2 Versions -> default + tuned + ob / pp + calibrated + ob
  plot1 = cbind(mset$Date, Cl.default.mset, Cl.tuned.mset,ti$Cl.pp)
  plot1 = as.data.frame(plot1)
  {names(plot1)[1] <- c("Date")
    names(plot1)[2] <- c("Cl.ob")
    names(plot1)[3] <- c("Cl.default.mset")
    names(plot1)[5] <- c("Cl.tuned.mset")
    names(plot1)[6] <- c("Cl.pp")
  }
  head(plot1)
  Cl  = ggplot() + 
    geom_point(data = plot1, aes(x = Date, y = Cl.default.mset), color = "dodgerblue4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.default.mset, group=1), color = "dodgerblue4", linewidth = 1) +
    geom_point(data = plot1, aes(x = Date, y = Cl.tuned.mset), color = "springgreen4", size = 3.2) +
    # geom_line(data = plot1, aes(x = Date, y = Cl.tuned.mset, group=1), color = "springgreen4", linewidth = 1) +
    geom_point(data = ti, aes(x = Date, y = Cl.ob), color = "red", size = 3.2) +
    geom_point(data = ti, aes(x = Date, y = Cl.pp), color = "black", size = 3.2) +
    # geom_line(data = ti, aes(x = Date, y = Cl.ob, group=1), color = "red", size = 1) +
    xlab('Month') +
    ylab('Cl') +
    #  ylim(0,20)+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) + ggtitle('Cl')
  Cl
  n8.Cl = ggplot() +
    geom_line(data = n8, aes(x = Date, y = Cl.pp), color = "dodgerblue4", size = 2) +
    geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
    geom_point(data = e8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Month') +
    ylab('Cl')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Cl (안성8)") #+ylim(2.5,4)
  #  scale_x_continuous(breaks = months)
  n4.Cl
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.pp))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    geom_point(aes(y=Cl.ob), size = 3, col = "red2") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(aes(y=Cl.ob),method = "lm", se = F, col = "red2", size =2) +
    scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Observed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      axis.title.y.right=element_text(color="red2"),
      axis.text.y.right=element_text(color="red2")
    )+
    ggtitle("Cl (안성8)") + 
    labs(x='Pre-processed', y='')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  scaleFactor = max(plot1$Cl.ob/max(plot1$Cl.ob))
  ggplot(plot1, aes(x=Cl.ob))+
    geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
    # geom_point(aes(y=Cl.pp), size = 3, col = "dodgerblue4") +
    geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    # geom_smooth(aes(y=Cl.pp),method = "lm", se = F, col = "dodgerblue4", size =2) +
    # scale_y_continuous(name = "Predicted", sec.axis = sec_axis(~., name="Pre-processed"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25))+
    theme(
      axis.title.y.left=element_text(color="springgreen4"),
      axis.text.y.left=element_text(color="springgreen4"),
      # axis.title.y.right=element_text(color="dodgerblue4"),
      # axis.text.y.right=element_text(color="dodgerblue4")
    )+
    ggtitle("Cl (안성8)") + 
    labs(x='Observed', y='Predicted')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none") #+ xlim(1.5,3.1) + ylim(1.5,3.1)
}
#===============================================================================
#품질관리vs보정 -> RMSE 개선 정도 정량 비교
{
  gs <- read_excel("안성 통합(ob,pp,ca)outlier제거,거리계산용.xlsx")
  
  rmse <- function(actual, predicted) {
    sqrt(mean((actual - predicted)^2))
  }
  
  #Cl
  rmse_original <- rmse(gs$Cl.ob, gs$Cl.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$Cl.ob, gs$Cl.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #Depth
  rmse_original <- rmse(gs$Depth.ob, gs$Depth.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$Depth.ob, gs$Depth.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #EC
  rmse_original <- rmse(gs$EC.ob, gs$EC.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$EC.ob, gs$EC.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #NH3-N
  rmse_original <- rmse(gs$NH3.N.ob, gs$NH3.N.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$NH3.N.ob, gs$NH3.N.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #NO3-N
  gs$NO3.N.ob = as.numeric(gs$NO3.N.ob)
  gsna = na.omit(gs)
  rmse_original <- rmse(gsna$NO3.N.ob, gsna$NO3.N.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gsna$NO3.N.ob, gsna$NO3.N.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #ORP
  rmse_original <- rmse(gs$ORP.ob, gs$ORP.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$ORP.ob, gs$ORP.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #pH
  rmse_original <- rmse(gs$pH.ob, gs$pH.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$pH.ob, gs$pH.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #Salinity
  rmse_original <- rmse(gs$Salinity.ob, gs$Salinity.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$Salinity.ob, gs$Salinity.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #TDS
  rmse_original <- rmse(gs$TDS.ob, gs$TDS.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$TDS.ob, gs$TDS.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
  
  #Turbidity
  rmse_original <- rmse(gs$Turbidity.ob, gs$Turbidity.pp) # 원래 값의 RMSE
  rmse_predicted <- rmse(gs$Turbidity.ob, gs$Turbidity.ca) # 예측 값의 RMSE
  cat("원래 값의 RMSE:", rmse_original, "\n") # 원래 값의 RMSE 출력
  cat("예측 값의 RMSE:", rmse_predicted, "\n") # 예측 값의 RMSE 출력
  if (rmse_original > rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 작으므로 성능이 좋습니다.\n")
  } else if (rmse_original < rmse_predicted) {
    cat("예측 값이 원래 값보다 RMSE가 크므로 성능이 나쁩니다.\n")
  } else {
    cat("예측 값과 원래 값의 RMSE가 같으므로 성능이 동일합니다.\n")
  }
}
#===============================================================================
#비로소 이제 데이터 만들기!
{
  n3 <- read_excel("품질관리(최종) 안성3.xlsx")
  n4 <- read_excel("품질관리(최종) 안성4.xlsx")
  n5 <- read_excel("품질관리(최종) 안성5.xlsx")
  n6 <- read_excel("품질관리(최종) 안성6.xlsx")
  n8 <- read_excel("품질관리(최종) 안성8.xlsx")
  
  n3$Date = as.Date(n3$Date)
  n4$Date = as.Date(n4$Date)
  n5$Date = as.Date(n5$Date)
  n6$Date = as.Date(n6$Date)
  n8$Date = as.Date(n8$Date)
  
  str(n3)
  str(n4)
  str(n5)
  str(n6)
  str(n8)
  
  head(n3)
  head(n4)
  head(n5)
  head(n6)
  head(n8)
  
  #여기에 수분석 데이터 불러오기
  x3 = read.csv("안성 수분석 관정3.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x4 = read.csv("안성 수분석 관정4.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x5 = read.csv("안성 수분석 관정5.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x6 = read.csv("안성 수분석 관정6.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  x8 = read.csv("안성 수분석 관정8.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
}
#관정별 인자 보정 모델
{
  Depth.3 = readRDS("안성3.Depth.svmRadial.tuned.rds")
  Depth.4 = readRDS("안성4.Depth.svmRadial.tuned.rds")
  Depth.5 = readRDS("안성5.Depth.svmRadial.tuned.rds")
  Depth.6 = readRDS("안성6.Depth.svmRadial.tuned.rds")
  Depth.8 = readRDS("안성8.Depth.svmRadial.tuned.rds")
  
  pH.3 = readRDS("안성3.pH.svmRadial.tuned.rds")
  pH.4 = readRDS("안성4.pH.svmRadial.tuned.rds")
  pH.5 = readRDS("안성5.pH.svmRadial.tuned.rds")
  pH.6 = readRDS("안성6.pH.svmRadial.tuned.rds")
  pH.8 = readRDS("안성8.pH.svmRadial.tuned.rds")
  
  ORP.3 = readRDS("안성3.ORP.svmRadial.tuned.rds")
  ORP.4 = readRDS("안성4.ORP.svmRadial.tuned.rds")
  ORP.5 = readRDS("안성5.ORP.svmRadial.tuned.rds")
  ORP.6 = readRDS("안성6.ORP.svmRadial.tuned.rds")
  ORP.8 = readRDS("안성8.ORP.svmRadial.tuned.rds")
  
  EC.3 = readRDS("안성3.EC.svmRadial.tuned.rds")
  EC.4 = readRDS("안성4.EC.svmRadial.tuned.rds")
  EC.5 = readRDS("안성5.EC.svmRadial.tuned.rds")
  EC.6 = readRDS("안성6.EC.svmRadial.tuned.rds")
  EC.8 = readRDS("안성8.EC.svmRadial.tuned.rds")
  
  Turbidity.3 = readRDS("안성3.Turbidity.svmRadial.tuned.rds")
  Turbidity.4 = readRDS("안성4.Turbidity.svmRadial.tuned.rds")
  Turbidity.5 = readRDS("안성5.Turbidity.svmRadial.tuned.rds")
  Turbidity.6 = readRDS("안성6.Turbidity.svmRadial.tuned.rds")
  Turbidity.8 = readRDS("안성8.Turbidity.svmRadial.tuned.rds")
  
  TDS.3 = readRDS("안성3.TDS.svmRadial.tuned.rds")
  TDS.4 = readRDS("안성4.TDS.svmRadial.tuned.rds")
  TDS.5 = readRDS("안성5.TDS.svmRadial.tuned.rds")
  TDS.6 = readRDS("안성6.TDS.svmRadial.tuned.rds")
  TDS.8 = readRDS("안성8.TDS.svmRadial.tuned.rds")
  
  Salinity.3 = readRDS("안성3.Salinity.svmRadial.tuned.rds")
  Salinity.4 = readRDS("안성4.Salinity.svmRadial.tuned.rds")
  Salinity.5 = readRDS("안성5.Salinity.svmRadial.tuned.rds")
  Salinity.6 = readRDS("안성6.Salinity.svmRadial.tuned.rds")
  Salinity.8 = readRDS("안성8.Salinity.svmRadial.tuned.rds")
  
  NH3.N.3 = readRDS("안성3.NH3.N.svmRadial.tuned.rds")
  NH3.N.4 = readRDS("안성4.NH3.N.svmRadial.tuned.rds")
  NH3.N.5 = readRDS("안성5.NH3.N.svmRadial.tuned.rds")
  NH3.N.6 = readRDS("안성6.NH3.N.svmRadial.tuned.rds")
  NH3.N.8 = readRDS("안성8.NH3.N.svmRadial.tuned.rds")
  
  NO3.N.3 = readRDS("안성3.NO3.N.svmRadial.tuned.rds")
  NO3.N.4 = readRDS("안성4.NO3.N.svmRadial.tuned.rds")
  NO3.N.5 = readRDS("안성5.NO3.N.svmRadial.tuned.rds")
  NO3.N.6 = readRDS("안성6.NO3.N.svmRadial.tuned.rds")
  NO3.N.8 = readRDS("안성8.NO3.N.svmRadial.tuned.rds")
  
  Cl.3 = readRDS("안성3.Cl.svmRadial.tuned.rds")
  Cl.4 = readRDS("안성4.Cl.svmRadial.tuned.rds")
  Cl.5 = readRDS("안성5.Cl.svmRadial.tuned.rds")
  Cl.6 = readRDS("안성6.Cl.svmRadial.tuned.rds")
  Cl.8 = readRDS("안성8.Cl.svmRadial.tuned.rds")
}
#관정별 인자 보정 데이터 생성
#관정3
{
  #Depth
  pv=predict(Depth.3, n3[2])
  ca.3.Depth =as.data.frame(pv)
  head(ca.3.Depth)
  names(ca.3.Depth)[1] <- c("Depth.ca")
  head(ca.3.Depth)
  
  #pH
  pv=predict(pH.3, n3[4])
  ca.3.pH =as.data.frame(pv)
  head(ca.3.pH)
  names(ca.3.pH)[1] <- c("pH.ca")
  head(ca.3.pH)
  
  #ORP
  pv=predict(ORP.3, n3[5])
  ca.3.ORP =as.data.frame(pv)
  head(ca.3.ORP)
  names(ca.3.ORP)[1] <- c("ORP.ca")
  head(ca.3.ORP)
  
  #EC
  pv=predict(EC.3, n3[6])
  ca.3.EC =as.data.frame(pv)
  head(ca.3.EC)
  names(ca.3.EC)[1] <- c("EC.ca")
  head(ca.3.EC)
  
  #Turbidity
  pv=predict(Turbidity.3, n3[7])
  ca.3.Turbidity =as.data.frame(pv)
  head(ca.3.Turbidity)
  names(ca.3.Turbidity)[1] <- c("Turbidity.ca")
  head(ca.3.Turbidity)
  
  #TDS
  pv=predict(TDS.3, n3[8])
  ca.3.TDS =as.data.frame(pv)
  head(ca.3.TDS)
  names(ca.3.TDS)[1] <- c("TDS.ca")
  head(ca.3.TDS)
  
  #Salinity
  pv=predict(Salinity.3, n3[9])
  ca.3.Salinity =as.data.frame(pv)
  head(ca.3.Salinity)
  names(ca.3.Salinity)[1] <- c("Salinity.ca")
  head(ca.3.Salinity)
  
  #NH3.N
  pv=predict(NH3.N.3, n3[10])
  ca.3.NH3.N =as.data.frame(pv)
  head(ca.3.NH3.N)
  names(ca.3.NH3.N)[1] <- c("NH3.N.ca")
  head(ca.3.NH3.N)
  
  #NO3.N
  pv=predict(NO3.N.3, n3[11])
  ca.3.NO3.N =as.data.frame(pv)
  head(ca.3.NO3.N)
  names(ca.3.NO3.N)[1] <- c("NO3.N.ca")
  head(ca.3.NO3.N)
  
  #Cl
  pv=predict(Cl.3, n3[12])
  ca.3.Cl =as.data.frame(pv)
  head(ca.3.Cl)
  names(ca.3.Cl)[1] <- c("Cl.ca")
  head(ca.3.Cl)
  
  #Total
  ca.well3 = cbind(n3$Date,ca.3.Depth,n3$Temperature.pp,ca.3.pH,ca.3.ORP,ca.3.EC,ca.3.Turbidity,ca.3.TDS,ca.3.Salinity,ca.3.NH3.N,ca.3.NO3.N,ca.3.Cl)
  head(ca.well3)
  names(ca.well3)[1] <- c("Date")
  names(ca.well3)[3] <- c("Temperature.ca")
  head(ca.well3)
}
#관정4
{  
  #Depth
  pv=predict(Depth.4, n4[2])
  ca.4.Depth =as.data.frame(pv)
  head(ca.4.Depth)
  names(ca.4.Depth)[1] <- c("Depth.ca")
  head(ca.4.Depth)
  
  #pH
  pv=predict(pH.4, n4[4])
  ca.4.pH =as.data.frame(pv)
  head(ca.4.pH)
  names(ca.4.pH)[1] <- c("pH.ca")
  head(ca.4.pH)
  
  #ORP
  pv=predict(ORP.4, n4[5])
  ca.4.ORP =as.data.frame(pv)
  head(ca.4.ORP)
  names(ca.4.ORP)[1] <- c("ORP.ca")
  head(ca.4.ORP)
  
  #EC
  pv=predict(EC.4, n4[6])
  ca.4.EC =as.data.frame(pv)
  head(ca.4.EC)
  names(ca.4.EC)[1] <- c("EC.ca")
  head(ca.4.EC)
  
  #Turbidity
  pv=predict(Turbidity.4, n4[7])
  ca.4.Turbidity =as.data.frame(pv)
  head(ca.4.Turbidity)
  names(ca.4.Turbidity)[1] <- c("Turbidity.ca")
  head(ca.4.Turbidity)
  
  #TDS
  pv=predict(TDS.4, n4[8])
  ca.4.TDS =as.data.frame(pv)
  head(ca.4.TDS)
  names(ca.4.TDS)[1] <- c("TDS.ca")
  head(ca.4.TDS)
  
  #Salinity
  pv=predict(Salinity.4, n4[9])
  ca.4.Salinity =as.data.frame(pv)
  head(ca.4.Salinity)
  names(ca.4.Salinity)[1] <- c("Salinity.ca")
  head(ca.4.Salinity)
  
  #NH3.N
  pv=predict(NH3.N.4, n4[10])
  ca.4.NH3.N =as.data.frame(pv)
  head(ca.4.NH3.N)
  names(ca.4.NH3.N)[1] <- c("NH3.N.ca")
  head(ca.4.NH3.N)
  
  #NO3.N
  pv=predict(NO3.N.4, n4[11])
  ca.4.NO3.N =as.data.frame(pv)
  head(ca.4.NO3.N)
  names(ca.4.NO3.N)[1] <- c("NO3.N.ca")
  head(ca.4.NO3.N)
  
  #Cl
  pv=predict(Cl.4, n4[12])
  ca.4.Cl =as.data.frame(pv)
  head(ca.4.Cl)
  names(ca.4.Cl)[1] <- c("Cl.ca")
  head(ca.4.Cl)
  
  #Total
  ca.well4 = cbind(n4$Date,ca.4.Depth,n4$Temperature.pp,ca.4.pH,ca.4.ORP,ca.4.EC,ca.4.Turbidity,ca.4.TDS,ca.4.Salinity,ca.4.NH3.N,ca.4.NO3.N,ca.4.Cl)
  head(ca.well4)
  names(ca.well4)[1] <- c("Date")
  names(ca.well4)[3] <- c("Temperature.ca")
  head(ca.well4)
}
#관정5
{  
  #Depth
  pv=predict(Depth.5, n5[2])
  ca.5.Depth =as.data.frame(pv)
  head(ca.5.Depth)
  names(ca.5.Depth)[1] <- c("Depth.ca")
  head(ca.5.Depth)
  
  #pH
  pv=predict(pH.5, n5[4])
  ca.5.pH =as.data.frame(pv)
  head(ca.5.pH)
  names(ca.5.pH)[1] <- c("pH.ca")
  head(ca.5.pH)
  
  #ORP
  pv=predict(ORP.5, n5[5])
  ca.5.ORP =as.data.frame(pv)
  head(ca.5.ORP)
  names(ca.5.ORP)[1] <- c("ORP.ca")
  head(ca.5.ORP)
  
  #EC
  pv=predict(EC.5, n5[6])
  ca.5.EC =as.data.frame(pv)
  head(ca.5.EC)
  names(ca.5.EC)[1] <- c("EC.ca")
  head(ca.5.EC)
  
  #Turbidity
  pv=predict(Turbidity.5, n5[7])
  ca.5.Turbidity =as.data.frame(pv)
  head(ca.5.Turbidity)
  names(ca.5.Turbidity)[1] <- c("Turbidity.ca")
  head(ca.5.Turbidity)
  
  #TDS
  pv=predict(TDS.5, n5[8])
  ca.5.TDS =as.data.frame(pv)
  head(ca.5.TDS)
  names(ca.5.TDS)[1] <- c("TDS.ca")
  head(ca.5.TDS)
  
  #Salinity
  pv=predict(Salinity.5, n5[9])
  ca.5.Salinity =as.data.frame(pv)
  head(ca.5.Salinity)
  names(ca.5.Salinity)[1] <- c("Salinity.ca")
  head(ca.5.Salinity)
  
  #NH3.N
  pv=predict(NH3.N.5, n5[10])
  ca.5.NH3.N =as.data.frame(pv)
  head(ca.5.NH3.N)
  names(ca.5.NH3.N)[1] <- c("NH3.N.ca")
  head(ca.5.NH3.N)
  
  #NO3.N
  pv=predict(NO3.N.5, n5[11])
  ca.5.NO3.N =as.data.frame(pv)
  head(ca.5.NO3.N)
  names(ca.5.NO3.N)[1] <- c("NO3.N.ca")
  head(ca.5.NO3.N)
  
  #Cl
  pv=predict(Cl.5, n5[12])
  ca.5.Cl =as.data.frame(pv)
  head(ca.5.Cl)
  names(ca.5.Cl)[1] <- c("Cl.ca")
  head(ca.5.Cl)
  
  #Total
  ca.well5 = cbind(n5$Date,ca.5.Depth,n5$Temperature.pp,ca.5.pH,ca.5.ORP,ca.5.EC,ca.5.Turbidity,ca.5.TDS,ca.5.Salinity,ca.5.NH3.N,ca.5.NO3.N,ca.5.Cl)
  head(ca.well5)
  names(ca.well5)[1] <- c("Date")
  names(ca.well5)[3] <- c("Temperature.ca")
  head(ca.well5)
}
#관정6
{ 
  #Depth
  pv=predict(Depth.6, n6[2])
  ca.6.Depth =as.data.frame(pv)
  head(ca.6.Depth)
  names(ca.6.Depth)[1] <- c("Depth.ca")
  head(ca.6.Depth)
  
  #pH
  pv=predict(pH.6, n6[4])
  ca.6.pH =as.data.frame(pv)
  head(ca.6.pH)
  names(ca.6.pH)[1] <- c("pH.ca")
  head(ca.6.pH)
  
  #ORP
  pv=predict(ORP.6, n6[5])
  ca.6.ORP =as.data.frame(pv)
  head(ca.6.ORP)
  names(ca.6.ORP)[1] <- c("ORP.ca")
  head(ca.6.ORP)
  
  #EC
  pv=predict(EC.6, n6[6])
  ca.6.EC =as.data.frame(pv)
  head(ca.6.EC)
  names(ca.6.EC)[1] <- c("EC.ca")
  head(ca.6.EC)
  
  #Turbidity
  pv=predict(Turbidity.6, n6[7])
  ca.6.Turbidity =as.data.frame(pv)
  head(ca.6.Turbidity)
  names(ca.6.Turbidity)[1] <- c("Turbidity.ca")
  head(ca.6.Turbidity)
  
  #TDS
  pv=predict(TDS.6, n6[8])
  ca.6.TDS =as.data.frame(pv)
  head(ca.6.TDS)
  names(ca.6.TDS)[1] <- c("TDS.ca")
  head(ca.6.TDS)
  
  #Salinity
  pv=predict(Salinity.6, n6[9])
  ca.6.Salinity =as.data.frame(pv)
  head(ca.6.Salinity)
  names(ca.6.Salinity)[1] <- c("Salinity.ca")
  head(ca.6.Salinity)
  
  #NH3.N
  pv=predict(NH3.N.6, n6[10])
  ca.6.NH3.N =as.data.frame(pv)
  head(ca.6.NH3.N)
  names(ca.6.NH3.N)[1] <- c("NH3.N.ca")
  head(ca.6.NH3.N)
  
  #NO3.N
  pv=predict(NO3.N.6, n6[11])
  ca.6.NO3.N =as.data.frame(pv)
  head(ca.6.NO3.N)
  names(ca.6.NO3.N)[1] <- c("NO3.N.ca")
  head(ca.6.NO3.N)
  
  #Cl
  pv=predict(Cl.6, n6[12])
  ca.6.Cl =as.data.frame(pv)
  head(ca.6.Cl)
  names(ca.6.Cl)[1] <- c("Cl.ca")
  head(ca.6.Cl)
  
  #Total
  ca.well6 = cbind(n6$Date,ca.6.Depth,n6$Temperature.pp,ca.6.pH,ca.6.ORP,ca.6.EC,ca.6.Turbidity,ca.6.TDS,ca.6.Salinity,ca.6.NH3.N,ca.6.NO3.N,ca.6.Cl)
  head(ca.well6)
  names(ca.well6)[1] <- c("Date")
  names(ca.well6)[3] <- c("Temperature.ca")
  head(ca.well6)
}
#관정8
{  
  #Depth
  pv=predict(Depth.8, n8[2])
  ca.8.Depth =as.data.frame(pv)
  head(ca.8.Depth)
  names(ca.8.Depth)[1] <- c("Depth.ca")
  head(ca.8.Depth)
  
  #pH
  pv=predict(pH.8, n8[4])
  ca.8.pH =as.data.frame(pv)
  head(ca.8.pH)
  names(ca.8.pH)[1] <- c("pH.ca")
  head(ca.8.pH)
  
  #ORP
  pv=predict(ORP.8, n8[5])
  ca.8.ORP =as.data.frame(pv)
  head(ca.8.ORP)
  names(ca.8.ORP)[1] <- c("ORP.ca")
  head(ca.8.ORP)
  
  #EC
  pv=predict(EC.8, n8[6])
  ca.8.EC =as.data.frame(pv)
  head(ca.8.EC)
  names(ca.8.EC)[1] <- c("EC.ca")
  head(ca.8.EC)
  
  #Turbidity
  pv=predict(Turbidity.8, n8[7])
  ca.8.Turbidity =as.data.frame(pv)
  head(ca.8.Turbidity)
  names(ca.8.Turbidity)[1] <- c("Turbidity.ca")
  head(ca.8.Turbidity)
  
  #TDS
  pv=predict(TDS.8, n8[8])
  ca.8.TDS =as.data.frame(pv)
  head(ca.8.TDS)
  names(ca.8.TDS)[1] <- c("TDS.ca")
  head(ca.8.TDS)
  
  #Salinity
  pv=predict(Salinity.8, n8[9])
  ca.8.Salinity =as.data.frame(pv)
  head(ca.8.Salinity)
  names(ca.8.Salinity)[1] <- c("Salinity.ca")
  head(ca.8.Salinity)
  
  #NH3.N
  pv=predict(NH3.N.8, n8[10])
  ca.8.NH3.N =as.data.frame(pv)
  head(ca.8.NH3.N)
  names(ca.8.NH3.N)[1] <- c("NH3.N.ca")
  head(ca.8.NH3.N)
  
  #NO3.N
  pv=predict(NO3.N.8, n8[11])
  ca.8.NO3.N =as.data.frame(pv)
  head(ca.8.NO3.N)
  names(ca.8.NO3.N)[1] <- c("NO3.N.ca")
  head(ca.8.NO3.N)
  
  #Cl
  pv=predict(Cl.8, n8[12])
  ca.8.Cl =as.data.frame(pv)
  head(ca.8.Cl)
  names(ca.8.Cl)[1] <- c("Cl.ca")
  head(ca.8.Cl)
  
  #Total
  ca.well8 = cbind(n8$Date,ca.8.Depth,n8$Temperature.pp,ca.8.pH,ca.8.ORP,ca.8.EC,ca.8.Turbidity,ca.8.TDS,ca.8.Salinity,ca.8.NH3.N,ca.8.NO3.N,ca.8.Cl)
  head(ca.well8)
  names(ca.well8)[1] <- c("Date")
  names(ca.well8)[3] <- c("Temperature.ca")
  head(ca.well8)
}
head(ca.well3)
head(ca.well4)
head(ca.well5)
head(ca.well6)
head(ca.well8)

# write.xlsx(ca.well3, '보정 안성3.xlsx')
# write.xlsx(ca.well4, '보정 안성4.xlsx')
# write.xlsx(ca.well5, '보정 안성5.xlsx')
# write.xlsx(ca.well6, '보정 안성6.xlsx')
# write.xlsx(ca.well8, '보정 안성8.xlsx')
#===============================================================================
#===============================================================================
#Data 
{
  x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
  x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
  x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
  x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
  x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
  x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  x34568$Date = as.Date(x34568$Date)
  
  x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
  x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
  # x3$TPH.ob = as.numeric(x3$TPH.ob)
  x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
  x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
  
  x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
  x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
  # x4$TPH.ob = as.numeric(x4$TPH.ob)
  x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
  x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
  
  x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
  x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
  # x5$TPH.ob = as.numeric(x5$TPH.ob)
  x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
  x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
  
  x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
  x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
  # x6$TPH.ob = as.numeric(x6$TPH.ob)
  x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
  x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
  
  x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
  x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
  # x8$TPH.ob = as.numeric(x8$TPH.ob)
  x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
  x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
  
  x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
  x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
  # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
  x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
  x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
  head(x34568)
  
  ca3 <- read_excel("보정 안성3.xlsx")
  ca4 <- read_excel("보정 안성4.xlsx")
  ca5 <- read_excel("보정 안성5.xlsx")
  ca6 <- read_excel("보정 안성6.xlsx")
  ca8 <- read_excel("보정 안성8.xlsx")
  
  ca3$Date = as.Date(ca3$Date)
  ca4$Date = as.Date(ca4$Date)
  ca5$Date = as.Date(ca5$Date)
  ca6$Date = as.Date(ca6$Date)
  ca8$Date = as.Date(ca8$Date)
  str(ca3)
  
  n3 <- read_excel("품질관리(최종) 안성3.xlsx")
  n4 <- read_excel("품질관리(최종) 안성4.xlsx")
  n5 <- read_excel("품질관리(최종) 안성5.xlsx")
  n6 <- read_excel("품질관리(최종) 안성6.xlsx")
  n8 <- read_excel("품질관리(최종) 안성8.xlsx")
  
  n3$Date = as.Date(n3$Date)
  n4$Date = as.Date(n4$Date)
  n5$Date = as.Date(n5$Date)
  n6$Date = as.Date(n6$Date)
  n8$Date = as.Date(n8$Date)
  
  str(n3)
  str(n4)
  str(n5)
  str(n6)
  str(n8)
  
  head(n3)
  head(n4)
  head(n5)
  head(n6)
  head(n8)
}
#===============================================================================
#Raw, Pre-processed, Calibration Figure
{
  as4 <- read_excel("센서데이터_안성_4번.xlsx")
  head(as4)
  as.f = as4[c(25155:199535),]
  as.f$timestamp = as.Date(as.f$timestamp)
  
  #Cl
  p.Cl = ggplot() + 
    geom_line(data = n4, aes(x = Date, y = Cl.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = Cl), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = Cl.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab(expression(Cl^'-'~(mg/L)))+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") 
  p.Cl
  
  #Depth
  p.Depth = ggplot() + 
    geom_line(data = n4, aes(x = Date, y = Depth.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = Depth), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = Depth.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = Depth.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Depth (m)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("")
  p.Depth
  
  # #DO
  # p.DO = ggplot() + 
  #   geom_line(data = as.f, aes(x = timestamp, y = rdo), color = "black", size = 1, alpha=0.7) +
  #   geom_line(data = n4, aes(x = Date, y = DO.pp), color = "dodgerblue2", size = 2) +
  #   geom_line(data = ca4, aes(x = Date, y = DO.ca), color = "springgreen4", size = 2) +
  #   geom_point(data = x4, aes(x = Date, y = DO.ob), color = "red2", size = 3) +
  #   xlab('Date') +
  #   ylab('DO (mg/L)')+
  #   #ylim(0,0.3)+ 
  #   theme(legend.text = element_text(size = 22))+
  #   theme(panel.background = element_rect(fill="white", color = "black"),
  #         axis.title.x = element_text(size=20),
  #         axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
  #         axis.title.y = element_text(size=25),
  #         plot.title = element_text(size = 30),
  #         legend.text = element_text(size = 25),
  #         legend.title = element_text(size = 28)) +
  #   ggtitle("")
  # p.DO
  
  #EC
  p.EC = ggplot() + 
    geom_line(data = n4, aes(x = Date, y = EC.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = EC), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = EC.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = EC.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('EC (μS/cm)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("")
  p.EC
  
  #NH3-N
  p.NH3.N = ggplot() +
    geom_line(data = n4, aes(x = Date, y = NH3.N.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = NH3.N), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = NH3.N.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab(expression(NH[3]-N~(mg/L)))+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") #+ ylim(0,30)
  p.NH3.N
  
  #NO3-N
  p.NO3.N = ggplot() +
    geom_line(data = n4, aes(x = Date, y = NO3.N.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = NO3.N), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = NO3.N.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab(expression(NO[3]-N~(mg/L)))+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") + ylim(0,100)
  p.NO3.N
  
  #ORP
  p.ORP = ggplot() + 
    geom_line(data = n4, aes(x = Date, y = ORP.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = ORP), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = ORP.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('ORP (mV)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") 
  p.ORP
  
  p.pH = ggplot() +
    geom_line(data = n4, aes(x = Date, y = pH.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = pH), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = pH.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = pH.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab(expression(pH))+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("")# + ylim(0,30)
  p.pH
  
  p.Salinity = ggplot() + 
    geom_line(data = n4, aes(x = Date, y = Salinity.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = Salinity), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = Salinity.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = Salinity.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Salinity')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("")
  p.Salinity
  
  p.TDS = ggplot() + 
    geom_line(data = n4, aes(x = Date, y = TDS.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = TDS), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = TDS.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = TDS.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('TDS (ppt)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") #+ ylim(0,1000)
  p.TDS
  
  p.Temp = ggplot() + 
    geom_line(data = n4, aes(x = Date, y = Temperature.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = Temp.), color = "black", size = 1, alpha=0.7) +
    # geom_line(data = ca4, aes(x = Date, y = Temperature.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = Temperature.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Temperature (°C)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") 
  p.Temp
  
  p.Turbidity = ggplot() + 
    geom_line(data = n4, aes(x = Date, y = Turbidity.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = Turbidity), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = Turbidity.ca), color = "springgreen4", size = 2) +
    geom_point(data = x4, aes(x = Date, y = Turbidity.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Turbidity (NTU)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") 
  p.Turbidity
  
  {
    p.Salinity = ggplot() + 
      geom_line(data = as.f, aes(x = timestamp, y = Salinity), color = "black", size = 1, alpha=0.7) +
      geom_line(data = n4, aes(x = Date, y = Salinity.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = ca4, aes(x = Date, y = Salinity.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = Salinity.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab('Salinity')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("")
    p.Salinity
    
    p.ORP = ggplot() + 
      geom_line(data = n4, aes(x = Date, y = ORP.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = ca4, aes(x = Date, y = ORP.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab('ORP (mV)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") 
    p.ORP
    
    p.Cl = ggplot() + 
      geom_line(data = n4, aes(x = Date, y = Cl.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = Cl), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = Cl.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab(expression(Cl^'-'~(mg/L)))+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") 
    p.Cl
    
    p.Turbidity = ggplot() + 
      geom_line(data = n4, aes(x = Date, y = Turbidity.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = ca4, aes(x = Date, y = Turbidity.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = Turbidity.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab('Turbidity (NTU)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") 
    p.Turbidity
    
    p.TDS = ggplot() + 
      geom_line(data = n4, aes(x = Date, y = TDS.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = NO3.N), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = TDS.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = TDS.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab('TDS (ppt)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") #+ ylim(0,1000)
    p.TDS
    
    p.NO3.N = ggplot() +
      geom_line(data = n4, aes(x = Date, y = NO3.N.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = NO3.N), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = NO3.N.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab(expression(NO[3]-N~(mg/L)))+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") #+ ylim(0,100)
    p.NO3.N
    
    p.pH = ggplot() +
      geom_line(data = n4, aes(x = Date, y = pH.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = pH), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = pH.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = pH.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab(expression(pH))+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("")# + ylim(0,30)
    p.pH
    
    p.NH3.N = ggplot() +
      geom_line(data = n4, aes(x = Date, y = NH3.N.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = NH3.N), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = NH3.N.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab(expression(NH[3]-N~(mg/L)))+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") #+ ylim(0,30)
    p.NH3.N
    
    p.NO3.N = ggplot() +
      geom_line(data = n4, aes(x = Date, y = NO3.N.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = NO3.N), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = NO3.N.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab("")+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") + ylim(0,100)
    p.NO3.N
    
    p.NO3.N = ggplot() +
      geom_line(data = n4, aes(x = Date, y = NO3.N.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = NO3.N), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = NO3.N.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = NO3.N.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab("")+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") + ylim(0,30)
    p.NO3.N
    
    p.ORP = ggplot() +
      geom_line(data = n4, aes(x = Date, y = ORP.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = ORP), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = ORP.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab("ORP (mV)")+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("")# + ylim(0,30)
    p.ORP
    
    p.ORP = ggplot() +
      geom_line(data = n4, aes(x = Date, y = ORP.pp), color = "dodgerblue2", size = 2) +
      geom_line(data = as.f, aes(x = timestamp, y = ORP), color = "black", size = 1, alpha=0.7) +
      geom_line(data = ca4, aes(x = Date, y = ORP.ca), color = "springgreen4", size = 2) +
      geom_point(data = x4, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
      xlab('Date') +
      ylab("")+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("") + ylim(-100,0)
    p.ORP
  }
}
{
  as5 <- read_excel("센서데이터_안성_5번.xlsx")
  head(as5)
  as.f = as5[c(26061:106684),]
  as.f$timestamp = as.Date(as.f$timestamp)
  
  p.ORP = ggplot() + 
    # geom_line(data = n5, aes(x = Date, y = ORP.pp), color = "dodgerblue2", size = 2) +
    # geom_line(data = as.f, aes(x = timestamp, y = ORP), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca5, aes(x = Date, y = ORP.ca), color = "springgreen4", size = 2) +
    # geom_point(data = x5, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('ORP (mV)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") + ylim(-100,40)
  p.ORP
  
  p.ORP = ggplot() + 
    geom_line(data = n5, aes(x = Date, y = ORP.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = ORP), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca5, aes(x = Date, y = ORP.ca), color = "springgreen4", size = 2) +
    geom_point(data = x5, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") +ylim(-200,150)
  p.ORP
  
  p.ORP = ggplot() + 
    geom_line(data = n5, aes(x = Date, y = ORP.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = ORP), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca5, aes(x = Date, y = ORP.ca), color = "springgreen4", size = 2) +
    geom_point(data = x5, aes(x = Date, y = ORP.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") +ylim(-150,50)
  p.ORP
  #============
  p.Cl = ggplot() + 
    geom_line(data = n5, aes(x = Date, y = Cl.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = Cl), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca5, aes(x = Date, y = Cl.ca), color = "springgreen4", size = 2) +
    geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('Cl (mg/L)')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") 
  p.Cl
  
  p.Cl = ggplot() + 
    geom_line(data = n5, aes(x = Date, y = Cl.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = Cl), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca5, aes(x = Date, y = Cl.ca), color = "springgreen4", size = 2) +
    geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") +ylim(0,500)
  p.Cl
  
  p.Cl = ggplot() + 
    geom_line(data = n5, aes(x = Date, y = Cl.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = Cl), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca5, aes(x = Date, y = Cl.ca), color = "springgreen4", size = 2) +
    geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab('')+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("") +ylim(10,150)
  p.Cl
}
#===============================================================================
#관정 A 모델로 관정 B,C 예측했을때 -> variance test figure
{
  #Variance test 결과에서 untuned만 보이기 + facet을 사용해서 관정1, 관정 5 모두 보이기
  vari = read.csv("관정1,5 Variance.csv", na="-", fileEncoding = "CP949") #200
  head(vari)
  # automl.loop=automl.loop[,2:4] %>%  
  #   tidyr::separate(Model, c("Model","traintest"), sep="_", extra='drop')
  modelnames <- c("Boosted linear", "Randomforest", "SVM Radial", "Gaussian Radial")
  vari$Model <- factor(vari$Model, levels = c("Boosted linear", "Randomforest", "SVM Radial","Gaussian Radial"))
  
  vari.plot <- ggplot(data = vari, aes(x = Model, y = R2, fill = Model)) +
    geom_boxplot(outlier.colour = "black")+
    theme_bw() + #plot 영역에 박스, 배경제거
    theme(legend.position = c(""),
          strip.background =element_rect(fill="white"),
          strip.text = element_text(size = 22, face = "bold"),
          panel.grid.minor = element_blank(),
          panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
          plot.title = element_text(size = 28),
          axis.title.x = element_text(size=0),
          axis.text.x = element_text(size=22,angle=45,hjust = 1, face = "bold"),
          axis.title.y = element_text(size=22, face = "bold"),
          axis.text.y = element_text(size=22, face = "bold")) +
    ggtitle("Variance test (using Well A optimized model for prediction)") +
    ylab(expression(R^'2'))+
    scale_fill_manual(values = c("red3", "orange2", "dodgerblue3", "green4"))+
    facet_grid(~Well, scales = "free", space = "free", labeller = labeller(modelnames))
  
  # scale_fill_manual(values = c("red2", "red4", "orange", "orange3", "dodgerblue3", "dodgerblue4","green2", "green4"))
  vari.plot
}
#===============================================================================
#Multicollinearity test - NH3-N, Cl -> 다중공선성 검사는 독립변수들간의 상관분석을 통해 강한 상관관계가 있을시 제거를 통해 예측 성능을 높힘
#-> 따라서 예측 대상이 NH3-N 이나 Cl이나 어차피 결과는 같음. 독립변수끼리의 상관분석이기에
{
  head(x34568)
  target_column <- 12
  predictor_columns <- c(36,26,33,34,35,29,28,30,32,27,31)
  # 26:36
  
  # Extract the predictors and response variable
  predictors <- x34568[, predictor_columns]
  response <- x34568[, target_column]
  # predictors = factor(predictors, levels = c("Cl.ca","Depth.ca","EC.ca","NH3.N.ca","NO3.N.ca",
  # "ORP.ca","pH.ca","Salinity.ca","TDS.ca","Temperature.ca","Turbidity.ca"))
  # Calculate the correlation matrix for predictors
  cor_matrix <- cor(predictors,method="spearman")
  cor_matrix
  # write.csv(cor_matrix, "Multicollinearity test(1).csv")
  # library(corrplot)
  # corrplot(cor_matrix)
  # cor1 = predictors
  # corrplot.mixed(cor1, lower.col = "black", number.cex = .7)
  # corrplot(cor(predictors), method = "number", type = "upper", diag = FALSE)
  
  # Set a threshold for high correlation (e.g., 0.7, but you can adjust as needed)
  high_correlation_threshold <- 0.8
  
  # Find highly correlated predictors
  highly_correlated <- findCorrelation(cor_matrix, cutoff = high_correlation_threshold)
  
  # Display the highly correlated predictor pairs
  print(highly_correlated)
  
  # Remove highly correlated predictors from your dataset (if desired)
  predictors_cleaned <- predictors[,-highly_correlated]
  
  head(predictors_cleaned)
  # Now, you can use 'predictors_cleaned' for your SVM radial regression model
}
#그러면 여기서 2개의 pair가 나옴 NO3-N, NH3-N, Salinity, EC
#NH3-N과 EC를 남기자! 왜? 그래야 NH3-N ox, Cl ox 논리가 맞음
#근데 내가 이거 좀 잘 못 해석한거 같은데,,, 이거,,, 아무래도,, 여기서 선정되는 모든 수질인자를 삭제해야하는거같음, 그중에 2개만 하는게 아니라,,,

#그니까 EC를 남길게 아니라 Salinity를 남겼어야하는거 같음,, NO3-N가 제거되는건 맞는데
#Depth.ca / Temperature.ca / pH.ca / ORP.ca / EC.ca / Turbidity.ca / TDS.ca / NH3-N.ca / Cl.ca 가 남음, NO3-N, Salinity 제거됨 - 0.7 기준

#아니 근데 보면, 그냥, 얘가 알아서 지워주는거 같아, 0.8이상인거는 2번 즉 4개의 수질인자가 연관되어있는데, 그중에서, 임의로 잘라내는거같아
#그니까 Salinity를 없애고 EC를 살려도 될듯?

#===============================================================================
#===============================================================================
#NH3-N 예측전략 수립
#Importance- NH3-N (NH3-N o)
{
  ti = x34568[c(12,26:32,34,36)]
  head(ti)
  px = as.data.frame(ti)
  head(px)
  mset = px
  # {mset$NO3.N.ca[mset$NO3.N.ca %in% "NA"] <- NA
  #   mset$NH3.N.ca[mset$NH3.N.ca %in% "NA"] <- NA}
  # head(mset)
  # mset = mset[complete.cases(mset), ]
  head(mset)
  inTraining <- createDataPartition(mset$NH3.N.ob, p = .70, list = FALSE)
  train <- mset[ inTraining,]
  test  <- mset[-inTraining,]
  
  #importance
  fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 10)
  tunegrid <- expand.grid(.mtry=c(1:15))
  
  model.rf.NH3.N <- train(NH3.N.ob ~ ., data = train, method = 'rf', tuneGrid=tunegrid, trControl = fitControl,preProcess = c("center", "scale"),  ntry = 501)
  # model.rf.TPH <- train(NH3.N.ob ~ ., data = train, method = 'rf')
  model.rf.NH3.N
  
  # saveRDS(model.rf.NH3.N, "rf.NH3.N.total.importance(N포함).rds")
  model.rf.NH3.N = readRDS("rf.NH3.N.total.importance(N포함).rds")
  model.rf.NH3.N
  # importance(model.rf.TPH)
  # varImpPlot(model.rf.TPH)
  gbmImp <- varImp(model.rf.NH3.N, scale = FALSE)
  gbmImp
  gbmImp = as.data.frame(gbmImp$importance)
  plot(gbmImp)
  # write.csv(gbmImp, file = "NH3.N.imp.total(N포함).csv", na="-", fileEncoding = "CP949")
  
  imp.ad = read.csv("NH3.N.imp.total(N포함).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  head(imp.ad)
  ord.ad = as.vector(imp.ad$X)
  order(ord.ad)
  new_order7 <- with(imp.ad, reorder(X, Overall, median , na.rm=T))
  # TPH.model.RMSE.plot <- ggplot(data = big_data1.TPH, aes(x = RMSE, y = new_order1, fill = Model)) +
  imp.ad$X=factor(imp.ad$X, levels = rev(ord.ad))
  
  brk = ggplot(imp.ad, aes(x=Overall, y=X)) +
    geom_bar(stat = "identity", position = "dodge", color="black", width = 1) +
    #  geom_point(shape=16,size=1, color="blue")+
    theme_bw() +
    theme(panel.grid = element_blank(),
          axis.text.y = element_text(size=25),
          axis.text.x = element_text(size=20,angle = 0, vjust = 0.5, hjust =0.5),
          axis.title.y = element_text(size=25),
          axis.title.x = element_text(size=25),
          legend.position = c(0,3),
          legend.text = element_text(size = 25),
          legend.background = element_rect(fill="white", size = 0.5, linetype = "solid", colour = "black"))+
    # scale_x_break(c(60, 350), scales = 0.2)+ #여기서 scales는 양쪽 넓이 비율 지정, break는 잘라버릴 범위 지정
    labs(fill = "")+
    xlab("Importance")+ ylab(~paste("")) 
  brk
}

#Importance- NH3-N (NH3-N x)
{
  ti = x34568[c(12,26:32,36)]
  head(ti)
  px = as.data.frame(ti)
  head(px)
  mset = px
  # {mset$NO3.N.ca[mset$NO3.N.ca %in% "NA"] <- NA
  #   mset$NH3.N.ca[mset$NH3.N.ca %in% "NA"] <- NA}
  # head(mset)
  # mset = mset[complete.cases(mset), ]
  head(mset)
  inTraining <- createDataPartition(mset$NH3.N.ob, p = .70, list = FALSE)
  train <- mset[ inTraining,]
  test  <- mset[-inTraining,]
  
  #importance
  fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 10)
  tunegrid <- expand.grid(.mtry=c(1:15))
  
  model.rf.NH3.N <- train(NH3.N.ob ~ ., data = train, method = 'rf', tuneGrid=tunegrid, trControl = fitControl,preProcess = c("center", "scale"),  ntry = 501)
  # model.rf.TPH <- train(NH3.N.ob ~ ., data = train, method = 'rf')
  model.rf.NH3.N
  
  # saveRDS(model.rf.NH3.N, "rf.NH3.N.total.importance(N제거).rds")
  model.rf.NH3.N = readRDS("rf.NH3.N.total.importance(N제거).rds")
  model.rf.NH3.N
  # importance(model.rf.TPH)
  # varImpPlot(model.rf.TPH)
  gbmImp <- varImp(model.rf.NH3.N, scale = FALSE)
  gbmImp
  gbmImp = as.data.frame(gbmImp$importance)
  plot(gbmImp)
  # write.csv(gbmImp, file = "NH3.N.imp.total(N제거).csv", na="-", fileEncoding = "CP949")
  
  imp.ad = read.csv("NH3.N.imp.total(N제거).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  head(imp.ad)
  ord.ad = as.vector(imp.ad$X)
  order(ord.ad)
  new_order7 <- with(imp.ad, reorder(X, Overall, median , na.rm=T))
  # TPH.model.RMSE.plot <- ggplot(data = big_data1.TPH, aes(x = RMSE, y = new_order1, fill = Model)) +
  imp.ad$X=factor(imp.ad$X, levels = rev(ord.ad))
}
#통합 피규어
{
  imp.ad = read.csv("NH3.N.imp.total(N포함,제거).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  names(imp.ad)[2] <- c("NH3-N Excluded")
  names(imp.ad)[3] <- c("NH3-N Included")
  datam = reshape::melt(imp.ad, id.vars = c("Parameter"))
  head(datam)
  # datam$Parameter <- factor(datam$Parameter, levels = c("NH3-N", "EC","Temp.","Cl","Turbidity","ORP","TDS","pH","Depth"))
  datam$Parameter <- factor(datam$Parameter, levels = c("Depth", "pH","TDS","ORP","Turbidity","Cl-","Temp.","EC","NH3-N"))
  datam$variable <- factor(datam$variable, levels = c("NH3-N Excluded","NH3-N Included"))
  gn <- c(expression(NH[3]-N~Excluded),expression(NH[3]-N~Included))
  group_name <- c("Depth","pH","TDS","ORP","Turbidity",expression(Cl^'-'),"Temp.","EC",expression(NH[3]-N))
  
  brk = ggplot(datam, aes(value, Parameter, fill = variable)) +
    geom_bar(stat = "identity", position = "dodge", color="black", width = 0.7) +
    #  geom_point(shape=16,size=1, color="blue")+
    theme_bw() +
    # guides(color = guide_legend(keywidth = unit(0, "cm"), keyheight = unit(0, "cm")))+
    theme(panel.grid = element_blank(),
          axis.text.y = element_text(size=25),
          axis.text.x = element_text(size=20,angle = 0, vjust = 0.5, hjust =0.5),
          axis.title.y = element_text(size=25),
          axis.title.x = element_text(size=25),
          legend.position = c(0.72,0.12),
          legend.key = element_blank(),
          legend.text = element_text(size = 20))+
    # legend.background = element_rect(fill="white", size = 0, linetype = "solid", colour = "black"))+
    # scale_x_break(c(60, 350), scales = 0.2)+ #여기서 scales는 양쪽 넓이 비율 지정, break는 잘라버릴 범위 지정
    labs(fill = "") +
    xlab("Importance")+ ylab(~paste("")) +
    scale_y_discrete(labels=group_name)
  brk
  brk =set_palette(brk, "Set1")
}
brk
ggsave("brk.TIFF", dpi=350, dev='tiff', height=15, width=17, units="cm")

#NH3-N 예측에 NH3-N 포함: NH3-N, EC, Temp., Cl, Turbidity, ORP, TDS, pH, Depth
#NH3-N 예측에 NH3-N 제거: EC, Temp., TDS, Depth, pH, Turbidity, Cl, ORP

#Cl 예측 전략 수립
#Importance- Cl (Cl o)
{
  ti = x34568[c(14,26:32,34,36)]
  head(ti)
  px = as.data.frame(ti)
  head(px)
  mset = px
  # {mset$NO3.N.ca[mset$NO3.N.ca %in% "NA"] <- NA
  #   mset$NH3.N.ca[mset$NH3.N.ca %in% "NA"] <- NA}
  # head(mset)
  # mset = mset[complete.cases(mset), ]
  head(mset)
  inTraining <- createDataPartition(mset$Cl.ob, p = .70, list = FALSE)
  train <- mset[ inTraining,]
  test  <- mset[-inTraining,]
  
  #importance
  fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 10)
  tunegrid <- expand.grid(.mtry=c(1:15))
  
  model.rf.Cl <- train(Cl.ob ~ ., data = train, method = 'rf', tuneGrid=tunegrid, trControl = fitControl,preProcess = c("center", "scale"),  ntry = 501)
  model.rf.Cl
  
  # saveRDS(model.rf.Cl, "rf.Cl.total.importance(Cl포함).rds")
  model.rf.Cl = readRDS("rf.Cl.total.importance(Cl포함).rds")
  model.rf.Cl
  
  gbmImp <- varImp(model.rf.Cl, scale = FALSE)
  gbmImp
  gbmImp = as.data.frame(gbmImp$importance)
  plot(gbmImp)
  # write.csv(gbmImp, file = "Cl.imp.total(Cl포함).csv", na="-", fileEncoding = "CP949")
  
  imp.ad = read.csv("Cl.imp.total(Cl포함).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  head(imp.ad)
  ord.ad = as.vector(imp.ad$X)
  order(ord.ad)
  new_order7 <- with(imp.ad, reorder(X, Overall, median , na.rm=T))
  # TPH.model.RMSE.plot <- ggplot(data = big_data1.TPH, aes(x = RMSE, y = new_order1, fill = Model)) +
  imp.ad$X=factor(imp.ad$X, levels = rev(ord.ad))
  
  brk = ggplot(imp.ad, aes(x=Overall, y=X)) +
    geom_bar(stat = "identity", position = "dodge", color="black", width = 1) +
    #  geom_point(shape=16,size=1, color="blue")+
    theme_bw() +
    theme(panel.grid = element_blank(),
          axis.text.y = element_text(size=25),
          axis.text.x = element_text(size=20,angle = 0, vjust = 0.5, hjust =0.5),
          axis.title.y = element_text(size=25),
          axis.title.x = element_text(size=25),
          legend.position = c(0,3),
          legend.text = element_text(size = 25),
          legend.background = element_rect(fill="white", size = 0.5, linetype = "solid", colour = "black"))+
    # scale_x_break(c(60, 350), scales = 0.2)+ #여기서 scales는 양쪽 넓이 비율 지정, break는 잘라버릴 범위 지정
    labs(fill = "")+
    xlab("Importance")+ ylab(~paste("")) 
  brk
}
#Importance- Cl (Cl x)
{
  ti = x34568[c(14,26:32,34)]
  head(ti)
  px = as.data.frame(ti)
  head(px)
  mset = px
  # {mset$NO3.N.ca[mset$NO3.N.ca %in% "NA"] <- NA
  #   mset$NH3.N.ca[mset$NH3.N.ca %in% "NA"] <- NA}
  # head(mset)
  # mset = mset[complete.cases(mset), ]
  head(mset)
  inTraining <- createDataPartition(mset$Cl.ob, p = .70, list = FALSE)
  train <- mset[ inTraining,]
  test  <- mset[-inTraining,]
  
  #importance
  fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 10)
  tunegrid <- expand.grid(.mtry=c(1:15))
  
  model.rf.Cl <- train(Cl.ob ~ ., data = train, method = 'rf', tuneGrid=tunegrid, trControl = fitControl,preProcess = c("center", "scale"),  ntry = 501)
  model.rf.Cl
  
  # saveRDS(model.rf.Cl, "rf.Cl.total.importance(Cl제거).rds")
  model.rf.Cl = readRDS("rf.Cl.total.importance(Cl제거).rds")
  model.rf.Cl
  # importance(model.rf.TPH)
  # varImpPlot(model.rf.TPH)
  gbmImp <- varImp(model.rf.Cl, scale = FALSE)
  gbmImp
  gbmImp = as.data.frame(gbmImp$importance)
  plot(gbmImp)
  # write.csv(gbmImp, file = "Cl.imp.total(Cl제거).csv", na="-", fileEncoding = "CP949")
  
  imp.ad = read.csv("Cl.imp.total(Cl제거).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  head(imp.ad)
  ord.ad = as.vector(imp.ad$X)
  order(ord.ad)
  new_order7 <- with(imp.ad, reorder(X, Overall, median , na.rm=T))
  # TPH.model.RMSE.plot <- ggplot(data = big_data1.TPH, aes(x = RMSE, y = new_order1, fill = Model)) +
  imp.ad$X=factor(imp.ad$X, levels = rev(ord.ad))
}
#통합 피규어
{
  imp.ad = read.csv("Cl.imp.total(Cl포함,제거).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  names(imp.ad)[2] <- c("Cl Included")
  names(imp.ad)[3] <- c("Cl Excluded")
  datam = reshape::melt(imp.ad, id.vars = c("Parameter"))
  head(datam)
  # datam$Parameter <- factor(datam$Parameter, levels = c("NH3-N", "EC","Temp.","Cl","Turbidity","ORP","TDS","pH","Depth"))
  datam$Parameter <- factor(datam$Parameter, levels = c("Depth", "Temp.","TDS","Turbidity","NH3-N","pH","ORP","EC","Cl-"))
  datam$variable <- factor(datam$variable, levels = c("Cl Excluded","Cl Included"))
  gn <- c(expression(Cl^'-'~Excluded),expression(Cl^'-'~Excluded))
  group_name <- c("Depth","Temp.","TDS","Turbidity",expression(NH[3]-N),"pH","ORP","EC",expression(Cl^'-'))
  
  brk = ggplot(datam, aes(value, Parameter, fill = variable)) +
    geom_bar(stat = "identity", position = "dodge", color="black", width = 0.7) +
    #  geom_point(shape=16,size=1, color="blue")+
    theme_bw() +
    # guides(color = guide_legend(keywidth = unit(0, "cm"), keyheight = unit(0, "cm")))+
    theme(panel.grid = element_blank(),
          axis.text.y = element_text(size=25),
          axis.text.x = element_text(size=20,angle = 0, vjust = 0.5, hjust =0.5),
          axis.title.y = element_text(size=25),
          axis.title.x = element_text(size=25),
          legend.position = c(0.70,0.12),
          legend.key = element_blank(),
          legend.text = element_text(size = 20))+
    # legend.background = element_rect(fill="white", size = 0, linetype = "solid", colour = "black"))+
    # scale_x_break(c(60, 350), scales = 0.2)+ #여기서 scales는 양쪽 넓이 비율 지정, break는 잘라버릴 범위 지정
    labs(fill = "") +
    xlab("Importance")+ ylab(~paste(""))  +
    scale_y_discrete(labels=group_name)
  brk
  brk =set_palette(brk, "Set1")
}
brk

#Cl 예측에 Cl 포함: Cl, EC, ORP, pH, NH3-N, Turbidity, TDS, Temp., Depth
#Cl 예측에 Cl 제거: EC, NH3-N, ORP, Turbidity, Temp., pH, TDS, Depth
#===============================================================================
#NH3-N 예측 모델에서 NH3-N 포함 - Feature&Algorithm selection
#Data
{
  x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
  x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
  x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
  x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
  x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
  x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  x34568$Date = as.Date(x34568$Date)
  
  x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
  x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
  # x3$TPH.ob = as.numeric(x3$TPH.ob)
  x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
  x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
  
  x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
  x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
  # x4$TPH.ob = as.numeric(x4$TPH.ob)
  x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
  x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
  
  x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
  x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
  # x5$TPH.ob = as.numeric(x5$TPH.ob)
  x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
  x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
  
  x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
  x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
  # x6$TPH.ob = as.numeric(x6$TPH.ob)
  x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
  x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
  
  x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
  x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
  # x8$TPH.ob = as.numeric(x8$TPH.ob)
  x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
  x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
  
  x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
  x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
  # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
  x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
  x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
  head(x34568)
  
  ca3 <- read_excel("보정 안성3.xlsx")
  ca4 <- read_excel("보정 안성4.xlsx")
  ca5 <- read_excel("보정 안성5.xlsx")
  ca6 <- read_excel("보정 안성6.xlsx")
  ca8 <- read_excel("보정 안성8.xlsx")
  
  ca3$Date = as.Date(ca3$Date)
  ca4$Date = as.Date(ca4$Date)
  ca5$Date = as.Date(ca5$Date)
  ca6$Date = as.Date(ca6$Date)
  ca8$Date = as.Date(ca8$Date)
  str(ca3)
}
{
  #Feature & Algorithm
  ti = x34568[c(12,34,30,27,36,31,29,32,28,26)]
  head(ti)
  
  #Feature combination
  {
    c3 = ti[c(1:4)]
    c4 = ti[c(1:5)]
    c5 = ti[c(1:6)]
    c6 = ti[c(1:7)]
    c7 = ti[c(1:8)]
    c8 = ti[c(1:9)]
    c9 = ti[c(1:10)]   
  }   
  
  datalist = list()
  for (i in 1:10) {
    {
      c3 = as.data.frame(c3)
      inTraining <- createDataPartition(c3$NH3.N.ob, p = .70, list = FALSE)
      train.c3 <- c3[ inTraining,]
      test.c3  <- c3[-inTraining,]
      
      c4 = as.data.frame(c4)
      inTraining <- createDataPartition(c4$NH3.N.ob, p = .70, list = FALSE)
      train.c4 <- c4[ inTraining,]
      test.c4  <- c4[-inTraining,]
      
      c5 = as.data.frame(c5)
      inTraining <- createDataPartition(c5$NH3.N.ob, p = .70, list = FALSE)
      train.c5 <- c5[ inTraining,]
      test.c5  <- c5[-inTraining,]
      
      c6 = as.data.frame(c6)
      inTraining <- createDataPartition(c6$NH3.N.ob, p = .70, list = FALSE)
      train.c6 <- c6[ inTraining,]
      test.c6  <- c6[-inTraining,]
      
      c7 = as.data.frame(c7)
      inTraining <- createDataPartition(c7$NH3.N.ob, p = .70, list = FALSE)
      train.c7 <- c7[ inTraining,]
      test.c7  <- c7[-inTraining,]
      
      c8 = as.data.frame(c8)
      inTraining <- createDataPartition(c8$NH3.N.ob, p = .70, list = FALSE)
      train.c8 <- c8[ inTraining,]
      test.c8  <- c8[-inTraining,]
      
      c9 = as.data.frame(c9)
      inTraining <- createDataPartition(c9$NH3.N.ob, p = .70, list = FALSE)
      train.c9 <- c9[ inTraining,]
      test.c9  <- c9[-inTraining,]
      
      # c10 = as.data.frame(c10)
      # inTraining <- createDataPartition(c10$NH3.N.ob, p = .70, list = FALSE)
      # train.c10 <- c10[ inTraining,]
      # test.c10  <- c10[-inTraining,]
      
      # c11 = as.data.frame(c11)
      # inTraining <- createDataPartition(c11$NH3.N.ob, p = .70, list = FALSE)
      # train.c11 <- c11[ inTraining,]
      # test.c11  <- c11[-inTraining,]
      
      # GR = as.data.frame(GR)
      # inTraining <- createDataPartition(GR$NH3.N.ob, p = .70, list = FALSE)
      # train.GR <- GR[ inTraining,]
      # test.GR  <- GR[-inTraining,]
      # 
      # RF = as.data.frame(RF)
      # inTraining <- createDataPartition(RF$NH3.N.ob, p = .70, list = FALSE)
      # train.RF <- RF[ inTraining,]
      # test.RF  <- RF[-inTraining,]
      # 
      # SR = as.data.frame(SR)
      # inTraining <- createDataPartition(SR$NH3.N.ob, p = .70, list = FALSE)
      # train.SR <- SR[ inTraining,]
      # test.SR  <- SR[-inTraining,]
    }
    #===
    {
      # fitControl <- trainControl(method = "repeatedcv", repeats = 20)
      model.rf.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'rf')
      model.rf.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'rf')
      model.rf.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'rf')
      model.rf.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'rf')
      model.rf.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'rf')
      model.rf.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'rf')
      model.rf.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'rf')
      # model.rf.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'rf')
      # model.rf.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'rf')
      # model.rf.RF <- train(NH3.N.ob ~ .,data = train.RF, method = 'rf')
      
      model.rf.3$results$RMSE
      model.rf.3$results$MAE
      model.rf.4$results$RMSE
      model.rf.4$results$MAE
      model.rf.5$results$RMSE
      model.rf.5$results$MAE
      model.rf.6$results$RMSE
      model.rf.6$results$MAE
      model.rf.7$results$RMSE
      model.rf.7$results$MAE
      model.rf.8$results$RMSE
      model.rf.8$results$MAE
      model.rf.9$results$RMSE
      model.rf.9$results$MAE
      # model.rf.10$results$RMSE
      # model.rf.10$results$MAE
      # model.rf.11$results$RMSE
      # model.rf.11$results$MAE
      # model.rf.RF$results$RMSE
      # model.rf.RF$results$MAE
      #===
      model.gaussprRadial.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'gaussprRadial')
      model.gaussprRadial.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'gaussprRadial')
      model.gaussprRadial.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'gaussprRadial')
      model.gaussprRadial.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'gaussprRadial')
      model.gaussprRadial.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'gaussprRadial')
      model.gaussprRadial.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'gaussprRadial')
      model.gaussprRadial.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'gaussprRadial')
      # model.gaussprRadial.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'gaussprRadial')
      # model.gaussprRadial.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'gaussprRadial')
      # model.gaussprRadial.GR <- train(NH3.N.ob ~ .,data = train.GR, method = 'gaussprRadial')
      
      model.gaussprRadial.3$results$RMSE
      model.gaussprRadial.3$results$MAE
      model.gaussprRadial.4$results$RMSE
      model.gaussprRadial.4$results$MAE
      model.gaussprRadial.5$results$RMSE
      model.gaussprRadial.5$results$MAE
      model.gaussprRadial.6$results$RMSE
      model.gaussprRadial.6$results$MAE
      model.gaussprRadial.7$results$RMSE
      model.gaussprRadial.7$results$MAE
      model.gaussprRadial.8$results$RMSE
      model.gaussprRadial.8$results$MAE
      model.gaussprRadial.9$results$RMSE
      model.gaussprRadial.9$results$MAE
      # model.gaussprRadial.10$results$RMSE
      # model.gaussprRadial.10$results$MAE
      # model.gaussprRadial.11$results$RMSE
      # model.gaussprRadial.11$results$MAE
      # model.gaussprRadial.GR$results$RMSE
      # model.gaussprRadial.GR$results$MAE
      #===
      model.svmRadial.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'svmRadial')
      model.svmRadial.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'svmRadial')
      model.svmRadial.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'svmRadial')
      model.svmRadial.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'svmRadial')
      model.svmRadial.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'svmRadial')
      model.svmRadial.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'svmRadial')
      model.svmRadial.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'svmRadial')
      # model.svmRadial.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'svmRadial')
      # model.svmRadial.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'svmRadial')
      # model.svmRadial.SR <- train(NH3.N.ob ~ .,data = train.SR, method = 'svmRadial')
      
      model.svmRadial.3$results$RMSE
      model.svmRadial.3$results$MAE
      model.svmRadial.4$results$RMSE
      model.svmRadial.4$results$MAE
      model.svmRadial.5$results$RMSE
      model.svmRadial.5$results$MAE
      model.svmRadial.6$results$RMSE
      model.svmRadial.6$results$MAE
      model.svmRadial.7$results$RMSE
      model.svmRadial.7$results$MAE
      model.svmRadial.8$results$RMSE
      model.svmRadial.8$results$MAE
      model.svmRadial.9$results$RMSE
      model.svmRadial.9$results$MAE
      # model.svmRadial.10$results$RMSE
      # model.svmRadial.10$results$MAE
      # model.svmRadial.11$results$RMSE
      # model.svmRadial.11$results$MAE
      # model.svmRadial.SR$results$RMSE
      # model.svmRadial.SR$results$MAE
    }
    #===
    model.cp <- data.frame(Case = c("Rf.3","Rf.4","Rf.5","Rf.6","Rf.7","Rf.8","Rf.9",
                                    "Gaussian Radial.3","Gaussian Radial.4","Gaussian Radial.5","Gaussian Radial.6","Gaussian Radial.7","Gaussian Radial.8","Gaussian Radial.9",
                                    "SVM Radial.3","SVM Radial.4","SVM Radial.5","SVM Radial.6","SVM Radial.7","SVM Radial.8","SVM Radial.9"),
                           RMSE = c(model.rf.3$results$RMSE[1],model.rf.4$results$RMSE[1],model.rf.5$results$RMSE[1],model.rf.6$results$RMSE[1],model.rf.7$results$RMSE[1],model.rf.8$results$RMSE[1],model.rf.9$results$RMSE[1],
                                    model.gaussprRadial.3$results$RMSE,model.gaussprRadial.4$results$RMSE,model.gaussprRadial.5$results$RMSE,model.gaussprRadial.6$results$RMSE,model.gaussprRadial.7$results$RMSE,model.gaussprRadial.8$results$RMSE,model.gaussprRadial.9$results$RMSE,
                                    model.svmRadial.3$results$RMSE[1],model.svmRadial.4$results$RMSE[1],model.svmRadial.5$results$RMSE[1],model.svmRadial.6$results$RMSE[1],model.svmRadial.7$results$RMSE[1],model.svmRadial.8$results$RMSE[1],model.svmRadial.9$results$RMSE[1]),
                           MAE = c(model.rf.3$results$MAE[1],model.rf.4$results$MAE[1],model.rf.5$results$MAE[1],model.rf.6$results$MAE[1],model.rf.7$results$MAE[1],model.rf.8$results$MAE[1],model.rf.9$results$MAE[1],
                                   model.gaussprRadial.3$results$MAE,model.gaussprRadial.4$results$MAE,model.gaussprRadial.5$results$MAE,model.gaussprRadial.6$results$MAE,model.gaussprRadial.7$results$MAE,model.gaussprRadial.8$results$MAE,model.gaussprRadial.9$results$MAE,
                                   model.svmRadial.3$results$MAE[1],model.svmRadial.4$results$MAE[1],model.svmRadial.5$results$MAE[1],model.svmRadial.6$results$MAE[1],model.svmRadial.7$results$MAE[1],model.svmRadial.8$results$MAE[1],model.svmRadial.9$results$MAE[1]))
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  MFselect = do.call(rbind, datalist)
  # write.csv(MFselect, file = "안성.NH3.N,F&A(N포함).csv", na="-", fileEncoding = "CP949")
  MFselect.t = read.csv("안성.NH3.N,F&A(N포함).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  
  { 
    MFselect.t.G = subset(MFselect.t, MFselect.t$Model== "Gaussian Radial")
    MFselect.t.G.3 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.3")
    MFselect.t.G.4 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.4")
    MFselect.t.G.5 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.5")
    MFselect.t.G.6 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.6")
    MFselect.t.G.7 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.7")
    MFselect.t.G.8 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.8")
    MFselect.t.G.9 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.9")
    # MFselect.t.G.10 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.10")
    # MFselect.t.G.11 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.11")
    # MFselect.t.G.GR = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.GR")
    
    MFselect.t.R = subset(MFselect.t, MFselect.t$Model== "Randomforest")
    MFselect.t.R.3 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.3")
    MFselect.t.R.4 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.4")
    MFselect.t.R.5 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.5")
    MFselect.t.R.6 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.6")
    MFselect.t.R.7 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.7")
    MFselect.t.R.8 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.8")
    MFselect.t.R.9 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.9")
    # MFselect.t.R.10 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.10")
    # MFselect.t.R.11 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.11")
    # MFselect.t.R.RF = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.RF")
    
    MFselect.t.S = subset(MFselect.t, MFselect.t$Model== "SVM Radial")
    MFselect.t.S.3 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.3")
    MFselect.t.S.4 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.4")
    MFselect.t.S.5 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.5")
    MFselect.t.S.6 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.6")
    MFselect.t.S.7 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.7")
    MFselect.t.S.8 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.8")
    MFselect.t.S.9 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.9")
    # MFselect.t.S.10 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.10")
    # MFselect.t.S.11 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.11")
    # MFselect.t.S.SR = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.SR")
  }
  {  
    summary(MFselect.t.G.3)
    summary(MFselect.t.G.4)
    summary(MFselect.t.G.5)
    summary(MFselect.t.G.6)
    summary(MFselect.t.G.7)
    summary(MFselect.t.G.8)
    summary(MFselect.t.G.9)
    # summary(MFselect.t.G.10)
    # summary(MFselect.t.G.11)
    # summary(MFselect.t.G.GR)
    
    summary(MFselect.t.R.3)
    summary(MFselect.t.R.4)
    summary(MFselect.t.R.5)
    summary(MFselect.t.R.6)
    summary(MFselect.t.R.7)
    summary(MFselect.t.R.8)
    summary(MFselect.t.R.9)
    # summary(MFselect.t.R.10)
    # summary(MFselect.t.R.11)
    # summary(MFselect.t.R.RF)
    
    summary(MFselect.t.S.3)
    summary(MFselect.t.S.4)
    summary(MFselect.t.S.5)
    summary(MFselect.t.S.6)
    summary(MFselect.t.S.7)
    summary(MFselect.t.S.8)
    summary(MFselect.t.S.9)
    # summary(MFselect.t.S.10)
    # summary(MFselect.t.S.11)
    # summary(MFselect.t.S.SR)
  }
  {  
    MFselect.t = read.csv("안성.NH3.N,F&A(N포함).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    head(MFselect.t)
    MFselect.t = MFselect.t[c(1,3,4,6)]
    head(MFselect.t)
    MFselect.t$Feature = as.character(MFselect.t$Feature)
  }
  {
    MFselect.t$Model <- factor(MFselect.t$Model, levels = c("Gaussian Radial", "Randomforest", "SVM Radial"))
    
    MFselect.t$Feature <- factor(MFselect.t$Feature, levels = c("3","4","5","6","7","8","9"))
    
    # modelnames <- c("BstLm", "Gaussian Radial", "Randomforest", "SVM Radial", "GBM", "GLM")
    
    Feature.plot <- ggplot(data = MFselect.t, aes(x = Feature, y = RMSE, fill = Feature, group = Feature)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(size = 30),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=20),
            axis.text.y = element_text(size=20)) +
      ggtitle("Feature & Algorithm Selection for NH3-N prediction (Including NH3-N)") +
      ylab("RMSE")+xlab("Number of Parameters")+
      # scale_fill_manual(values = c("red3", "orange2", "dodgerblue3", "green4", "purple", "deeppink3"))+
      facet_grid(~Model, scales = "free", space = "free")
    # geom_hline(yintercept = 0.9144, color = "red", lty = "dashed", size = 0.8)
    
    # scale_fill_manual(values = c("red2", "red4", "orange", "orange3", "dodgerblue3", "dodgerblue4","green2", "green4"))
    Feature.plot
  }
  
  a=set_palette(Feature.plot, "Set1")
}
a
#result => Randomforest + 4 features (NH3-N, EC, Temp., Cl)

#NH3-N 예측 모델에서 NH3-N 제거 - Feature&Algorithm selection
{
  #Feature & Algorithm
  ti = x34568[c(12,30,27,32,26,28,31,36,29)]
  head(ti)
  #Feature combination
  {
    c3 = ti[c(1:4)]
    c4 = ti[c(1:5)]
    c5 = ti[c(1:6)]
    c6 = ti[c(1:7)]
    c7 = ti[c(1:8)]
    c8 = ti[c(1:9)]
  } 
  datalist = list()
  for (i in 1:10) {
    {
      c3 = as.data.frame(c3)
      inTraining <- createDataPartition(c3$NH3.N.ob, p = .70, list = FALSE)
      train.c3 <- c3[ inTraining,]
      test.c3  <- c3[-inTraining,]
      
      c4 = as.data.frame(c4)
      inTraining <- createDataPartition(c4$NH3.N.ob, p = .70, list = FALSE)
      train.c4 <- c4[ inTraining,]
      test.c4  <- c4[-inTraining,]
      
      c5 = as.data.frame(c5)
      inTraining <- createDataPartition(c5$NH3.N.ob, p = .70, list = FALSE)
      train.c5 <- c5[ inTraining,]
      test.c5  <- c5[-inTraining,]
      
      c6 = as.data.frame(c6)
      inTraining <- createDataPartition(c6$NH3.N.ob, p = .70, list = FALSE)
      train.c6 <- c6[ inTraining,]
      test.c6  <- c6[-inTraining,]
      
      c7 = as.data.frame(c7)
      inTraining <- createDataPartition(c7$NH3.N.ob, p = .70, list = FALSE)
      train.c7 <- c7[ inTraining,]
      test.c7  <- c7[-inTraining,]
      
      c8 = as.data.frame(c8)
      inTraining <- createDataPartition(c8$NH3.N.ob, p = .70, list = FALSE)
      train.c8 <- c8[ inTraining,]
      test.c8  <- c8[-inTraining,]
      
      # c9 = as.data.frame(c9)
      # inTraining <- createDataPartition(c9$NH3.N.ob, p = .70, list = FALSE)
      # train.c9 <- c9[ inTraining,]
      # test.c9  <- c9[-inTraining,]
      
      # c10 = as.data.frame(c10)
      # inTraining <- createDataPartition(c10$NH3.N.ob, p = .70, list = FALSE)
      # train.c10 <- c10[ inTraining,]
      # test.c10  <- c10[-inTraining,]
      
      # c11 = as.data.frame(c11)
      # inTraining <- createDataPartition(c11$NH3.N.ob, p = .70, list = FALSE)
      # train.c11 <- c11[ inTraining,]
      # test.c11  <- c11[-inTraining,]
      
      # GR = as.data.frame(GR)
      # inTraining <- createDataPartition(GR$NH3.N.ob, p = .70, list = FALSE)
      # train.GR <- GR[ inTraining,]
      # test.GR  <- GR[-inTraining,]
      # 
      # RF = as.data.frame(RF)
      # inTraining <- createDataPartition(RF$NH3.N.ob, p = .70, list = FALSE)
      # train.RF <- RF[ inTraining,]
      # test.RF  <- RF[-inTraining,]
      # 
      # SR = as.data.frame(SR)
      # inTraining <- createDataPartition(SR$NH3.N.ob, p = .70, list = FALSE)
      # train.SR <- SR[ inTraining,]
      # test.SR  <- SR[-inTraining,]
    }
    #===
    {
      # fitControl <- trainControl(method = "repeatedcv", repeats = 20)
      model.rf.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'rf')
      model.rf.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'rf')
      model.rf.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'rf')
      model.rf.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'rf')
      model.rf.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'rf')
      model.rf.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'rf')
      # model.rf.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'rf')
      # model.rf.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'rf')
      # model.rf.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'rf')
      # model.rf.RF <- train(NH3.N.ob ~ .,data = train.RF, method = 'rf')
      
      model.rf.3$results$RMSE
      model.rf.3$results$MAE
      model.rf.4$results$RMSE
      model.rf.4$results$MAE
      model.rf.5$results$RMSE
      model.rf.5$results$MAE
      model.rf.6$results$RMSE
      model.rf.6$results$MAE
      model.rf.7$results$RMSE
      model.rf.7$results$MAE
      model.rf.8$results$RMSE
      model.rf.8$results$MAE
      # model.rf.9$results$RMSE
      # model.rf.9$results$MAE
      # model.rf.10$results$RMSE
      # model.rf.10$results$MAE
      # model.rf.11$results$RMSE
      # model.rf.11$results$MAE
      # model.rf.RF$results$RMSE
      # model.rf.RF$results$MAE
      #===
      model.gaussprRadial.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'gaussprRadial')
      model.gaussprRadial.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'gaussprRadial')
      model.gaussprRadial.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'gaussprRadial')
      model.gaussprRadial.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'gaussprRadial')
      model.gaussprRadial.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'gaussprRadial')
      model.gaussprRadial.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'gaussprRadial')
      # model.gaussprRadial.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'gaussprRadial')
      # model.gaussprRadial.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'gaussprRadial')
      # model.gaussprRadial.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'gaussprRadial')
      # model.gaussprRadial.GR <- train(NH3.N.ob ~ .,data = train.GR, method = 'gaussprRadial')
      
      model.gaussprRadial.3$results$RMSE
      model.gaussprRadial.3$results$MAE
      model.gaussprRadial.4$results$RMSE
      model.gaussprRadial.4$results$MAE
      model.gaussprRadial.5$results$RMSE
      model.gaussprRadial.5$results$MAE
      model.gaussprRadial.6$results$RMSE
      model.gaussprRadial.6$results$MAE
      model.gaussprRadial.7$results$RMSE
      model.gaussprRadial.7$results$MAE
      model.gaussprRadial.8$results$RMSE
      model.gaussprRadial.8$results$MAE
      # model.gaussprRadial.9$results$RMSE
      # model.gaussprRadial.9$results$MAE
      # model.gaussprRadial.10$results$RMSE
      # model.gaussprRadial.10$results$MAE
      # model.gaussprRadial.11$results$RMSE
      # model.gaussprRadial.11$results$MAE
      # model.gaussprRadial.GR$results$RMSE
      # model.gaussprRadial.GR$results$MAE
      #===
      model.svmRadial.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'svmRadial')
      model.svmRadial.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'svmRadial')
      model.svmRadial.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'svmRadial')
      model.svmRadial.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'svmRadial')
      model.svmRadial.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'svmRadial')
      model.svmRadial.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'svmRadial')
      # model.svmRadial.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'svmRadial')
      # model.svmRadial.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'svmRadial')
      # model.svmRadial.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'svmRadial')
      # model.svmRadial.SR <- train(NH3.N.ob ~ .,data = train.SR, method = 'svmRadial')
      
      model.svmRadial.3$results$RMSE
      model.svmRadial.3$results$MAE
      model.svmRadial.4$results$RMSE
      model.svmRadial.4$results$MAE
      model.svmRadial.5$results$RMSE
      model.svmRadial.5$results$MAE
      model.svmRadial.6$results$RMSE
      model.svmRadial.6$results$MAE
      model.svmRadial.7$results$RMSE
      model.svmRadial.7$results$MAE
      model.svmRadial.8$results$RMSE
      model.svmRadial.8$results$MAE
      # model.svmRadial.9$results$RMSE
      # model.svmRadial.9$results$MAE
      # model.svmRadial.10$results$RMSE
      # model.svmRadial.10$results$MAE
      # model.svmRadial.11$results$RMSE
      # model.svmRadial.11$results$MAE
      # model.svmRadial.SR$results$RMSE
      # model.svmRadial.SR$results$MAE
    }
    #===
    model.cp <- data.frame(Case = c("Rf.3","Rf.4","Rf.5","Rf.6","Rf.7","Rf.8",
                                    "Gaussian Radial.3","Gaussian Radial.4","Gaussian Radial.5","Gaussian Radial.6","Gaussian Radial.7","Gaussian Radial.8",
                                    "SVM Radial.3","SVM Radial.4","SVM Radial.5","SVM Radial.6","SVM Radial.7","SVM Radial.8"),
                           RMSE = c(model.rf.3$results$RMSE[1],model.rf.4$results$RMSE[1],model.rf.5$results$RMSE[1],model.rf.6$results$RMSE[1],model.rf.7$results$RMSE[1],model.rf.8$results$RMSE[1],
                                    model.gaussprRadial.3$results$RMSE,model.gaussprRadial.4$results$RMSE,model.gaussprRadial.5$results$RMSE,model.gaussprRadial.6$results$RMSE,model.gaussprRadial.7$results$RMSE,model.gaussprRadial.8$results$RMSE,
                                    model.svmRadial.3$results$RMSE[1],model.svmRadial.4$results$RMSE[1],model.svmRadial.5$results$RMSE[1],model.svmRadial.6$results$RMSE[1],model.svmRadial.7$results$RMSE[1],model.svmRadial.8$results$RMSE[1]),
                           MAE = c(model.rf.3$results$MAE[1],model.rf.4$results$MAE[1],model.rf.5$results$MAE[1],model.rf.6$results$MAE[1],model.rf.7$results$MAE[1],model.rf.8$results$MAE[1],
                                   model.gaussprRadial.3$results$MAE,model.gaussprRadial.4$results$MAE,model.gaussprRadial.5$results$MAE,model.gaussprRadial.6$results$MAE,model.gaussprRadial.7$results$MAE,model.gaussprRadial.8$results$MAE,
                                   model.svmRadial.3$results$MAE[1],model.svmRadial.4$results$MAE[1],model.svmRadial.5$results$MAE[1],model.svmRadial.6$results$MAE[1],model.svmRadial.7$results$MAE[1],model.svmRadial.8$results$MAE[1]))
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  MFselect = do.call(rbind, datalist)
  # write.csv(MFselect, file = "안성.NH3.N,F&A(N제거).csv", na="-", fileEncoding = "CP949")
  MFselect.t = read.csv("안성.NH3.N,F&A(N제거).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  { 
    MFselect.t.G = subset(MFselect.t, MFselect.t$Model== "Gaussian Radial")
    MFselect.t.G.3 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.3")
    MFselect.t.G.4 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.4")
    MFselect.t.G.5 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.5")
    MFselect.t.G.6 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.6")
    MFselect.t.G.7 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.7")
    MFselect.t.G.8 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.8")
    # MFselect.t.G.9 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.9")
    # MFselect.t.G.10 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.10")
    # MFselect.t.G.11 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.11")
    # MFselect.t.G.GR = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.GR")
    
    MFselect.t.R = subset(MFselect.t, MFselect.t$Model== "Randomforest")
    MFselect.t.R.3 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.3")
    MFselect.t.R.4 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.4")
    MFselect.t.R.5 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.5")
    MFselect.t.R.6 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.6")
    MFselect.t.R.7 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.7")
    MFselect.t.R.8 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.8")
    # MFselect.t.R.9 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.9")
    # MFselect.t.R.10 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.10")
    # MFselect.t.R.11 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.11")
    # MFselect.t.R.RF = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.RF")
    
    MFselect.t.S = subset(MFselect.t, MFselect.t$Model== "SVM Radial")
    MFselect.t.S.3 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.3")
    MFselect.t.S.4 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.4")
    MFselect.t.S.5 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.5")
    MFselect.t.S.6 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.6")
    MFselect.t.S.7 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.7")
    MFselect.t.S.8 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.8")
    # MFselect.t.S.9 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.9")
    # MFselect.t.S.10 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.10")
    # MFselect.t.S.11 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.11")
    # MFselect.t.S.SR = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.SR")
  }
  {  
    summary(MFselect.t.G.3)
    summary(MFselect.t.G.4)
    summary(MFselect.t.G.5)
    summary(MFselect.t.G.6)
    summary(MFselect.t.G.7)
    summary(MFselect.t.G.8)
    # summary(MFselect.t.G.9)
    # summary(MFselect.t.G.10)
    # summary(MFselect.t.G.11)
    # summary(MFselect.t.G.GR)
    
    summary(MFselect.t.R.3)
    summary(MFselect.t.R.4)
    summary(MFselect.t.R.5)
    summary(MFselect.t.R.6)
    summary(MFselect.t.R.7)
    summary(MFselect.t.R.8)
    # summary(MFselect.t.R.9)
    # summary(MFselect.t.R.10)
    # summary(MFselect.t.R.11)
    # summary(MFselect.t.R.RF)
    
    summary(MFselect.t.S.3)
    summary(MFselect.t.S.4)
    summary(MFselect.t.S.5)
    summary(MFselect.t.S.6)
    summary(MFselect.t.S.7)
    summary(MFselect.t.S.8)
    # summary(MFselect.t.S.9)
    # summary(MFselect.t.S.10)
    # summary(MFselect.t.S.11)
    # summary(MFselect.t.S.SR)
  }
  {  
    MFselect.t = read.csv("안성.NH3.N,F&A(N제거).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    head(MFselect.t)
    MFselect.t = MFselect.t[c(1,3,4,6)]
    head(MFselect.t)
    MFselect.t$Feature = as.character(MFselect.t$Feature)
  }
  {
    MFselect.t$Model <- factor(MFselect.t$Model, levels = c("Gaussian Radial", "Randomforest", "SVM Radial"))
    
    MFselect.t$Feature <- factor(MFselect.t$Feature, levels = c("3","4","5","6","7","8"))
    
    # modelnames <- c("BstLm", "Gaussian Radial", "Randomforest", "SVM Radial", "GBM", "GLM")
    
    Feature.plot <- ggplot(data = MFselect.t, aes(x = Feature, y = RMSE, fill = Feature, group = Feature)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(size = 30),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=20),
            axis.text.y = element_text(size=20)) +
      ggtitle("Feature & Algorithm Selection for NH3-N prediction (Excluding NH3-N)") +
      ylab("RMSE")+xlab("Number of Parameters")+
      # scale_fill_manual(values = c("red3", "orange2", "dodgerblue3", "green4", "purple", "deeppink3"))+
      facet_grid(~Model, scales = "free", space = "free")
    # geom_hline(yintercept = 1.0442, color = "red", lty = "dashed", size = 0.8)
    
    # scale_fill_manual(values = c("red2", "red4", "orange", "orange3", "dodgerblue3", "dodgerblue4","green2", "green4"))
    Feature.plot
  }
  
  b = set_palette(Feature.plot, "Set1")
}
b
#result => Randomforest + 7 features (EC, Temp., TDS, Depth, pH, Turbidity, Cl)
#===============================================================================
#Cl 예측 모델에서 Cl 포함 - Feature&Algorithm selection
#Data
{
  x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
  x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
  x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
  x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
  x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
  x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  x34568$Date = as.Date(x34568$Date)
  
  x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
  x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
  # x3$TPH.ob = as.numeric(x3$TPH.ob)
  x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
  x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
  
  x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
  x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
  # x4$TPH.ob = as.numeric(x4$TPH.ob)
  x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
  x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
  
  x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
  x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
  # x5$TPH.ob = as.numeric(x5$TPH.ob)
  x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
  x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
  
  x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
  x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
  # x6$TPH.ob = as.numeric(x6$TPH.ob)
  x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
  x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
  
  x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
  x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
  # x8$TPH.ob = as.numeric(x8$TPH.ob)
  x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
  x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
  
  x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
  x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
  # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
  x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
  x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
  head(x34568)
  
  ca3 <- read_excel("보정 안성3.xlsx")
  ca4 <- read_excel("보정 안성4.xlsx")
  ca5 <- read_excel("보정 안성5.xlsx")
  ca6 <- read_excel("보정 안성6.xlsx")
  ca8 <- read_excel("보정 안성8.xlsx")
  
  ca3$Date = as.Date(ca3$Date)
  ca4$Date = as.Date(ca4$Date)
  ca5$Date = as.Date(ca5$Date)
  ca6$Date = as.Date(ca6$Date)
  ca8$Date = as.Date(ca8$Date)
  str(ca3)
}
{
  #Feature & Algorithm
  ti = x34568[c(14,36,30,29,28,34,31,32,27,26)]
  head(ti)
  
  #Feature combination
  {
    c3 = ti[c(1:4)]
    c4 = ti[c(1:5)]
    c5 = ti[c(1:6)]
    c6 = ti[c(1:7)]
    c7 = ti[c(1:8)]
    c8 = ti[c(1:9)]
    c9 = ti[c(1:10)]   
  }   
  
  datalist = list()
  for (i in 1:10) {
    {
      c3 = as.data.frame(c3)
      inTraining <- createDataPartition(c3$Cl.ob, p = .70, list = FALSE)
      train.c3 <- c3[ inTraining,]
      test.c3  <- c3[-inTraining,]
      
      c4 = as.data.frame(c4)
      inTraining <- createDataPartition(c4$Cl.ob, p = .70, list = FALSE)
      train.c4 <- c4[ inTraining,]
      test.c4  <- c4[-inTraining,]
      
      c5 = as.data.frame(c5)
      inTraining <- createDataPartition(c5$Cl.ob, p = .70, list = FALSE)
      train.c5 <- c5[ inTraining,]
      test.c5  <- c5[-inTraining,]
      
      c6 = as.data.frame(c6)
      inTraining <- createDataPartition(c6$Cl.ob, p = .70, list = FALSE)
      train.c6 <- c6[ inTraining,]
      test.c6  <- c6[-inTraining,]
      
      c7 = as.data.frame(c7)
      inTraining <- createDataPartition(c7$Cl.ob, p = .70, list = FALSE)
      train.c7 <- c7[ inTraining,]
      test.c7  <- c7[-inTraining,]
      
      c8 = as.data.frame(c8)
      inTraining <- createDataPartition(c8$Cl.ob, p = .70, list = FALSE)
      train.c8 <- c8[ inTraining,]
      test.c8  <- c8[-inTraining,]
      
      c9 = as.data.frame(c9)
      inTraining <- createDataPartition(c9$Cl.ob, p = .70, list = FALSE)
      train.c9 <- c9[ inTraining,]
      test.c9  <- c9[-inTraining,]
      
      # c10 = as.data.frame(c10)
      # inTraining <- createDataPartition(c10$Cl.ob, p = .70, list = FALSE)
      # train.c10 <- c10[ inTraining,]
      # test.c10  <- c10[-inTraining,]
      
      # c11 = as.data.frame(c11)
      # inTraining <- createDataPartition(c11$Cl.ob, p = .70, list = FALSE)
      # train.c11 <- c11[ inTraining,]
      # test.c11  <- c11[-inTraining,]
      
      # GR = as.data.frame(GR)
      # inTraining <- createDataPartition(GR$Cl.ob, p = .70, list = FALSE)
      # train.GR <- GR[ inTraining,]
      # test.GR  <- GR[-inTraining,]
      # 
      # RF = as.data.frame(RF)
      # inTraining <- createDataPartition(RF$Cl.ob, p = .70, list = FALSE)
      # train.RF <- RF[ inTraining,]
      # test.RF  <- RF[-inTraining,]
      # 
      # SR = as.data.frame(SR)
      # inTraining <- createDataPartition(SR$Cl.ob, p = .70, list = FALSE)
      # train.SR <- SR[ inTraining,]
      # test.SR  <- SR[-inTraining,]
    }
    #===
    {
      # fitControl <- trainControl(method = "repeatedcv", repeats = 20)
      model.rf.3 <- train(Cl.ob ~ .,data = train.c3, method = 'rf')
      model.rf.4 <- train(Cl.ob ~ .,data = train.c4, method = 'rf')
      model.rf.5 <- train(Cl.ob ~ .,data = train.c5, method = 'rf')
      model.rf.6 <- train(Cl.ob ~ .,data = train.c6, method = 'rf')
      model.rf.7 <- train(Cl.ob ~ .,data = train.c7, method = 'rf')
      model.rf.8 <- train(Cl.ob ~ .,data = train.c8, method = 'rf')
      model.rf.9 <- train(Cl.ob ~ .,data = train.c9, method = 'rf')
      # model.rf.10 <- train(Cl.ob ~ .,data = train.c10, method = 'rf')
      # model.rf.11 <- train(Cl.ob ~ .,data = train.c11, method = 'rf')
      # model.rf.RF <- train(Cl.ob ~ .,data = train.RF, method = 'rf')
      
      model.rf.3$results$RMSE
      model.rf.3$results$MAE
      model.rf.4$results$RMSE
      model.rf.4$results$MAE
      model.rf.5$results$RMSE
      model.rf.5$results$MAE
      model.rf.6$results$RMSE
      model.rf.6$results$MAE
      model.rf.7$results$RMSE
      model.rf.7$results$MAE
      model.rf.8$results$RMSE
      model.rf.8$results$MAE
      model.rf.9$results$RMSE
      model.rf.9$results$MAE
      # model.rf.10$results$RMSE
      # model.rf.10$results$MAE
      # model.rf.11$results$RMSE
      # model.rf.11$results$MAE
      # model.rf.RF$results$RMSE
      # model.rf.RF$results$MAE
      #===
      model.gaussprRadial.3 <- train(Cl.ob ~ .,data = train.c3, method = 'gaussprRadial')
      model.gaussprRadial.4 <- train(Cl.ob ~ .,data = train.c4, method = 'gaussprRadial')
      model.gaussprRadial.5 <- train(Cl.ob ~ .,data = train.c5, method = 'gaussprRadial')
      model.gaussprRadial.6 <- train(Cl.ob ~ .,data = train.c6, method = 'gaussprRadial')
      model.gaussprRadial.7 <- train(Cl.ob ~ .,data = train.c7, method = 'gaussprRadial')
      model.gaussprRadial.8 <- train(Cl.ob ~ .,data = train.c8, method = 'gaussprRadial')
      model.gaussprRadial.9 <- train(Cl.ob ~ .,data = train.c9, method = 'gaussprRadial')
      # model.gaussprRadial.10 <- train(Cl.ob ~ .,data = train.c10, method = 'gaussprRadial')
      # model.gaussprRadial.11 <- train(Cl.ob ~ .,data = train.c11, method = 'gaussprRadial')
      # model.gaussprRadial.GR <- train(Cl.ob ~ .,data = train.GR, method = 'gaussprRadial')
      
      model.gaussprRadial.3$results$RMSE
      model.gaussprRadial.3$results$MAE
      model.gaussprRadial.4$results$RMSE
      model.gaussprRadial.4$results$MAE
      model.gaussprRadial.5$results$RMSE
      model.gaussprRadial.5$results$MAE
      model.gaussprRadial.6$results$RMSE
      model.gaussprRadial.6$results$MAE
      model.gaussprRadial.7$results$RMSE
      model.gaussprRadial.7$results$MAE
      model.gaussprRadial.8$results$RMSE
      model.gaussprRadial.8$results$MAE
      model.gaussprRadial.9$results$RMSE
      model.gaussprRadial.9$results$MAE
      # model.gaussprRadial.10$results$RMSE
      # model.gaussprRadial.10$results$MAE
      # model.gaussprRadial.11$results$RMSE
      # model.gaussprRadial.11$results$MAE
      # model.gaussprRadial.GR$results$RMSE
      # model.gaussprRadial.GR$results$MAE
      #===
      model.svmRadial.3 <- train(Cl.ob ~ .,data = train.c3, method = 'svmRadial')
      model.svmRadial.4 <- train(Cl.ob ~ .,data = train.c4, method = 'svmRadial')
      model.svmRadial.5 <- train(Cl.ob ~ .,data = train.c5, method = 'svmRadial')
      model.svmRadial.6 <- train(Cl.ob ~ .,data = train.c6, method = 'svmRadial')
      model.svmRadial.7 <- train(Cl.ob ~ .,data = train.c7, method = 'svmRadial')
      model.svmRadial.8 <- train(Cl.ob ~ .,data = train.c8, method = 'svmRadial')
      model.svmRadial.9 <- train(Cl.ob ~ .,data = train.c9, method = 'svmRadial')
      # model.svmRadial.10 <- train(Cl.ob ~ .,data = train.c10, method = 'svmRadial')
      # model.svmRadial.11 <- train(Cl.ob ~ .,data = train.c11, method = 'svmRadial')
      # model.svmRadial.SR <- train(Cl.ob ~ .,data = train.SR, method = 'svmRadial')
      
      model.svmRadial.3$results$RMSE
      model.svmRadial.3$results$MAE
      model.svmRadial.4$results$RMSE
      model.svmRadial.4$results$MAE
      model.svmRadial.5$results$RMSE
      model.svmRadial.5$results$MAE
      model.svmRadial.6$results$RMSE
      model.svmRadial.6$results$MAE
      model.svmRadial.7$results$RMSE
      model.svmRadial.7$results$MAE
      model.svmRadial.8$results$RMSE
      model.svmRadial.8$results$MAE
      model.svmRadial.9$results$RMSE
      model.svmRadial.9$results$MAE
      # model.svmRadial.10$results$RMSE
      # model.svmRadial.10$results$MAE
      # model.svmRadial.11$results$RMSE
      # model.svmRadial.11$results$MAE
      # model.svmRadial.SR$results$RMSE
      # model.svmRadial.SR$results$MAE
    }
    #===
    model.cp <- data.frame(Case = c("Rf.3","Rf.4","Rf.5","Rf.6","Rf.7","Rf.8","Rf.9",
                                    "Gaussian Radial.3","Gaussian Radial.4","Gaussian Radial.5","Gaussian Radial.6","Gaussian Radial.7","Gaussian Radial.8","Gaussian Radial.9",
                                    "SVM Radial.3","SVM Radial.4","SVM Radial.5","SVM Radial.6","SVM Radial.7","SVM Radial.8","SVM Radial.9"),
                           RMSE = c(model.rf.3$results$RMSE[1],model.rf.4$results$RMSE[1],model.rf.5$results$RMSE[1],model.rf.6$results$RMSE[1],model.rf.7$results$RMSE[1],model.rf.8$results$RMSE[1],model.rf.9$results$RMSE[1],
                                    model.gaussprRadial.3$results$RMSE,model.gaussprRadial.4$results$RMSE,model.gaussprRadial.5$results$RMSE,model.gaussprRadial.6$results$RMSE,model.gaussprRadial.7$results$RMSE,model.gaussprRadial.8$results$RMSE,model.gaussprRadial.9$results$RMSE,
                                    model.svmRadial.3$results$RMSE[1],model.svmRadial.4$results$RMSE[1],model.svmRadial.5$results$RMSE[1],model.svmRadial.6$results$RMSE[1],model.svmRadial.7$results$RMSE[1],model.svmRadial.8$results$RMSE[1],model.svmRadial.9$results$RMSE[1]),
                           MAE = c(model.rf.3$results$MAE[1],model.rf.4$results$MAE[1],model.rf.5$results$MAE[1],model.rf.6$results$MAE[1],model.rf.7$results$MAE[1],model.rf.8$results$MAE[1],model.rf.9$results$MAE[1],
                                   model.gaussprRadial.3$results$MAE,model.gaussprRadial.4$results$MAE,model.gaussprRadial.5$results$MAE,model.gaussprRadial.6$results$MAE,model.gaussprRadial.7$results$MAE,model.gaussprRadial.8$results$MAE,model.gaussprRadial.9$results$MAE,
                                   model.svmRadial.3$results$MAE[1],model.svmRadial.4$results$MAE[1],model.svmRadial.5$results$MAE[1],model.svmRadial.6$results$MAE[1],model.svmRadial.7$results$MAE[1],model.svmRadial.8$results$MAE[1],model.svmRadial.9$results$MAE[1]))
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  MFselect = do.call(rbind, datalist)
  # write.csv(MFselect, file = "안성.Cl,F&A(Cl포함).csv", na="-", fileEncoding = "CP949")
  MFselect.t = read.csv("안성.Cl,F&A(Cl포함).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  
  { 
    MFselect.t.G = subset(MFselect.t, MFselect.t$Model== "Gaussian Radial")
    MFselect.t.G.3 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.3")
    MFselect.t.G.4 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.4")
    MFselect.t.G.5 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.5")
    MFselect.t.G.6 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.6")
    MFselect.t.G.7 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.7")
    MFselect.t.G.8 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.8")
    MFselect.t.G.9 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.9")
    # MFselect.t.G.10 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.10")
    # MFselect.t.G.11 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.11")
    # MFselect.t.G.GR = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.GR")
    
    MFselect.t.R = subset(MFselect.t, MFselect.t$Model== "Randomforest")
    MFselect.t.R.3 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.3")
    MFselect.t.R.4 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.4")
    MFselect.t.R.5 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.5")
    MFselect.t.R.6 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.6")
    MFselect.t.R.7 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.7")
    MFselect.t.R.8 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.8")
    MFselect.t.R.9 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.9")
    # MFselect.t.R.10 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.10")
    # MFselect.t.R.11 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.11")
    # MFselect.t.R.RF = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.RF")
    
    MFselect.t.S = subset(MFselect.t, MFselect.t$Model== "SVM Radial")
    MFselect.t.S.3 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.3")
    MFselect.t.S.4 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.4")
    MFselect.t.S.5 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.5")
    MFselect.t.S.6 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.6")
    MFselect.t.S.7 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.7")
    MFselect.t.S.8 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.8")
    MFselect.t.S.9 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.9")
    # MFselect.t.S.10 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.10")
    # MFselect.t.S.11 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.11")
    # MFselect.t.S.SR = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.SR")
  }
  {  
    summary(MFselect.t.G.3)
    summary(MFselect.t.G.4)
    summary(MFselect.t.G.5)
    summary(MFselect.t.G.6)
    summary(MFselect.t.G.7)
    summary(MFselect.t.G.8)
    summary(MFselect.t.G.9)
    # summary(MFselect.t.G.10)
    # summary(MFselect.t.G.11)
    # summary(MFselect.t.G.GR)
    
    summary(MFselect.t.R.3)
    summary(MFselect.t.R.4)
    summary(MFselect.t.R.5)
    summary(MFselect.t.R.6)
    summary(MFselect.t.R.7)
    summary(MFselect.t.R.8)
    summary(MFselect.t.R.9)
    # summary(MFselect.t.R.10)
    # summary(MFselect.t.R.11)
    # summary(MFselect.t.R.RF)
    
    summary(MFselect.t.S.3)
    summary(MFselect.t.S.4)
    summary(MFselect.t.S.5)
    summary(MFselect.t.S.6)
    summary(MFselect.t.S.7)
    summary(MFselect.t.S.8)
    summary(MFselect.t.S.9)
    # summary(MFselect.t.S.10)
    # summary(MFselect.t.S.11)
    # summary(MFselect.t.S.SR)
  }
  {  
    MFselect.t = read.csv("안성.Cl,F&A(Cl포함).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    head(MFselect.t)
    MFselect.t = MFselect.t[c(1,3,4,6)]
    head(MFselect.t)
    MFselect.t$Feature = as.character(MFselect.t$Feature)
  }
  {
    MFselect.t$Model <- factor(MFselect.t$Model, levels = c("Gaussian Radial", "Randomforest", "SVM Radial"))
    
    MFselect.t$Feature <- factor(MFselect.t$Feature, levels = c("3","4","5","6","7","8","9"))
    
    # modelnames <- c("BstLm", "Gaussian Radial", "Randomforest", "SVM Radial", "GBM", "GLM")
    
    Feature.plot <- ggplot(data = MFselect.t, aes(x = Feature, y = RMSE, fill = Feature, group = Feature)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(size = 30),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=20),
            axis.text.y = element_text(size=20)) +
      ggtitle("Feature & Algorithm Selection for Cl- prediction (Including Cl)") +
      ylab("RMSE")+xlab("Number of Parameters")+
      # scale_fill_manual(values = c("red3", "orange2", "dodgerblue3", "green4", "purple", "deeppink3"))+
      facet_grid(~Model, scales = "free", space = "free")+
      geom_hline(yintercept = 12.63, color = "red", lty = "dashed", size = 0.8)
    
    # scale_fill_manual(values = c("red2", "red4", "orange", "orange3", "dodgerblue3", "dodgerblue4","green2", "green4"))
    Feature.plot
    c=set_palette(Feature.plot, "Set1")
  }
}
c
#result => Randomforest + 8 features (Cl, EC, ORP, pH, NH3-N, Turbidity, TDS, Temp.)

#Cl 예측 모델에서 Cl 제거 - Feature&Algorithm selection
{
  #Feature & Algorithm
  ti = x34568[c(14,30,34,29,31,27,28,32,26)]
  head(ti)
  
  #Feature combination
  {
    c3 = ti[c(1:4)]
    c4 = ti[c(1:5)]
    c5 = ti[c(1:6)]
    c6 = ti[c(1:7)]
    c7 = ti[c(1:8)]
    c8 = ti[c(1:9)]  
  }
  datalist = list()
  for (i in 1:10) {
    {
      c3 = as.data.frame(c3)
      inTraining <- createDataPartition(c3$Cl.ob, p = .70, list = FALSE)
      train.c3 <- c3[ inTraining,]
      test.c3  <- c3[-inTraining,]
      
      c4 = as.data.frame(c4)
      inTraining <- createDataPartition(c4$Cl.ob, p = .70, list = FALSE)
      train.c4 <- c4[ inTraining,]
      test.c4  <- c4[-inTraining,]
      
      c5 = as.data.frame(c5)
      inTraining <- createDataPartition(c5$Cl.ob, p = .70, list = FALSE)
      train.c5 <- c5[ inTraining,]
      test.c5  <- c5[-inTraining,]
      
      c6 = as.data.frame(c6)
      inTraining <- createDataPartition(c6$Cl.ob, p = .70, list = FALSE)
      train.c6 <- c6[ inTraining,]
      test.c6  <- c6[-inTraining,]
      
      c7 = as.data.frame(c7)
      inTraining <- createDataPartition(c7$Cl.ob, p = .70, list = FALSE)
      train.c7 <- c7[ inTraining,]
      test.c7  <- c7[-inTraining,]
      
      c8 = as.data.frame(c8)
      inTraining <- createDataPartition(c8$Cl.ob, p = .70, list = FALSE)
      train.c8 <- c8[ inTraining,]
      test.c8  <- c8[-inTraining,]
      
      # c9 = as.data.frame(c9)
      # inTraining <- createDataPartition(c9$Cl.ob, p = .70, list = FALSE)
      # train.c9 <- c9[ inTraining,]
      # test.c9  <- c9[-inTraining,]
      
      # c10 = as.data.frame(c10)
      # inTraining <- createDataPartition(c10$Cl.ob, p = .70, list = FALSE)
      # train.c10 <- c10[ inTraining,]
      # test.c10  <- c10[-inTraining,]
      
      # c11 = as.data.frame(c11)
      # inTraining <- createDataPartition(c11$Cl.ob, p = .70, list = FALSE)
      # train.c11 <- c11[ inTraining,]
      # test.c11  <- c11[-inTraining,]
      
      # GR = as.data.frame(GR)
      # inTraining <- createDataPartition(GR$Cl.ob, p = .70, list = FALSE)
      # train.GR <- GR[ inTraining,]
      # test.GR  <- GR[-inTraining,]
      # 
      # RF = as.data.frame(RF)
      # inTraining <- createDataPartition(RF$Cl.ob, p = .70, list = FALSE)
      # train.RF <- RF[ inTraining,]
      # test.RF  <- RF[-inTraining,]
      # 
      # SR = as.data.frame(SR)
      # inTraining <- createDataPartition(SR$Cl.ob, p = .70, list = FALSE)
      # train.SR <- SR[ inTraining,]
      # test.SR  <- SR[-inTraining,]
    }
    #===
    {
      # fitControl <- trainControl(method = "repeatedcv", repeats = 20)
      model.rf.3 <- train(Cl.ob ~ .,data = train.c3, method = 'rf')
      model.rf.4 <- train(Cl.ob ~ .,data = train.c4, method = 'rf')
      model.rf.5 <- train(Cl.ob ~ .,data = train.c5, method = 'rf')
      model.rf.6 <- train(Cl.ob ~ .,data = train.c6, method = 'rf')
      model.rf.7 <- train(Cl.ob ~ .,data = train.c7, method = 'rf')
      model.rf.8 <- train(Cl.ob ~ .,data = train.c8, method = 'rf')
      # model.rf.9 <- train(Cl.ob ~ .,data = train.c9, method = 'rf')
      # model.rf.10 <- train(Cl.ob ~ .,data = train.c10, method = 'rf')
      # model.rf.11 <- train(Cl.ob ~ .,data = train.c11, method = 'rf')
      # model.rf.RF <- train(Cl.ob ~ .,data = train.RF, method = 'rf')
      
      model.rf.3$results$RMSE
      model.rf.3$results$MAE
      model.rf.4$results$RMSE
      model.rf.4$results$MAE
      model.rf.5$results$RMSE
      model.rf.5$results$MAE
      model.rf.6$results$RMSE
      model.rf.6$results$MAE
      model.rf.7$results$RMSE
      model.rf.7$results$MAE
      model.rf.8$results$RMSE
      model.rf.8$results$MAE
      # model.rf.9$results$RMSE
      # model.rf.9$results$MAE
      # model.rf.10$results$RMSE
      # model.rf.10$results$MAE
      # model.rf.11$results$RMSE
      # model.rf.11$results$MAE
      # model.rf.RF$results$RMSE
      # model.rf.RF$results$MAE
      #===
      model.gaussprRadial.3 <- train(Cl.ob ~ .,data = train.c3, method = 'gaussprRadial')
      model.gaussprRadial.4 <- train(Cl.ob ~ .,data = train.c4, method = 'gaussprRadial')
      model.gaussprRadial.5 <- train(Cl.ob ~ .,data = train.c5, method = 'gaussprRadial')
      model.gaussprRadial.6 <- train(Cl.ob ~ .,data = train.c6, method = 'gaussprRadial')
      model.gaussprRadial.7 <- train(Cl.ob ~ .,data = train.c7, method = 'gaussprRadial')
      model.gaussprRadial.8 <- train(Cl.ob ~ .,data = train.c8, method = 'gaussprRadial')
      # model.gaussprRadial.9 <- train(Cl.ob ~ .,data = train.c9, method = 'gaussprRadial')
      # model.gaussprRadial.10 <- train(Cl.ob ~ .,data = train.c10, method = 'gaussprRadial')
      # model.gaussprRadial.11 <- train(Cl.ob ~ .,data = train.c11, method = 'gaussprRadial')
      # model.gaussprRadial.GR <- train(Cl.ob ~ .,data = train.GR, method = 'gaussprRadial')
      
      model.gaussprRadial.3$results$RMSE
      model.gaussprRadial.3$results$MAE
      model.gaussprRadial.4$results$RMSE
      model.gaussprRadial.4$results$MAE
      model.gaussprRadial.5$results$RMSE
      model.gaussprRadial.5$results$MAE
      model.gaussprRadial.6$results$RMSE
      model.gaussprRadial.6$results$MAE
      model.gaussprRadial.7$results$RMSE
      model.gaussprRadial.7$results$MAE
      model.gaussprRadial.8$results$RMSE
      model.gaussprRadial.8$results$MAE
      # model.gaussprRadial.9$results$RMSE
      # model.gaussprRadial.9$results$MAE
      # model.gaussprRadial.10$results$RMSE
      # model.gaussprRadial.10$results$MAE
      # model.gaussprRadial.11$results$RMSE
      # model.gaussprRadial.11$results$MAE
      # model.gaussprRadial.GR$results$RMSE
      # model.gaussprRadial.GR$results$MAE
      #===
      model.svmRadial.3 <- train(Cl.ob ~ .,data = train.c3, method = 'svmRadial')
      model.svmRadial.4 <- train(Cl.ob ~ .,data = train.c4, method = 'svmRadial')
      model.svmRadial.5 <- train(Cl.ob ~ .,data = train.c5, method = 'svmRadial')
      model.svmRadial.6 <- train(Cl.ob ~ .,data = train.c6, method = 'svmRadial')
      model.svmRadial.7 <- train(Cl.ob ~ .,data = train.c7, method = 'svmRadial')
      model.svmRadial.8 <- train(Cl.ob ~ .,data = train.c8, method = 'svmRadial')
      # model.svmRadial.9 <- train(Cl.ob ~ .,data = train.c9, method = 'svmRadial')
      # model.svmRadial.10 <- train(Cl.ob ~ .,data = train.c10, method = 'svmRadial')
      # model.svmRadial.11 <- train(Cl.ob ~ .,data = train.c11, method = 'svmRadial')
      # model.svmRadial.SR <- train(Cl.ob ~ .,data = train.SR, method = 'svmRadial')
      
      model.svmRadial.3$results$RMSE
      model.svmRadial.3$results$MAE
      model.svmRadial.4$results$RMSE
      model.svmRadial.4$results$MAE
      model.svmRadial.5$results$RMSE
      model.svmRadial.5$results$MAE
      model.svmRadial.6$results$RMSE
      model.svmRadial.6$results$MAE
      model.svmRadial.7$results$RMSE
      model.svmRadial.7$results$MAE
      model.svmRadial.8$results$RMSE
      model.svmRadial.8$results$MAE
      # model.svmRadial.9$results$RMSE
      # model.svmRadial.9$results$MAE
      # model.svmRadial.10$results$RMSE
      # model.svmRadial.10$results$MAE
      # model.svmRadial.11$results$RMSE
      # model.svmRadial.11$results$MAE
      # model.svmRadial.SR$results$RMSE
      # model.svmRadial.SR$results$MAE
    }
    #===
    model.cp <- data.frame(Case = c("Rf.3","Rf.4","Rf.5","Rf.6","Rf.7","Rf.8",
                                    "Gaussian Radial.3","Gaussian Radial.4","Gaussian Radial.5","Gaussian Radial.6","Gaussian Radial.7","Gaussian Radial.8",
                                    "SVM Radial.3","SVM Radial.4","SVM Radial.5","SVM Radial.6","SVM Radial.7","SVM Radial.8"),
                           RMSE = c(model.rf.3$results$RMSE[1],model.rf.4$results$RMSE[1],model.rf.5$results$RMSE[1],model.rf.6$results$RMSE[1],model.rf.7$results$RMSE[1],model.rf.8$results$RMSE[1],
                                    model.gaussprRadial.3$results$RMSE,model.gaussprRadial.4$results$RMSE,model.gaussprRadial.5$results$RMSE,model.gaussprRadial.6$results$RMSE,model.gaussprRadial.7$results$RMSE,model.gaussprRadial.8$results$RMSE,
                                    model.svmRadial.3$results$RMSE[1],model.svmRadial.4$results$RMSE[1],model.svmRadial.5$results$RMSE[1],model.svmRadial.6$results$RMSE[1],model.svmRadial.7$results$RMSE[1],model.svmRadial.8$results$RMSE[1]),
                           MAE = c(model.rf.3$results$MAE[1],model.rf.4$results$MAE[1],model.rf.5$results$MAE[1],model.rf.6$results$MAE[1],model.rf.7$results$MAE[1],model.rf.8$results$MAE[1],
                                   model.gaussprRadial.3$results$MAE,model.gaussprRadial.4$results$MAE,model.gaussprRadial.5$results$MAE,model.gaussprRadial.6$results$MAE,model.gaussprRadial.7$results$MAE,model.gaussprRadial.8$results$MAE,
                                   model.svmRadial.3$results$MAE[1],model.svmRadial.4$results$MAE[1],model.svmRadial.5$results$MAE[1],model.svmRadial.6$results$MAE[1],model.svmRadial.7$results$MAE[1],model.svmRadial.8$results$MAE[1]))
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  MFselect = do.call(rbind, datalist)
  # write.csv(MFselect, file = "안성.Cl,F&A(Cl제거).csv", na="-", fileEncoding = "CP949")
  MFselect.t = read.csv("안성.Cl,F&A(Cl제거).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  
  { 
    MFselect.t.G = subset(MFselect.t, MFselect.t$Model== "Gaussian Radial")
    MFselect.t.G.3 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.3")
    MFselect.t.G.4 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.4")
    MFselect.t.G.5 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.5")
    MFselect.t.G.6 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.6")
    MFselect.t.G.7 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.7")
    MFselect.t.G.8 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.8")
    # MFselect.t.G.9 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.9")
    # MFselect.t.G.10 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.10")
    # MFselect.t.G.11 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.11")
    # MFselect.t.G.GR = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.GR")
    
    MFselect.t.R = subset(MFselect.t, MFselect.t$Model== "Randomforest")
    MFselect.t.R.3 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.3")
    MFselect.t.R.4 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.4")
    MFselect.t.R.5 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.5")
    MFselect.t.R.6 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.6")
    MFselect.t.R.7 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.7")
    MFselect.t.R.8 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.8")
    # MFselect.t.R.9 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.9")
    # MFselect.t.R.10 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.10")
    # MFselect.t.R.11 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.11")
    # MFselect.t.R.RF = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.RF")
    
    MFselect.t.S = subset(MFselect.t, MFselect.t$Model== "SVM Radial")
    MFselect.t.S.3 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.3")
    MFselect.t.S.4 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.4")
    MFselect.t.S.5 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.5")
    MFselect.t.S.6 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.6")
    MFselect.t.S.7 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.7")
    MFselect.t.S.8 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.8")
    # MFselect.t.S.9 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.9")
    # MFselect.t.S.10 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.10")
    # MFselect.t.S.11 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.11")
    # MFselect.t.S.SR = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.SR")
  }
  {  
    summary(MFselect.t.G.3)
    summary(MFselect.t.G.4)
    summary(MFselect.t.G.5)
    summary(MFselect.t.G.6)
    summary(MFselect.t.G.7)
    summary(MFselect.t.G.8)
    # summary(MFselect.t.G.9)
    # summary(MFselect.t.G.10)
    # summary(MFselect.t.G.11)
    # summary(MFselect.t.G.GR)
    
    summary(MFselect.t.R.3)
    summary(MFselect.t.R.4)
    summary(MFselect.t.R.5)
    summary(MFselect.t.R.6)
    summary(MFselect.t.R.7)
    summary(MFselect.t.R.8)
    # summary(MFselect.t.R.9)
    # summary(MFselect.t.R.10)
    # summary(MFselect.t.R.11)
    # summary(MFselect.t.R.RF)
    
    summary(MFselect.t.S.3)
    summary(MFselect.t.S.4)
    summary(MFselect.t.S.5)
    summary(MFselect.t.S.6)
    summary(MFselect.t.S.7)
    summary(MFselect.t.S.8)
    # summary(MFselect.t.S.9)
    # summary(MFselect.t.S.10)
    # summary(MFselect.t.S.11)
    # summary(MFselect.t.S.SR)
  }
  {  
    MFselect.t = read.csv("안성.Cl,F&A(Cl제거).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    head(MFselect.t)
    MFselect.t = MFselect.t[c(1,3,4,6)]
    head(MFselect.t)
    MFselect.t$Feature = as.character(MFselect.t$Feature)
  }
  {
    MFselect.t$Model <- factor(MFselect.t$Model, levels = c("Gaussian Radial", "Randomforest", "SVM Radial"))
    
    MFselect.t$Feature <- factor(MFselect.t$Feature, levels = c("3","4","5","6","7","8"))
    
    # modelnames <- c("BstLm", "Gaussian Radial", "Randomforest", "SVM Radial", "GBM", "GLM")
    
    Feature.plot <- ggplot(data = MFselect.t, aes(x = Feature, y = RMSE, fill = Feature, group = Feature)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(size = 30),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=20),
            axis.text.y = element_text(size=20)) +
      ggtitle("Feature & Algorithm Selection for Cl- prediction (Excluding Cl)") +
      ylab("RMSE")+xlab("Number of Parameters")+
      # scale_fill_manual(values = c("red3", "orange2", "dodgerblue3", "green4", "purple", "deeppink3"))+
      facet_grid(~Model, scales = "free", space = "free")+
      geom_hline(yintercept = 13.37, color = "red", lty = "dashed", size = 0.8)
    
    # scale_fill_manual(values = c("red2", "red4", "orange", "orange3", "dodgerblue3", "dodgerblue4","green2", "green4"))
    Feature.plot
  }
  d = set_palette(Feature.plot, "Set1")
}
d
#result => Randomforest + 8 features (EC, NH3-N, ORP, Turbidity, Temp., pH, TDS, Depth)
#===============================================================================
#===============================================================================
#NH3-N 예측모델 개발 => 증강 X
#NH3-N이 포함===================================================================
{
  #Data
  {
    x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
    x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
    x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
    x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
    x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
    x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
    
    x3$Date = as.Date(x3$Date)
    x4$Date = as.Date(x4$Date)
    x5$Date = as.Date(x5$Date)
    x6$Date = as.Date(x6$Date)
    x8$Date = as.Date(x8$Date)
    x34568$Date = as.Date(x34568$Date)
    
    x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
    x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
    # x3$TPH.ob = as.numeric(x3$TPH.ob)
    x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
    x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
    
    x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
    x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
    # x4$TPH.ob = as.numeric(x4$TPH.ob)
    x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
    x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
    
    x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
    x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
    # x5$TPH.ob = as.numeric(x5$TPH.ob)
    x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
    x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
    
    x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
    x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
    # x6$TPH.ob = as.numeric(x6$TPH.ob)
    x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
    x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
    
    x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
    x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
    # x8$TPH.ob = as.numeric(x8$TPH.ob)
    x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
    x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
    
    x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
    x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
    # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
    x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
    x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
    
    head(x3)
    head(x4)
    head(x5)
    head(x6)
    head(x8)
    head(x34568)
    
    ca3 <- read_excel("보정 안성3.xlsx")
    ca4 <- read_excel("보정 안성4.xlsx")
    ca5 <- read_excel("보정 안성5.xlsx")
    ca6 <- read_excel("보정 안성6.xlsx")
    ca8 <- read_excel("보정 안성8.xlsx")
    
    ca3$Date = as.Date(ca3$Date)
    ca4$Date = as.Date(ca4$Date)
    ca5$Date = as.Date(ca5$Date)
    ca6$Date = as.Date(ca6$Date)
    ca8$Date = as.Date(ca8$Date)
    str(ca3)
  }
  ti.4 = x34568[c(1,2,12,34,30,27,36)]
  head(ti.4)
  { 
    head(ti.4)
    px = ti.4
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  
  #Untuned(모델 생성)
  # NH3.N.rf.default = train(NH3.N.ob ~ ., data = train, method = 'rf')
  # NH3.N.rf.default
  # saveRDS(NH3.N.rf.default, "안성통합.rf.NH3-N(NH3-N포함).default.rds")
  NH3.N.rf.default = readRDS("안성통합.rf.NH3-N(NH3-N포함).default.rds")
  NH3.N.rf.default
  
  #Tuned(모델 생성)
  # control <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
  # tunegrid <- expand.grid(.mtry=c(1:4))
  # modellist <- list()
  # for (ntree in c(300, 500, 1000, 1500, 2000, 2500)) {
  #   # set.seed(seed)
  #   NH3.N.rf.tuned <- train(NH3.N.ob~., data=train, method="rf", tuneGrid=tunegrid, trControl=control, ntree=ntree)
  #   key <- toString(ntree)
  #   modellist[[key]] <- NH3.N.rf.tuned
  # }
  # # compare results
  # results <- resamples(modellist)
  # summary(results)
  # dotplot(results)
  # NH3.N.rf.tuned
  # saveRDS(NH3.N.rf.tuned, "안성통합.rf.NH3-N(NH3-N포함).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.rf.NH3-N(NH3-N포함).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.default, test[3:6])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.default, mset[4:7])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[3:6])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[4:7])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x3[c(33,29,26,35)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(x3$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x4[c(33,29,26,35)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(x4$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x5[c(33,29,26,35)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(x5$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x6[c(33,29,26,35)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(x6$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x8[c(33,29,26,35)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(x8$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca3[c(10,6,3,12)])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(ca3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca4[c(10,6,3,12)])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(ca4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca5[c(10,6,3,12)])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(ca5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca6[c(10,6,3,12)])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(ca6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca8[c(10,6,3,12)])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(ca8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test) #튜닝 안한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot1 = Ca(NH3-N o) + ML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot1 = cbind(mset$Site, NH3.N.default.mset, NH3.N.tuned.mset)
    plot1 = as.data.frame(plot1)
    {
      names(plot1)[1] <- c("Site")
      names(plot1)[2] <- c("NH3.N.ob")
      names(plot1)[3] <- c("NH3.N.default.mset")
      names(plot1)[5] <- c("NH3.N.tuned.mset")
    }
    head(plot1)
    
    ca3.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.NH3.N
    
    ca4.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.NH3.N
    
    ca5.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.NH3.N
    
    ca6.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.NH3.N
    
    ca8.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.NH3.N
    
    # expression(NH[3]-N~prediction result~(NH[3]-N O))
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.1 = ggplot(plot1, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle(With~NH[3]-N) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.1
    
    plot1.3 = subset(plot1, plot1$Site == "Site3")
    plot.1.3 = ggplot(plot1.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.1.3
    
    plot1.4 = subset(plot1, plot1$Site == "Site4")
    plot.1.4 = ggplot(plot1.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.1.4
    
    plot1.5 = subset(plot1, plot1$Site == "Site5")
    plot.1.5 = ggplot(plot1.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.1.5
    
    plot1.6 = subset(plot1, plot1$Site == "Site6")
    plot.1.6 = ggplot(plot1.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.1.6
    
    plot1.8 = subset(plot1, plot1$Site == "Site8")
    plot.1.8 = ggplot(plot1.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.1.8
  }
}
#NH3-N이 제거===================================================================
{
  #Data
  {
    x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
    x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
    x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
    x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
    x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
    x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
    
    x3$Date = as.Date(x3$Date)
    x4$Date = as.Date(x4$Date)
    x5$Date = as.Date(x5$Date)
    x6$Date = as.Date(x6$Date)
    x8$Date = as.Date(x8$Date)
    x34568$Date = as.Date(x34568$Date)
    
    x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
    x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
    # x3$TPH.ob = as.numeric(x3$TPH.ob)
    x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
    x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
    
    x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
    x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
    # x4$TPH.ob = as.numeric(x4$TPH.ob)
    x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
    x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
    
    x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
    x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
    # x5$TPH.ob = as.numeric(x5$TPH.ob)
    x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
    x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
    
    x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
    x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
    # x6$TPH.ob = as.numeric(x6$TPH.ob)
    x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
    x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
    
    x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
    x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
    # x8$TPH.ob = as.numeric(x8$TPH.ob)
    x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
    x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
    
    x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
    x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
    # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
    x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
    x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
    
    head(x3)
    head(x4)
    head(x5)
    head(x6)
    head(x8)
    head(x34568)
    
    ca3 <- read_excel("보정 안성3.xlsx")
    ca4 <- read_excel("보정 안성4.xlsx")
    ca5 <- read_excel("보정 안성5.xlsx")
    ca6 <- read_excel("보정 안성6.xlsx")
    ca8 <- read_excel("보정 안성8.xlsx")
    
    ca3$Date = as.Date(ca3$Date)
    ca4$Date = as.Date(ca4$Date)
    ca5$Date = as.Date(ca5$Date)
    ca6$Date = as.Date(ca6$Date)
    ca8$Date = as.Date(ca8$Date)
    str(ca3)
  }
  ti.7 = x34568[c(1,2,12,30,27,32,26,28,31,36)]
  head(ti.7)
  { 
    head(ti.7)
    px = ti.7
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1,2)]
    test = test[-c(1,2)]
  }
  head(train)
  head(test)
  head(mset)
  
  #Untuned(모델 생성)
  # NH3.N.rf.default = train(NH3.N.ob ~ ., data = train, method = 'rf')
  # NH3.N.rf.default
  # saveRDS(NH3.N.rf.default, "안성통합.rf.NH3-N(NH3-N제거).default.rds")
  NH3.N.rf.default = readRDS("안성통합.rf.NH3-N(NH3-N제거).default.rds")
  NH3.N.rf.default
  
  #Tuned(모델 생성)
  # control <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
  # tunegrid <- expand.grid(.mtry=c(1:4))
  # modellist <- list()
  # for (ntree in c(300, 500, 1000, 1500, 2000, 2500)) {
  #   # set.seed(seed)
  #   NH3.N.rf.tuned <- train(NH3.N.ob~., data=train, method="rf", tuneGrid=tunegrid, trControl=control, ntree=ntree)
  #   key <- toString(ntree)
  #   modellist[[key]] <- NH3.N.rf.tuned
  # }
  # # compare results
  # results <- resamples(modellist)
  # summary(results)
  # dotplot(results)
  # NH3.N.rf.tuned
  # saveRDS(NH3.N.rf.tuned, "안성통합.rf.NH3-N(NH3-N제거).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.rf.NH3-N(NH3-N제거).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.default, test[2:8])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.default, mset[4:10])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[2:8])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[4:10])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x3[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(x3$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x4[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(x4$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x5[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(x5$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x6[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(x6$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x8[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(x8$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca3[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(ca3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca4[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(ca4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca5[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(ca5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca6[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(ca6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca8[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(ca8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test) #튜닝 안한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot2 = Ca(NH3-N x) + ML  
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot2 = cbind(mset$Site, NH3.N.default.mset, NH3.N.tuned.mset)
    plot2 = as.data.frame(plot2)
    {
      names(plot2)[1] <- c("Site")
      names(plot2)[2] <- c("NH3.N.ob")
      names(plot2)[3] <- c("NH3.N.default.mset")
      names(plot2)[5] <- c("NH3.N.tuned.mset")
    }
    head(plot2)
    
    ca3.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.NH3.N
    
    ca4.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.NH3.N
    
    ca5.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.NH3.N
    
    ca6.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.NH3.N
    
    ca8.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.NH3.N
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.2 = ggplot(plot2, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle(Without~NH[3]-N) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.2
    
    plot2.3 = subset(plot2, plot2$Site == "Site3")
    plot.2.3 = ggplot(plot2.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.2.3
    
    plot2.4 = subset(plot2, plot2$Site == "Site4")
    plot.2.4 = ggplot(plot2.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.2.4
    
    plot2.5 = subset(plot2, plot2$Site == "Site5")
    plot.2.5 = ggplot(plot2.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.2.5
    
    plot2.6 = subset(plot2, plot2$Site == "Site6")
    plot.2.6 = ggplot(plot2.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.2.6
    
    plot2.8 = subset(plot2, plot2$Site == "Site8")
    plot.2.8 = ggplot(plot2.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.2.8
  }
}

#plot1 = Ca(NH3-N o) + ML
#plot2 = Ca(NH3-N x) + ML  
#===============================================================================
#Cl 예측모델 개발 => 증강 X
#Cl이 포함======================================================================
{
  #Data
  {
    x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
    x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
    x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
    x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
    x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
    x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
    
    x3$Date = as.Date(x3$Date)
    x4$Date = as.Date(x4$Date)
    x5$Date = as.Date(x5$Date)
    x6$Date = as.Date(x6$Date)
    x8$Date = as.Date(x8$Date)
    x34568$Date = as.Date(x34568$Date)
    
    x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
    x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
    # x3$TPH.ob = as.numeric(x3$TPH.ob)
    x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
    x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
    
    x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
    x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
    # x4$TPH.ob = as.numeric(x4$TPH.ob)
    x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
    x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
    
    x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
    x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
    # x5$TPH.ob = as.numeric(x5$TPH.ob)
    x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
    x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
    
    x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
    x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
    # x6$TPH.ob = as.numeric(x6$TPH.ob)
    x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
    x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
    
    x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
    x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
    # x8$TPH.ob = as.numeric(x8$TPH.ob)
    x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
    x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
    
    x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
    x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
    # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
    x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
    x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
    
    head(x3)
    head(x4)
    head(x5)
    head(x6)
    head(x8)
    head(x34568)
    
    ca3 <- read_excel("보정 안성3.xlsx")
    ca4 <- read_excel("보정 안성4.xlsx")
    ca5 <- read_excel("보정 안성5.xlsx")
    ca6 <- read_excel("보정 안성6.xlsx")
    ca8 <- read_excel("보정 안성8.xlsx")
    
    ca3$Date = as.Date(ca3$Date)
    ca4$Date = as.Date(ca4$Date)
    ca5$Date = as.Date(ca5$Date)
    ca6$Date = as.Date(ca6$Date)
    ca8$Date = as.Date(ca8$Date)
    str(ca3)
  }
  
  ti.8 = x34568[c(1,2,14,36,30,29,28,34,31,32,27)]
  head(ti.8)
  { 
    head(ti.8)
    px = ti.8
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1,2)]
    test = test[-c(1,2)]
  }
  head(train)
  head(test)
  head(mset)
  
  #Untuned(모델 생성)
  # Cl.rf.default = train(Cl.ob ~ ., data = train, method = 'rf')
  # Cl.rf.default
  # saveRDS(Cl.rf.default, "안성통합.rf.Cl(Cl포함).default.rds")
  Cl.rf.default = readRDS("안성통합.rf.Cl(Cl포함).default.rds")
  Cl.rf.default
  
  #Tuned(모델 생성)
  # control <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
  # tunegrid <- expand.grid(.mtry=c(1:4))
  # modellist <- list()
  # for (ntree in c(300, 500, 1000, 1500, 2000, 2500)) {
  #   # set.seed(seed)
  #   Cl.rf.tuned <- train(Cl.ob~., data=train, method="rf", tuneGrid=tunegrid, trControl=control, ntree=ntree)
  #   key <- toString(ntree)
  #   modellist[[key]] <- Cl.rf.tuned
  # }
  # # compare results
  # results <- resamples(modellist)
  # summary(results)
  # dotplot(results)
  # Cl.rf.tuned
  # saveRDS(Cl.rf.tuned, "안성통합.rf.Cl(Cl포함).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.rf.Cl(Cl포함).tuned.rds")
  Cl.rf.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.default, test[2:9])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.default, mset[4:11])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:9])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[4:11])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x3[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(x3$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x4[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(x4$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x5[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(x5$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x6[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(x6$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x8[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(x8$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca3[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(ca3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca4[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(ca4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca5[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(ca5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca6[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(ca6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca8[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(ca8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test) #튜닝 안한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot3 = Ca(Cl o) + ML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot3 = cbind(mset$Site, Cl.default.mset, Cl.tuned.mset)
    plot3 = as.data.frame(plot3)
    {
      names(plot3)[1] <- c("Site")
      names(plot3)[2] <- c("Cl.ob")
      names(plot3)[3] <- c("Cl.default.mset")
      names(plot3)[5] <- c("Cl.tuned.mset")
    }
    head(plot3)
    
    ca3.Cl = ggplot() +
      geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.Cl
    
    ca4.Cl = ggplot() +
      geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.Cl
    
    ca5.Cl = ggplot() +
      geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.Cl
    
    ca6.Cl = ggplot() +
      geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.Cl
    
    ca8.Cl = ggplot() +
      geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.Cl
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.3 = ggplot(plot3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle(expression(With~Cl^'-')) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.3
    
    plot3.3 = subset(plot3, plot3$Site == "Site3")
    plot.3.3 = ggplot(plot3.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.3.3
    
    plot3.4 = subset(plot3, plot3$Site == "Site4")
    plot.3.4 = ggplot(plot3.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.3.4
    
    plot3.5 = subset(plot3, plot3$Site == "Site5")
    plot.3.5 = ggplot(plot3.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.3.5
    
    plot3.6 = subset(plot3, plot3$Site == "Site6")
    plot.3.6 = ggplot(plot3.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.3.6
    
    plot3.8 = subset(plot3, plot3$Site == "Site8")
    plot.3.8 = ggplot(plot3.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.3.8
  }
}
#Cl이 제거======================================================================
{
  #Data
  {
    x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
    x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
    x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
    x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
    x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
    x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
    
    x3$Date = as.Date(x3$Date)
    x4$Date = as.Date(x4$Date)
    x5$Date = as.Date(x5$Date)
    x6$Date = as.Date(x6$Date)
    x8$Date = as.Date(x8$Date)
    x34568$Date = as.Date(x34568$Date)
    
    x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
    x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
    # x3$TPH.ob = as.numeric(x3$TPH.ob)
    x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
    x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
    
    x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
    x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
    # x4$TPH.ob = as.numeric(x4$TPH.ob)
    x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
    x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
    
    x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
    x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
    # x5$TPH.ob = as.numeric(x5$TPH.ob)
    x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
    x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
    
    x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
    x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
    # x6$TPH.ob = as.numeric(x6$TPH.ob)
    x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
    x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
    
    x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
    x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
    # x8$TPH.ob = as.numeric(x8$TPH.ob)
    x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
    x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
    
    x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
    x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
    # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
    x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
    x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
    
    head(x3)
    head(x4)
    head(x5)
    head(x6)
    head(x8)
    head(x34568)
    
    ca3 <- read_excel("보정 안성3.xlsx")
    ca4 <- read_excel("보정 안성4.xlsx")
    ca5 <- read_excel("보정 안성5.xlsx")
    ca6 <- read_excel("보정 안성6.xlsx")
    ca8 <- read_excel("보정 안성8.xlsx")
    
    ca3$Date = as.Date(ca3$Date)
    ca4$Date = as.Date(ca4$Date)
    ca5$Date = as.Date(ca5$Date)
    ca6$Date = as.Date(ca6$Date)
    ca8$Date = as.Date(ca8$Date)
    str(ca3)
  }
  
  ti.8 = x34568[c(1,2,14,30,34,29,31,27,28,32,26)]
  head(ti.8)
  { 
    head(ti.8)
    px = ti.8
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1,2)]
    test = test[-c(1,2)]
  }
  head(train)
  head(test)
  head(mset)
  
  #Untuned(모델 생성)
  # Cl.rf.default = train(Cl.ob ~ ., data = train, method = 'rf')
  # Cl.rf.default
  # saveRDS(Cl.rf.default, "안성통합.rf.Cl(Cl제거).default.rds")
  Cl.rf.default = readRDS("안성통합.rf.Cl(Cl제거).default.rds")
  Cl.rf.default
  
  #Tuned(모델 생성)
  # control <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
  # tunegrid <- expand.grid(.mtry=c(1:4))
  # modellist <- list()
  # for (ntree in c(300, 500, 1000, 1500, 2000, 2500)) {
  #   # set.seed(seed)
  #   Cl.rf.tuned <- train(Cl.ob~., data=train, method="rf", tuneGrid=tunegrid, trControl=control, ntree=ntree)
  #   key <- toString(ntree)
  #   modellist[[key]] <- Cl.rf.tuned
  # }
  # # compare results
  # results <- resamples(modellist)
  # summary(results)
  # dotplot(results)
  # Cl.rf.tuned
  # saveRDS(Cl.rf.tuned, "안성통합.rf.Cl(Cl제거).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.rf.Cl(Cl제거).tuned.rds")
  Cl.rf.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.default, test[2:9])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.default, mset[4:11])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:9])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[4:11])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x3[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(x3$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x4[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(x4$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x5[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(x5$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x6[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(x6$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x8[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(x8$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca3[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(ca3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca4[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(ca4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca5[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(ca5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca6[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(ca6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca8[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(ca8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test) #튜닝 안한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot4 = Ca(Cl x) + ML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot4 = cbind(mset$Site, Cl.default.mset, Cl.tuned.mset)
    plot4 = as.data.frame(plot4)
    {
      names(plot4)[1] <- c("Site")
      names(plot4)[2] <- c("Cl.ob")
      names(plot4)[3] <- c("Cl.default.mset")
      names(plot4)[5] <- c("Cl.tuned.mset")
    }
    head(plot4)
    
    ca3.Cl = ggplot() +
      geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.Cl
    
    ca4.Cl = ggplot() +
      geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.Cl
    
    ca5.Cl = ggplot() +
      geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.Cl
    
    ca6.Cl = ggplot() +
      geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.Cl
    
    ca8.Cl = ggplot() +
      geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.Cl
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.4 = ggplot(plot4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle(expression(Without~Cl^'-')) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.4
    
    plot4.3 = subset(plot4, plot4$Site == "Site3")
    plot.4.3 = ggplot(plot4.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.4.3
    
    plot4.4 = subset(plot4, plot4$Site == "Site4")
    plot.4.4 = ggplot(plot4.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.4.4
    
    plot4.5 = subset(plot4, plot4$Site == "Site5")
    plot.4.5 = ggplot(plot4.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.4.5
    
    plot4.6 = subset(plot4, plot4$Site == "Site6")
    plot.4.6 = ggplot(plot4.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.4.6
    
    plot4.8 = subset(plot4, plot4$Site == "Site8")
    plot.4.8 = ggplot(plot4.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.4.8
  }
}
#plot3 = Ca(Cl o) + ML
#plot4 = Ca(Cl x) + ML
#===============================================================================
#===============================================================================
#증강 Augmentation!
#Data
{
  x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
  x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
  x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
  x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
  x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
  x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  x34568$Date = as.Date(x34568$Date)
  
  x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
  x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
  # x3$TPH.ob = as.numeric(x3$TPH.ob)
  x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
  x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
  
  x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
  x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
  # x4$TPH.ob = as.numeric(x4$TPH.ob)
  x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
  x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
  
  x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
  x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
  # x5$TPH.ob = as.numeric(x5$TPH.ob)
  x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
  x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
  
  x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
  x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
  # x6$TPH.ob = as.numeric(x6$TPH.ob)
  x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
  x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
  
  x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
  x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
  # x8$TPH.ob = as.numeric(x8$TPH.ob)
  x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
  x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
  
  x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
  x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
  # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
  x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
  x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
  head(x34568)
  
  ca3 <- read_excel("보정 안성3.xlsx")
  ca4 <- read_excel("보정 안성4.xlsx")
  ca5 <- read_excel("보정 안성5.xlsx")
  ca6 <- read_excel("보정 안성6.xlsx")
  ca8 <- read_excel("보정 안성8.xlsx")
  
  ca3$Date = as.Date(ca3$Date)
  ca4$Date = as.Date(ca4$Date)
  ca5$Date = as.Date(ca5$Date)
  ca6$Date = as.Date(ca6$Date)
  ca8$Date = as.Date(ca8$Date)
  str(ca3)
}

#관정 상관없이 전체를 3배
{
  ti = read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  head(ti)
  ti = ti[c(2,12,14,26:32,34,36)]
  ti = as.data.frame(ti)
  str(ti)
  head(ti)
  
  resample_data <- function(data) {
    resampled_data <- data
    for (i in 1:ncol(data)) {
      resampled_data[, i] <- sample(data[, i], replace = TRUE)
    }
    return(resampled_data)
  }
  
  # Number of times to augment the data
  num_augmentations <- 2
  
  # Create a list to store augmented datasets
  augmented_datasets <- list()
  
  # Perform data augmentation
  for (i in 1:num_augmentations) {
    augmented_datasets[[i]] <- resample_data(ti)
  }
  augmented_data_1 = augmented_datasets[[1]]
  
  combined_augmented_data <- bind_rows(augmented_datasets)
}
# combined_augmented_data = rbind(ti, combined_augmented_data)
# write.csv(combined_augmented_data, file='안성통합 증강2.csv')

#각 관정 데이터 수를 50로 맞추기 (boot)
{
  ti = read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  head(ti)
  ti = ti[c(2,12,14,26:32,34,36)]
  ti = as.data.frame(ti)
  str(ti)
  head(ti)
  
  wellA = subset(ti, ti$Site == "Site3")
  wellB = subset(ti, ti$Site == "Site4")
  wellC = subset(ti, ti$Site == "Site5")
  wellD = subset(ti, ti$Site == "Site6")
  wellE = subset(ti, ti$Site == "Site8")
  
  resample_data <- function(data) {
    resampled_data <- data
    for (i in 1:ncol(data)) {
      resampled_data[, i] <- sample(data[, i], replace = TRUE)
    }
    return(resampled_data)
  }
  
  #Well A
  {
    # Assuming you have a dataset named wellA with 15 data points
    
    # Number of desired data points for Well A
    desired_data_points_wellA <- 50
    
    # Calculate the number of augmentations required to reach 50 data points for Well A
    num_augmentations_needed_wellA <- desired_data_points_wellA - nrow(wellA)
    
    # Create a list to store augmented datasets
    augmented_datasets <- list()
    
    # If Well A dataset has fewer than 50 data points, perform resampling to reach 50
    if (num_augmentations_needed_wellA > 0) {
      augmented_data_wellA <- wellA
      for (i in 1:num_augmentations_needed_wellA) {
        augmented_data_wellA <- rbind(augmented_data_wellA, resample_data(wellA))
      }
      # If the augmented dataset exceeds 50 data points, truncate it to 50
      if (nrow(augmented_data_wellA) > desired_data_points_wellA) {
        augmented_data_wellA <- augmented_data_wellA[1:desired_data_points_wellA, ]
      }
      # Store the augmented data for Well A
      augmented_datasets$wellA <- augmented_data_wellA
    } else {
      # If Well A dataset already has 50 or more data points, no augmentation is needed
      augmented_datasets$wellA <- wellA[1:desired_data_points_wellA, ]
    }
    
    # Combined augmented dataset for Well A
    combined_augmented_data_wellA <- augmented_datasets$wellA
  }
  #Well B
  {
    # Assuming you have a dataset named wellB with 15 data points
    # Number of desired data points for Well A
    desired_data_points_wellB <- 50
    # Calculate the number of augmentations required to reach 50 data points for Well A
    num_augmentations_needed_wellB <- desired_data_points_wellB - nrow(wellB)
    # Create a list to store augmented datasets
    augmented_datasets <- list()
    # If Well A dataset has fewer than 50 data points, perform resampling to reach 50
    if (num_augmentations_needed_wellB > 0) {
      augmented_data_wellB <- wellB
      for (i in 1:num_augmentations_needed_wellB) {
        augmented_data_wellB <- rbind(augmented_data_wellB, resample_data(wellB))
      }
      # If the augmented dataset exceeds 50 data points, truncate it to 50
      if (nrow(augmented_data_wellB) > desired_data_points_wellB) {
        augmented_data_wellB <- augmented_data_wellB[1:desired_data_points_wellB, ]
      }
      # Store the augmented data for Well A
      augmented_datasets$wellB <- augmented_data_wellB
    } else {
      # If Well A dataset already has 50 or more data points, no augmentation is needed
      augmented_datasets$wellB <- wellB[1:desired_data_points_wellB, ]
    }# Combined augmented dataset for Well A
    combined_augmented_data_wellB <- augmented_datasets$wellB
  }
  #Well C
  {
    # Assuming you have a dataset named wellC with 15 data points
    # Number of desired data points for Well A
    desired_data_points_wellC <- 50
    # Calculate the number of augmentations required to reach 50 data points for Well A
    num_augmentations_needed_wellC <- desired_data_points_wellC - nrow(wellC)
    # Create a list to store augmented datasets
    augmented_datasets <- list()
    # If Well A dataset has fewer than 50 data points, perform resampling to reach 50
    if (num_augmentations_needed_wellC > 0) {
      augmented_data_wellC <- wellC
      for (i in 1:num_augmentations_needed_wellC) {
        augmented_data_wellC <- rbind(augmented_data_wellC, resample_data(wellC))
      }
      # If the augmented dataset exceeds 50 data points, truncate it to 50
      if (nrow(augmented_data_wellC) > desired_data_points_wellC) {
        augmented_data_wellC <- augmented_data_wellC[1:desired_data_points_wellC, ]
      }
      # Store the augmented data for Well A
      augmented_datasets$wellC <- augmented_data_wellC
    } else {
      # If Well A dataset already has 50 or more data points, no augmentation is needed
      augmented_datasets$wellC <- wellC[1:desired_data_points_wellC, ]
    }# Combined augmented dataset for Well A
    combined_augmented_data_wellC <- augmented_datasets$wellC
  }
  #Well D
  {
    # Assuming you have a dataset named wellD with 15 data points
    # Number of desired data points for Well A
    desired_data_points_wellD <- 50
    # Calculate the number of augmentations required to reach 50 data points for Well A
    num_augmentations_needed_wellD <- desired_data_points_wellD - nrow(wellD)
    # Create a list to store augmented datasets
    augmented_datasets <- list()
    # If Well A dataset has fewer than 50 data points, perform resampling to reach 50
    if (num_augmentations_needed_wellD > 0) {
      augmented_data_wellD <- wellD
      for (i in 1:num_augmentations_needed_wellD) {
        augmented_data_wellD <- rbind(augmented_data_wellD, resample_data(wellD))
      }
      # If the augmented dataset exceeds 50 data points, truncate it to 50
      if (nrow(augmented_data_wellD) > desired_data_points_wellD) {
        augmented_data_wellD <- augmented_data_wellD[1:desired_data_points_wellD, ]
      }
      # Store the augmented data for Well A
      augmented_datasets$wellD <- augmented_data_wellD
    } else {
      # If Well A dataset already has 50 or more data points, no augmentation is needed
      augmented_datasets$wellD <- wellD[1:desired_data_points_wellD, ]
    }# Combined augmented dataset for Well A
    combined_augmented_data_wellD <- augmented_datasets$wellD
  }
  #Well E
  {
    # Assuming you have a dataset named wellE with 15 data points
    # Number of desired data points for Well A
    desired_data_points_wellE <- 50
    # Calculate the number of augmentations required to reach 50 data points for Well A
    num_augmentations_needed_wellE <- desired_data_points_wellE - nrow(wellE)
    # Create a list to store augmented datasets
    augmented_datasets <- list()
    # If Well A dataset has fewer than 50 data points, perform resampling to reach 50
    if (num_augmentations_needed_wellE > 0) {
      augmented_data_wellE <- wellE
      for (i in 1:num_augmentations_needed_wellE) {
        augmented_data_wellE <- rbind(augmented_data_wellE, resample_data(wellE))
      }
      # If the augmented dataset exceeds 50 data points, truncate it to 50
      if (nrow(augmented_data_wellE) > desired_data_points_wellE) {
        augmented_data_wellE <- augmented_data_wellE[1:desired_data_points_wellE, ]
      }
      # Store the augmented data for Well A
      augmented_datasets$wellE <- augmented_data_wellE
    } else {
      # If Well A dataset already has 50 or more data points, no augmentation is needed
      augmented_datasets$wellE <- wellE[1:desired_data_points_wellE, ]
    }# Combined augmented dataset for Well A
    combined_augmented_data_wellE <- augmented_datasets$wellE
  }
  all_augmented_datasets <- list(
    combined_augmented_data_wellA,
    combined_augmented_data_wellB,
    combined_augmented_data_wellC,
    combined_augmented_data_wellD,
    combined_augmented_data_wellE
  )
  
  # Combine all augmented datasets into a single dataframe
  total <- do.call(rbind, all_augmented_datasets)
  table(total$Site)
  
  # write.csv(total, file='안성통합 증강.csv')
}
# aug = read_excel("안성통합 증강.xlsx")

#각 관정 데이터 수를 50개로 맞추기(AugmenterR)
{
  ti = read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  head(ti)
  ti = ti[-c(1,3:11,13,15:25)]
  ti = as.data.frame(ti)
  str(ti)
  head(ti)
  # GenerateMultipleCandidates(dataset,'class', column,probability,number)
  A = GenerateMultipleCandidates(ti, 'Site3', 1, 0.9, 55) #원본 15개 증강 35개 => 총량을 맞춰야하는거 아님? 총량을 50으로 맞추자!
  head(A)
  B = GenerateMultipleCandidates(ti, 'Site4', 1, 0.9, 33) #원본 17개 증강 33개
  head(B)
  C = GenerateMultipleCandidates(ti, 'Site5', 1, 0.9, 55) #원본 18개 증강 32개
  head(C)
  D = GenerateMultipleCandidates(ti, 'Site6', 1, 0.9, 40) #원본 13개 증강 37개
  head(D)
  E = GenerateMultipleCandidates(ti, 'Site8', 1, 0.9, 20) #원본 35개 증강 15개
  head(E)
  
  ABCDE = rbind(A,B,C,D,E)
  head(ABCDE)
  
  total = rbind(ti, ABCDE)
  head(total)
  ti = total
  head(ti)
}
# write.csv(ti, file='안성통합 증강3.csv')

#===============================================================================
#증강이 통계적으로 다른 데이터가 된 것은 아닌지 통계 분석
{
  #Data
  {
    x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
    x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
    x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
    x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
    x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
    x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
    
    x3$Date = as.Date(x3$Date)
    x4$Date = as.Date(x4$Date)
    x5$Date = as.Date(x5$Date)
    x6$Date = as.Date(x6$Date)
    x8$Date = as.Date(x8$Date)
    x34568$Date = as.Date(x34568$Date)
    
    x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
    x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
    # x3$TPH.ob = as.numeric(x3$TPH.ob)
    x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
    x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
    
    x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
    x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
    # x4$TPH.ob = as.numeric(x4$TPH.ob)
    x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
    x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
    
    x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
    x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
    # x5$TPH.ob = as.numeric(x5$TPH.ob)
    x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
    x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
    
    x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
    x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
    # x6$TPH.ob = as.numeric(x6$TPH.ob)
    x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
    x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
    
    x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
    x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
    # x8$TPH.ob = as.numeric(x8$TPH.ob)
    x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
    x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
    
    x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
    x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
    # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
    x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
    x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
    
    head(x3)
    head(x4)
    head(x5)
    head(x6)
    head(x8)
    head(x34568)
    
    ca3 <- read_excel("보정 안성3.xlsx")
    ca4 <- read_excel("보정 안성4.xlsx")
    ca5 <- read_excel("보정 안성5.xlsx")
    ca6 <- read_excel("보정 안성6.xlsx")
    ca8 <- read_excel("보정 안성8.xlsx")
    
    ca3$Date = as.Date(ca3$Date)
    ca4$Date = as.Date(ca4$Date)
    ca5$Date = as.Date(ca5$Date)
    ca6$Date = as.Date(ca6$Date)
    ca8$Date = as.Date(ca8$Date)
    str(ca3)
    
    aug = read_excel("안성통합 증강2.xlsx")
  }
  # aug = read_excel("안성통합 증강.xlsx")
  aug = read_excel("안성통합 증강2.xlsx")
  head(x34568)
  head(aug)
  
  #ob
  summary(x34568$Cl.ob)
  summary(x34568$NH3.N.ob)
  summary(aug$Cl.ob)
  summary(aug$NH3.N.ob)
  
  shapiro.test(x34568$Cl.ob) #정규성 이루지 않음
  shapiro.test(aug$Cl.ob) #정규성 이루지 않음
  shapiro.test(x34568$NH3.N.ob) #정규성 이루지 않음
  shapiro.test(aug$NH3.N.ob) #정규성 이루지 않음
  
  wilcox.test(x34568$Cl.ob, aug$Cl.ob)
  wilcox.test(x34568$NH3.N.ob, aug$NH3.N.ob)
  
  #ca
  summary(x34568$Cl.ca)
  summary(x34568$Depth.ca)
  summary(x34568$EC.ca)
  summary(x34568$NH3.N.ca)
  summary(x34568$ORP.ca)
  summary(x34568$pH.ca)
  summary(x34568$TDS.ca)
  summary(x34568$Temperature.ca)
  summary(x34568$Turbidity.ca)
  
  summary(aug$Cl.ca)
  summary(aug$Depth.ca)
  summary(aug$EC.ca)
  summary(aug$NH3.N.ca)
  summary(aug$ORP.ca)
  summary(aug$pH.ca)
  summary(aug$TDS.ca)
  summary(aug$Temperature.ca)
  summary(aug$Turbidity.ca)
  
  shapiro.test(x34568$Cl.ca)
  shapiro.test(x34568$Depth.ca)
  shapiro.test(x34568$EC.ca)
  shapiro.test(x34568$NH3.N.ca)
  shapiro.test(x34568$ORP.ca)
  shapiro.test(x34568$pH.ca)
  shapiro.test(x34568$TDS.ca)
  shapiro.test(x34568$Temperature.ca)
  shapiro.test(x34568$Turbidity.ca)
  
  shapiro.test(aug$Cl.ca)
  shapiro.test(aug$Depth.ca)
  shapiro.test(aug$EC.ca)
  shapiro.test(aug$NH3.N.ca)
  shapiro.test(aug$ORP.ca)
  shapiro.test(aug$pH.ca)
  shapiro.test(aug$TDS.ca)
  shapiro.test(aug$Temperature.ca)
  shapiro.test(aug$Turbidity.ca)
  
  wilcox.test(x34568$Cl.ca, aug$Cl.ca)
  wilcox.test(x34568$Depth.ca, aug$Depth.ca)
  wilcox.test(x34568$EC.ca, aug$EC.ca)
  wilcox.test(x34568$NH3.N.ca, aug$NH3.N.ca)
  wilcox.test(x34568$ORP.ca, aug$ORP.ca)
  wilcox.test(x34568$pH.ca, aug$pH.ca)
  wilcox.test(x34568$TDS.ca, aug$TDS.ca)
  wilcox.test(x34568$Temperature.ca, aug$Temperature.ca)
  wilcox.test(x34568$Turbidity.ca, aug$Turbidity.ca)
}
# 교수님과의 디스커션 후 증강을 통계검정 할 필요가 없다????!!!!!!!!!!!!!!!!!!!!!
# 그러면 그냥 50개씩으로 증강한 데이터 사용하자!
# 안성통합 증강3 사용! 

#증강에 대한 density plot
{
  #Histogram
  aug = read_excel("안성통합 증강3.xlsx")
  ggplot(aug, aes(x=NH3.N.ca))+
    geom_histogram(colour = "white", binwidth = 0.5, fill = "black")+
    theme_bw()+
    ylab("Number of data points")+
    xlab(expression(NH[3]-N~(mg/L)))+
    theme(panel.grid= element_blank(),
          axis.title = element_text(size = 25),
          axis.text = element_text(size = 20),
          title = element_text(size=25)) + ylim(0,75) + ggtitle("After augmentation")
  
  ti = read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  ggplot(ti, aes(x=NH3.N.ca))+
    geom_histogram(colour = "white", binwidth = 0.5, fill = "darkgrey")+
    theme_bw()+
    ylab("Number of data points")+
    xlab(expression(NH[3]-N~(mg/L)))+
    theme(panel.grid= element_blank(),
          axis.title = element_text(size = 25),
          axis.text = element_text(size = 20),
          title = element_text(size=25)) + ylim(0,75)+ ggtitle("Before augmentation")
}

#===============================================================================
#===============================================================================
#NH3-N 예측모델 개발 => 증강 O
#Data
{
  x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
  x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
  x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
  x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
  x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
  x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  x34568$Date = as.Date(x34568$Date)
  
  x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
  x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
  # x3$TPH.ob = as.numeric(x3$TPH.ob)
  x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
  x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
  
  x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
  x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
  # x4$TPH.ob = as.numeric(x4$TPH.ob)
  x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
  x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
  
  x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
  x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
  # x5$TPH.ob = as.numeric(x5$TPH.ob)
  x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
  x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
  
  x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
  x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
  # x6$TPH.ob = as.numeric(x6$TPH.ob)
  x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
  x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
  
  x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
  x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
  # x8$TPH.ob = as.numeric(x8$TPH.ob)
  x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
  x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
  
  x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
  x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
  # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
  x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
  x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
  head(x34568)
  
  ca3 <- read_excel("보정 안성3.xlsx")
  ca4 <- read_excel("보정 안성4.xlsx")
  ca5 <- read_excel("보정 안성5.xlsx")
  ca6 <- read_excel("보정 안성6.xlsx")
  ca8 <- read_excel("보정 안성8.xlsx")
  
  ca3$Date = as.Date(ca3$Date)
  ca4$Date = as.Date(ca4$Date)
  ca5$Date = as.Date(ca5$Date)
  ca6$Date = as.Date(ca6$Date)
  ca8$Date = as.Date(ca8$Date)
  str(ca3)
  
  aug = read_excel("안성통합 증강2.xlsx")
}
#NH3-N이 포함===================================================================
{
  aug = read_excel("안성통합 증강3.xlsx")
  head(aug)
  ti.4 = aug[c(1,2,12,8,5,14)]
  head(ti.4)
  { 
    head(ti.4)
    px = ti.4
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  wellA = subset(mset, mset$Site == "Site3")
  wellB = subset(mset, mset$Site == "Site4")
  wellC = subset(mset, mset$Site == "Site5")
  wellD = subset(mset, mset$Site == "Site6")
  wellE = subset(mset, mset$Site == "Site8")
  
  #Untuned(모델 생성)
  # NH3.N.rf.default = train(NH3.N.ob ~ ., data = train, method = 'rf')
  # NH3.N.rf.default
  # saveRDS(NH3.N.rf.default, "안성통합.증강.rf.NH3-N(NH3-N포함).default.rds")
  NH3.N.rf.default = readRDS("안성통합.증강.rf.NH3-N(NH3-N포함).default.rds")
  NH3.N.rf.default
  
  #Tuned(모델 생성)
  # control <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
  # tunegrid <- expand.grid(.mtry=c(1:4))
  # modellist <- list()
  # for (ntree in c(200,300,500,1000)) {
  #   # set.seed(seed)
  #   NH3.N.rf.tuned <- train(NH3.N.ob~., data=train, method="rf", tuneGrid=tunegrid, trControl=control, ntree=ntree)
  #   key <- toString(ntree)
  #   modellist[[key]] <- NH3.N.rf.tuned
  # }
  # # compare results
  # results <- resamples(modellist)
  # summary(results)
  # dotplot(results)
  # NH3.N.rf.tuned
  # saveRDS(NH3.N.rf.tuned, "안성통합.증강.rf.NH3-N(NH3-N포함)(4).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.증강.rf.NH3-N(NH3-N포함)(4).tuned.rds")
  # NH3.N.rf.tuned = readRDS("안성통합.증강.rf.NH3-N(NH3-N포함)(3).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.default, test[2:5])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.default, mset[3:6])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[2:5])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[3:6])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellA[c(3,4,5,6)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(wellA$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellB[c(3,4,5,6)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(wellB$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellC[c(3,4,5,6)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(wellC$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellD[c(3,4,5,6)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(wellD$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellE[c(3,4,5,6)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(wellE$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca3[c(10,6,3,12)])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(ca3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca4[c(10,6,3,12)])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(ca4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca5[c(10,6,3,12)])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(ca5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca6[c(10,6,3,12)])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(ca6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca8[c(10,6,3,12)])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(ca8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test) #튜닝 안한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.default.mset) #튜닝 안한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot5 = Ca(NH3-N o)+증강+ML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot5 = cbind(mset$Site, NH3.N.default.mset, NH3.N.tuned.mset)
    plot5 = as.data.frame(plot5)
    {
      names(plot5)[1] <- c("Site")
      names(plot5)[2] <- c("NH3.N.ob")
      names(plot5)[3] <- c("NH3.N.default.mset")
      names(plot5)[5] <- c("NH3.N.tuned.mset")
    }
    head(plot5)
    
    ca3.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.NH3.N
    
    ca4.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.NH3.N
    
    ca5.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.NH3.N
    
    ca6.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.NH3.N
    
    ca8.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.NH3.N
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.5 = ggplot(plot5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle(With~NH[3]-N) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.5
    
    plot5.3 = subset(plot5, plot5$Site == "Site3")
    plot.5.3 = ggplot(plot5.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.5.3
    
    plot5.4 = subset(plot5, plot5$Site == "Site4")
    plot.5.4 = ggplot(plot5.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.5.4
    
    plot5.5 = subset(plot5, plot5$Site == "Site5")
    plot.5.5 = ggplot(plot5.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.5.5
    
    plot5.6 = subset(plot5, plot5$Site == "Site6")
    plot.5.6 = ggplot(plot5.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.5.6
    
    plot5.8 = subset(plot5, plot5$Site == "Site8")
    plot.5.8 = ggplot(plot5.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2, alpha=100) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.5.8
  }
}
#NH3-N이 제거===================================================================
{
  aug = read_excel("안성통합 증강3.xlsx")
  head(aug)
  ti.7 = aug[c(1,2,8,5,10,4,6,9,14)]
  head(ti.7)
  { 
    head(ti.7)
    px = ti.7
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  wellA = subset(mset, mset$Site == "Site3")
  wellB = subset(mset, mset$Site == "Site4")
  wellC = subset(mset, mset$Site == "Site5")
  wellD = subset(mset, mset$Site == "Site6")
  wellE = subset(mset, mset$Site == "Site8")
  
  #Untuned(모델 생성)
  # NH3.N.rf.default = train(NH3.N.ob ~ ., data = train, method = 'rf')
  # NH3.N.rf.default
  # saveRDS(NH3.N.rf.default, "안성통합.증강.rf.NH3-N(NH3-N제거).default.rds")
  NH3.N.rf.default = readRDS("안성통합.증강.rf.NH3-N(NH3-N제거).default.rds")
  NH3.N.rf.default
  
  #Tuned(모델 생성)
  # control <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
  # tunegrid <- expand.grid(.mtry=c(1.512:4))
  # modellist <- list()
  # for (ntree in c(300, 500, 1000, 1500, 2500)) {
  #   # set.seed(seed)
  #   NH3.N.rf.tuned <- train(NH3.N.ob~., data=train, method="rf", tuneGrid=tunegrid, trControl=control, ntree=ntree)
  #   key <- toString(ntree)
  #   modellist[[key]] <- NH3.N.rf.tuned
  # }
  # # compare results
  # results <- resamples(modellist)
  # summary(results)
  # dotplot(results)
  # NH3.N.rf.tuned
  # saveRDS(NH3.N.rf.tuned, "안성통합.증강.rf.NH3-N(NH3-N제거).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.증강.rf.NH3-N(NH3-N제거).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.default, test[2:8])
    NH3.N.default.test =as.data.frame (pv)
    head(NH3.N.default.test)
    names(NH3.N.default.test)[1] <- c("NH3.N.default.test")
    head(NH3.N.default.test)
    NH3.N.default.test = cbind(test$NH3.N.ob, NH3.N.default.test$NH3.N.default.test)
    NH3.N.default.test = as.data.frame(NH3.N.default.test)
    head(NH3.N.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.default, mset[3:9])
    NH3.N.default.mset =as.data.frame (pv)
    head(NH3.N.default.mset)
    names(NH3.N.default.mset)[1] <- c("NH3.N.default.mset")
    head(NH3.N.default.mset)
    NH3.N.default.mset = cbind(mset$NH3.N.ob, NH3.N.default.mset$NH3.N.default.mset)
    NH3.N.default.mset = as.data.frame(NH3.N.default.mset)
    head(NH3.N.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[2:8])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[3:9])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellA[c(3:9)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(wellA$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellB[c(3:9)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(wellB$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellC[c(3:9)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(wellC$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellD[c(3:9)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(wellD$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellE[c(3:9)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(wellE$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca3[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(ca3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca4[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(ca4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca5[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(ca5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca6[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(ca6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca8[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(ca8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.default.test) #튜닝 안한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.default.mset) #튜닝 안한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot6 = Ca(NH3-N x)+증강+ML  
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot6 = cbind(mset$Site, NH3.N.default.mset, NH3.N.tuned.mset)
    plot6 = as.data.frame(plot6)
    {
      names(plot6)[1] <- c("Site")
      names(plot6)[2] <- c("NH3.N.ob")
      names(plot6)[3] <- c("NH3.N.default.mset")
      names(plot6)[5] <- c("NH3.N.tuned.mset")
    }
    head(plot6)
    
    ca3.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.NH3.N
    
    ca4.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.NH3.N
    
    ca5.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.NH3.N
    
    ca6.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.NH3.N
    
    ca8.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.NH3.N
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.6 = ggplot(plot6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle(Without~NH[3]-N) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.6
    
    plot6.3 = subset(plot6, plot6$Site == "Site3")
    plot.6.3 = ggplot(plot6.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.6.3
    
    plot6.4 = subset(plot6, plot6$Site == "Site4")
    plot.6.4 = ggplot(plot6.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.6.4
    
    plot6.5 = subset(plot6, plot6$Site == "Site5")
    plot.6.5 = ggplot(plot6.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.6.5
    
    plot6.6 = subset(plot6, plot6$Site == "Site6")
    plot.6.6 = ggplot(plot6.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.6.6
    
    plot6.8 = subset(plot6, plot6$Site == "Site8")
    plot.6.8 = ggplot(plot6.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.6.8
  }
}
#plot5 = Ca(NH3-N o)+증강+ML
#plot6 = Ca(NH3-N x)+증강+ML
#===============================================================================
#Cl 예측모델 개발 => 증강 O
#Data
{
  x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
  x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
  x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
  x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
  x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
  x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  x34568$Date = as.Date(x34568$Date)
  
  x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
  x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
  # x3$TPH.ob = as.numeric(x3$TPH.ob)
  x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
  x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
  
  x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
  x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
  # x4$TPH.ob = as.numeric(x4$TPH.ob)
  x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
  x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
  
  x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
  x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
  # x5$TPH.ob = as.numeric(x5$TPH.ob)
  x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
  x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
  
  x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
  x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
  # x6$TPH.ob = as.numeric(x6$TPH.ob)
  x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
  x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
  
  x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
  x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
  # x8$TPH.ob = as.numeric(x8$TPH.ob)
  x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
  x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
  
  x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
  x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
  # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
  x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
  x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
  head(x34568)
  
  ca3 <- read_excel("보정 안성3.xlsx")
  ca4 <- read_excel("보정 안성4.xlsx")
  ca5 <- read_excel("보정 안성5.xlsx")
  ca6 <- read_excel("보정 안성6.xlsx")
  ca8 <- read_excel("보정 안성8.xlsx")
  
  ca3$Date = as.Date(ca3$Date)
  ca4$Date = as.Date(ca4$Date)
  ca5$Date = as.Date(ca5$Date)
  ca6$Date = as.Date(ca6$Date)
  ca8$Date = as.Date(ca8$Date)
  str(ca3)
}
#Cl이 포함======================================================================
{
  aug = read_excel("안성통합 증강3.xlsx")
  head(aug)
  ti.8 = aug[c(1,3,14,8,7,6,12,9,10,5)]
  head(ti.8)
  { 
    head(ti.8)
    px = ti.8
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  wellA = subset(mset, mset$Site == "Site3")
  wellB = subset(mset, mset$Site == "Site4")
  wellC = subset(mset, mset$Site == "Site5")
  wellD = subset(mset, mset$Site == "Site6")
  wellE = subset(mset, mset$Site == "Site8")
  
  #Untuned(모델 생성)
  # Cl.rf.default = train(Cl.ob ~ ., data = train, method = 'rf')
  # Cl.rf.default
  # saveRDS(Cl.rf.default, "안성통합.증강.rf.Cl(Cl포함).default.rds")
  Cl.rf.default = readRDS("안성통합.증강.rf.Cl(Cl포함).default.rds")
  Cl.rf.default
  
  #Tuned(모델 생성)
  # control <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
  # tunegrid <- expand.grid(.mtry=c(1:4))
  # modellist <- list()
  # for (ntree in c(100,300,500,1000)) {
  #   # set.seed(seed)
  #   Cl.rf.tuned <- train(Cl.ob~., data=train, method="rf", tuneGrid=tunegrid, trControl=control, ntree=ntree)
  #   key <- toString(ntree)
  #   modellist[[key]] <- Cl.rf.tuned
  # }
  # # compare results
  # results <- resamples(modellist)
  # summary(results)
  # dotplot(results)
  # Cl.rf.tuned
  # saveRDS(Cl.rf.tuned, "안성통합.증강.rf.Cl(Cl포함).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.증강.rf.Cl(Cl포함).tuned.rds")
  Cl.rf.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.default, test[2:9])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.default, mset[3:10])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:9])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[3:10])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellA[c(3:10)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(wellA$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellB[c(3:10)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(wellB$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellC[c(3:10)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(wellC$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellD[c(3:10)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(wellD$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellE[c(3:10)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(wellE$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca3[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(ca3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca4[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(ca4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca5[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(ca5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca6[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(ca6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca8[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(ca8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test) #튜닝 안한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.default.mset) #튜닝 안한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot7 = Ca(Cl o)+증강+ML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot7 = cbind(mset$Site, Cl.default.mset, Cl.tuned.mset)
    plot7 = as.data.frame(plot7)
    {
      names(plot7)[1] <- c("Site")
      names(plot7)[2] <- c("Cl.ob")
      names(plot7)[3] <- c("Cl.default.mset")
      names(plot7)[5] <- c("Cl.tuned.mset")
    }
    head(plot7)
    
    ca3.Cl = ggplot() +
      geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.Cl
    
    ca4.Cl = ggplot() +
      geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.Cl
    
    ca5.Cl = ggplot() +
      geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.Cl
    
    ca6.Cl = ggplot() +
      geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.Cl
    
    ca8.Cl = ggplot() +
      geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.Cl
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.7 = ggplot(plot7, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle(expression(With~Cl^'-')) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.7
    
    plot7.3 = subset(plot7, plot7$Site == "Site3")
    plot.7.3 = ggplot(plot7.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.7.3
    
    plot7.4 = subset(plot7, plot7$Site == "Site4")
    plot.7.4 = ggplot(plot7.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.7.4
    
    plot7.5 = subset(plot7, plot7$Site == "Site5")
    plot.7.5 = ggplot(plot7.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.7.5
    
    plot7.6 = subset(plot7, plot7$Site == "Site6")
    plot.7.6 = ggplot(plot7.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.7.6
    
    plot7.8 = subset(plot7, plot7$Site == "Site8")
    plot.7.8 = ggplot(plot7.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.7.8
  }
}
#Cl이 제거======================================================================
{
  aug = read_excel("안성통합 증강3.xlsx")
  head(aug)
  ti.8 = aug[c(1,3,8,12,7,9,5,6,10,4)]
  head(ti.8)
  { 
    head(ti.8)
    px = ti.8
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  wellA = subset(mset, mset$Site == "Site3")
  wellB = subset(mset, mset$Site == "Site4")
  wellC = subset(mset, mset$Site == "Site5")
  wellD = subset(mset, mset$Site == "Site6")
  wellE = subset(mset, mset$Site == "Site8")
  
  #Untuned(모델 생성)
  # Cl.rf.default = train(Cl.ob ~ ., data = train, method = 'rf')
  # Cl.rf.default
  # saveRDS(Cl.rf.default, "안성통합.증강.rf.Cl(Cl제거).default.rds")
  Cl.rf.default = readRDS("안성통합.증강.rf.Cl(Cl제거).default.rds")
  Cl.rf.default
  
  #Tuned(모델 생성)
  # control <- trainControl(method="repeatedcv", number=10, repeats=3, search="grid")
  # tunegrid <- expand.grid(.mtry=c(1:4))
  # modellist <- list()
  # for (ntree in c(300, 500, 1000,1500)) {
  #   # set.seed(seed)
  #   Cl.rf.tuned <- train(Cl.ob~., data=train, method="rf", tuneGrid=tunegrid, trControl=control, ntree=ntree)
  #   key <- toString(ntree)
  #   modellist[[key]] <- Cl.rf.tuned
  # }
  # # compare results
  # results <- resamples(modellist)
  # summary(results)
  # dotplot(results)
  # Cl.rf.tuned
  # saveRDS(Cl.rf.tuned, "안성통합.증강.rf.Cl(Cl제거).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.증강.rf.Cl(Cl제거).tuned.rds")
  Cl.rf.tuned
  
  {
    #Default
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.default, test[2:9])
    Cl.default.test =as.data.frame (pv)
    head(Cl.default.test)
    names(Cl.default.test)[1] <- c("Cl.default.test")
    head(Cl.default.test)
    Cl.default.test = cbind(test$Cl.ob, Cl.default.test$Cl.default.test)
    Cl.default.test = as.data.frame(Cl.default.test)
    head(Cl.default.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.default, mset[3:10])
    Cl.default.mset =as.data.frame (pv)
    head(Cl.default.mset)
    names(Cl.default.mset)[1] <- c("Cl.default.mset")
    head(Cl.default.mset)
    Cl.default.mset = cbind(mset$Cl.ob, Cl.default.mset$Cl.default.mset)
    Cl.default.mset = as.data.frame(Cl.default.mset)
    head(Cl.default.mset)
    
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:9])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[3:10])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellA[c(3:10)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(wellA$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellB[c(3:10)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(wellB$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellC[c(3:10)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(wellC$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellD[c(3:10)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(wellD$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellE[c(3:10)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(wellE$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca3[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(ca3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca4[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(ca4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca5[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(ca5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca6[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(ca6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca8[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(ca8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.default.test) #튜닝 안한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.default.mset) #튜닝 안한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot8 = Ca(Cl x)+증강+ML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot8 = cbind(mset$Site, Cl.default.mset, Cl.tuned.mset)
    plot8 = as.data.frame(plot8)
    {
      names(plot8)[1] <- c("Site")
      names(plot8)[2] <- c("Cl.ob")
      names(plot8)[3] <- c("Cl.default.mset")
      names(plot8)[5] <- c("Cl.tuned.mset")
    }
    head(plot8)
    
    ca3.Cl = ggplot() +
      geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.Cl
    
    ca4.Cl = ggplot() +
      geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.Cl
    
    ca5.Cl = ggplot() +
      geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.Cl
    
    ca6.Cl = ggplot() +
      geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.Cl
    
    ca8.Cl = ggplot() +
      geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.Cl
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.8 = ggplot(plot8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle(expression(Without~Cl^'-')) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.8
    
    plot8.3 = subset(plot8, plot8$Site == "Site3")
    plot.8.3 = ggplot(plot8.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.8.3
    
    plot8.4 = subset(plot8, plot8$Site == "Site4")
    plot.8.4 = ggplot(plot8.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.8.4
    
    plot8.5 = subset(plot8, plot8$Site == "Site5")
    plot.8.5 = ggplot(plot8.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.8.5
    
    plot8.6 = subset(plot8, plot8$Site == "Site6")
    plot.8.6 = ggplot(plot8.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.8.6
    
    plot8.8 = subset(plot8, plot8$Site == "Site8")
    plot.8.8 = ggplot(plot8.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.8.8
  }
}
#plot7 = Ca(Cl o)+증강+ML
#plot8 = Ca(Cl x)+증강+ML
#===============================================================================
#===============================================================================
#AutoML
#Data
{
  x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
  x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
  x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
  x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
  x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
  x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  x34568$Date = as.Date(x34568$Date)
  
  x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
  x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
  # x3$TPH.ob = as.numeric(x3$TPH.ob)
  x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
  x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
  
  x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
  x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
  # x4$TPH.ob = as.numeric(x4$TPH.ob)
  x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
  x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
  
  x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
  x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
  # x5$TPH.ob = as.numeric(x5$TPH.ob)
  x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
  x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
  
  x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
  x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
  # x6$TPH.ob = as.numeric(x6$TPH.ob)
  x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
  x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
  
  x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
  x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
  # x8$TPH.ob = as.numeric(x8$TPH.ob)
  x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
  x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
  
  x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
  x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
  # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
  x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
  x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
  head(x34568)
  
  ca3 <- read_excel("보정 안성3.xlsx")
  ca4 <- read_excel("보정 안성4.xlsx")
  ca5 <- read_excel("보정 안성5.xlsx")
  ca6 <- read_excel("보정 안성6.xlsx")
  ca8 <- read_excel("보정 안성8.xlsx")
  
  ca3$Date = as.Date(ca3$Date)
  ca4$Date = as.Date(ca4$Date)
  ca5$Date = as.Date(ca5$Date)
  ca6$Date = as.Date(ca6$Date)
  ca8$Date = as.Date(ca8$Date)
  str(ca3)
}
#Original
#NH3-N이 포함===================================================================
# {
#   "class_name": "ExtraTreesRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": true,
#     "criterion": "mse",
#     "max_features": 0.7,
#     "min_samples_leaf": 0.009017208223328022,
#     "min_samples_split": 0.031067599098338297,
#     "n_estimators": 10
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  ti.4 = x34568[c(1,2,12,34,30,27,36)]
  head(ti.4)
  { 
    head(ti.4)
    px = ti.4
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1,2)]
    test = test[-c(1,2)]
    mset = mset[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  
  #모델 생성
  model <- ranger(NH3.N.ob ~ ., data = train, num.trees = 100, mtry = 0.5,
                  splitrule = "extratrees", min.node.size = 0.009017208223328022, min.split.size  = 0.031067599098338297)
  # model
  # saveRDS(model, "안성통합.AutoML(Extratree).NH3-N(NH3-N포함)(2).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.AutoML(Extratree).NH3-N(NH3-N포함)(2).tuned.rds")
  # NH3.N.rf.tuned = readRDS("안성통합.AutoML(Extratree).NH3-N(NH3-N포함)(1).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[2:5])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[3:6])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x3[c(33,29,26,35)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(x3$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x4[c(33,29,26,35)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(x4$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x5[c(33,29,26,35)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(x5$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x6[c(33,29,26,35)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(x6$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x8[c(33,29,26,35)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(x8$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca3[c(10,6,3,12)])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(ca3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca4[c(10,6,3,12)])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(ca4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca5[c(10,6,3,12)])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(ca5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca6[c(10,6,3,12)])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(ca6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca8[c(10,6,3,12)])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(ca8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot9 = Ca(NH3-N o) + AutoML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot9 = cbind(mset$Site, NH3.N.tuned.mset)
    plot9 = as.data.frame(plot9)
    {
      names(plot9)[1] <- c("Site")
      names(plot9)[2] <- c("NH3.N.ob")
      names(plot9)[3] <- c("NH3.N.tuned.mset")
    }
    head(plot9)
    
    a = as.vector(t(plot9[3]))
    b = as.vector(t(plot9[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    ca3.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.NH3.N
    
    ca4.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.NH3.N
    
    ca5.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.NH3.N
    
    ca6.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.NH3.N
    
    ca8.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.NH3.N
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.9 = ggplot(plot9, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "dodgerblue3")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "dodgerblue3", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="dodgerblue3"),
        axis.text.y.left=element_text(color="dodgerblue3"),
      )+
      ggtitle(expression(NH[3]-N~O/~Augmentation~X)) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.9
    
    plot9.3 = subset(plot9, plot9$Site == "Site3")
    plot.9.3 = ggplot(plot9.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.9.3
    
    plot9.4 = subset(plot9, plot9$Site == "Site4")
    plot.9.4 = ggplot(plot9.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.9.4
    
    plot9.5 = subset(plot9, plot9$Site == "Site5")
    plot.9.5 = ggplot(plot9.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.9.5
    
    plot9.6 = subset(plot9, plot9$Site == "Site6")
    plot.9.6 = ggplot(plot9.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.9.6
    
    plot9.8 = subset(plot9, plot9$Site == "Site8")
    plot.9.8 = ggplot(plot9.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.9.8
  }
}
#plot9 = Ca(NH3-N o)+AutoML
#NH3-N이 제거===================================================================
# {
#   "class_name": "ExtraTreesRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": false,
#     "criterion": "mse",
#     "max_features": 0.4,
#     "min_samples_leaf": 0.01600296187889058,
#     "min_samples_split": 0.015297321160913582,
#     "n_estimators": 25
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  ti.7 = x34568[c(1,2,12,30,27,32,26,28,31,36)]
  head(ti.7)
  { 
    head(ti.7)
    px = ti.7
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1,2)]
    test = test[-c(1,2)]
  }
  head(train)
  head(test)
  head(mset)
  
  #모델 생성
  # model <- ranger(NH3.N.ob ~ ., data = train, num.trees = 70, mtry = 0.4,
  #                 splitrule = "extratrees", min.node.size = 0.01600296187889058, min.split.size  = 0.015297321160913582)
  # model
  # saveRDS(model, "안성통합.AutoML(Extratree).NH3-N(NH3-N제거)(3).tuned.rds")
  # NH3.N.rf.tuned = readRDS("안성통합.AutoML(Extratree).NH3-N(NH3-N제거)(3).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.AutoML(Extratree).NH3-N(NH3-N제거)(2).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[2:8])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[4:10])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x3[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(x3$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x4[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(x4$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x5[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(x5$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x6[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(x6$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, x8[c(29,26,31,25,27,30,35)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(x8$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca3[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(ca3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca4[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(ca4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca5[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(ca5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca6[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(ca6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca8[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(ca8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot10 = Ca(NH3-N x) + AutoML  
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot10 = cbind(mset$Site,NH3.N.tuned.mset)
    plot10 = as.data.frame(plot10)
    {
      names(plot10)[1] <- c("Site")
      names(plot10)[2] <- c("NH3.N.ob")
      names(plot10)[3] <- c("NH3.N.tuned.mset")
    }
    head(plot10)
    
    a = as.vector(t(plot10[3]))
    b = as.vector(t(plot10[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    
    ca3.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.NH3.N
    
    ca4.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.NH3.N
    
    ca5.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.NH3.N
    
    ca6.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.NH3.N
    
    ca8.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.NH3.N
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.10 = ggplot(plot10, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "dodgerblue3")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "dodgerblue3", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="dodgerblue3"),
        axis.text.y.left=element_text(color="dodgerblue3"),
      )+
      ggtitle(expression(NH[3]-N~X/~Augmentation~X)) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.10
    
    plot10.3 = subset(plot10, plot10$Site == "Site3")
    plot.10.3 = ggplot(plot10.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.10.3
    
    plot10.4 = subset(plot10, plot10$Site == "Site4")
    plot.10.4 = ggplot(plot10.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.10.4
    
    plot10.5 = subset(plot10, plot10$Site == "Site5")
    plot.10.5 = ggplot(plot10.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.10.5
    
    plot10.6 = subset(plot10, plot10$Site == "Site6")
    plot.10.6 = ggplot(plot10.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.10.6
    
    plot10.8 = subset(plot10, plot10$Site == "Site8")
    plot.10.8 = ggplot(plot10.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.10.8
  }
}
#plot10 = Ca(NH3-N x)+AutoML
#Cl이 포함======================================================================
# {
#   "class_name": "ExtraTreesRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": false,
#     "criterion": "mse",
#     "max_features": 0.4,
#     "min_samples_leaf": 0.0074478228980205795,
#     "min_samples_split": 0.0012814223889440828,
#     "n_estimators": 400
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  ti.8 = x34568[c(1,2,14,36,30,29,28,34,31,32,27)]
  head(ti.8)
  { 
    head(ti.8)
    px = ti.8
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1,2)]
    test = test[-c(1,2)]
  }
  head(train)
  head(test)
  head(mset)
  
  #모델 생성
  # model <- ranger(Cl.ob ~ ., data = train, num.trees = 400, mtry = 0.4,
  #                 splitrule = "extratrees", min.node.size = 0.0074478228980205795, min.split.size  = 0.0012814223889440828)
  # model
  # saveRDS(model, "안성통합.AutoML(Extratree).Cl(Cl포함)(2).tuned.rds")
  # Cl.rf.tuned = readRDS("안성통합.AutoML(Extratree).Cl(Cl포함)(2).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.AutoML(Extratree).Cl(Cl포함)(1).tuned.rds")
  Cl.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:9])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[4:11])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x3[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(x3$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x4[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(x4$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x5[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(x5$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x6[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(x6$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x8[c(35,29,28,27,33,30,31,26)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(x8$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca3[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(ca3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca4[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(ca4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca5[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(ca5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca6[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(ca6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca8[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(ca8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot11 = Ca(Cl o) + ML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot11 = cbind(mset$Site, Cl.tuned.mset)
    plot11 = as.data.frame(plot11)
    {
      names(plot11)[1] <- c("Site")
      names(plot11)[2] <- c("Cl.ob")
      names(plot11)[3] <- c("Cl.tuned.mset")
    }
    head(plot11)
    
    a = as.vector(t(plot11[3]))
    b = as.vector(t(plot11[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    ca3.Cl = ggplot() +
      geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.Cl
    
    ca4.Cl = ggplot() +
      geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.Cl
    
    ca5.Cl = ggplot() +
      geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.Cl
    
    ca6.Cl = ggplot() +
      geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.Cl
    
    ca8.Cl = ggplot() +
      geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.Cl
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.11 = ggplot(plot11, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Total well / Cl o)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.11
    
    plot11.3 = subset(plot11, plot11$Site == "Site3")
    plot.11.3 = ggplot(plot11.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.11.3
    
    plot11.4 = subset(plot11, plot11$Site == "Site4")
    plot.11.4 = ggplot(plot11.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.11.4
    
    plot11.5 = subset(plot11, plot11$Site == "Site5")
    plot.11.5 = ggplot(plot11.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.11.5
    
    plot11.6 = subset(plot11, plot11$Site == "Site6")
    plot.11.6 = ggplot(plot11.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.11.6
    
    plot11.8 = subset(plot11, plot11$Site == "Site8")
    plot.11.8 = ggplot(plot11.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.11.8
  }
}
#plot11 = Ca(Cl o)+AutoML
#Cl이 제거======================================================================
# {
#   "class_name": "RandomForestRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": false,
#     "criterion": "mse",
#     "max_features": 0.7,
#     "min_samples_leaf": 0.004196633747563344,
#     "min_samples_split": 0.008991789964660124,
#     "n_estimators": 25
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  ti.8 = x34568[c(1,2,14,30,34,29,31,27,28,32,26)]
  head(ti.8)
  { 
    head(ti.8)
    px = ti.8
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1,2)]
    test = test[-c(1,2)]
  }
  head(train)
  head(test)
  head(mset)
  
  # model <- randomForest(Cl.ob ~ .,
  #                       data = train,
  #                       min_samples_leaf = 0.004196633747563344,
  #                       min_samples_split = 0.008991789964660124)
  # saveRDS(model, "안성통합.AutoML(RF).Cl(Cl제거).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.AutoML(RF).Cl(Cl제거).tuned.rds")
  Cl.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:9])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[4:11])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x3[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(x3$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x4[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(x4$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x5[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(x5$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x6[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(x6$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, x8[c(29,33,28,30,26,27,31,25)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(x8$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca3[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(ca3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca4[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(ca4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca5[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(ca5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca6[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(ca6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca8[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(ca8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot12 = Ca(Cl x)+AutoML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot12 = cbind(mset$Site, Cl.tuned.mset)
    plot12 = as.data.frame(plot12)
    {
      names(plot12)[1] <- c("Site")
      names(plot12)[2] <- c("Cl.ob")
      names(plot12)[3] <- c("Cl.tuned.mset")
    }
    head(plot12)
    
    a = as.vector(t(plot12[3]))
    b = as.vector(t(plot12[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    ca3.Cl = ggplot() +
      geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.Cl
    
    ca4.Cl = ggplot() +
      geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.Cl
    
    ca5.Cl = ggplot() +
      geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.Cl
    
    ca6.Cl = ggplot() +
      geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.Cl
    
    ca8.Cl = ggplot() +
      geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.Cl
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.12 = ggplot(plot12, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Total well / Cl o)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.12
    
    plot12.3 = subset(plot12, plot12$Site == "Site3")
    plot.12.3 = ggplot(plot12.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.12.3
    
    plot12.4 = subset(plot12, plot12$Site == "Site4")
    plot.12.4 = ggplot(plot12.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.12.4
    
    plot12.5 = subset(plot12, plot12$Site == "Site5")
    plot.12.5 = ggplot(plot12.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.12.5
    
    plot12.6 = subset(plot12, plot12$Site == "Site6")
    plot.12.6 = ggplot(plot12.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.12.6
    
    plot12.8 = subset(plot12, plot12$Site == "Site8")
    plot.12.8 = ggplot(plot12.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.12.8
  }
}
#plot12 = Ca(Cl x)+AutoML
#===============================================================================
#Augmented
#NH3-N이 포함===================================================================
# {
#   "class_name": "RandomForestRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": true,
#     "criterion": "mse",
#     "max_features": "sqrt",
#     "min_samples_leaf": 0.003466237459044996,
#     "min_samples_split": 0.0075322213975862395,
#     "n_estimators": 25
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  aug = read_excel("안성통합 증강3.xlsx")
  head(aug)
  ti.4 = aug[c(1,2,12,8,5,14)]
  head(ti.4)
  { 
    head(ti.4)
    px = ti.4
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  wellA = subset(mset, mset$Site == "Site3")
  wellB = subset(mset, mset$Site == "Site4")
  wellC = subset(mset, mset$Site == "Site5")
  wellD = subset(mset, mset$Site == "Site6")
  wellE = subset(mset, mset$Site == "Site8")
  
  # model <- randomForest(NH3.N.ob ~ .,
  #                       data = train,
  #                       min_samples_leaf = 0.003466237459044996,
  #                       min_samples_split = 0.0075322213975862395)
  # saveRDS(model, "안성통합.증강.AutoML(RF).NH3-N(NH3-N포함).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.증강.AutoML(RF).NH3-N(NH3-N포함).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[2:5])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[3:6])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellA[c(3,4,5,6)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(wellA$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellB[c(3,4,5,6)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(wellB$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellC[c(3,4,5,6)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(wellC$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellD[c(3,4,5,6)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(wellD$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellE[c(3,4,5,6)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(wellE$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca3[c(10,6,3,12)])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(ca3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca4[c(10,6,3,12)])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(ca4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca5[c(10,6,3,12)])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(ca5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca6[c(10,6,3,12)])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(ca6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca8[c(10,6,3,12)])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(ca8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot13 = Ca(NH3-N o)+증강+AutoML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot13 = cbind(mset$Site, NH3.N.tuned.mset)
    plot13 = as.data.frame(plot13)
    {
      names(plot13)[1] <- c("Site")
      names(plot13)[2] <- c("NH3.N.ob")
      names(plot13)[3] <- c("NH3.N.tuned.mset")
    }
    head(plot13)
    
    a = as.vector(t(plot13[3]))
    b = as.vector(t(plot13[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    
    ca3.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.NH3.N
    
    ca4.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.NH3.N
    
    ca5.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.NH3.N
    
    ca6.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.NH3.N
    
    ca8.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.NH3.N
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.13 = ggplot(plot13, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "dodgerblue3")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "dodgerblue3", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="dodgerblue3"),
        axis.text.y.left=element_text(color="dodgerblue3"),
      )+
      ggtitle(With~NH[3]-N) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.13
    
    plot13.3 = subset(plot13, plot13$Site == "Site3")
    plot.13.3 = ggplot(plot13.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.13.3
    
    plot13.4 = subset(plot13, plot13$Site == "Site4")
    plot.13.4 = ggplot(plot13.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.13.4
    
    plot13.5 = subset(plot13, plot13$Site == "Site5")
    plot.13.5 = ggplot(plot13.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.13.5
    
    plot13.6 = subset(plot13, plot13$Site == "Site6")
    plot.13.6 = ggplot(plot13.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.13.6
    
    plot13.8 = subset(plot13, plot13$Site == "Site8")
    plot.13.8 = ggplot(plot13.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.13.8
  }
}
#plot13 = Ca(NH3-N o)+증강+AutoML
#NH3-N이 제거===================================================================
# {
#   "class_name": "RandomForestRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": true,
#     "criterion": "mse",
#     "max_features": "sqrt",
#     "min_samples_leaf": 0.003466237459044996,
#     "min_samples_split": 0.0075322213975862395,
#     "n_estimators": 25
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  aug = read_excel("안성통합 증강3.xlsx")
  head(aug)
  ti.7 = aug[c(1,2,8,5,10,4,6,9,14)]
  head(ti.7)
  { 
    head(ti.7)
    px = ti.7
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  wellA = subset(mset, mset$Site == "Site3")
  wellB = subset(mset, mset$Site == "Site4")
  wellC = subset(mset, mset$Site == "Site5")
  wellD = subset(mset, mset$Site == "Site6")
  wellE = subset(mset, mset$Site == "Site8")
  
  # model <- randomForest(NH3.N.ob ~ .,
  #                       data = train,
  #                       min_samples_leaf = 0.003466237459044996,
  #                       min_samples_split = 0.0075322213975862395)
  # saveRDS(model, "안성통합.증강.AutoML(RF).NH3-N(NH3-N제거).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.증강.AutoML(RF).NH3-N(NH3-N제거).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[2:8])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[3:9])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellA[c(3:9)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(wellA$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellB[c(3:9)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(wellB$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellC[c(3:9)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(wellC$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellD[c(3:9)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(wellD$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellE[c(3:9)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(wellE$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca3[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n3 =as.data.frame (pv)
    head(NH3.N.tuned.n3)
    names(NH3.N.tuned.n3)[1] <- c("NH3.N.tuned.n3")
    head(NH3.N.tuned.n3)
    NH3.N.tuned.n3 = cbind(ca3[1], NH3.N.tuned.n3)
    head(NH3.N.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca4[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n4 =as.data.frame (pv)
    head(NH3.N.tuned.n4)
    names(NH3.N.tuned.n4)[1] <- c("NH3.N.tuned.n4")
    head(NH3.N.tuned.n4)
    NH3.N.tuned.n4 = cbind(ca4[1], NH3.N.tuned.n4)
    head(NH3.N.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca5[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n5 =as.data.frame (pv)
    head(NH3.N.tuned.n5)
    names(NH3.N.tuned.n5)[1] <- c("NH3.N.tuned.n5")
    head(NH3.N.tuned.n5)
    NH3.N.tuned.n5 = cbind(ca5[1], NH3.N.tuned.n5)
    head(NH3.N.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca6[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n6 =as.data.frame (pv)
    head(NH3.N.tuned.n6)
    names(NH3.N.tuned.n6)[1] <- c("NH3.N.tuned.n6")
    head(NH3.N.tuned.n6)
    NH3.N.tuned.n6 = cbind(ca6[1], NH3.N.tuned.n6)
    head(NH3.N.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, ca8[c(6,3,8,2,4,7,12)])
    NH3.N.tuned.n8 =as.data.frame (pv)
    head(NH3.N.tuned.n8)
    names(NH3.N.tuned.n8)[1] <- c("NH3.N.tuned.n8")
    head(NH3.N.tuned.n8)
    NH3.N.tuned.n8 = cbind(ca8[1], NH3.N.tuned.n8)
    head(NH3.N.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot14 = Ca(NH3-N o)+증강+AutoML  
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot14 = cbind(mset$Site, NH3.N.tuned.mset)
    plot14 = as.data.frame(plot14)
    {
      names(plot14)[1] <- c("Site")
      names(plot14)[2] <- c("NH3.N.ob")
      names(plot14)[3] <- c("NH3.N.tuned.mset")
    }
    head(plot14)
    
    a = as.vector(t(plot14[3]))
    b = as.vector(t(plot14[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    ca3.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n3, aes(x = Date, y = NH3.N.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.NH3.N
    
    ca4.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.NH3.N
    
    ca5.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n5, aes(x = Date, y = NH3.N.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.NH3.N
    
    ca6.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n6, aes(x = Date, y = NH3.N.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.NH3.N
    
    ca8.NH3.N = ggplot() +
      geom_line(data = NH3.N.tuned.n8, aes(x = Date, y = NH3.N.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('NH3-N (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("NH3-N (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.NH3.N
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.14 = ggplot(plot14, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "dodgerblue3")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "dodgerblue3", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="dodgerblue3"),
        axis.text.y.left=element_text(color="dodgerblue3"),
      )+
      ggtitle(Without~NH[3]-N) + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.14
    
    plot14.3 = subset(plot14, plot14$Site == "Site3")
    plot.14.3 = ggplot(plot14.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.14.3
    
    plot14.4 = subset(plot14, plot14$Site == "Site4")
    plot.14.4 = ggplot(plot14.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.14.4
    
    plot14.5 = subset(plot14, plot14$Site == "Site5")
    plot.14.5 = ggplot(plot14.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.14.5
    
    plot14.6 = subset(plot14, plot14$Site == "Site6")
    plot.14.6 = ggplot(plot14.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.14.6
    
    plot14.8 = subset(plot14, plot14$Site == "Site8")
    plot.14.8 = ggplot(plot14.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.14.8
  }
}
#plot14 = Ca(NH3-N x)+증강+AutoML
#Cl이 포함======================================================================
# {
#   "class_name": "RandomForestRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": false,
#     "criterion": "mse",
#     "max_features": 0.7,
#     "min_samples_leaf": 0.004196633747563344,
#     "min_samples_split": 0.008991789964660124,
#     "n_estimators": 25
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  aug = read_excel("안성통합 증강3.xlsx")
  head(aug)
  ti.8 = aug[c(1,3,14,8,7,6,12,9,10,5)]
  head(ti.8)
  { 
    head(ti.8)
    px = ti.8
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  wellA = subset(mset, mset$Site == "Site3")
  wellB = subset(mset, mset$Site == "Site4")
  wellC = subset(mset, mset$Site == "Site5")
  wellD = subset(mset, mset$Site == "Site6")
  wellE = subset(mset, mset$Site == "Site8")
  
  # model <- randomForest(Cl.ob ~ .,
  #                       data = train,
  #                       min_samples_leaf = 0.003466237459044996,
  #                       min_samples_split = 0.0075322213975862395)
  # saveRDS(model, "안성통합.증강.AutoML(RF).Cl(Cl포함).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.증강.AutoML(RF).Cl(Cl포함).tuned.rds")
  Cl.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:9])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[3:10])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellA[c(3:10)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(wellA$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellB[c(3:10)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(wellB$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellC[c(3:10)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(wellC$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellD[c(3:10)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(wellD$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellE[c(3:10)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(wellE$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca3[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(ca3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca4[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(ca4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca5[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(ca5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca6[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(ca6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca8[c(12,6,5,4,10,7,8,3)])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(ca8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot15 = Ca(Cl o)+증강+AutoML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot15 = cbind(mset$Site, Cl.tuned.mset)
    plot15 = as.data.frame(plot15)
    {
      names(plot15)[1] <- c("Site")
      names(plot15)[2] <- c("Cl.ob")
      names(plot15)[3] <- c("Cl.tuned.mset")
    }
    head(plot15)
    
    a = as.vector(t(plot15[3]))
    b = as.vector(t(plot15[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    ca3.Cl = ggplot() +
      geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.Cl
    
    ca4.Cl = ggplot() +
      geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.Cl
    
    ca5.Cl = ggplot() +
      geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.Cl
    
    ca6.Cl = ggplot() +
      geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.Cl
    
    ca8.Cl = ggplot() +
      geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.Cl
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.15 = ggplot(plot15, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "dodgerblue3")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "dodgerblue3", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="dodgerblue3"),
        axis.text.y.left=element_text(color="dodgerblue3"),
      )+
      ggtitle(With~Cl^'-') + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.15
    
    plot15.3 = subset(plot15, plot15$Site == "Site3")
    plot.15.3 = ggplot(plot15.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.15.3
    
    plot15.4 = subset(plot15, plot15$Site == "Site4")
    plot.15.4 = ggplot(plot15.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.15.4
    
    plot15.5 = subset(plot15, plot15$Site == "Site5")
    plot.15.5 = ggplot(plot15.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.15.5
    
    plot15.6 = subset(plot15, plot15$Site == "Site6")
    plot.15.6 = ggplot(plot15.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.15.6
    
    plot15.8 = subset(plot15, plot15$Site == "Site8")
    plot.15.8 = ggplot(plot15.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.15.8
  }
}
# plot15 = Ca(Cl o)+증강+AutoML
#Cl이 제거======================================================================
# {
#   "class_name": "ExtraTreesRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": false,
#     "criterion": "mse",
#     "max_features": 0.4,
#     "min_samples_leaf": 0.001953125,
#     "min_samples_split": 0.000630957344480193,
#     "n_estimators": 10
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  aug = read_excel("안성통합 증강3.xlsx")
  head(aug)
  ti.8 = aug[c(1,3,8,12,7,9,5,6,10,4)]
  head(ti.8)
  { 
    head(ti.8)
    px = ti.8
    px = as.data.frame(px)
    mset = px
    head(mset)
    
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train = train[-c(1)]
    test = test[-c(1)]
  }
  head(train)
  head(test)
  head(mset)
  wellA = subset(mset, mset$Site == "Site3")
  wellB = subset(mset, mset$Site == "Site4")
  wellC = subset(mset, mset$Site == "Site5")
  wellD = subset(mset, mset$Site == "Site6")
  wellE = subset(mset, mset$Site == "Site8")
  
  # model <- ranger(Cl.ob ~ ., data = train, num.trees = 300, mtry = 0.7,
  #                 splitrule = "extratrees", min.node.size = 0.001953125, min.split.size  = 0.000630957344480193)
  # model
  # saveRDS(model, "안성통합.증강.AutoML(ET).Cl(Cl제거).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.증강.AutoML(ET).Cl(Cl제거).tuned.rds")
  Cl.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:9])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[3:10])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellA[c(3:10)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(wellA$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellB[c(3:10)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(wellB$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellC[c(3:10)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(wellC$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellD[c(3:10)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(wellD$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellE[c(3:10)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(wellE$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
    
    #관정통합(관정통합으로 관정3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca3[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n3 =as.data.frame (pv)
    head(Cl.tuned.n3)
    names(Cl.tuned.n3)[1] <- c("Cl.tuned.n3")
    head(Cl.tuned.n3)
    Cl.tuned.n3 = cbind(ca3[1], Cl.tuned.n3)
    head(Cl.tuned.n3)
    
    #관정통합(관정통합으로 관정4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca4[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n4 =as.data.frame (pv)
    head(Cl.tuned.n4)
    names(Cl.tuned.n4)[1] <- c("Cl.tuned.n4")
    head(Cl.tuned.n4)
    Cl.tuned.n4 = cbind(ca4[1], Cl.tuned.n4)
    head(Cl.tuned.n4)
    
    #관정통합(관정통합으로 관정5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca5[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n5 =as.data.frame (pv)
    head(Cl.tuned.n5)
    names(Cl.tuned.n5)[1] <- c("Cl.tuned.n5")
    head(Cl.tuned.n5)
    Cl.tuned.n5 = cbind(ca5[1], Cl.tuned.n5)
    head(Cl.tuned.n5)
    
    #관정통합(관정통합으로 관정6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca6[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n6 =as.data.frame (pv)
    head(Cl.tuned.n6)
    names(Cl.tuned.n6)[1] <- c("Cl.tuned.n6")
    head(Cl.tuned.n6)
    Cl.tuned.n6 = cbind(ca6[1], Cl.tuned.n6)
    head(Cl.tuned.n6)
    
    #관정통합(관정통합으로 관정8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, ca8[c(6,10,5,7,3,4,8,2)])
    Cl.tuned.n8 =as.data.frame (pv)
    head(Cl.tuned.n8)
    names(Cl.tuned.n8)[1] <- c("Cl.tuned.n8")
    head(Cl.tuned.n8)
    Cl.tuned.n8 = cbind(ca8[1], Cl.tuned.n8)
    head(Cl.tuned.n8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot16 = Ca(Cl x)+증강+AutoML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot16 = cbind(mset$Site, Cl.tuned.mset)
    plot16 = as.data.frame(plot16)
    {
      names(plot16)[1] <- c("Site")
      names(plot16)[2] <- c("Cl.ob")
      names(plot16)[3] <- c("Cl.tuned.mset")
    }
    head(plot16)
    
    a = as.vector(t(plot16[3]))
    b = as.vector(t(plot16[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    ca3.Cl = ggplot() +
      geom_line(data = Cl.tuned.n3, aes(x = Date, y = Cl.tuned.n3), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x3, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well3)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca3.Cl
    
    ca4.Cl = ggplot() +
      geom_line(data = Cl.tuned.n4, aes(x = Date, y = Cl.tuned.n4), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x4, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well4)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca4.Cl
    
    ca5.Cl = ggplot() +
      geom_line(data = Cl.tuned.n5, aes(x = Date, y = Cl.tuned.n5), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x5, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well5)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca5.Cl
    
    ca6.Cl = ggplot() +
      geom_line(data = Cl.tuned.n6, aes(x = Date, y = Cl.tuned.n6), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x6, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well6)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca6.Cl
    
    ca8.Cl = ggplot() +
      geom_line(data = Cl.tuned.n8, aes(x = Date, y = Cl.tuned.n8), color = "springgreen4", size = 2, alpha = 0.8) +
      geom_point(data = x8, aes(x = Date, y = Cl.ob), color = "red2", size = 3) +
      xlab('Month') +
      ylab('Cl (mg/L)')+
      #ylim(0,0.3)+ 
      theme(legend.text = element_text(size = 22))+
      theme(panel.background = element_rect(fill="white", color = "black"),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
            axis.title.y = element_text(size=25),
            plot.title = element_text(size = 30),
            legend.text = element_text(size = 25),
            legend.title = element_text(size = 28)) +
      ggtitle("Cl (Well8)") #+ylim(0,1)
    #  scale_x_continuous(breaks = months)
    ca8.Cl
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.16 = ggplot(plot16, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "dodgerblue3")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "dodgerblue3", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="dodgerblue3"),
        axis.text.y.left=element_text(color="dodgerblue3"),
      )+
      ggtitle(Without~Cl^'-') + 
      labs(x='Laboratory-analyzed data', y='Predicted sensor data')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.16
    
    plot16.3 = subset(plot16, plot16$Site == "Site3")
    plot.16.3 = ggplot(plot16.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.16.3
    
    plot16.4 = subset(plot16, plot16$Site == "Site4")
    plot.16.4 = ggplot(plot16.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.16.4
    
    plot16.5 = subset(plot16, plot16$Site == "Site5")
    plot.16.5 = ggplot(plot16.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.16.5
    
    plot16.6 = subset(plot16, plot16$Site == "Site6")
    plot.16.6 = ggplot(plot16.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.16.6
    
    plot16.8 = subset(plot16, plot16$Site == "Site8")
    plot.16.8 = ggplot(plot16.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.16.8
  }
}
# plot16 = Ca(Cl x)+증강+AutoML
#===============================================================================
#===============================================================================
#===============================================================================
#ob 모델 만들기
#Data 
{
  x3 <- read_excel("안성 관정3(ob,pp,ca).xlsx")
  x4 <- read_excel("안성 관정4(ob,pp,ca).xlsx")
  x5 <- read_excel("안성 관정5(ob,pp,ca).xlsx")
  x6 <- read_excel("안성 관정6(ob,pp,ca).xlsx")
  x8 <- read_excel("안성 관정8(ob,pp,ca).xlsx")
  x34568 <- read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  
  x3$Date = as.Date(x3$Date)
  x4$Date = as.Date(x4$Date)
  x5$Date = as.Date(x5$Date)
  x6$Date = as.Date(x6$Date)
  x8$Date = as.Date(x8$Date)
  x34568$Date = as.Date(x34568$Date)
  
  x3$NH3.N.ob = as.numeric(x3$NH3.N.ob)
  x3$NO3.N.ob = as.numeric(x3$NO3.N.ob)
  # x3$TPH.ob = as.numeric(x3$TPH.ob)
  x3$NH3.N.ca = as.numeric(x3$NH3.N.ca)
  x3$NO3.N.ca = as.numeric(x3$NO3.N.ca)
  
  x4$NH3.N.ob = as.numeric(x4$NH3.N.ob)
  x4$NO3.N.ob = as.numeric(x4$NO3.N.ob)
  # x4$TPH.ob = as.numeric(x4$TPH.ob)
  x4$NH3.N.ca = as.numeric(x4$NH3.N.ca)
  x4$NO3.N.ca = as.numeric(x4$NO3.N.ca)
  
  x5$NH3.N.ob = as.numeric(x5$NH3.N.ob)
  x5$NO3.N.ob = as.numeric(x5$NO3.N.ob)
  # x5$TPH.ob = as.numeric(x5$TPH.ob)
  x5$NH3.N.ca = as.numeric(x5$NH3.N.ca)
  x5$NO3.N.ca = as.numeric(x5$NO3.N.ca)
  
  x6$NH3.N.ob = as.numeric(x6$NH3.N.ob)
  x6$NO3.N.ob = as.numeric(x6$NO3.N.ob)
  # x6$TPH.ob = as.numeric(x6$TPH.ob)
  x6$NH3.N.ca = as.numeric(x6$NH3.N.ca)
  x6$NO3.N.ca = as.numeric(x6$NO3.N.ca)
  
  x8$NH3.N.ob = as.numeric(x8$NH3.N.ob)
  x8$NO3.N.ob = as.numeric(x8$NO3.N.ob)
  # x8$TPH.ob = as.numeric(x8$TPH.ob)
  x8$NH3.N.ca = as.numeric(x8$NH3.N.ca)
  x8$NO3.N.ca = as.numeric(x8$NO3.N.ca)
  
  x34568$NH3.N.ob = as.numeric(x34568$NH3.N.ob)
  x34568$NO3.N.ob = as.numeric(x34568$NO3.N.ob)
  # x34568$TPH.ob = as.numeric(x34568$TPH.ob)
  x34568$NH3.N.ca = as.numeric(x34568$NH3.N.ca)
  x34568$NO3.N.ca = as.numeric(x34568$NO3.N.ca)
  
  head(x3)
  head(x4)
  head(x5)
  head(x6)
  head(x8)
  head(x34568)
  
  ca3 <- read_excel("보정 안성3.xlsx")
  ca4 <- read_excel("보정 안성4.xlsx")
  ca5 <- read_excel("보정 안성5.xlsx")
  ca6 <- read_excel("보정 안성6.xlsx")
  ca8 <- read_excel("보정 안성8.xlsx")
  
  ca3$Date = as.Date(ca3$Date)
  ca4$Date = as.Date(ca4$Date)
  ca5$Date = as.Date(ca5$Date)
  ca6$Date = as.Date(ca6$Date)
  ca8$Date = as.Date(ca8$Date)
  str(ca3)
}
{
  ob = read_excel("안성 통합(ob,pp,ca)outlier제거.xlsx")
  head(ob)
  # as.numeric(ob$Depth.ob)
  # as.character(ob$Temperature.ob)
  str(ob)
  
  summary(ob$Cl.ob)
  summary(ob$Depth.ob)
  summary(ob$DO.ob)
  summary(ob$EC.ob)
  summary(ob$NH3.N.ob)
  summary(ob$NO3.N.ob)
  summary(ob$ORP.ob)
  summary(ob$pH.ob)
  summary(ob$Salinity.ob)
  summary(ob$TDS.ob)
  summary(ob$Temperature.ob)
  summary(ob$Turbidity.ob)
  
  {ob$NO3.N.ob[ob$NO3.N.ob %in% "NA"] <- NA}
  head(ob)
  ob = ob[complete.cases(ob), ]
  ob$NO3.N.ob =  as.numeric(ob$NO3.N.ob)
  summary(ob$NO3.N.ob)
}

#근데 생각해보면,,, 수분석에서는 NH3-N 예측모델에 애초에 NH3-N가 들어가는게 말이 안되는거 아냐?
#그니까 NH3-N 유무의 경우를 따질 필요가 없다는거지
#===============================================================================
#Multicollinearity test - NH3-N, Cl -> 다중공선성 검사는 독립변수들간의 상관분석을 통해 강한 상관관계가 있을시 제거를 통해 예측 성능을 높힘
#-> 따라서 예측 대상이 NH3-N 이나 Cl이나 어차피 결과는 같음. 독립변수끼리의 상관분석이기에
{
  head(x34568)
  target_column <- 12
  predictor_columns <- 3:14
  
  # Extract the predictors and response variable
  predictors <- x34568[, predictor_columns]
  response <- x34568[, target_column]
  
  # Calculate the correlation matrix for predictors
  cor_matrix <- cor(predictors,method="spearman")
  
  # Set a threshold for high correlation (e.g., 0.7, but you can adjust as needed)
  high_correlation_threshold <- 0.8
  
  # Find highly correlated predictors
  highly_correlated <- findCorrelation(cor_matrix, cutoff = high_correlation_threshold)
  
  # Display the highly correlated predictor pairs
  print(highly_correlated)
  
  # Remove highly correlated predictors from your dataset (if desired)
  predictors_cleaned <- predictors[,-highly_correlated]
  
  head(predictors_cleaned)
  # Now, you can use 'predictors_cleaned' for your SVM radial regression model
}
#그러면 여기서 Salinity 제거

#수분석 모델링에서는 NH3-N ox, Cl ox를 하지 않습니다.

#NH3-N
{
  head(x34568)
  obdata = x34568[c(3:10,12:14)]
  head(obdata)
  
  obdata = as.data.frame(obdata)
  head(obdata)
  mset = obdata
  head(mset)
  {mset$NO3.N.ob[mset$NO3.N.ob %in% "NA"] <- NA}
  head(mset)
  mset = mset[complete.cases(mset), ]
  inTraining <- createDataPartition(mset$NH3.N.ob, p = .70, list = FALSE)
  train <- mset[ inTraining,]
  test  <- mset[-inTraining,]
  head(train)
  #importance
  fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 10)
  tunegrid <- expand.grid(.mtry=c(1:5))
  
  model.rf.NH3.N <- train(NH3.N.ob ~ ., data = train, method = 'rf', tuneGrid=tunegrid, trControl = fitControl,preProcess = c("center", "scale"),  ntry = 501)
  model.rf.NH3.N
  
  # saveRDS(model.rf.NH3.N, "importance.NH3-N(ob).rds")
  model.rf.NH3.N = readRDS("importance.NH3-N(ob).rds")
  model.rf.NH3.N
  # importance(model.rf.TPH)
  # varImpPlot(model.rf.TPH)
  gbmImp <- varImp(model.rf.NH3.N, scale = FALSE)
  gbmImp
  gbmImp = as.data.frame(gbmImp$importance)
  plot(gbmImp)
  # write.csv(gbmImp, file = "NH3.N.imp.ob.csv", na="-", fileEncoding = "CP949")
  
  imp.ad = read.csv("NH3.N.imp.ob.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  head(imp.ad)
  ord.ad = as.vector(imp.ad$X)
  order(ord.ad)
  new_order7 <- with(imp.ad, reorder(X, Overall, median , na.rm=T))
  # TPH.model.RMSE.plot <- ggplot(data = big_data1.TPH, aes(x = RMSE, y = new_order1, fill = Model)) +
  imp.ad$X=factor(imp.ad$X, levels = rev(ord.ad))
  group_name <- c("Temp.",expression(Cl^'-'),"DO","ORP","pH","Turbidity","Depth","TDS",expression(NO[3]-N),"EC")
  
  brk = ggplot(imp.ad, aes(x=Overall, y=X)) +
    geom_bar(stat = "identity", position = "dodge", fill="dodgerblue3",color = "black", width = 0.7) +
    #  geom_point(shape=16,size=1, color="blue")+
    theme_bw() +
    theme(panel.grid = element_blank(),
          axis.text.y = element_text(size=25),
          axis.text.x = element_text(size=20,angle = 0, vjust = 0.5, hjust =0.5),
          axis.title.y = element_text(size=25),
          axis.title.x = element_text(size=25),
          legend.position = c(0,3),
          legend.text = element_text(size = 25),
          legend.background = element_rect(fill="white", size = 0.5, linetype = "solid", colour = "black"))+
    # scale_x_break(c(60, 350), scales = 0.2)+ #여기서 scales는 양쪽 넓이 비율 지정, break는 잘라버릴 범위 지정
    labs(fill = "")+
    xlab("Importance")+ ylab(~paste("")) +
    scale_y_discrete(labels=group_name)
  brk
}
#===============
#Cl
{
  #importance
  fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 10)
  tunegrid <- expand.grid(.mtry=c(1:5))
  model.rf.Cl <- train(Cl.ob ~ ., data = train, method = 'rf', tuneGrid=tunegrid, trControl = fitControl,preProcess = c("center", "scale"),  ntry = 501)
  model.rf.Cl
  # saveRDS(model.rf.Cl, "importance.Cl(ob).rds")
  model.rf.Cl = readRDS("importance.Cl(ob).rds")
  model.rf.Cl
  # importance(model.rf.TPH)
  # varImpPlot(model.rf.TPH)
  gbmImp <- varImp(model.rf.Cl, scale = FALSE)
  gbmImp
  gbmImp = as.data.frame(gbmImp$importance)
  plot(gbmImp)
  # write.csv(gbmImp, file = "Cl.imp.ob.csv", na="-", fileEncoding = "CP949")
  imp.ad = read.csv("Cl.imp.ob.csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  head(imp.ad)
  ord.ad = as.vector(imp.ad$X)
  order(ord.ad)
  new_order7 <- with(imp.ad, reorder(X, Overall, median , na.rm=T))
  # TPH.model.RMSE.plot <- ggplot(data = big_data1.TPH, aes(x = RMSE, y = new_order1, fill = Model)) +
  imp.ad$X=factor(imp.ad$X, levels = rev(ord.ad))
  brk = ggplot(imp.ad, aes(x=Overall, y=X)) +
    geom_bar(stat = "identity", position = "dodge", fill="dodgerblue3",color = "black", width = 0.7) +
    #  geom_point(shape=16,size=1, color="blue")+
    theme_bw() +
    theme(panel.grid = element_blank(),
          axis.text.y = element_text(size=25),
          axis.text.x = element_text(size=20,angle = 0, vjust = 0.5, hjust =0.5),
          axis.title.y = element_text(size=25),
          axis.title.x = element_text(size=25),
          legend.position = c(0,3),
          legend.text = element_text(size = 25),
          legend.background = element_rect(fill="white", size = 0.5, linetype = "solid", colour = "black"))+
    # scale_x_break(c(60, 350), scales = 0.2)+ #여기서 scales는 양쪽 넓이 비율 지정, break는 잘라버릴 범위 지정
    labs(fill = "")+
    xlab("Importance")+ ylab(~paste("")) 
  brk
}
#===============================================================================
#Feature & Algorithm
#NH3-N
{
  head(x34568)
  obdata = x34568[c(3:10,12:14)]
  {obdata$NO3.N.ob[obdata$NO3.N.ob %in% "NA"] <- NA}
  head(obdata)
  obdata = obdata[complete.cases(obdata), ]
  head(obdata)
  #Feature combination
  obdata.NH3.N = obdata[c(9,5,10,8,1,7,3,4,6,11,2)]
  head(obdata.NH3.N)
  {
    c3 = obdata.NH3.N[c(1:4)]
    c4 = obdata.NH3.N[c(1:5)]
    c5 = obdata.NH3.N[c(1:6)]
    c6 = obdata.NH3.N[c(1:7)]
    c7 = obdata.NH3.N[c(1:8)]
    c8 = obdata.NH3.N[c(1:9)]
    c9 = obdata.NH3.N[c(1:10)]
    c10 = obdata.NH3.N[c(1:11)]   
  }   
  
  datalist = list()
  for (i in 1:10) {
    {
      c3 = as.data.frame(c3)
      inTraining <- createDataPartition(c3$NH3.N.ob, p = .70, list = FALSE)
      train.c3 <- c3[ inTraining,]
      test.c3  <- c3[-inTraining,]
      
      c4 = as.data.frame(c4)
      inTraining <- createDataPartition(c4$NH3.N.ob, p = .70, list = FALSE)
      train.c4 <- c4[ inTraining,]
      test.c4  <- c4[-inTraining,]
      
      c5 = as.data.frame(c5)
      inTraining <- createDataPartition(c5$NH3.N.ob, p = .70, list = FALSE)
      train.c5 <- c5[ inTraining,]
      test.c5  <- c5[-inTraining,]
      
      c6 = as.data.frame(c6)
      inTraining <- createDataPartition(c6$NH3.N.ob, p = .70, list = FALSE)
      train.c6 <- c6[ inTraining,]
      test.c6  <- c6[-inTraining,]
      
      c7 = as.data.frame(c7)
      inTraining <- createDataPartition(c7$NH3.N.ob, p = .70, list = FALSE)
      train.c7 <- c7[ inTraining,]
      test.c7  <- c7[-inTraining,]
      
      c8 = as.data.frame(c8)
      inTraining <- createDataPartition(c8$NH3.N.ob, p = .70, list = FALSE)
      train.c8 <- c8[ inTraining,]
      test.c8  <- c8[-inTraining,]
      
      c9 = as.data.frame(c9)
      inTraining <- createDataPartition(c9$NH3.N.ob, p = .70, list = FALSE)
      train.c9 <- c9[ inTraining,]
      test.c9  <- c9[-inTraining,]
      
      c10 = as.data.frame(c10)
      inTraining <- createDataPartition(c10$NH3.N.ob, p = .70, list = FALSE)
      train.c10 <- c10[ inTraining,]
      test.c10  <- c10[-inTraining,]
      
      # c11 = as.data.frame(c11)
      # inTraining <- createDataPartition(c11$NH3.N.ob, p = .70, list = FALSE)
      # train.c11 <- c11[ inTraining,]
      # test.c11  <- c11[-inTraining,]
      
      # GR = as.data.frame(GR)
      # inTraining <- createDataPartition(GR$NH3.N.ob, p = .70, list = FALSE)
      # train.GR <- GR[ inTraining,]
      # test.GR  <- GR[-inTraining,]
      # 
      # RF = as.data.frame(RF)
      # inTraining <- createDataPartition(RF$NH3.N.ob, p = .70, list = FALSE)
      # train.RF <- RF[ inTraining,]
      # test.RF  <- RF[-inTraining,]
      # 
      # SR = as.data.frame(SR)
      # inTraining <- createDataPartition(SR$NH3.N.ob, p = .70, list = FALSE)
      # train.SR <- SR[ inTraining,]
      # test.SR  <- SR[-inTraining,]
    }
    #===
    {
      # fitControl <- trainControl(method = "repeatedcv", repeats = 20)
      model.rf.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'rf')
      model.rf.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'rf')
      model.rf.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'rf')
      model.rf.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'rf')
      model.rf.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'rf')
      model.rf.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'rf')
      model.rf.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'rf')
      model.rf.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'rf')
      # model.rf.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'rf')
      # model.rf.RF <- train(NH3.N.ob ~ .,data = train.RF, method = 'rf')
      
      model.rf.3$results$RMSE
      model.rf.3$results$MAE
      model.rf.4$results$RMSE
      model.rf.4$results$MAE
      model.rf.5$results$RMSE
      model.rf.5$results$MAE
      model.rf.6$results$RMSE
      model.rf.6$results$MAE
      model.rf.7$results$RMSE
      model.rf.7$results$MAE
      model.rf.8$results$RMSE
      model.rf.8$results$MAE
      model.rf.9$results$RMSE
      model.rf.9$results$MAE
      model.rf.10$results$RMSE
      model.rf.10$results$MAE
      # model.rf.11$results$RMSE
      # model.rf.11$results$MAE
      # model.rf.RF$results$RMSE
      # model.rf.RF$results$MAE
      #===
      model.gaussprRadial.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'gaussprRadial')
      model.gaussprRadial.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'gaussprRadial')
      model.gaussprRadial.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'gaussprRadial')
      model.gaussprRadial.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'gaussprRadial')
      model.gaussprRadial.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'gaussprRadial')
      model.gaussprRadial.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'gaussprRadial')
      model.gaussprRadial.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'gaussprRadial')
      model.gaussprRadial.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'gaussprRadial')
      # model.gaussprRadial.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'gaussprRadial')
      # model.gaussprRadial.GR <- train(NH3.N.ob ~ .,data = train.GR, method = 'gaussprRadial')
      
      model.gaussprRadial.3$results$RMSE
      model.gaussprRadial.3$results$MAE
      model.gaussprRadial.4$results$RMSE
      model.gaussprRadial.4$results$MAE
      model.gaussprRadial.5$results$RMSE
      model.gaussprRadial.5$results$MAE
      model.gaussprRadial.6$results$RMSE
      model.gaussprRadial.6$results$MAE
      model.gaussprRadial.7$results$RMSE
      model.gaussprRadial.7$results$MAE
      model.gaussprRadial.8$results$RMSE
      model.gaussprRadial.8$results$MAE
      model.gaussprRadial.9$results$RMSE
      model.gaussprRadial.9$results$MAE
      model.gaussprRadial.10$results$RMSE
      model.gaussprRadial.10$results$MAE
      # model.gaussprRadial.11$results$RMSE
      # model.gaussprRadial.11$results$MAE
      # model.gaussprRadial.GR$results$RMSE
      # model.gaussprRadial.GR$results$MAE
      #===
      model.svmRadial.3 <- train(NH3.N.ob ~ .,data = train.c3, method = 'svmRadial')
      model.svmRadial.4 <- train(NH3.N.ob ~ .,data = train.c4, method = 'svmRadial')
      model.svmRadial.5 <- train(NH3.N.ob ~ .,data = train.c5, method = 'svmRadial')
      model.svmRadial.6 <- train(NH3.N.ob ~ .,data = train.c6, method = 'svmRadial')
      model.svmRadial.7 <- train(NH3.N.ob ~ .,data = train.c7, method = 'svmRadial')
      model.svmRadial.8 <- train(NH3.N.ob ~ .,data = train.c8, method = 'svmRadial')
      model.svmRadial.9 <- train(NH3.N.ob ~ .,data = train.c9, method = 'svmRadial')
      model.svmRadial.10 <- train(NH3.N.ob ~ .,data = train.c10, method = 'svmRadial')
      # model.svmRadial.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'svmRadial')
      # model.svmRadial.SR <- train(NH3.N.ob ~ .,data = train.SR, method = 'svmRadial')
      
      model.svmRadial.3$results$RMSE
      model.svmRadial.3$results$MAE
      model.svmRadial.4$results$RMSE
      model.svmRadial.4$results$MAE
      model.svmRadial.5$results$RMSE
      model.svmRadial.5$results$MAE
      model.svmRadial.6$results$RMSE
      model.svmRadial.6$results$MAE
      model.svmRadial.7$results$RMSE
      model.svmRadial.7$results$MAE
      model.svmRadial.8$results$RMSE
      model.svmRadial.8$results$MAE
      model.svmRadial.9$results$RMSE
      model.svmRadial.9$results$MAE
      model.svmRadial.10$results$RMSE
      model.svmRadial.10$results$MAE
      # model.svmRadial.11$results$RMSE
      # model.svmRadial.11$results$MAE
      # model.svmRadial.SR$results$RMSE
      # model.svmRadial.SR$results$MAE
    }
    #===
    model.cp <- data.frame(Case = c("Rf.3","Rf.4","Rf.5","Rf.6","Rf.7","Rf.8","Rf.9","Rf.10",
                                    "Gaussian Radial.3","Gaussian Radial.4","Gaussian Radial.5","Gaussian Radial.6","Gaussian Radial.7","Gaussian Radial.8","Gaussian Radial.9","Gaussian Radial.10",
                                    "SVM Radial.3","SVM Radial.4","SVM Radial.5","SVM Radial.6","SVM Radial.7","SVM Radial.8","SVM Radial.9","SVM Radial.10"),
                           RMSE = c(model.rf.3$results$RMSE[1],model.rf.4$results$RMSE[1],model.rf.5$results$RMSE[1],model.rf.6$results$RMSE[1],model.rf.7$results$RMSE[1],model.rf.8$results$RMSE[1],model.rf.9$results$RMSE[1],model.rf.10$results$RMSE[1],
                                    model.gaussprRadial.3$results$RMSE,model.gaussprRadial.4$results$RMSE,model.gaussprRadial.5$results$RMSE,model.gaussprRadial.6$results$RMSE,model.gaussprRadial.7$results$RMSE,model.gaussprRadial.8$results$RMSE,model.gaussprRadial.9$results$RMSE,model.gaussprRadial.10$results$RMSE,
                                    model.svmRadial.3$results$RMSE[1],model.svmRadial.4$results$RMSE[1],model.svmRadial.5$results$RMSE[1],model.svmRadial.6$results$RMSE[1],model.svmRadial.7$results$RMSE[1],model.svmRadial.8$results$RMSE[1],model.svmRadial.9$results$RMSE[1],model.svmRadial.10$results$RMSE[1]),
                           MAE = c(model.rf.3$results$MAE[1],model.rf.4$results$MAE[1],model.rf.5$results$MAE[1],model.rf.6$results$MAE[1],model.rf.7$results$MAE[1],model.rf.8$results$MAE[1],model.rf.9$results$MAE[1],model.rf.10$results$MAE[1],
                                   model.gaussprRadial.3$results$MAE,model.gaussprRadial.4$results$MAE,model.gaussprRadial.5$results$MAE,model.gaussprRadial.6$results$MAE,model.gaussprRadial.7$results$MAE,model.gaussprRadial.8$results$MAE,model.gaussprRadial.9$results$MAE,model.gaussprRadial.10$results$MAE,
                                   model.svmRadial.3$results$MAE[1],model.svmRadial.4$results$MAE[1],model.svmRadial.5$results$MAE[1],model.svmRadial.6$results$MAE[1],model.svmRadial.7$results$MAE[1],model.svmRadial.8$results$MAE[1],model.svmRadial.9$results$MAE[1],model.svmRadial.10$results$MAE[1]))
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  MFselect = do.call(rbind, datalist)
  # write.csv(MFselect, file = "안성.NH3.N,F&A(ob).csv", na="-", fileEncoding = "CP949")
  MFselect.t = read.csv("안성.NH3.N,F&A(ob).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  
  { 
    MFselect.t.G = subset(MFselect.t, MFselect.t$Model== "Gaussian Radial")
    MFselect.t.G.3 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.3")
    MFselect.t.G.4 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.4")
    MFselect.t.G.5 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.5")
    MFselect.t.G.6 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.6")
    MFselect.t.G.7 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.7")
    MFselect.t.G.8 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.8")
    MFselect.t.G.9 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.9")
    MFselect.t.G.10 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.10")
    # MFselect.t.G.11 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.11")
    # MFselect.t.G.GR = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.GR")
    
    MFselect.t.R = subset(MFselect.t, MFselect.t$Model== "Randomforest")
    MFselect.t.R.3 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.3")
    MFselect.t.R.4 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.4")
    MFselect.t.R.5 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.5")
    MFselect.t.R.6 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.6")
    MFselect.t.R.7 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.7")
    MFselect.t.R.8 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.8")
    MFselect.t.R.9 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.9")
    MFselect.t.R.10 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.10")
    # MFselect.t.R.11 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.11")
    # MFselect.t.R.RF = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.RF")
    
    MFselect.t.S = subset(MFselect.t, MFselect.t$Model== "SVM Radial")
    MFselect.t.S.3 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.3")
    MFselect.t.S.4 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.4")
    MFselect.t.S.5 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.5")
    MFselect.t.S.6 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.6")
    MFselect.t.S.7 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.7")
    MFselect.t.S.8 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.8")
    MFselect.t.S.9 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.9")
    MFselect.t.S.10 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.10")
    # MFselect.t.S.11 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.11")
    # MFselect.t.S.SR = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.SR")
  }
  {  
    summary(MFselect.t.G.3)
    summary(MFselect.t.G.4)
    summary(MFselect.t.G.5)
    summary(MFselect.t.G.6)
    summary(MFselect.t.G.7)
    summary(MFselect.t.G.8)
    summary(MFselect.t.G.9)
    # summary(MFselect.t.G.10)
    # summary(MFselect.t.G.11)
    # summary(MFselect.t.G.GR)
    
    summary(MFselect.t.R.3)
    summary(MFselect.t.R.4)
    summary(MFselect.t.R.5)
    summary(MFselect.t.R.6)
    summary(MFselect.t.R.7)
    summary(MFselect.t.R.8)
    summary(MFselect.t.R.9)
    # summary(MFselect.t.R.10)
    # summary(MFselect.t.R.11)
    # summary(MFselect.t.R.RF)
    
    summary(MFselect.t.S.3)
    summary(MFselect.t.S.4)
    summary(MFselect.t.S.5)
    summary(MFselect.t.S.6)
    summary(MFselect.t.S.7)
    summary(MFselect.t.S.8)
    summary(MFselect.t.S.9)
    # summary(MFselect.t.S.10)
    # summary(MFselect.t.S.11)
    # summary(MFselect.t.S.SR)
  }
  {  
    MFselect.t = read.csv("안성.NH3.N,F&A(ob).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    head(MFselect.t)
    MFselect.t = MFselect.t[c(1,3,4,6)]
    head(MFselect.t)
    MFselect.t$Feature = as.character(MFselect.t$Feature)
  }
  {
    MFselect.t$Model <- factor(MFselect.t$Model, levels = c("Gaussian Radial", "Randomforest", "SVM Radial"))
    
    MFselect.t$Feature <- factor(MFselect.t$Feature, levels = c("3","4","5","6","7","8","9","10"))
    
    Feature.plot <- ggplot(data = MFselect.t, aes(x = Feature, y = RMSE, fill = Feature, group = Feature)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(size = 30),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=20),
            axis.text.y = element_text(size=20)) +
      ggtitle("Feature & Algorithm Selection for NH3-N prediction (ob)") +
      ylab("RMSE")+xlab("Number of Parameters")+
      # scale_fill_manual(values = c("red3", "orange2", "dodgerblue3", "green4", "purple", "deeppink3"))+
      facet_grid(~Model, scales = "free", space = "free")+
      geom_hline(yintercept = 1.0555, color = "red", lty = "dashed", size = 0.8)
    
    # scale_fill_manual(values = c("red2", "red4", "orange", "orange3", "dodgerblue3", "dodgerblue4","green2", "green4"))
    Feature.plot
  }
  
  e=set_palette(Feature.plot, "Set1")
}
e
#SVM Radial + 4(EC, NO3-N, TDS, Depth)
#===============
#Cl
{
  head(x34568)
  obdata = x34568[c(3:10,12:14)]
  {obdata$NO3.N.ob[obdata$NO3.N.ob %in% "NA"] <- NA}
  head(obdata)
  obdata = obdata[complete.cases(obdata), ]
  head(obdata)
  #Feature combination
  obdata.Cl = obdata[c(11,6,10,4,8,5,7,2,3,9,1)]
  head(obdata.Cl)
  {
    c3 = obdata.Cl[c(1:4)]
    c4 = obdata.Cl[c(1:5)]
    c5 = obdata.Cl[c(1:6)]
    c6 = obdata.Cl[c(1:7)]
    c7 = obdata.Cl[c(1:8)]
    c8 = obdata.Cl[c(1:9)]
    c9 = obdata.Cl[c(1:10)]
    c10 = obdata.Cl[c(1:11)]   
  }   
  
  datalist = list()
  for (i in 1:10) {
    {
      c3 = as.data.frame(c3)
      inTraining <- createDataPartition(c3$Cl.ob, p = .70, list = FALSE)
      train.c3 <- c3[ inTraining,]
      test.c3  <- c3[-inTraining,]
      
      c4 = as.data.frame(c4)
      inTraining <- createDataPartition(c4$Cl.ob, p = .70, list = FALSE)
      train.c4 <- c4[ inTraining,]
      test.c4  <- c4[-inTraining,]
      
      c5 = as.data.frame(c5)
      inTraining <- createDataPartition(c5$Cl.ob, p = .70, list = FALSE)
      train.c5 <- c5[ inTraining,]
      test.c5  <- c5[-inTraining,]
      
      c6 = as.data.frame(c6)
      inTraining <- createDataPartition(c6$Cl.ob, p = .70, list = FALSE)
      train.c6 <- c6[ inTraining,]
      test.c6  <- c6[-inTraining,]
      
      c7 = as.data.frame(c7)
      inTraining <- createDataPartition(c7$Cl.ob, p = .70, list = FALSE)
      train.c7 <- c7[ inTraining,]
      test.c7  <- c7[-inTraining,]
      
      c8 = as.data.frame(c8)
      inTraining <- createDataPartition(c8$Cl.ob, p = .70, list = FALSE)
      train.c8 <- c8[ inTraining,]
      test.c8  <- c8[-inTraining,]
      
      c9 = as.data.frame(c9)
      inTraining <- createDataPartition(c9$Cl.ob, p = .70, list = FALSE)
      train.c9 <- c9[ inTraining,]
      test.c9  <- c9[-inTraining,]
      
      c10 = as.data.frame(c10)
      inTraining <- createDataPartition(c10$Cl.ob, p = .70, list = FALSE)
      train.c10 <- c10[ inTraining,]
      test.c10  <- c10[-inTraining,]
      
      # c11 = as.data.frame(c11)
      # inTraining <- createDataPartition(c11$NH3.N.ob, p = .70, list = FALSE)
      # train.c11 <- c11[ inTraining,]
      # test.c11  <- c11[-inTraining,]
      
      # GR = as.data.frame(GR)
      # inTraining <- createDataPartition(GR$NH3.N.ob, p = .70, list = FALSE)
      # train.GR <- GR[ inTraining,]
      # test.GR  <- GR[-inTraining,]
      # 
      # RF = as.data.frame(RF)
      # inTraining <- createDataPartition(RF$NH3.N.ob, p = .70, list = FALSE)
      # train.RF <- RF[ inTraining,]
      # test.RF  <- RF[-inTraining,]
      # 
      # SR = as.data.frame(SR)
      # inTraining <- createDataPartition(SR$NH3.N.ob, p = .70, list = FALSE)
      # train.SR <- SR[ inTraining,]
      # test.SR  <- SR[-inTraining,]
    }
    #===
    {
      # fitControl <- trainControl(method = "repeatedcv", repeats = 20)
      model.rf.3 <- train(Cl.ob ~ .,data = train.c3, method = 'rf')
      model.rf.4 <- train(Cl.ob ~ .,data = train.c4, method = 'rf')
      model.rf.5 <- train(Cl.ob ~ .,data = train.c5, method = 'rf')
      model.rf.6 <- train(Cl.ob ~ .,data = train.c6, method = 'rf')
      model.rf.7 <- train(Cl.ob ~ .,data = train.c7, method = 'rf')
      model.rf.8 <- train(Cl.ob ~ .,data = train.c8, method = 'rf')
      model.rf.9 <- train(Cl.ob ~ .,data = train.c9, method = 'rf')
      model.rf.10 <- train(Cl.ob ~ .,data = train.c10, method = 'rf')
      # model.rf.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'rf')
      # model.rf.RF <- train(NH3.N.ob ~ .,data = train.RF, method = 'rf')
      
      model.rf.3$results$RMSE
      model.rf.3$results$MAE
      model.rf.4$results$RMSE
      model.rf.4$results$MAE
      model.rf.5$results$RMSE
      model.rf.5$results$MAE
      model.rf.6$results$RMSE
      model.rf.6$results$MAE
      model.rf.7$results$RMSE
      model.rf.7$results$MAE
      model.rf.8$results$RMSE
      model.rf.8$results$MAE
      model.rf.9$results$RMSE
      model.rf.9$results$MAE
      model.rf.10$results$RMSE
      model.rf.10$results$MAE
      # model.rf.11$results$RMSE
      # model.rf.11$results$MAE
      # model.rf.RF$results$RMSE
      # model.rf.RF$results$MAE
      #===
      model.gaussprRadial.3 <- train(Cl.ob ~ .,data = train.c3, method = 'gaussprRadial')
      model.gaussprRadial.4 <- train(Cl.ob ~ .,data = train.c4, method = 'gaussprRadial')
      model.gaussprRadial.5 <- train(Cl.ob ~ .,data = train.c5, method = 'gaussprRadial')
      model.gaussprRadial.6 <- train(Cl.ob ~ .,data = train.c6, method = 'gaussprRadial')
      model.gaussprRadial.7 <- train(Cl.ob ~ .,data = train.c7, method = 'gaussprRadial')
      model.gaussprRadial.8 <- train(Cl.ob ~ .,data = train.c8, method = 'gaussprRadial')
      model.gaussprRadial.9 <- train(Cl.ob ~ .,data = train.c9, method = 'gaussprRadial')
      model.gaussprRadial.10 <- train(Cl.ob ~ .,data = train.c10, method = 'gaussprRadial')
      # model.gaussprRadial.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'gaussprRadial')
      # model.gaussprRadial.GR <- train(NH3.N.ob ~ .,data = train.GR, method = 'gaussprRadial')
      
      model.gaussprRadial.3$results$RMSE
      model.gaussprRadial.3$results$MAE
      model.gaussprRadial.4$results$RMSE
      model.gaussprRadial.4$results$MAE
      model.gaussprRadial.5$results$RMSE
      model.gaussprRadial.5$results$MAE
      model.gaussprRadial.6$results$RMSE
      model.gaussprRadial.6$results$MAE
      model.gaussprRadial.7$results$RMSE
      model.gaussprRadial.7$results$MAE
      model.gaussprRadial.8$results$RMSE
      model.gaussprRadial.8$results$MAE
      model.gaussprRadial.9$results$RMSE
      model.gaussprRadial.9$results$MAE
      model.gaussprRadial.10$results$RMSE
      model.gaussprRadial.10$results$MAE
      # model.gaussprRadial.11$results$RMSE
      # model.gaussprRadial.11$results$MAE
      # model.gaussprRadial.GR$results$RMSE
      # model.gaussprRadial.GR$results$MAE
      #===
      model.svmRadial.3 <- train(Cl.ob ~ .,data = train.c3, method = 'svmRadial')
      model.svmRadial.4 <- train(Cl.ob ~ .,data = train.c4, method = 'svmRadial')
      model.svmRadial.5 <- train(Cl.ob ~ .,data = train.c5, method = 'svmRadial')
      model.svmRadial.6 <- train(Cl.ob ~ .,data = train.c6, method = 'svmRadial')
      model.svmRadial.7 <- train(Cl.ob ~ .,data = train.c7, method = 'svmRadial')
      model.svmRadial.8 <- train(Cl.ob ~ .,data = train.c8, method = 'svmRadial')
      model.svmRadial.9 <- train(Cl.ob ~ .,data = train.c9, method = 'svmRadial')
      model.svmRadial.10 <- train(Cl.ob ~ .,data = train.c10, method = 'svmRadial')
      # model.svmRadial.11 <- train(NH3.N.ob ~ .,data = train.c11, method = 'svmRadial')
      # model.svmRadial.SR <- train(NH3.N.ob ~ .,data = train.SR, method = 'svmRadial')
      
      model.svmRadial.3$results$RMSE
      model.svmRadial.3$results$MAE
      model.svmRadial.4$results$RMSE
      model.svmRadial.4$results$MAE
      model.svmRadial.5$results$RMSE
      model.svmRadial.5$results$MAE
      model.svmRadial.6$results$RMSE
      model.svmRadial.6$results$MAE
      model.svmRadial.7$results$RMSE
      model.svmRadial.7$results$MAE
      model.svmRadial.8$results$RMSE
      model.svmRadial.8$results$MAE
      model.svmRadial.9$results$RMSE
      model.svmRadial.9$results$MAE
      model.svmRadial.10$results$RMSE
      model.svmRadial.10$results$MAE
      # model.svmRadial.11$results$RMSE
      # model.svmRadial.11$results$MAE
      # model.svmRadial.SR$results$RMSE
      # model.svmRadial.SR$results$MAE
    }
    #===
    model.cp <- data.frame(Case = c("Rf.3","Rf.4","Rf.5","Rf.6","Rf.7","Rf.8","Rf.9","Rf.10",
                                    "Gaussian Radial.3","Gaussian Radial.4","Gaussian Radial.5","Gaussian Radial.6","Gaussian Radial.7","Gaussian Radial.8","Gaussian Radial.9","Gaussian Radial.10",
                                    "SVM Radial.3","SVM Radial.4","SVM Radial.5","SVM Radial.6","SVM Radial.7","SVM Radial.8","SVM Radial.9","SVM Radial.10"),
                           RMSE = c(model.rf.3$results$RMSE[1],model.rf.4$results$RMSE[1],model.rf.5$results$RMSE[1],model.rf.6$results$RMSE[1],model.rf.7$results$RMSE[1],model.rf.8$results$RMSE[1],model.rf.9$results$RMSE[1],model.rf.10$results$RMSE[1],
                                    model.gaussprRadial.3$results$RMSE,model.gaussprRadial.4$results$RMSE,model.gaussprRadial.5$results$RMSE,model.gaussprRadial.6$results$RMSE,model.gaussprRadial.7$results$RMSE,model.gaussprRadial.8$results$RMSE,model.gaussprRadial.9$results$RMSE,model.gaussprRadial.10$results$RMSE,
                                    model.svmRadial.3$results$RMSE[1],model.svmRadial.4$results$RMSE[1],model.svmRadial.5$results$RMSE[1],model.svmRadial.6$results$RMSE[1],model.svmRadial.7$results$RMSE[1],model.svmRadial.8$results$RMSE[1],model.svmRadial.9$results$RMSE[1],model.svmRadial.10$results$RMSE[1]),
                           MAE = c(model.rf.3$results$MAE[1],model.rf.4$results$MAE[1],model.rf.5$results$MAE[1],model.rf.6$results$MAE[1],model.rf.7$results$MAE[1],model.rf.8$results$MAE[1],model.rf.9$results$MAE[1],model.rf.10$results$MAE[1],
                                   model.gaussprRadial.3$results$MAE,model.gaussprRadial.4$results$MAE,model.gaussprRadial.5$results$MAE,model.gaussprRadial.6$results$MAE,model.gaussprRadial.7$results$MAE,model.gaussprRadial.8$results$MAE,model.gaussprRadial.9$results$MAE,model.gaussprRadial.10$results$MAE,
                                   model.svmRadial.3$results$MAE[1],model.svmRadial.4$results$MAE[1],model.svmRadial.5$results$MAE[1],model.svmRadial.6$results$MAE[1],model.svmRadial.7$results$MAE[1],model.svmRadial.8$results$MAE[1],model.svmRadial.9$results$MAE[1],model.svmRadial.10$results$MAE[1]))
    model.cp$i <- i
    datalist[[i]] <- model.cp
  }
  MFselect = do.call(rbind, datalist)
  # write.csv(MFselect, file = "안성.Cl,F&A(ob).csv", na="-", fileEncoding = "CP949")
  MFselect.t = read.csv("안성.Cl,F&A(ob).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
  
  { 
    MFselect.t.G = subset(MFselect.t, MFselect.t$Model== "Gaussian Radial")
    MFselect.t.G.3 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.3")
    MFselect.t.G.4 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.4")
    MFselect.t.G.5 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.5")
    MFselect.t.G.6 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.6")
    MFselect.t.G.7 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.7")
    MFselect.t.G.8 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.8")
    MFselect.t.G.9 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.9")
    MFselect.t.G.10 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.10")
    # MFselect.t.G.11 = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.11")
    # MFselect.t.G.GR = subset(MFselect.t.G, MFselect.t.G$Case== "Gaussian Radial.GR")
    
    MFselect.t.R = subset(MFselect.t, MFselect.t$Model== "Randomforest")
    MFselect.t.R.3 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.3")
    MFselect.t.R.4 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.4")
    MFselect.t.R.5 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.5")
    MFselect.t.R.6 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.6")
    MFselect.t.R.7 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.7")
    MFselect.t.R.8 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.8")
    MFselect.t.R.9 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.9")
    MFselect.t.R.10 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.10")
    # MFselect.t.R.11 = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.11")
    # MFselect.t.R.RF = subset(MFselect.t.R, MFselect.t.R$Case== "Rf.RF")
    
    MFselect.t.S = subset(MFselect.t, MFselect.t$Model== "SVM Radial")
    MFselect.t.S.3 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.3")
    MFselect.t.S.4 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.4")
    MFselect.t.S.5 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.5")
    MFselect.t.S.6 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.6")
    MFselect.t.S.7 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.7")
    MFselect.t.S.8 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.8")
    MFselect.t.S.9 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.9")
    MFselect.t.S.10 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.10")
    # MFselect.t.S.11 = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.11")
    # MFselect.t.S.SR = subset(MFselect.t.S, MFselect.t.S$Case== "SVM Radial.SR")
  }
  {  
    summary(MFselect.t.G.3)
    summary(MFselect.t.G.4)
    summary(MFselect.t.G.5)
    summary(MFselect.t.G.6)
    summary(MFselect.t.G.7)
    summary(MFselect.t.G.8)
    summary(MFselect.t.G.9)
    # summary(MFselect.t.G.10)
    # summary(MFselect.t.G.11)
    # summary(MFselect.t.G.GR)
    
    summary(MFselect.t.R.3)
    summary(MFselect.t.R.4)
    summary(MFselect.t.R.5)
    summary(MFselect.t.R.6)
    summary(MFselect.t.R.7)
    summary(MFselect.t.R.8)
    summary(MFselect.t.R.9)
    # summary(MFselect.t.R.10)
    # summary(MFselect.t.R.11)
    # summary(MFselect.t.R.RF)
    
    summary(MFselect.t.S.3)
    summary(MFselect.t.S.4)
    summary(MFselect.t.S.5)
    summary(MFselect.t.S.6)
    summary(MFselect.t.S.7)
    summary(MFselect.t.S.8)
    summary(MFselect.t.S.9)
    # summary(MFselect.t.S.10)
    # summary(MFselect.t.S.11)
    # summary(MFselect.t.S.SR)
  }
  {
    MFselect.t = read.csv("안성.Cl,F&A(ob).csv", na="-", fileEncoding = "CP949", encoding = "UTF-8")
    head(MFselect.t)
    MFselect.t = MFselect.t[c(1,3,4,6)]
    head(MFselect.t)
    MFselect.t$Feature = as.character(MFselect.t$Feature)
  }
  {
    MFselect.t$Model <- factor(MFselect.t$Model, levels = c("Gaussian Radial", "Randomforest", "SVM Radial"))
    
    MFselect.t$Feature <- factor(MFselect.t$Feature, levels = c("3","4","5","6","7","8","9","10"))
    
    Feature.plot <- ggplot(data = MFselect.t, aes(x = Feature, y = RMSE, fill = Feature, group = Feature)) +
      geom_boxplot(outlier.colour = NA)+
      theme_bw() + #plot 영역에 박스, 배경제거
      theme(legend.position = c(""),
            strip.background =element_rect(fill="white"),
            strip.text = element_text(size = 25, face = "bold"),
            panel.grid.minor = element_blank(),
            panel.grid.major = element_blank(),# panel.grid.minor는 보조 구분선
            plot.title = element_text(size = 30),
            axis.title.x = element_text(size=20),
            axis.text.x = element_text(size=20),
            axis.title.y = element_text(size=20),
            axis.text.y = element_text(size=20)) +
      ggtitle("Feature & Algorithm Selection for Cl- prediction (ob)") +
      ylab("RMSE")+xlab("Number of Parameters")+
      # scale_fill_manual(values = c("red3", "orange2", "dodgerblue3", "green4", "purple", "deeppink3"))+
      facet_grid(~Model, scales = "free", space = "free")+
      geom_hline(yintercept = 15.09, color = "red", lty = "dashed", size = 0.8)
    
    # scale_fill_manual(values = c("red2", "red4", "orange", "orange3", "dodgerblue3", "dodgerblue4","green2", "green4"))
    Feature.plot
  }
  
  d=set_palette(Feature.plot, "Set1")
}
d
#SVM Radial + 3(DO, NO3-N, ORP)
#===============================================================================
#Model 만들기 ML
#NH3-N
{
  head(x34568)
  obdata = x34568[c(2,3:10,12:14)]
  {obdata$NO3.N.ob[obdata$NO3.N.ob %in% "NA"] <- NA}
  head(obdata)
  obdata = obdata[complete.cases(obdata), ]
  head(obdata)
  {
    #Data for model
    obdata.NH3.N = obdata[c(1,10,6,11,9,2)]
    head(obdata.NH3.N)
    mset = obdata.NH3.N
    head(mset)
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train <- train[-1]
    test  <- test[-1]
    head(train)
    head(test)
    
    wellA = subset(mset, mset$Site == "Site3")
    wellB = subset(mset, mset$Site == "Site4")
    wellC = subset(mset, mset$Site == "Site5")
    wellD = subset(mset, mset$Site == "Site6")
    wellE = subset(mset, mset$Site == "Site8")
  }
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # fitControl <- trainControl(method = "LOOCV", number = 10)
  # NH3.N.svmRadial.tuned = train(NH3.N.ob ~ ., data = train, method = 'svmRadial', trControl = fitControl, preProcess = c("center", "scale"),
  #                               tuneGrid = expand.grid(sigma = c(5:10), C = c(0.1,0.25,0.5,0.75,1)))
  # NH3.N.svmRadial.tuned
  # saveRDS(NH3.N.svmRadial.tuned, "안성통합.NH3.N.svmRadial(ob).tuned.rds")
  NH3.N.svmRadial.tuned = readRDS("안성통합.NH3.N.svmRadial(ob).tuned.rds")
  NH3.N.svmRadial.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, test[2:5])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, mset[3:6])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, wellA[c(3:6)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(wellA$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, wellB[c(3:6)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(wellB$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, wellC[c(3:6)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(wellC$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, wellD[c(3:6)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(wellD$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.svmRadial.tuned, wellE[c(3:6)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(wellE$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
  }
  
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  {
    
    plot17 = cbind(mset$Site, NH3.N.tuned.mset)
    plot17 = as.data.frame(plot17)
    {
      names(plot17)[1] <- c("Site")
      names(plot17)[2] <- c("NH3.N.ob")
      names(plot17)[3] <- c("NH3.N.tuned.mset")
    }
    head(plot17)
    
    a = as.vector(t(plot17[3]))
    b = as.vector(t(plot17[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    plot.17 = ggplot(plot17, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (laboratory_analyzed)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.17
    
    plot17.3 = subset(plot17, plot17$Site == "Site3")
    plot.17.3 = ggplot(plot17.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.17.3
    
    plot17.4 = subset(plot17, plot17$Site == "Site4")
    plot.17.4 = ggplot(plot17.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.17.4
    
    plot17.5 = subset(plot17, plot17$Site == "Site5")
    plot.17.5 = ggplot(plot17.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.17.5
    
    plot17.6 = subset(plot17, plot17$Site == "Site6")
    plot.17.6 = ggplot(plot17.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.17.6
    
    plot17.8 = subset(plot17, plot17$Site == "Site8")
    plot.17.8 = ggplot(plot17.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.17.8
  }
}
# plot17 = ob(NH3-N)+ML
#===============
#Cl
{
  head(x34568)
  obdata = x34568[c(2,3:10,12:14)]
  {obdata$NO3.N.ob[obdata$NO3.N.ob %in% "NA"] <- NA}
  head(obdata)
  obdata = obdata[complete.cases(obdata), ]
  head(obdata)
  {
    #Data for model
    obdata.Cl = obdata[c(1,12,7,11,5)]
    head(obdata.Cl)
    mset = obdata.Cl
    head(mset)
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train <- train[-1]
    test  <- test[-1]
    head(train)
    head(test)
    
    wellA = subset(mset, mset$Site == "Site3")
    wellB = subset(mset, mset$Site == "Site4")
    wellC = subset(mset, mset$Site == "Site5")
    wellD = subset(mset, mset$Site == "Site6")
    wellE = subset(mset, mset$Site == "Site8")
  }
  
  #Tuned(모델 생성)
  # fitControl <- trainControl(method = "repeatedcv", number = 10, repeats = 3)
  # fitControl <- trainControl(method = "LOOCV", number = 10)
  # Cl.svmRadial.tuned = train(Cl.ob ~ ., data = train, method = 'svmRadial', trControl = fitControl, preProcess = c("center", "scale"),
  #                               tuneGrid = expand.grid(sigma = c(5:10), C = c(0.1,0.25,0.5,0.75,1)))
  # Cl.svmRadial.tuned
  # saveRDS(Cl.svmRadial.tuned, "안성통합.Cl.svmRadial(ob).tuned.rds")
  Cl.svmRadial.tuned = readRDS("안성통합.Cl.svmRadial(ob).tuned.rds")
  Cl.svmRadial.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, test[2:4])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, mset[3:5])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, wellA[c(3:5)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(wellA$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, wellB[c(3:5)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(wellB$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, wellC[c(3:5)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(wellC$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, wellD[c(3:5)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(wellD$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.svmRadial.tuned, wellE[c(3:5)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(wellE$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  #Plotting
  #plot18 = ob(Cl)+ML
  {
    #2 Versions -> default + tuned + ob / pp + calibrated + ob
    plot18 = cbind(mset$Site, Cl.tuned.mset)
    plot18 = as.data.frame(plot18)
    {
      names(plot18)[1] <- c("Site")
      names(plot18)[2] <- c("Cl.ob")
      names(plot18)[3] <- c("Cl.tuned.mset")
    }
    head(plot18)
    
    a = as.vector(t(plot18[3]))
    b = as.vector(t(plot18[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.18 = ggplot(plot18, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Total well / Cl o)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.18
    
    plot18.3 = subset(plot18, plot18$Site == "Site3")
    plot.18.3 = ggplot(plot18.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.18.3
    
    plot18.4 = subset(plot18, plot18$Site == "Site4")
    plot.18.4 = ggplot(plot18.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.18.4
    
    plot18.5 = subset(plot18, plot18$Site == "Site5")
    plot.18.5 = ggplot(plot18.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.18.5
    
    plot18.6 = subset(plot18, plot18$Site == "Site6")
    plot.18.6 = ggplot(plot18.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.18.6
    
    plot18.8 = subset(plot18, plot18$Site == "Site8")
    plot.18.8 = ggplot(plot18.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.18.8
  }
}
# plot18 = ob(Cl)+ML
#===============================================================================
#Model 만들기 AutoML
#NH3-N
# {
#   "class_name": "RandomForestRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": true,
#     "criterion": "mae",
#     "max_features": "sqrt",
#     "min_samples_leaf": 0.01091729022778783,
#     "min_samples_split": 0.07532221397586239,
#     "n_estimators": 25
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  head(x34568)
  obdata = x34568[c(2,3:10,12:14)]
  {obdata$NO3.N.ob[obdata$NO3.N.ob %in% "NA"] <- NA}
  head(obdata)
  obdata = obdata[complete.cases(obdata), ]
  head(obdata)
  {
    #Data for model
    obdata.NH3.N = obdata[c(1,10,6,11,9,2)]
    head(obdata.NH3.N)
    mset = obdata.NH3.N
    head(mset)
    inTraining <- createDataPartition(mset$NH3.N.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train <- train[-1]
    test  <- test[-1]
    head(train)
    head(test)
    
    wellA = subset(mset, mset$Site == "Site3")
    wellB = subset(mset, mset$Site == "Site4")
    wellC = subset(mset, mset$Site == "Site5")
    wellD = subset(mset, mset$Site == "Site6")
    wellE = subset(mset, mset$Site == "Site8")
  }
  ??randomforest
  # model <- randomForest(NH3.N.ob ~ .,
  #                       data = train,
  #                       min_samples_leaf = 0.01091729022778783,
  #                       min_samples_split = 0.07532221397586239)
  # saveRDS(model, "안성통합.AutoML(RF).NH3-N(ob)(1).tuned.rds")
  NH3.N.rf.tuned = readRDS("안성통합.AutoML(RF).NH3-N(ob)(1).tuned.rds")
  NH3.N.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, test[2:5])
    NH3.N.tuned.test =as.data.frame (pv)
    head(NH3.N.tuned.test)
    names(NH3.N.tuned.test)[1] <- c("NH3.N.tuned.test")
    NH3.N.tuned.test = cbind(test$NH3.N.ob, NH3.N.tuned.test$NH3.N.tuned.test)
    NH3.N.tuned.test = as.data.frame(NH3.N.tuned.test)
    head(NH3.N.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, mset[3:6])
    NH3.N.tuned.mset =as.data.frame (pv)
    head(NH3.N.tuned.mset)
    names(NH3.N.tuned.mset)[1] <- c("NH3.N.tuned.mset")
    head(NH3.N.tuned.mset)
    NH3.N.tuned.mset = cbind(mset$NH3.N.ob, NH3.N.tuned.mset$NH3.N.tuned.mset)
    NH3.N.tuned.mset = as.data.frame(NH3.N.tuned.mset)
    head(NH3.N.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellA[c(3,4,5,6)])
    NH3.N.tuned.Well3 =as.data.frame (pv)
    head(NH3.N.tuned.Well3)
    names(NH3.N.tuned.Well3)[1] <- c("NH3.N.tuned.Well3")
    head(NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = cbind(wellA$NH3.N.ob, NH3.N.tuned.Well3$NH3.N.tuned.Well3)
    NH3.N.tuned.Well3 = as.data.frame(NH3.N.tuned.Well3)
    head(NH3.N.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellB[c(3,4,5,6)])
    NH3.N.tuned.Well4 =as.data.frame (pv)
    head(NH3.N.tuned.Well4)
    names(NH3.N.tuned.Well4)[1] <- c("NH3.N.tuned.Well4")
    head(NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = cbind(wellB$NH3.N.ob, NH3.N.tuned.Well4$NH3.N.tuned.Well4)
    NH3.N.tuned.Well4 = as.data.frame(NH3.N.tuned.Well4)
    head(NH3.N.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellC[c(3,4,5,6)])
    NH3.N.tuned.Well5 =as.data.frame (pv)
    head(NH3.N.tuned.Well5)
    names(NH3.N.tuned.Well5)[1] <- c("NH3.N.tuned.Well5")
    head(NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = cbind(wellC$NH3.N.ob, NH3.N.tuned.Well5$NH3.N.tuned.Well5)
    NH3.N.tuned.Well5 = as.data.frame(NH3.N.tuned.Well5)
    head(NH3.N.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellD[c(3,4,5,6)])
    NH3.N.tuned.Well6 =as.data.frame (pv)
    head(NH3.N.tuned.Well6)
    names(NH3.N.tuned.Well6)[1] <- c("NH3.N.tuned.Well6")
    head(NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = cbind(wellD$NH3.N.ob, NH3.N.tuned.Well6$NH3.N.tuned.Well6)
    NH3.N.tuned.Well6 = as.data.frame(NH3.N.tuned.Well6)
    head(NH3.N.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(NH3.N.rf.tuned, wellE[c(3,4,5,6)])
    NH3.N.tuned.Well8 =as.data.frame (pv)
    head(NH3.N.tuned.Well8)
    names(NH3.N.tuned.Well8)[1] <- c("NH3.N.tuned.Well8")
    head(NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = cbind(wellE$NH3.N.ob, NH3.N.tuned.Well8$NH3.N.tuned.Well8)
    NH3.N.tuned.Well8 = as.data.frame(NH3.N.tuned.Well8)
    head(NH3.N.tuned.Well8)
  }
  #R^2
  lm1 = lm(V2 ~ V1, NH3.N.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, NH3.N.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  
  # plot19 = ob(NH3-N)+AutoML
  
  {
    plot19 = cbind(mset$Site, NH3.N.tuned.mset)
    plot19 = as.data.frame(plot19)
    {
      names(plot19)[1] <- c("Site")
      names(plot19)[2] <- c("NH3.N.ob")
      names(plot19)[3] <- c("NH3.N.tuned.mset")
    }
    head(plot19)
    
    a = as.vector(t(plot19[3]))
    b = as.vector(t(plot19[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    plot.19 = ggplot(plot19, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (laboratory_analyzed)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.19
    
    plot19.3 = subset(plot19, plot19$Site == "Site3")
    plot.19.3 = ggplot(plot19.3, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.19.3
    
    plot19.4 = subset(plot19, plot19$Site == "Site4")
    plot.19.4 = ggplot(plot19.4, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.19.4
    
    plot19.5 = subset(plot19, plot19$Site == "Site5")
    plot.19.5 = ggplot(plot19.5, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.19.5
    
    plot19.6 = subset(plot19, plot19$Site == "Site6")
    plot.19.6 = ggplot(plot19.6, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.19.6
    
    plot19.8 = subset(plot19, plot19$Site == "Site8")
    plot.19.8 = ggplot(plot19.8, aes(x=NH3.N.ob))+
      geom_point(aes(y=NH3.N.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("NH3-N (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.19.8
  }
}
# plot19 = ob(NH3-N)+AutoML
#===============
#Cl
# {
#   "class_name": "ExtraTreesRegressor",
#   "module": "sklearn.ensemble",
#   "param_args": [],
#   "param_kwargs": {
#     "bootstrap": true,
#     "criterion": "mae",
#     "max_features": 0.6,
#     "min_samples_leaf": 0.02840067375118317,
#     "min_samples_split": 0.10734188827013527,
#     "n_estimators": 25
#   },
#   "prepared_kwargs": {},
#   "spec_class": "sklearn"
# }
{
  head(x34568)
  obdata = x34568[c(2,3:10,12:14)]
  {obdata$NO3.N.ob[obdata$NO3.N.ob %in% "NA"] <- NA}
  head(obdata)
  obdata = obdata[complete.cases(obdata), ]
  head(obdata)
  {
    #Data for model
    obdata.Cl = obdata[c(1,12,7,11,5)]
    head(obdata.Cl)
    mset = obdata.Cl
    head(mset)
    inTraining <- createDataPartition(mset$Cl.ob, p = .7, list = FALSE)
    train <- mset[ inTraining,]
    test  <- mset[-inTraining,]
    train <- train[-1]
    test  <- test[-1]
    head(train)
    head(test)
    
    wellA = subset(mset, mset$Site == "Site3")
    wellB = subset(mset, mset$Site == "Site4")
    wellC = subset(mset, mset$Site == "Site5")
    wellD = subset(mset, mset$Site == "Site6")
    wellE = subset(mset, mset$Site == "Site8")
  }
  
  # model <- ranger(Cl.ob ~ ., data = train, num.trees = 25, mtry = 0.6,
  #                 splitrule = "extratrees", min.node.size = 0.02840067375118317, min.split.size  = 0.10734188827013527)
  # model
  # saveRDS(model, "안성통합.AutoML(Extratrees).Cl(ob).tuned.rds")
  Cl.rf.tuned = readRDS("안성통합.AutoML(Extratrees).Cl(ob).tuned.rds")
  Cl.rf.tuned
  
  {
    #Tuned
    #test(test 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, test[2:4])
    Cl.tuned.test =as.data.frame (pv)
    head(Cl.tuned.test)
    names(Cl.tuned.test)[1] <- c("Cl.tuned.test")
    Cl.tuned.test = cbind(test$Cl.ob, Cl.tuned.test$Cl.tuned.test)
    Cl.tuned.test = as.data.frame(Cl.tuned.test)
    head(Cl.tuned.test)
    
    #mset(mset 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, mset[3:5])
    Cl.tuned.mset =as.data.frame (pv)
    head(Cl.tuned.mset)
    names(Cl.tuned.mset)[1] <- c("Cl.tuned.mset")
    head(Cl.tuned.mset)
    Cl.tuned.mset = cbind(mset$Cl.ob, Cl.tuned.mset$Cl.tuned.mset)
    Cl.tuned.mset = as.data.frame(Cl.tuned.mset)
    head(Cl.tuned.mset)
    
    #Well3(Well3 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellA[c(3:5)])
    Cl.tuned.Well3 =as.data.frame (pv)
    head(Cl.tuned.Well3)
    names(Cl.tuned.Well3)[1] <- c("Cl.tuned.Well3")
    head(Cl.tuned.Well3)
    Cl.tuned.Well3 = cbind(wellA$Cl.ob, Cl.tuned.Well3$Cl.tuned.Well3)
    Cl.tuned.Well3 = as.data.frame(Cl.tuned.Well3)
    head(Cl.tuned.Well3)
    
    #Well4(Well4 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellB[c(3:5)])
    Cl.tuned.Well4 =as.data.frame (pv)
    head(Cl.tuned.Well4)
    names(Cl.tuned.Well4)[1] <- c("Cl.tuned.Well4")
    head(Cl.tuned.Well4)
    Cl.tuned.Well4 = cbind(wellB$Cl.ob, Cl.tuned.Well4$Cl.tuned.Well4)
    Cl.tuned.Well4 = as.data.frame(Cl.tuned.Well4)
    head(Cl.tuned.Well4)
    
    #Well5(Well5 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellC[c(3:5)])
    Cl.tuned.Well5 =as.data.frame (pv)
    head(Cl.tuned.Well5)
    names(Cl.tuned.Well5)[1] <- c("Cl.tuned.Well5")
    head(Cl.tuned.Well5)
    Cl.tuned.Well5 = cbind(wellC$Cl.ob, Cl.tuned.Well5$Cl.tuned.Well5)
    Cl.tuned.Well5 = as.data.frame(Cl.tuned.Well5)
    head(Cl.tuned.Well5)
    
    #Well6(Well6 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellD[c(3:5)])
    Cl.tuned.Well6 =as.data.frame (pv)
    head(Cl.tuned.Well6)
    names(Cl.tuned.Well6)[1] <- c("Cl.tuned.Well6")
    head(Cl.tuned.Well6)
    Cl.tuned.Well6 = cbind(wellD$Cl.ob, Cl.tuned.Well6$Cl.tuned.Well6)
    Cl.tuned.Well6 = as.data.frame(Cl.tuned.Well6)
    head(Cl.tuned.Well6)
    
    #Well8(Well8 예측 데이터 생성)
    pv=predict(Cl.rf.tuned, wellE[c(3:5)])
    Cl.tuned.Well8 =as.data.frame (pv)
    head(Cl.tuned.Well8)
    names(Cl.tuned.Well8)[1] <- c("Cl.tuned.Well8")
    head(Cl.tuned.Well8)
    Cl.tuned.Well8 = cbind(wellE$Cl.ob, Cl.tuned.Well8$Cl.tuned.Well8)
    Cl.tuned.Well8 = as.data.frame(Cl.tuned.Well8)
    head(Cl.tuned.Well8)
  }
  
  #R^2
  lm1 = lm(V2 ~ V1, Cl.tuned.test) #튜닝 한거 + test
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.mset) #튜닝 한거 + (train+test)
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well3) #튜닝 한거 + 관정3
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well4) #튜닝 한거 + 관정4
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well5) #튜닝 한거 + 관정5
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well6) #튜닝 한거 + 관정6
  summary(lm1)
  lm1 = lm(V2 ~ V1, Cl.tuned.Well8) #튜닝 한거 + 관정8
  summary(lm1)
  # plot20 = ob(Cl)+AutoML
  
  #Plotting
  {
    plot20 = cbind(mset$Site, Cl.tuned.mset)
    plot20 = as.data.frame(plot20)
    {
      names(plot20)[1] <- c("Site")
      names(plot20)[2] <- c("Cl.ob")
      names(plot20)[3] <- c("Cl.tuned.mset")
    }
    head(plot20)
    
    a = as.vector(t(plot20[3]))
    b = as.vector(t(plot20[2]))
    
    MAE(a,b)
    RMSE(a,b)
    
    # scaleFactor = max(plot1$TPH.ob/max(plot1$TPH.ob))
    plot.20 = ggplot(plot20, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Total well / Cl o)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.20
    
    plot20.3 = subset(plot20, plot20$Site == "Site3")
    plot.20.3 = ggplot(plot20.3, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 3)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.20.3
    
    plot20.4 = subset(plot20, plot20$Site == "Site4")
    plot.20.4 = ggplot(plot20.4, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 4)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.20.4
    
    plot20.5 = subset(plot20, plot20$Site == "Site5")
    plot.20.5 = ggplot(plot20.5, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 5)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.20.5
    
    plot20.6 = subset(plot20, plot20$Site == "Site6")
    plot.20.6 = ggplot(plot20.6, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 6)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.20.6
    
    plot20.8 = subset(plot20, plot20$Site == "Site8")
    plot.20.8 = ggplot(plot20.8, aes(x=Cl.ob))+
      geom_point(aes(y=Cl.tuned.mset), size = 3, col = "springgreen4")+
      geom_smooth(aes(y=Cl.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
      theme_bw()+
      theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
            axis.title.x = element_text(size=25),
            axis.title.y = element_text(size=25),
            axis.text.x = element_text(size=25),
            axis.text.y = element_text(size=25),
            plot.title = element_text(size = 25))+
      theme(
        axis.title.y.left=element_text(color="springgreen4"),
        axis.text.y.left=element_text(color="springgreen4"),
      )+
      ggtitle("Cl (Well 8)") + 
      labs(x='Observed', y='Predicted')+
      theme(strip.background =element_rect(fill="white")) +
      theme(legend.position="none")# + xlim(1.5,3.1) + ylim(1.5,3.1)
    plot.20.8
  }
}
# plot20 = ob(Cl)+AutoML
#===============================================================================
#plot1 = Ca(NH3-N o) + ML
#plot2 = Ca(NH3-N x) + ML

#plot5 = Ca(NH3-N o)+증강+ML
#plot6 = Ca(NH3-N x)+증강+ML

#plot9 = Ca(NH3-N o)+AutoML
#plot10 = Ca(NH3-N x)+AutoML

#plot13 = Ca(NH3-N o)+증강+AutoML
#plot14 = Ca(NH3-N x)+증강+AutoML

#plot17 = ob(NH3-N)+ML

#plot19 = ob(NH3-N)+AutoML
#===============================================================================
#최종 Figure
{
  head(plot1)
  head(plot2)
  head(plot3)
  head(plot4)
  head(plot5)
  head(plot6)
  head(plot7)
  head(plot8)
  head(plot9)
  head(plot10)
  head(plot11)
  head(plot12)
  head(plot13)
  head(plot14)
  head(plot15)
  head(plot16)
  
  plot1.3 = subset(plot1, plot1$Site == "Site3")
  plot1.4 = subset(plot1, plot1$Site == "Site4")
  plot1.5 = subset(plot1, plot1$Site == "Site5")
  plot1.6 = subset(plot1, plot1$Site == "Site6")
  plot1.8 = subset(plot1, plot1$Site == "Site8")
  
  plot2.3 = subset(plot2, plot2$Site == "Site3")
  plot2.4 = subset(plot2, plot2$Site == "Site4")
  plot2.5 = subset(plot2, plot2$Site == "Site5")
  plot2.6 = subset(plot2, plot2$Site == "Site6")
  plot2.8 = subset(plot2, plot2$Site == "Site8")
  
  plot3.3 = subset(plot3, plot3$Site == "Site3")
  plot3.4 = subset(plot3, plot3$Site == "Site4")
  plot3.5 = subset(plot3, plot3$Site == "Site5")
  plot3.6 = subset(plot3, plot3$Site == "Site6")
  plot3.8 = subset(plot3, plot3$Site == "Site8")
  
  plot4.3 = subset(plot4, plot4$Site == "Site3")
  plot4.4 = subset(plot4, plot4$Site == "Site4")
  plot4.5 = subset(plot4, plot4$Site == "Site5")
  plot4.6 = subset(plot4, plot4$Site == "Site6")
  plot4.8 = subset(plot4, plot4$Site == "Site8")
  
  plot5.3 = subset(plot5, plot5$Site == "Site3")
  plot5.4 = subset(plot5, plot5$Site == "Site4")
  plot5.5 = subset(plot5, plot5$Site == "Site5")
  plot5.6 = subset(plot5, plot5$Site == "Site6")
  plot5.8 = subset(plot5, plot5$Site == "Site8")
  
  plot6.3 = subset(plot6, plot6$Site == "Site3")
  plot6.4 = subset(plot6, plot6$Site == "Site4")
  plot6.5 = subset(plot6, plot6$Site == "Site5")
  plot6.6 = subset(plot6, plot6$Site == "Site6")
  plot6.8 = subset(plot6, plot6$Site == "Site8")
  
  plot7.3 = subset(plot7, plot7$Site == "Site3")
  plot7.4 = subset(plot7, plot7$Site == "Site4")
  plot7.5 = subset(plot7, plot7$Site == "Site5")
  plot7.6 = subset(plot7, plot7$Site == "Site6")
  plot7.8 = subset(plot7, plot7$Site == "Site8")
  
  plot8.3 = subset(plot8, plot8$Site == "Site3")
  plot8.4 = subset(plot8, plot8$Site == "Site4")
  plot8.5 = subset(plot8, plot8$Site == "Site5")
  plot8.6 = subset(plot8, plot8$Site == "Site6")
  plot8.8 = subset(plot8, plot8$Site == "Site8")
  
  plot9.3 = subset(plot9, plot9$Site == "Site3")
  plot9.4 = subset(plot9, plot9$Site == "Site4")
  plot9.5 = subset(plot9, plot9$Site == "Site5")
  plot9.6 = subset(plot9, plot9$Site == "Site6")
  plot9.8 = subset(plot9, plot9$Site == "Site8")
  
  plot10.3 = subset(plot10, plot10$Site == "Site3")
  plot10.4 = subset(plot10, plot10$Site == "Site4")
  plot10.5 = subset(plot10, plot10$Site == "Site5")
  plot10.6 = subset(plot10, plot10$Site == "Site6")
  plot10.8 = subset(plot10, plot10$Site == "Site8")
  
  plot11.3 = subset(plot11, plot11$Site == "Site3")
  plot11.4 = subset(plot11, plot11$Site == "Site4")
  plot11.5 = subset(plot11, plot11$Site == "Site5")
  plot11.6 = subset(plot11, plot11$Site == "Site6")
  plot11.8 = subset(plot11, plot11$Site == "Site8")
  
  plot12.3 = subset(plot12, plot12$Site == "Site3")
  plot12.4 = subset(plot12, plot12$Site == "Site4")
  plot12.5 = subset(plot12, plot12$Site == "Site5")
  plot12.6 = subset(plot12, plot12$Site == "Site6")
  plot12.8 = subset(plot12, plot12$Site == "Site8")
  
  plot13.3 = subset(plot13, plot13$Site == "Site3")
  plot13.4 = subset(plot13, plot13$Site == "Site4")
  plot13.5 = subset(plot13, plot13$Site == "Site5")
  plot13.6 = subset(plot13, plot13$Site == "Site6")
  plot13.8 = subset(plot13, plot13$Site == "Site8")
  
  plot14.3 = subset(plot14, plot14$Site == "Site3")
  plot14.4 = subset(plot14, plot14$Site == "Site4")
  plot14.5 = subset(plot14, plot14$Site == "Site5")
  plot14.6 = subset(plot14, plot14$Site == "Site6")
  plot14.8 = subset(plot14, plot14$Site == "Site8")
  
  plot15.3 = subset(plot15, plot15$Site == "Site3")
  plot15.4 = subset(plot15, plot15$Site == "Site4")
  plot15.5 = subset(plot15, plot15$Site == "Site5")
  plot15.6 = subset(plot15, plot15$Site == "Site6")
  plot15.8 = subset(plot15, plot15$Site == "Site8")
  
  plot16.3 = subset(plot16, plot16$Site == "Site3")
  plot16.4 = subset(plot16, plot16$Site == "Site4")
  plot16.5 = subset(plot16, plot16$Site == "Site5")
  plot16.6 = subset(plot16, plot16$Site == "Site6")
  plot16.8 = subset(plot16, plot16$Site == "Site8")
}
{
  ggplot()+
    geom_point(data = plot1, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "springgreen4", size =3) +
    geom_point(data = plot2, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "red2", size = 3) +
    geom_point(data = plot5, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "black", size = 3) +
    geom_point(data = plot6, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "dodgerblue3", size = 3) +
    geom_point(data = plot9, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "springgreen4", size =3) +
    geom_point(data = plot10, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "red2", size = 3) +
    geom_point(data = plot13, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "black", size = 3) +
    geom_point(data = plot14, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "dodgerblue3", size = 3) +
    geom_point(data = plot17, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "dodgerblue3", size = 3) +
    geom_point(data = plot19, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "dodgerblue3", size = 3) +
    geom_smooth(data = plot1, aes(x = NH3.N.ob, y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(data = plot2, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "red2", size =2) +
    geom_smooth(data = plot5, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "black", size =2) +
    geom_smooth(data = plot6, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "dodgerblue3", size =2) +
    geom_smooth(data = plot9, aes(x = NH3.N.ob, y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(data = plot10, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "red2", size =2) +
    geom_smooth(data = plot13, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "black", size =2) +
    geom_smooth(data = plot14, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "dodgerblue3", size =2) +
    geom_smooth(data = plot17, aes(x = NH3.N.ob, y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen4", size = 2) +
    geom_smooth(data = plot19, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "red2", size =2) +
    # scale_y_continuous(name = "Predicted TPH (Calibrated time series data)", sec.axis = sec_axis(~., name="Predicted TPH (Measured data)"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25)) +
    # theme(
    #   axis.title.y.left=element_text(color="springgreen4"),
    #   axis.text.y.left=element_text(color="springgreen4"),
    #   axis.title.y.right=element_text(color="red2"),
    #   axis.text.y.right=element_text(color="red2")
    # )+
    ggtitle("NH3-N (Total Well / N X)") + 
    labs(x='Observed NH3-N', y='Predicted NH3-N')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
  
  ggplot()+
    geom_point(data = plot1, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "springgreen", size =1) +
    # geom_point(data = plot2, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "red2", size = 3) +
    geom_point(data = plot5, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "springgreen4", size = 1) +
    # geom_point(data = plot6, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "dodgerblue3", size = 3) +
    geom_point(data = plot9, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "dodgerblue", size =1) +
    # geom_point(data = plot10, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "red2", size = 3) +
    geom_point(data = plot13, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "dodgerblue4", size = 1) +
    # geom_point(data = plot14, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "dodgerblue3", size = 3) +
    geom_point(data = plot17, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "red", size = 1) +
    geom_point(data = plot19, aes(x = NH3.N.ob, y = NH3.N.tuned.mset), color = "red4", size = 1) +
    geom_smooth(data = plot1, aes(x = NH3.N.ob, y=NH3.N.tuned.mset),method = "lm",se = F, col = "springgreen", size = 1) +
    # geom_smooth(data = plot2, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "red2", size =2) +
    geom_smooth(data = plot5, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "springgreen4", size =1) +
    # geom_smooth(data = plot6, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "dodgerblue3", size =2) +
    geom_smooth(data = plot9, aes(x = NH3.N.ob, y=NH3.N.tuned.mset),method = "lm",se = F, col = "dodgerblue", size = 1) +
    # geom_smooth(data = plot10, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "red2", size =2) +
    geom_smooth(data = plot13, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "dodgerblue4", size =1) +
    # geom_smooth(data = plot14, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "dodgerblue3", size =2) +
    geom_smooth(data = plot17, aes(x = NH3.N.ob, y=NH3.N.tuned.mset),method = "lm",se = F, col = "red", size = 1) +
    geom_smooth(data = plot19, aes(x=NH3.N.ob, y= NH3.N.tuned.mset),method = "lm", se = F, col = "red4", size =1) +
    # scale_y_continuous(name = "Predicted TPH (Calibrated time series data)", sec.axis = sec_axis(~., name="Predicted TPH (Measured data)"))+
    theme_bw()+
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          axis.title.x = element_text(size=25),
          axis.title.y = element_text(size=25),
          axis.text.x = element_text(size=25),
          axis.text.y = element_text(size=25),
          plot.title = element_text(size = 25)) +
    # theme(
    #   axis.title.y.left=element_text(color="springgreen4"),
    #   axis.text.y.left=element_text(color="springgreen4"),
    #   axis.title.y.right=element_text(color="red2"),
    #   axis.text.y.right=element_text(color="red2")
    # )+
    ggtitle("NH3-N (Total Well / N X)") + 
    labs(x='Observed NH3-N', y='Predicted NH3-N')+
    theme(strip.background =element_rect(fill="white")) +
    theme(legend.position="none")
}
#===============================================================================
#원센서데이터부터 품질관리, 보정, 예측 모델로 예측한 NH3-N 시계열 시각화
{
  #사용될 모든 재료 가져오기
  #원센서 데이터
  #품질관리된 데이터
  #보정된 데이터
  #예측 모델
  #예측 모델로 예측된 데이터
  
  as4 <- read_excel("센서데이터_안성_4번.xlsx")
  head(as4)
  as.f = as4[c(25155:199535),]
  as.f$timestamp = as.Date(as.f$timestamp)
  head(NH3.N.tuned.n4)
  
  p.NH3.N = ggplot() +
    geom_line(data = n4, aes(x = Date, y = NH3.N.pp), color = "dodgerblue2", size = 2) +
    geom_line(data = as.f, aes(x = timestamp, y = NH3.N), color = "black", size = 1, alpha=0.7) +
    geom_line(data = ca4, aes(x = Date, y = NH3.N.ca), color = "springgreen4", size = 2) +
    geom_line(data = NH3.N.tuned.n4, aes(x = Date, y = NH3.N.tuned.n4), color = "orange", size = 2) +
    geom_point(data = x4, aes(x = Date, y = NH3.N.ob), color = "red2", size = 3) +
    xlab('Date') +
    ylab(expression(NH[3]-N~(mg/L)))+
    #ylim(0,0.3)+ 
    theme(legend.text = element_text(size = 22))+
    theme(panel.background = element_rect(fill="white", color = "black"),
          axis.title.x = element_text(size=20),
          axis.text.x = element_text(size=25), axis.text.y = element_text(size=20),
          axis.title.y = element_text(size=25),
          plot.title = element_text(size = 30),
          legend.text = element_text(size = 25),
          legend.title = element_text(size = 28)) +
    ggtitle("Well B") + ylim(0,8)
  p.NH3.N
}
